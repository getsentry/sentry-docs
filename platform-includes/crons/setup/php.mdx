## Check-Ins (Recommended)

Check-in monitoring allows you to track a job's progress by completing two check-ins: one at the start of your job and another at the end of your job. This two-step process allows Sentry to notify you if your job didn't start when expected (missed) or if it exceeded its maximum runtime (failed).

```php
// 游리 Notify Sentry your job is running:
$checkInId = \Sentry\captureCheckIn(
    slug: '<monitor-slug>',
    status: CheckInStatus::inProgress()
);

// Execute your scheduled task here...

// 游릭 Notify Sentry your job has completed successfully:
\Sentry\captureCheckIn(
    slug: '<monitor-slug>',
    status: CheckInStatus::ok(),
    checkInId: $checkInId,
);
```

If your job execution fails, you can notify Sentry about the failure:

```php
// 游댮 Notify Sentry your job has failed:
\Sentry\captureCheckIn(
    slug: '<monitor-slug>',
    status: CheckInStatus::error(),
    checkInId: $checkInId,
);
```

Alternatively, you can use `withMonitor()` to monitor a callback.

```php
\Sentry\withMonitor(
    slug: '<monitor-slug>',
    callback: fn () => doSomething(),
);
```

This will create an `in-progress` check-in and either an `ok` or `error` check-in, depending on if your provided callback threw an exception.

## Heartbeat

Heartbeat monitoring notifies Sentry of a job's status through one check-in. This setup will only notify you if your job didn't start when expected (missed). If you need to track a job to see if it exceeded its maximum runtime (failed), use check-ins instead.

```php
// Execute your scheduled task...

// 游릭 Notify Sentry your job completed successfully:
\Sentry\captureCheckIn(
    slug: '<monitor-slug>',
    status: CheckInStatus::ok(),
    duration: 10, // Optional duration in seconds
);
```

If your job execution fails, you can:

```php
// 游댮 Notify Sentry your job has failed:
\Sentry\captureCheckIn(
    slug: '<monitor-slug>',
    status: CheckInStatus::error(),
    duration: 10, // Optional duration in seconds
);
```

## Upserting Cron Monitors

You can create and update your Monitors programmatically with code
rather than [creating and configuring them in Sentry.io](https://sentry.io/crons/create/).

```php
// Create a crontab schedule object (every 10 minutes)
$monitorSchedule = \Sentry\MonitorSchedule::crontab('*/10 * * * *');

// Or create an interval schedule object (every 10 minutes)
$monitorSchedule = \Sentry\MonitorSchedule::interval(10, MonitorScheduleUnit::minute());
```

Supported units are:

- `MonitorScheduleUnit::minute()`
- `MonitorScheduleUnit::hour()`
- `MonitorScheduleUnit::day()`
- `MonitorScheduleUnit::week()`
- `MonitorScheduleUnit::month()`
- `MonitorScheduleUnit::year()`

```php
// Create a config object
$monitorConfig = new \Sentry\MonitorConfig(
    $monitorSchedule,
    checkinMargin: 5, // Optional check-in margin in minutes
    maxRuntime: 15, // Optional max runtime in minutes
    timezone: 'Europe/Vienna', // Optional timezone
    failureIssueThreshold: 2 //Optional failure issue threshold
    recoveryThreshold: 5 // Optional recovery threshold
);

// 游리 Notify Sentry your job is running:
$checkInId = \Sentry\captureCheckIn(
    slug: '<monitor-slug>',
    status: CheckInStatus::inProgress(),
    monitorConfig: $monitorConfig,
);

// Execute your scheduled task here...

// 游릭 Notify Sentry your job has completed successfully:
\Sentry\captureCheckIn(
    slug: '<monitor-slug>',
    status: CheckInStatus::ok(),
    checkInId: $checkInId,
);
```
