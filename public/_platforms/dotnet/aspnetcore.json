{"key":"dotnet.aspnetcore","type":"framework","doc_link":"https://docs.sentry.io/platforms/dotnet/guides/aspnetcore/","name":"ASP.NET Core","aliases":[],"categories":[],"body":"<p>Install the <strong>NuGet</strong> package:</p>\n<p>Package Manager:</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell highlight\"><code class=\"language-shell\">Install-Package Sentry.AspNetCore <span class=\"token parameter variable\">-Version</span> <span class=\"token number\">3.41</span>.4</code></pre></div>\n<p>Or .NET Core CLI:</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell highlight\"><code class=\"language-shell\">dotnet <span class=\"token function\">add</span> package Sentry.AspNetCore <span class=\"token parameter variable\">-v</span> <span class=\"token number\">3.41</span>.4</code></pre></div>\n<p>Add Sentry to <code>Program.cs</code> through the <code>WebHostBuilder</code>:</p>\n<div class=\"gatsby-highlight\" data-language=\"csharp\"><pre class=\"language-csharp highlight\"><code class=\"language-csharp\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token return-type class-name\">IHostBuilder</span> <span class=\"token function\">CreateHostBuilder</span><span class=\"token punctuation\">(</span><span class=\"token class-name\"><span class=\"token keyword\">string</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span></span> args<span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span>\n    Host<span class=\"token punctuation\">.</span><span class=\"token function\">CreateDefaultBuilder</span><span class=\"token punctuation\">(</span>args<span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">.</span><span class=\"token function\">ConfigureWebHostDefaults</span><span class=\"token punctuation\">(</span>webBuilder <span class=\"token operator\">=&gt;</span>\n        <span class=\"token punctuation\">{</span>\n            <span class=\"token comment\">// Add the following line:</span>\n            webBuilder<span class=\"token punctuation\">.</span><span class=\"token function\">UseSentry</span><span class=\"token punctuation\">(</span>o <span class=\"token operator\">=&gt;</span>\n            <span class=\"token punctuation\">{</span>\n                o<span class=\"token punctuation\">.</span>Dsn <span class=\"token operator\">=</span> <span class=\"token string\">\"___PUBLIC_DSN___\"</span><span class=\"token punctuation\">;</span>\n                <span class=\"token comment\">// When configuring for the first time, to see what the SDK is doing:</span>\n                o<span class=\"token punctuation\">.</span>Debug <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span>\n                <span class=\"token comment\">// Set TracesSampleRate to 1.0 to capture 100% of transactions for performance monitoring.</span>\n                <span class=\"token comment\">// We recommend adjusting this value in production.</span>\n                o<span class=\"token punctuation\">.</span>TracesSampleRate <span class=\"token operator\">=</span> <span class=\"token number\">1.0</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h2 id=\"verify\" style=\"position:relative;\">Verify</h2>\n<p>To verify your set up, you can capture a message with the SDK:</p>\n<div class=\"gatsby-highlight\" data-language=\"csharp\"><pre class=\"language-csharp highlight\"><code class=\"language-csharp\">SentrySdk<span class=\"token punctuation\">.</span><span class=\"token function\">CaptureMessage</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Hello Sentry\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>If you don't want to depend on the static class, the SDK registers a client in the DI container. In this case, you can <a href=\"https://docs.sentry.io/platforms/dotnet/guides/aspnetcore/unit-testing/\">take <code>IHub</code> as a dependency</a>.</p>\n<h3 id=\"performance-monitoring\" style=\"position:relative;\">Performance monitoring</h3>\n<p>You can measure the performance of your endpoints by adding a middleware to <code>Startup.cs</code>:</p>\n<div class=\"gatsby-highlight\" data-language=\"csharp\"><pre class=\"language-csharp highlight\"><code class=\"language-csharp\"><span class=\"token keyword\">using</span> <span class=\"token namespace\">Microsoft<span class=\"token punctuation\">.</span>AspNetCore<span class=\"token punctuation\">.</span>Builder</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">using</span> <span class=\"token namespace\">Microsoft<span class=\"token punctuation\">.</span>AspNetCore<span class=\"token punctuation\">.</span>Hosting</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">using</span> <span class=\"token namespace\">Microsoft<span class=\"token punctuation\">.</span>Extensions<span class=\"token punctuation\">.</span>Configuration</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">using</span> <span class=\"token namespace\">Microsoft<span class=\"token punctuation\">.</span>Extensions<span class=\"token punctuation\">.</span>DependencyInjection</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">using</span> <span class=\"token namespace\">Microsoft<span class=\"token punctuation\">.</span>Extensions<span class=\"token punctuation\">.</span>Hosting</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">using</span> <span class=\"token namespace\">Sentry<span class=\"token punctuation\">.</span>AspNetCore</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Startup</span>\n<span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">public</span> <span class=\"token return-type class-name\"><span class=\"token keyword\">void</span></span> <span class=\"token function\">Configure</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">IApplicationBuilder</span> app<span class=\"token punctuation\">,</span> <span class=\"token class-name\">IWebHostEnvironment</span> env<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">{</span>\n        app<span class=\"token punctuation\">.</span><span class=\"token function\">UseRouting</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token comment\">// Enable automatic tracing integration.</span>\n        <span class=\"token comment\">// If running with .NET 5 or below, make sure to put this middleware</span>\n        <span class=\"token comment\">// right after `UseRouting()`.</span>\n        app<span class=\"token punctuation\">.</span><span class=\"token function\">UseSentryTracing</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        app<span class=\"token punctuation\">.</span><span class=\"token function\">UseEndpoints</span><span class=\"token punctuation\">(</span>endpoints <span class=\"token operator\">=&gt;</span>\n        <span class=\"token punctuation\">{</span>\n            endpoints<span class=\"token punctuation\">.</span><span class=\"token function\">MapControllerRoute</span><span class=\"token punctuation\">(</span>\n                <span class=\"token named-parameter punctuation\">name</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"default\"</span><span class=\"token punctuation\">,</span>\n                <span class=\"token named-parameter punctuation\">pattern</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"{controller=Home}/{action=Index}/{id?}\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>You'll be able to monitor the performance of your actions automatically. To add additional spans to it, you can use the API:</p>\n<div class=\"gatsby-highlight\" data-language=\"csharp\"><pre class=\"language-csharp highlight\"><code class=\"language-csharp\"><span class=\"token keyword\">using</span> <span class=\"token namespace\">Microsoft<span class=\"token punctuation\">.</span>AspNetCore<span class=\"token punctuation\">.</span>Mvc</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">using</span> <span class=\"token namespace\">Microsoft<span class=\"token punctuation\">.</span>Extensions<span class=\"token punctuation\">.</span>Logging</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">using</span> <span class=\"token namespace\">Sentry</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">HomeController</span> <span class=\"token punctuation\">:</span> <span class=\"token type-list\"><span class=\"token class-name\">Controller</span></span>\n<span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">readonly</span> <span class=\"token class-name\">IHub</span> _sentryHub<span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token function\">HomeController</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">IHub</span> sentryHub<span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> _sentryHub <span class=\"token operator\">=</span> sentryHub<span class=\"token punctuation\">;</span>\n\n    <span class=\"token punctuation\">[</span><span class=\"token attribute\"><span class=\"token class-name\">HttpGet</span><span class=\"token attribute-arguments\"><span class=\"token punctuation\">(</span><span class=\"token string\">\"/person/{id}\"</span><span class=\"token punctuation\">)</span></span></span><span class=\"token punctuation\">]</span>\n    <span class=\"token keyword\">public</span> <span class=\"token return-type class-name\">IActionResult</span> <span class=\"token function\">Person</span><span class=\"token punctuation\">(</span><span class=\"token class-name\"><span class=\"token keyword\">string</span></span> id<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">{</span>\n        <span class=\"token class-name\"><span class=\"token keyword\">var</span></span> childSpan <span class=\"token operator\">=</span> _sentryHub<span class=\"token punctuation\">.</span><span class=\"token function\">GetSpan</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">?.</span><span class=\"token function\">StartChild</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"additional-work\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">try</span>\n        <span class=\"token punctuation\">{</span>\n            <span class=\"token comment\">// Do the work that gets measured.</span>\n\n            childSpan<span class=\"token punctuation\">?.</span><span class=\"token function\">Finish</span><span class=\"token punctuation\">(</span>SpanStatus<span class=\"token punctuation\">.</span>Ok<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">Exception</span> e<span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">{</span>\n            childSpan<span class=\"token punctuation\">?.</span><span class=\"token function\">Finish</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token keyword\">throw</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h2 id=\"samples\" style=\"position:relative;\">Samples</h2>\n<p>See the following examples that demonstrate how to integrate Sentry with various frameworks.</p>\n<ul>\n<li><a href=\"https://github.com/getsentry/sentry-dotnet/tree/main/samples\">Multiple samples in the <code>dotnet</code> SDK repository</a> (<strong>C#</strong>)</li>\n<li><a href=\"https://github.com/sentry-demos/fsharp\">Basic F# sample</a> (<strong>F#</strong>)</li>\n<li><a href=\"https://github.com/sentry-demos/giraffe\">Giraffe F# sample</a> (<strong>F#</strong>)</li>\n</ul>"}