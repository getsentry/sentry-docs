---
title: ASGI
description: "Conoce la integración de ASGI y cómo añade compatibilidad para aplicaciones ASGI."
---

El middleware de ASGI puede usarse para instrumentar cualquier framework web compatible con [ASGI](https://asgi.readthedocs.io/en/latest/) y adjuntar datos de la solicitud a tus eventos.

<Alert>
  Revisa nuestra lista de [integraciones compatibles](/es/platforms/python/integrations/), ya que puede que ya exista una integración específica (como [FastAPI](/es/platforms/python/integrations/fastapi/) o [Sanic](/es/platforms/python/integrations/sanic/)) que sea más fácil de usar y capture información más útil que nuestro middleware genérico de ASGI. Si es así, usa la integración específica en lugar de este middleware.
</Alert>

<div id="install">
  ## Instalación
</div>

```bash {tabTitle:pip}
pip install "sentry-sdk"
```

```bash {tabTitle:uv}
uv add "sentry-sdk"
```

<div id="configure">
  ## Configurar
</div>

Además de capturar errores, puedes supervisar las interacciones entre varios servicios o aplicaciones [activando el tracing](/es/concepts/key-terms/tracing/). También puedes recopilar y analizar perfiles de rendimiento de usuarios reales con [profiling](/es/product/explore/profiling/).

Elige qué funcionalidades de Sentry quieres instalar además de Error Monitoring para obtener a continuación las instrucciones correspondientes de instalación y configuración.

<OnboardingOptionButtons
  options={[
'error-monitoring',
'performance',
'profiling',
]}
/>

```python
import sentry_sdk
from sentry_sdk.integrations.asgi import SentryAsgiMiddleware

from my_asgi_app import app

sentry_sdk.init(
    dsn="___PUBLIC_DSN___",
    # Agrega datos como encabezados de solicitud e IP de usuarios, si aplica;
    # consulta https://docs.sentry.io/platforms/python/data-management/data-collected/ para más información
    send_default_pii=True,
    # ___PRODUCT_OPTION_START___ performance
    # Establece traces_sample_rate en 1.0 para capturar el 100%
    # de las transacciones para el rastreo.
    traces_sample_rate=1.0,
    # ___PRODUCT_OPTION_END___ performance
    # ___PRODUCT_OPTION_START___ profiling
    # Para recopilar perfiles de todas las sesiones de perfilado,
    # establece `profile_session_sample_rate` en 1.0.
    profile_session_sample_rate=1.0,
    # Los perfiles se recopilarán automáticamente mientras
    # haya un span activo.
    profile_lifecycle="trace",
    # ___PRODUCT_OPTION_END___ profiling
)

app = SentryAsgiMiddleware(app)
```

El middleware es compatible con ASGI 2 y ASGI 3 de forma transparente.

<div id="verify">
  ## Verificar
</div>

Provoca un error en tu código y comprueba que aparece en [sentry.io](https://sentry.io).

```python
sentry_sdk.init(...) # same as above

def app(scope):
    async def get_body():
        return f"The number is: {1/0}" # ¡lanza un error!

    async def asgi(receive, send):
        await send(
            {
                "type": "http.response.start",
                "status": 200,
                "headers": [[b"content-type", b"text/plain"]],
            }
        )
        await send({"type": "http.response.body", "body": await get_body()})

    return asgi

app = SentryAsgiMiddleware(app)
```

Ejecuta tu aplicación ASGI con unicorn:

```bash
uvicorn main:app --port 8000
```

Abre [http://localhost:8000](http://localhost:8000) en tu navegador para generar el error, que luego se enviará a Sentry.

Además, aparecerá una transacción en la sección «Performance» de [sentry.io](https://sentry.io).

<div id="behavior">
  ## Comportamiento
</div>

* Los datos de la solicitud se adjuntan a todos los eventos: **método HTTP, URL, encabezados**. Sentry excluye los cuerpos sin procesar y las cargas de archivos multiparte. Sentry también excluye la información de identificación personal (como IDs de usuario, nombres de usuario, cookies, encabezados de autorización, direcciones IP), a menos que configures `send_default_pii` en `True`.

* Cada solicitud tiene un alcance independiente. Los cambios en el alcance dentro de una vista, por ejemplo al establecer una etiqueta, solo se aplicarán a los eventos enviados como parte de la solicitud que se está procesando.

* El middleware ASGI no se comporta como una integración normal. No se inicializa mediante un parámetro adicional para `init` ni está asociado a un cliente. Al capturar o complementar eventos, simplemente utiliza los alcances activos en ese momento.

<div id="supported-versions">
  ## Versiones compatibles
</div>

* Python: 3.7+