---
title: MCP (Protocolo de Contexto del Modelo)
description: "Aprende a usar el SDK de Python de Sentry para servidores MCP (Model Context Protocol)."
---

<Alert title="Beta">

El soporte para el **SDK de Python de MCP (Model Context Protocol)** está en fase beta. Por favor, pruébalo localmente antes de usarlo en producción.

</Alert>

Esta integración conecta Sentry con el [MCP Python SDK](https://github.com/modelcontextprotocol/python-sdk), lo que permite monitoreo y seguimiento de errores para servidores MCP desarrollados en Python.

La integración admite tanto la API de alto nivel FastMCP como la API de bajo nivel `mcp.server.lowlevel.Server`, instrumentando automáticamente herramientas, indicaciones (prompts) y recursos.

Una vez que instales este SDK, podrás usar Sentry para monitorear las operaciones de tu servidor MCP, rastrear ejecuciones de herramientas y capturar errores que ocurran durante el manejo de solicitudes.

El monitoreo de MCP en Sentry recopilará automáticamente información sobre:

- Invocaciones de herramientas y sus argumentos
- Solicitudes de plantillas de indicaciones (prompts)
- Operaciones de acceso a recursos
- Identificadores de solicitud y sesión
- Tipos de transporte (stdio/HTTP)
- Errores de ejecución

<div id="install">
  ## Instalar
</div>

Instala `sentry-sdk` desde PyPI con el extra `mcp`:

```bash {tabTitle:pip}
pip install "sentry-sdk[mcp]"
```

```bash {tabTitle:uv}
uv add "sentry-sdk[mcp]"
```


<div id="configure">
  ## Configuración
</div>

Si tienes el paquete `mcp` entre tus dependencias, la integración de MCP se habilitará automáticamente al inicializar el SDK de Sentry.

<PlatformContent includePath="getting-started-config" />

<div id="verify">
  ## Verificar
</div>

Comprueba que la integración funcione ejecutando un servidor MCP con handlers de herramientas. Los datos resultantes deberían aparecer en tu panel de Sentry.

<div id="using-fastmcp-high-level-api">
  ### Uso de FastMCP (API de alto nivel)
</div>

FastMCP ofrece una API simplificada basada en decoradores para crear servidores MCP:

```python
import sentry_sdk
from sentry_sdk.integrations.mcp import MCPIntegration

from mcp.server.fastmcp import FastMCP

# Inicializar Sentry
sentry_sdk.init(
    dsn="___PUBLIC_DSN___",
    traces_sample_rate=1.0,
    # Agregar datos como entradas/salidas de herramientas;
    # consulta https://docs.sentry.io/platforms/python/data-management/data-collected/ para más información
    send_default_pii=True,
)

# Crear el servidor MCP
mcp = FastMCP("Example MCP Server")

# Definir una herramienta
@mcp.tool()
async def calculate_sum(a: int, b: int) -> int:
    """Suma dos números."""
    return a + b

@mcp.tool()
def greet_user(name: str) -> str:
    """Genera un saludo personalizado."""
    return f"¡Hola, {name}! Bienvenido al servidor MCP."

# Definir un recurso
@mcp.resource("config://settings")
def get_settings() -> str:
    """Obtiene la configuración del servidor."""
    return "Configuración del Servidor: Versión 1.0.0"

# Definir un prompt
@mcp.prompt()
def code_review_prompt(language: str = "python") -> str:
    """Genera un prompt de revisión de código para un lenguaje específico."""
    return f"Eres un experto revisor de código de {language}..."

# Ejecutar el servidor
mcp.run()
```


<div id="using-the-low-level-api">
  ### Uso de la API de bajo nivel
</div>

Para obtener un mayor control sobre el comportamiento del servidor, usa la API de bajo nivel:

```python
import asyncio
from typing import Any

import sentry_sdk
from sentry_sdk.integrations.mcp import MCPIntegration

from mcp.server.lowlevel import Server
from mcp.server import stdio
from mcp.types import Tool, TextContent, GetPromptResult, PromptMessage

# Inicializar Sentry
sentry_sdk.init(
    dsn="___PUBLIC_DSN___",
    traces_sample_rate=1.0,
    send_default_pii=True,
)

# Crear el servidor MCP de bajo nivel
server = Server("example-lowlevel-server")

# Listar las herramientas disponibles
@server.list_tools()
async def list_tools() -> list[Tool]:
    return [
        Tool(
            name="calculate_sum",
            description="Suma dos números",
            inputSchema={
                "type": "object",
                "properties": {
                    "a": {"type": "number", "description": "Primer número"},
                    "b": {"type": "number", "description": "Segundo número"},
                },
                "required": ["a", "b"],
            },
        ),
    ]

# Gestionar la ejecución de herramientas
@server.call_tool()
async def call_tool(name: str, arguments: dict[str, Any]) -> list[TextContent]:
    if name == "calculate_sum":
        a = arguments.get("a", 0)
        b = arguments.get("b", 0)
        result = a + b
        return [TextContent(type="text", text=f"La suma es {result}")]
    
    return [TextContent(type="text", text=f"Herramienta desconocida: {name}")]

async def main():
    async with stdio.stdio_server() as (read_stream, write_stream):
        await server.run(
            read_stream,
            write_stream,
            server.create_initialization_options(),
        )

if __name__ == "__main__":
    asyncio.run(main())
```

Es posible que los datos tarden unos momentos en aparecer en [sentry.io](https://sentry.io).


<div id="behavior">
  ## Comportamiento
</div>

Se recopilarán datos sobre lo siguiente:

- **Ejecuciones de herramientas**: nombre de la herramienta, argumentos, resultados y errores de ejecución
- **Solicitudes de prompts**: nombre del prompt, argumentos, conteo de mensajes y contenido (para prompts de un solo mensaje)
- **Acceso a recursos**: URI del recurso, protocolo y patrones de acceso
- **Contexto de la solicitud**: ID de solicitud, ID de sesión y tipos de transporte (stdio/HTTP)
- **Spans de ejecución**: información de temporización para todas las invocaciones del manejador

Sentry considera las entradas/salidas de herramientas y el contenido de los prompts como PII y no incluye datos de PII de forma predeterminada. Si quieres incluir estos datos, establece `send_default_pii=True` en la llamada a `sentry_sdk.init()`. Para excluir explícitamente estos datos a pesar de `send_default_pii=True`, configura la integración con `include_prompts=False` como se muestra en la [sección de opciones](#options) a continuación.

<div id="captured-span-data">
  ### Datos de spans capturados
</div>

Para cada operación, se capturan los siguientes atributos de datos del span:

**General (todas las operaciones):**

- `mcp.method.name`: Nombre del método MCP (p. ej., `tools/call`, `prompts/get`, `resources/read`)
- `mcp.transport`: Tipo de transporte (`pipe` para stdio, `tcp` para HTTP)
- `mcp.request_id`: Identificador de la solicitud (cuando esté disponible)
- `mcp.session_id`: Identificador de la sesión (cuando esté disponible)

**Tools:**

- `mcp.tool.name`: Nombre de la herramienta en ejecución
- `mcp.request.argument.*`: Argumentos de entrada de la herramienta
- `mcp.tool.result.content`: Salida de la herramienta (cuando `send_default_pii=True`)
- `mcp.tool.result.is_error`: Indica si la ejecución de la herramienta produjo un error

**Prompts:**

- `mcp.prompt.name`: Nombre del prompt solicitado
- `mcp.request.argument.*`: Argumentos de entrada del prompt
- `mcp.prompt.result.message.count`: Número de mensajes en el resultado del prompt
- `mcp.prompt.result.message.role`: Rol del mensaje (para prompts de un solo mensaje)
- `mcp.prompt.result.message.content`: Contenido del mensaje (para prompts de un solo mensaje, cuando `send_default_pii=True`)

**Resources:**

- `mcp.resource.uri`: URI del recurso al que se accede
- `mcp.resource.protocol`: Protocolo/esquema del URI (p. ej., `config`, `data`, `file`)

<div id="options">
  ## Opciones
</div>

Al agregar `MCPIntegration` explícitamente a la llamada `sentry_sdk.init()`, puedes configurar opciones de `MCPIntegration` para cambiar su comportamiento:

```python
import sentry_sdk
from sentry_sdk.integrations.mcp import MCPIntegration

sentry_sdk.init(
    # ...
    # Agrega datos como entradas y salidas de herramientas;
    # consulta https://docs.sentry.io/platforms/python/data-management/data-collected/ para más información
    send_default_pii=True,
    integrations=[
        MCPIntegration(
            include_prompts=False,  # Las entradas y salidas de herramientas y prompts no se enviarán a Sentry
        ),
    ],
)
```

You can pass the following keyword arguments to `MCPIntegration()`:

* `include_prompts`:

  Si se deben enviar a Sentry las entradas y salidas de herramientas, así como el contenido de los prompts. Sentry considera estos datos como información de identificación personal (PII) de forma predeterminada. Si quieres incluirlos, establece `send_default_pii=True` en la llamada a `sentry_sdk.init()`. Para excluir explícitamente los prompts y salidas incluso con `send_default_pii=True`, configura la integración con `include_prompts=False`.

  El valor predeterminado es `True`.


<div id="supported-versions">
  ## Versiones compatibles
</div>

- MCP SDK: 1.15.0+
- Python: 3.9+