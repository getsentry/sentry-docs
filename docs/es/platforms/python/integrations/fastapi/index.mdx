---
title: FastAPI
description: Aprende a usar Sentry con FastAPI.
og_image: /og-images/platforms-python-integrations-fastapi.png
---

La integración de FastAPI añade compatibilidad con el [framework FastAPI](https://fastapi.tiangolo.com/).

<div id="install">
  ## Instalar
</div>

Instala `sentry-sdk` desde PyPI con el extra `fastapi`:

```bash {tabTitle:pip}
pip install "sentry-sdk[fastapi]"
```

```bash {tabTitle:uv}
uv add "sentry-sdk[fastapi]"
```

<div id="configure">
  ## Configuración
</div>

Si tienes el paquete `fastapi` en tus dependencias, la integración de FastAPI se habilitará automáticamente al inicializar el SDK de Sentry.

<PlatformContent includePath="getting-started-config" />

<div id="verify">
  ## Verificar
</div>

```python
from fastapi import FastAPI

sentry_sdk.init(...)  # mismo que arriba

app = FastAPI()

@app.get("/sentry-debug")
async def trigger_error():
    division_by_zero = 1 / 0
```

Cuando abras en tu navegador [http://localhost:8000/sentry-debug](http://localhost:8000/sentry-debug), se creará una transacción en la sección Performance de [sentry.io](https://sentry.io). Además, se enviará un evento de error a [sentry.io](https://sentry.io) y se asociará a la transacción.

Los datos pueden tardar unos momentos en aparecer en [sentry.io](https://sentry.io).

<div id="behaviour">
  ## Comportamiento
</div>

<div id="issue-reporting">
  ### Informe de problemas
</div>

La siguiente información sobre tu proyecto de FastAPI estará disponible para ti en Sentry.io:

* De forma predeterminada, todas las excepciones que provocan un error interno del servidor se capturan y se reportan. Los códigos de estado HTTP que se deben reportar son configurables mediante la [opción](#options) `failed_request_status_codes`.
* Los datos de la solicitud, como la URL, el método HTTP, los encabezados, los datos de formulario y las cargas JSON, se adjuntan a todos los issues.
* Sentry excluye los cuerpos sin procesar y las cargas de archivos multipart.
* Sentry también excluye información de identificación personal (como IDs de usuario, nombres de usuario, cookies, encabezados de autorización, direcciones IP) a menos que establezcas `send_default_pii` en `True`.

![Lista de issues](./img/fastapi-issues-list.png)

<div id="monitor-performance">
  ### Monitoreo del rendimiento
</div>

Se supervisan las siguientes partes de tu proyecto de FastAPI:

* Pila de middleware
* Callbacks `send` y `receive` del middleware
* Consultas a la base de datos
* Comandos de Redis

![Los detalles de rendimiento se muestran como un diagrama de cascada](./img/fastapi-performance-details.png)

<Alert>
  Es necesario configurar el parámetro [traces&#95;sample&#95;rate](/es/platforms/python/configuration/options/#traces-sample-rate) al inicializar el SDK de Sentry para que se registren las mediciones de rendimiento.
</Alert>

<div id="options">
  ## Opciones
</div>

Al añadir explícitamente `FastApiIntegration` a tu llamada `sentry_sdk.init()`, puedes configurar opciones para `FastApiIntegration` para ajustar su comportamiento.
Como FastAPI se basa en el framework Starlette, ambas integraciones, `StarletteIntegration` y `FastApiIntegration`, deben instanciarse.

```python
from sentry_sdk.integrations.starlette import StarletteIntegration
from sentry_sdk.integrations.fastapi import FastApiIntegration

sentry_sdk.init(
    # mismo que arriba
    integrations=[
        StarletteIntegration(
            transaction_style="endpoint",
            failed_request_status_codes={403, *range(500, 599)},
            http_methods_to_capture=("GET",),
        ),
        FastApiIntegration(
            transaction_style="endpoint",
            failed_request_status_codes={403, *range(500, 599)},
            http_methods_to_capture=("GET",),
        ),
    ]
)
```

Puedes pasar los siguientes argumentos con nombre a `StarletteIntegration()` y `FastApiIntegration()`:

* `transaction_style`:

  Esta opción te permite influir en cómo se nombran las transacciones en Sentry. Por ejemplo:

  ```python
  import sentry_sdk
  from sentry_sdk.integrations.starlette import StarletteIntegration
  from sentry_sdk.integrations.fastapi import FastApiIntegration

  sentry_sdk.init(
      # ...
      integrations=[
          StarletteIntegration(
              transaction_style="endpoint",
          ),
          FastApiIntegration(
              transaction_style="endpoint",
          ),
      ],
  )

  app = FastAPI()

  @app.get("/catalog/product/{product_id}")
  async def product_detail(product_id):
      return {...}
  ```

  En el código anterior, el nombre de la transacción será:

  * `"/catalog/product/{product_id}"` si configuras `transaction_style="url"`
  * `"product_detail"` si configuras `transaction_style="endpoint"`

  El valor predeterminado es `"url"`.

* `failed_request_status_codes`:

  Un `set` de enteros que determina qué códigos de estado deben reportarse a Sentry.

  La opción `failed_request_status_codes` determina si las excepciones [`HTTPException`](https://fastapi.tiangolo.com/reference/exceptions/?h=httpexception) deben
  reportarse a Sentry. Las excepciones no controladas que no tienen un atributo `status_code` siempre se reportarán a Sentry.

  Ejemplos de `failed_request_status_codes` válidos:

  * `{500}` solo enviará eventos en HTTP 500.
  * `{400, *range(500, 600)}` enviará eventos en HTTP 400, así como en el rango 5xx.
  * `{500, 503}` enviará eventos en HTTP 500 y 503.
  * `set()` (el conjunto vacío) no enviará eventos para ningún código de estado HTTP.

  El valor predeterminado es `{*range(500, 600)}`, lo que significa que todos los códigos de estado 5xx se reportan a Sentry.

* `http_methods_to_capture`:

  Una tupla que contiene todos los métodos HTTP que deben crear una transacción en Sentry.

  El valor predeterminado es `("CONNECT", "DELETE", "GET", "PATCH", "POST", "PUT", "TRACE",)`.

  (Ten en cuenta que `OPTIONS` y `HEAD` no se incluyen de forma predeterminada).

  <Alert title="Agregado en 2.15.0">
    La opción `http_methods_to_capture`.
  </Alert>

<div id="supported-versions">
  ## Versiones compatibles
</div>

* FastAPI: 0.79.0+
* Python: 3.7+