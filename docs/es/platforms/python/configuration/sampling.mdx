---
title: Muestreo
description: "Aprende a configurar el volumen de eventos de error y transacción que se envían a Sentry."
sidebar_order: 60
---

Agregar Sentry a tu aplicación te brinda muchísima información valiosa sobre errores y rendimiento que de otro modo no obtendrías. Y mucha información es buena, siempre que sea la correcta y en una cantidad razonable.

<div id="sampling-error-events">
  ## Muestreo de eventos de error
</div>

Para enviar una muestra representativa de tus errores a Sentry, establece la opción <PlatformIdentifier name="sample-rate" /> en la configuración de tu SDK a un número entre `0` (0% de errores enviados) y `1` (100% de errores enviados). Esta es una tasa estática que se aplicará por igual a todos los errores. Por ejemplo, para muestrear el 25% de tus errores:

<PlatformContent includePath="configuration/sample-rate" />

De forma predeterminada, la tasa de muestreo de errores es `1.0`, lo que significa que todos los errores se envían a Sentry.

Cambiar la tasa de muestreo de errores requiere volver a desplegar. Además, configurar una tasa de muestreo en el SDK limita la visibilidad del origen de los eventos. Establecer un [límite de tasa](/es/pricing/quotas/manage-event-stream-guide/#rate-limiting) para tu proyecto (que solo descarta eventos cuando el volumen es alto) puede ajustarse mejor a tus necesidades.

<div id="dynamically-sampling-error-events">
  ### Muestreo dinámico de eventos de error
</div>

Para muestrear eventos de error de forma dinámica, establece <PlatformIdentifier name="error-sampler" /> en una función que devuelva la tasa de muestreo deseada para el evento. <PlatformIdentifier name="error-sampler" /> recibe dos argumentos, <PlatformIdentifier name="event" /> y <PlatformIdentifier name="hint" />. `event` es el [evento](https://github.com/getsentry/sentry-python/blob/master/sentry_sdk/_types.py) que se enviará a Sentry; `hint` incluye la información de [sys.exc&#95;info()](https://docs.python.org/3/library/sys.html#sys.exc_info) de Python en `hint["exc_info"]`.

<Alert>
  Tu función <PlatformIdentifier name="error-sampler" /> **debe devolver un valor válido**. Un valor válido es:

  * Un **número de punto flotante** entre `0.0` y `1.0` (inclusive) que indica la probabilidad de que un error se muestree, **o**
  * Un **booleano** que indica si se debe muestrear el error o no.
</Alert>

Un posible caso de uso de <PlatformIdentifier name="error-sampler" /> es aplicar diferentes tasas de muestreo a distintos tipos de excepciones. Por ejemplo, si deseas muestrear una excepción llamada `MyException` al 50%, descartar todos los eventos de otra excepción llamada `MyIgnoredException` y muestrear todos los demás tipos de excepciones al 100%, podrías usar el siguiente código al inicializar el SDK:

<PlatformContent includePath="configuration/error-sampler" />

<Alert>
  Puedes definir como máximo uno de <PlatformIdentifier name="error-sampler" /> y <PlatformIdentifier name="sample-rate" />. Si ambos están configurados, <PlatformIdentifier name="error-sampler" /> controlará el muestreo y se ignorará <PlatformIdentifier name="sample-rate" />.
</Alert>

<div id="sampling-transaction-events">
  ## Muestreo de eventos de transacción
</div>

Recomendamos muestrear tus transacciones por dos razones:

1. Capturar un único rastro conlleva una sobrecarga mínima, pero capturar rastros para *cada* carga de página o *cada* solicitud a la API puede añadir una carga indeseada a tu sistema.
2. Activar el muestreo te permite gestionar mejor la cantidad de eventos enviados a Sentry, para ajustar el volumen a las necesidades de tu organización.

Elige una tasa de muestreo que busque equilibrar el rendimiento y el volumen con la precisión de los datos. No quieres recopilar *demasiados* datos, pero sí los suficientes para sacar conclusiones significativas. Si no tienes claro qué tasa elegir, empieza con un valor bajo y auméntalo gradualmente a medida que conozcas mejor tus patrones de tráfico y volumen.

<div id="configuring-the-transaction-sample-rate">
  ## Configuración de la tasa de muestreo de transacciones
</div>

Los SDK de Sentry tienen dos opciones de configuración para controlar el volumen de transacciones enviadas a Sentry, lo que te permite obtener una muestra representativa:

1. Tasa de muestreo uniforme (<PlatformIdentifier name="traces-sample-rate" />):
   * Proporciona una muestra pareja de transacciones, sin importar en qué parte de tu app ocurran o bajo qué circunstancias.
   * Usa el comportamiento predeterminado de [herencia](#inheritance) y [precedencia](#precedence)
2. Función de muestreo (<PlatformIdentifier name="traces-sampler" />) que:
   * Muestrea distintas transacciones a diferentes tasas
   * <PlatformLink to="/configuration/filtering/">Filtra</PlatformLink> por completo algunas transacciones
   * Modifica el comportamiento predeterminado de [precedencia](#precedence) y [herencia](#inheritance)

De forma predeterminada, ninguna de estas opciones está configurada, por lo que no se enviarán transacciones a Sentry. Debes configurar al menos una de las opciones para empezar a enviar transacciones.

<div id="setting-a-uniform-sample-rate">
  ### Configurar una frecuencia de muestreo uniforme
</div>

<PlatformContent includePath="performance/uniform-sample-rate" />

<div id="setting-a-sampling-function">
  ### Configurar una función de muestreo
</div>

<PlatformContent includePath="performance/sampling-function-intro" />

<div id="sampling-context-data">
  ## Muestreo de datos de contexto
</div>

<div id="default-sampling-context-data">
  ### Datos predeterminados del contexto de muestreo
</div>

La información incluida en el objeto <PlatformIdentifier name="sampling-context" /> que se pasa a <PlatformIdentifier name="traces-sampler" /> al crear una transacción varía según la integración.

<PlatformContent includePath="performance/default-sampling-context" />

<div id="custom-sampling-context-data">
  ### Datos de contexto de muestreo personalizados
</div>

Al usar instrumentación personalizada para crear una transacción, puedes agregar datos al <PlatformIdentifier name="sampling-context" /> pasándolos como segundo argumento opcional a <PlatformIdentifier name="start-transaction" />. Esto es útil si hay datos a los que quieres que el muestreador tenga acceso, pero que no deseas adjuntar a la transacción como `tags` o `data`, por ejemplo, porque son sensibles o demasiado grandes para enviarlos con la transacción. Por ejemplo:

```python
sentry_sdk.start_transaction(
    # kwargs pasados al constructor de Transaction: se registrarán en la transacción
    name="GET /search",
    op="search",
    data={
        "query_params": {
            "animal": "perro",
            "type": "muy bueno"
        }
    },
    # `custom_sampling_context`: no se registrará
    custom_sampling_context={
        # PII
        "user_id": "12312012",
        # demasiado grande para enviar
        "search_results": { ... }
    }
)
```

<div id="inheritance">
  ## Herencia
</div>

Sea cual sea la decisión de muestreo de una transacción, esa decisión se propagará a sus spans hijas y, desde ahí, a cualquier transacción que estas inicien posteriormente en otros servicios.

(Consulta <PlatformLink to="/tracing/trace-propagation/">Distributed Tracing</PlatformLink> para obtener más información sobre cómo se realiza esa propagación).

Si la transacción que se está creando es una de esas transacciones posteriores (es decir, si tiene una transacción padre), la decisión de muestreo del upstream (padre) se incluirá en los datos del contexto de muestreo. Tu <PlatformIdentifier name="traces-sampler" /> puede usar esta información para decidir si heredar esa decisión. En la mayoría de los casos, heredar es la opción correcta para evitar romper trazas distribuidas. Una traza rota no incluirá todos tus servicios.

<PlatformContent includePath="performance/always-inherit-sampling-decision">
  En algunos SDK, por conveniencia, la función <PlatformIdentifier name="traces-sampler" /> puede devolver un valor booleano, de modo que la decisión del padre pueda devolverse directamente si ese es el comportamiento deseado.
</PlatformContent>

Si estás usando un <PlatformIdentifier name="traces-sample-rate" /> en lugar de un <PlatformIdentifier name="traces-sampler" />, la decisión siempre se heredará.

<div id="forcing-a-sampling-decision">
  ## Forzar una decisión de muestreo
</div>

Si, al crear la transacción, ya sabes si quieres que se envíe a Sentry o no, también puedes pasar una decisión de muestreo directamente al constructor de la transacción (nota: no en el objeto <PlatformIdentifier name="custom-sampling-context" />). Si haces eso, la transacción no estará sujeta a <PlatformIdentifier name="traces-sample-rate" /> ni se ejecutará <PlatformIdentifier name="traces-sampler" />, por lo que puedes confiar en que la decisión que pases no será sobrescrita.

```python
sentry_sdk.start_transaction(
    name="GET /search",
    sampled=True
)
```

<div id="precedence">
  ## Precedencia
</div>

Hay varias formas en que una transacción puede acabar con una decisión de muestreo.

* Muestreo aleatorio según una tasa de muestreo estática definida en <PlatformIdentifier name="traces-sample-rate" />
* Muestreo aleatorio según una tasa devuelta por una función de muestreo en <PlatformIdentifier name="traces-sampler" />
* Decisión absoluta (probabilidad del 100% o del 0%) devuelta por <PlatformIdentifier name="traces-sampler" />
* Si la transacción tiene un padre, heredar la decisión de muestreo del padre
* Decisión absoluta pasada a <PlatformIdentifier name="start-transaction" />

Cuando es posible que más de una de estas opciones entre en juego, se aplican las siguientes reglas de precedencia:

1. Si se pasa una decisión de muestreo a <PlatformIdentifier name="start-transaction" />, se usará esa decisión y se ignorará el resto.
2. Si <PlatformIdentifier name="traces-sampler" /> está definido, se usará su decisión. Puede optar por conservar o ignorar cualquier decisión de muestreo del padre, usar los datos del contexto de muestreo para tomar su propia decisión o elegir una tasa de muestreo para la transacción. Desaconsejamos anular la decisión de muestreo del padre porque rompería los trazados distribuidos.
3. Si <PlatformIdentifier name="traces-sampler" /> no está definido, pero existe una decisión de muestreo del padre, se usará la decisión de muestreo del padre.
4. Si <PlatformIdentifier name="traces-sampler" /> no está definido y no hay una decisión de muestreo del padre, se usará <PlatformIdentifier name="traces-sample-rate" />.