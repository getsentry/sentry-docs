---
draft: true
categories: []
toc: true
title: Uso avanzado
sidebar_order: 1
noindex: true
tags: []
---

<Alert level="warning" title="Aviso de desaprobación">
  Un nuevo SDK de Python ha reemplazado esta versión en desuso. Sentry conserva esta documentación para clientes que utilizan el cliente antiguo. Recomendamos usar el [SDK de Python actualizado](/es/platforms/python/) para proyectos nuevos.
</Alert>

Aquí se cubren algunos escenarios de uso avanzado de raven en Python.

<div id="alternative-installations">
  ## Instalaciones alternativas
</div>

Si quieres usar la versión más reciente de Git, puedes obtenerla desde [el repositorio de GitHub](https://github.com/getsentry/raven-python):

```bash
git clone https://github.com/getsentry/raven-python
pip install raven-python
```

Se pueden instalar ciertas funciones adicionales especificándolas al instalarlas con `pip`. Por ejemplo, para instalar todas las dependencias necesarias para usar la integración con Flask, puedes depender de `raven[flask]`:

```bash
pip install raven[flask]
```

Para más información, consulta la documentación de cada integración.

<div id="configuring-the-client">
  ## Configuración del cliente
</div>

La configuración se especifica como parte de la inicialización del cliente. El cliente es una clase que puede instanciarse con una configuración específica y, a partir de ahí, todos los informes pueden realizarse desde la instancia de ese objeto. Normalmente, se crea una instancia de forma global y luego se importa según sea necesario.

```python
from raven import Client

# Lee la configuración de la variable de entorno ``SENTRY_DSN``
client = Client()

# Especifica manualmente un DSN
client = Client('___DSN___')
```

Un cliente bien configurado normalmente debería incluir algunos ajustes adicionales:

```python
import os
import raven

client = raven.Client(
    dsn='___DSN___',

    # informa al cliente qué partes del código son tuyas
    # include_paths=['my.app']
    include_paths=[__name__.split('.', 1)[0]],

    # pasa la versión de tu aplicación
    # release='my-project-name@2.3.12'
    # release=raven.fetch_package_version('my-app')
    release=raven.fetch_git_sha(os.path.dirname(__file__)),
)
```

*(Nuevo en la versión 5.2.0: las utilidades `fetch_package_version` y `fetch_git_sha`.)*

<div id="client-arguments">
  ## Argumentos del cliente
</div>

A continuación se muestran los argumentos válidos que se pueden pasar al cliente de Raven:

`dsn`

Un DSN compatible con Sentry, como se mencionó antes:

```python
dsn = '___DSN___'
```

`transport`

La clase de transporte HTTP que se utilizará. De forma predeterminada, es un hilo de trabajo asíncrono que se ejecuta dentro del mismo proceso.

Para obtener más información, consulta [*Transports*](/es/platforms/python/legacy-sdk/transports/).

`site`

Una cadena arbitraria opcional para identificar esta instalación del cliente:

```python
site = 'my site name'
```

`name`

Esto sustituirá el valor de `server_name` para esta instalación. De forma predeterminada, usa `socket.gethostname()`:

```python
name = 'sentry_rocks_' + socket.gethostname()
```

`release`

La versión de tu aplicación. Esto se corresponderá con una versión (Release) en Sentry:

```python
release = '1.0.3'
```

`environment`

El entorno en el que se ejecuta tu aplicación:

```python
environment = 'staging'
```

`tags`

Etiquetas predeterminadas para enviar con los eventos:

```python
tags = {'site': 'foo.com'}
```

`exclude_paths`

Extender esto te permite ignorar prefijos de módulo cuando intentamos averiguar de qué función proviene un error (por lo general, una vista):

```python
exclude_paths = [
    'django',
    'sentry',
    'raven',
    'lxml.objectify',
]
```

`include_paths`

Por ejemplo, en Django esto, por defecto, corresponde a tu lista de `INSTALLED_APPS`, y se utiliza para profundizar y localizar dónde se produce una excepción:

```python
include_paths = [
    'django',
    'sentry',
    'raven',
    'lxml.objectify',
]
```

`ignore_exceptions`

Una lista de excepciones que ignorar:

```python
ignore_exceptions = [
    'Http404',
    'django.exceptions.http.Http404',
    'django.exceptions.*',
    ValueError,
]
```

Cada elemento puede ser una cadena o una clase. La declaración con cadena es estricta (es decir, no funciona para excepciones descendientes), mientras que la declaración con clase admite la herencia (es decir, las excepciones descendientes también se ignoran).

`sample_rate`

El factor de muestreo que se aplica a los eventos. Un valor de 0,00 impedirá enviar cualquier evento y un valor de 1,00 enviará el 100% de los eventos.

```python
# enviar el 50% de los eventos
sample_rate = 0.5
```

`list_max_length`

El número máximo de elementos que debe almacenar un contenedor de tipo lista.

Si un iterable supera la longitud especificada, se conservarán los elementos del inicio hasta alcanzar esa longitud. Esto también afecta a los conjuntos, que no tienen un orden definido.

```python
list_max_length = 50

```

`string_max_length`

La cantidad máxima de caracteres de una cadena que se deben almacenar.

Si una cadena supera la longitud indicada, se truncará al tamaño especificado:

```python
string_max_length = 200
```

`auto_log_stacks`

¿Debe Raven registrar automáticamente las pilas de frames (incluidas las variables locales) para todas las llamadas, como lo hace con las excepciones?

```python
auto_log_stacks = True
```

`processors`

Una lista de procesadores que se aplicarán a los eventos antes de enviarlos al servidor de Sentry. Útil para enviar datos globales adicionales o para depurar/anonimizar datos que quieras mantener fuera del servidor:

```python
processors = (
    'raven.processors.SanitizePasswordsProcessor',
)
```

`sanitize_keys`

Un conjunto obligatorio de claves que se deben depurar al usar `raven.processors.SanitizeKeysProcessor` en `processors`:

```python
sanitize_keys = ["sensitive_key_1", "sensitive_key_2"]
```

<div id="sanitizing-data">
  ## Sanitización de datos
</div>

Raven incluye varios procesadores para ayudar con la sanitización de datos. Se configuran con el valor `processors`.

`raven.processors.SanitizePasswordsProcessor`

Elimina todas las claves que se asemejen a `password`, `secret` o `api_key` en los contextos de trazas, en elementos de HTTP (como cookies, datos POST, la cadena de consulta y el entorno) y en los datos adicionales.

`raven.processors.RemoveStackLocalsProcessor`

Elimina todas las variables de contexto de las trazas. Esto limitará la funcionalidad de Sentry, ya que solo obtendrás trazas en bruto, pero garantizará que no haya información de ámbito local disponible para el servidor.

`raven.processors.RemovePostDataProcessor`

Elimina el `body` de todos los datos HTTP.

`raven.processors.SanitizeKeysProcessor`

Elimina todas las claves incluidas en el conjunto configurable `sanitize_keys`, que debe proporcionarse como argumento del cliente.

<div id="custom-grouping-behavior">
  ## Comportamiento de agrupación personalizado
</div>

En algunos casos, puedes encontrarte con situaciones en las que Sentry agrupa varios eventos que deberían ser entidades por separado. En otros, Sentry simplemente no agrupa eventos porque son tan esporádicos que nunca se parecen.

Ambos problemas pueden resolverse especificando el atributo `fingerprint`.

Por ejemplo, si tienes errores HTTP 404 (Página no encontrada) y prefieres que se desdupliquen teniendo en cuenta la URL:

```python
client.captureException(fingerprint=['{{ default }}', 'http://mi-url/'])
```

Para obtener más información, consulta [Personalizar la agrupación con huellas](/es/concepts/data-management/event-grouping/).

<div id="sampling-messages">
  ## Muestreo de mensajes
</div>

Hay dos maneras de muestrear mensajes:

* Agrega sample&#95;rate al objeto Client: esto envía a Sentry un porcentaje de los mensajes que llegan al Client

```python
client = Client('___DSN___', sample_rate=0.5) # envía el 50% de los eventos
```

* Ejemplos de mensajes individuales

```python
client = Client('___DSN___') # No se proporciona sample_rate

try:
    1 / 0
except ZeroDivisionError:
    client.captureException(sample_rate=0.5) # Envía el 50% de este evento
```

Como alternativa, si tienes SentryHandler configurado en tu pila de logging, puedes enviar `sample_rate` en el parámetro `extra` de cada log así

```python
some_logger.warning('foo', extra={'sample_rate': 0.5}) # Enviar el 50% de este evento
```

<div id="a-note-on-uwsgi">
  ## Una nota sobre uWSGI
</div>

Si usas uWSGI, debes añadir `enable-threads` a la llamada predeterminada o desactivar el transporte predeterminado con subprocesos.