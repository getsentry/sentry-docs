---
title: Instrumentación de cachés
sidebar_order: 1000
description: "Aprende a instrumentar manualmente tu código para usar el módulo Caches de Sentry. "
---

Una caché puede usarse para acelerar la recuperación de datos y, por lo tanto, mejorar el rendimiento de la aplicación. En lugar de obtener datos de una capa de datos potencialmente lenta, tu aplicación los obtendrá de la memoria (en el mejor de los casos). El almacenamiento en caché puede acelerar cargas de trabajo con muchas lecturas en aplicaciones como portales de preguntas y respuestas, videojuegos, intercambio de contenido y redes sociales.

Sentry ofrece un [panel de monitoreo de caché](https://sentry.io/orgredirect/organizations/:orgslug/insights/backend/caches/) que puede instrumentarse automáticamente para configuraciones populares de caché en Python (como <PlatformLink to="/integrations/django/">Django</PlatformLink> y <PlatformLink to="/integrations/redis/">Redis</PlatformLink>).

Si usas una solución de caché personalizada que no tiene instrumentación automática, puedes instrumentarla manualmente y usar Sentry para ver cómo está funcionando tu solución de caché siguiendo las instrucciones de configuración a continuación.

Para que Sentry pueda darte una visión general del rendimiento de tu caché, necesitas crear dos spans: uno que indique que algo se está guardando en la caché y otro que indique que algo se está obteniendo de la caché.

Asegúrate de que haya una transacción en ejecución cuando crees los spans. Si usas un framework web, esas transacciones se crearán automáticamente. Consulta <PlatformLink to="/tracing/">Tracing</PlatformLink> para obtener más información.

Para obtener información detallada sobre qué datos se pueden configurar, consulta la [Especificación del módulo de caché para desarrolladores](https://develop.sentry.dev/sdk/performance/modules/caches/).

<div id="manual-instrumentation">
  ## Instrumentación manual
</div>

Si utilizas algo distinto de <PlatformLink to="/integrations/django/">Django</PlatformLink> o <PlatformLink to="/integrations/redis/">Redis</PlatformLink>, deberás instrumentar manualmente el [módulo de caché](https://sentry.io/orgredirect/organizations/:orgslug/insights/backend/caches/) siguiendo los pasos a continuación.

<div id="add-span-when-putting-data-into-the-cache">
  ### Agrega un span al guardar datos en la caché
</div>

Si la caché que estás usando no es compatible con la autoinstrumentación mencionada arriba, puedes seguir las instrucciones de instrumentación personalizada de abajo para emitir spans de caché:

1. Establece el valor en la caché con la biblioteca de caché que estés usando.
2. Envuelve la parte de tu aplicación que usa el valor en caché con `with sentry_sdk.start_span(...)`.
3. Establece `op` en `cache.put`.
4. Establece `cache.item_size` en un número entero que represente el tamaño del elemento en caché.

(Los pasos descritos arriba están documentados en el fragmento).

```python
import my_caching
import sentry_sdk

key = "myCacheKey123"
value = "El valor que quiero guardar en caché."

with sentry_sdk.start_span(op="cache.put") as span:
    # Establece una clave en tu caché usando tu solución de caché personalizada
    my_caching.set(key, value)

    # Describe el servidor de caché al que accedes
    span.set_data("network.peer.address", "cache.example.com/supercache")
    span.set_data("network.peer.port", 9000)

    # Agrega las claves que quieres establecer
    span.set_data("cache.key", [key])

    # Agrega el tamaño del valor que guardaste en la caché
    span.set_data("cache.item_size", len(value))  # Advertencia: si el valor es muy grande, esto podría usar mucha memoria
```


<div id="add-span-when-retrieving-data-from-the-cache">
  ### Agregar un span al recuperar datos de la caché
</div>

Si la caché que estás usando no es compatible con la autoinstrumentación mencionada arriba, puedes seguir las instrucciones de instrumentación personalizada a continuación para emitir spans de caché:

1. Obtén el valor almacenado en la caché desde la biblioteca de caché que estés utilizando.
2. Envuelve la parte de tu aplicación que usa ese valor en caché con `with sentry_sdk.start_span(...)`
3. Establece `op` en `cache.get`.
4. Establece `cache.hit` en un valor booleano que indique si el valor se obtuvo correctamente de la caché o no.
5. Establece `cache.item_size` en un entero que represente el tamaño del elemento en caché.

(Los pasos descritos arriba están documentados en el fragmento).

```python
import my_caching
import sentry_sdk

key = "myCacheKey123"
value = None

with sentry_sdk.start_span(op="cache.get") as span:
    # Obtén una clave de tu solución de caché
    value = my_caching.get(key)

    # Describe el servidor de caché al que accedes
    span.set_data("network.peer.address", "cache.example.com/supercache")
    span.set_data("network.peer.port", 9000)

    # Agrega las claves que acabas de recuperar del caché
    span.set_data("cache.key", [key])

    if value is not None:
        # Si recuperaste un valor, hubo un acierto en el caché
        span.set_data("cache.hit", True)

        # Opcionalmente, agrega también el tamaño del valor recuperado
        span.set_data("cache.item_size", len(value))
    else:
        # Si no pudiste recuperar un valor, hubo un fallo
        span.set_data("cache.hit", False)
```

Ahora deberías tener los spans correctos en su lugar. Dirígete al [panel de caché](https://sentry.io/orgredirect/organizations/:orgslug/insights/backend/caches) para ver cómo está rindiendo tu caché.
