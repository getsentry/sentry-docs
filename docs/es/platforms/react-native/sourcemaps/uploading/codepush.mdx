---
title: CodePush
sidebar_order: 100
description: "Sube mapas de origen para las versiones de CodePush."
---

El SDK de React Native de Sentry funciona de forma nativa con CodePush. Para ver trazas legibles en el producto, debes subir mapas de origen a Sentry. Esta guía explica cómo subir mapas de origen para las versiones de CodePush creadas con la CLI de AppCenter.

<div id="prerequisites">
  ## Requisitos previos
</div>

* [Crea una cuenta](https://sentry.io/signup/)
* [Configura el SDK de Sentry para React Native](/es/platforms/react-native)
* [Configura el complemento Metro de Sentry](/es/platforms/react-native/manual-setup/metro)
  * El complemento garantiza que los IDs de depuración estén habilitados y se utilicen para vincular los mapas de origen con los paquetes.

<div id="wrap-your-app">
  ## Envuelve tu app
</div>

Asegúrate de que `codePush` sea la función más externa, ya que necesita acceso al componente raíz para poder reemplazar el bundle.

```javascript
export default codePush(Sentry.wrap(App));
```

<div id="create-codepush-release">
  ## Crear una versión de CodePush
</div>

Para que Sentry pueda desimbolizar los eventos de tus versiones de CodePush, debes generar y subir los artefactos necesarios. Al crear una versión de CodePush, incluye la opción `--sourcemap-output-dir` para generar los mapas de origen en un directorio separado. Esto te permitirá subir esos archivos a Sentry en el siguiente paso.

```bash {tabTitle:JSC (Standalone)}
code-push-standalone release-react \
  "${APP_NAME}" \
  "${PLATFORM}" \
  --deploymentName "${DEPLOYMENT_NAME}" \
  --outputDir ./build \
  --sourcemapOutput ./sourcemaps
```

```bash {tabTitle:Hermes (Standalone)}
rm -rf ./build ./sourcemaps
CODEPUSH_COMMAND="code-push-standalone release-react \
  \"${APP_NAME}\" \
  \"${PLATFORM}\" \
  --deploymentName \"${DEPLOYMENT_NAME}\" \
  --useHermes \
  --outputDir ./build \
  --sourcemapOutput ./sourcemaps"

DEBUG_ID=$(eval "$CODEPUSH_COMMAND" | tee /dev/tty | grep -o 'ID de depuración del bundle: [0-9a-f-]*' | sed 's/ID de depuración del bundle: //')

MAP_FILE=$(find ./sourcemaps -name "*.map" -type f)
jq -c ". + {\"debug_id\": \"${DEBUG_ID}\"}" "${MAP_FILE}" > "${MAP_FILE}.tmp"
mv "${MAP_FILE}.tmp" "${MAP_FILE}"
```

```bash {tabTitle:JSC (AppCenter)}
appcenter codepush release-react \
  --app "${APP_NAME}" \
  --deployment-name "${DEPLOYMENT_NAME}" \
  --output-dir ./build \
  --sourcemap-output-dir ./sourcemaps
```

```bash {tabTitle:Hermes (AppCenter)}
rm -rf ./build ./sourcemaps
CODEPUSH_COMMAND="appcenter codepush release-react \
  --app \"${APP_NAME}\" \
  --deployment-name \"${DEPLOYMENT_NAME}\" \
  --use-hermes \
  --output-dir ./build \
  --sourcemap-output-dir ./sourcemaps"

DEBUG_ID=$(eval "$CODEPUSH_COMMAND" | tee /dev/tty | grep -o 'Bundle Debug ID: [0-9a-f-]*' | sed 's/Bundle Debug ID: //')

MAP_FILE=$(find ./sourcemaps -name "*.map" -type f)
jq -c ". + {\"debug_id\": \"${DEBUG_ID}\"}" "${MAP_FILE}" > "${MAP_FILE}.tmp"
mv "${MAP_FILE}.tmp" "${MAP_FILE}"
```

<div id="notes">
  ### Notas
</div>

Si usas Hermes, asegúrate de que `jq` esté instalado en tu sistema. Si no lo está, puedes instalarlo con el gestor de paquetes de tu sistema. Por ejemplo, `apt-get install jq` en Ubuntu o `brew install jq` en macOS con Homebrew.

<div id="upload-source-maps">
  ## Cargar source maps
</div>

Sube los source maps de tu versión de CodePush configurando tus variables de entorno y ejecutando el comando `sourcemaps upload`.

Antes de ejecutar el comando de subida, asegúrate de configurar tus variables de entorno.

```bash {tabTitle:Environment Variables}
export SENTRY_ORG=___ORG_SLUG___
export SENTRY_PROJECT=___PROJECT_SLUG___
export SENTRY_AUTH_TOKEN=___ORG_AUTH_TOKEN___
```

Para subir los mapas de origen de tu versión de CodePush, usa el comando `sourcemaps upload`.

```bash {tabTitle:Sentry CLI}
npx sentry-cli sourcemaps upload \
  --debug-id-reference \
  --strip-prefix /path/to/project/root \
  ./sourcemaps
```

## Notas

<div id="optional-release-and-dist">
  ### Release y dist opcionales
</div>

Para asociar los artefactos subidos con el release de CodePush, usa las opciones `--release` y `--dist`, que son parámetros del comando sentry-cli. Asegúrate de que los eventos reportados por el SDK tengan los mismos valores de `release` y `dist`. Puedes seguir el esquema predeterminado `${BUNDLE}@${VERSION}+${BUILD}` para `release` y `${BUILD}` para `dist`, o establecer los valores manualmente en `Sentry.init`. Esto es opcional cuando se suben artefactos con Debug IDs.

<div id="using-codepushgetupdatemetadata">
  ### Usar `codePush.getUpdateMetadata`
</div>

Si dependes de `codePush.getUpdateMetadata` para obtener la etiqueta de actualización de CodePush, usa `Sentry.setTag` para asociarla con los eventos capturados. Esto te permitirá filtrar eventos en la interfaz de Sentry según la etiqueta. Desaconsejamos usar `codePush.getUpdateMetadata` para inicializar el SDK, ya que retrasa la inicialización y los errores que ocurran antes de que la etiqueta de actualización de CodePush esté disponible no se reportarán a Sentry.

```javascript
codePush.getUpdateMetadata().then((update) => {
  Sentry.setTag('codepush', update.label);
});
```
