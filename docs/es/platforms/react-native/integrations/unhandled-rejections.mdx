---
title: Rechazos de promesas no controlados
description: "Conoce cómo Sentry gestiona los rechazos de promesas no controlados en React Native."
sidebar_order: 60
---

Sentry rastrea automáticamente los rechazos de promesas no controlados en aplicaciones de React Native. Desde la versión `6.15.0`, el SDK utiliza implementaciones específicas del motor para garantizar un seguimiento confiable en distintos motores de JavaScript, incluidos Hermes, JavaScriptCore (JSC) y los entornos de React Native Web.

<div id="configuration">
  ## Configuración
</div>

El seguimiento de rechazos de promesas está activado de forma predeterminada al inicializar Sentry. Puedes controlar el seguimiento de rechazos de promesas mediante `reactNativeErrorHandlersIntegration`:

```javascript
import * as Sentry from '@sentry/react-native';

Sentry.init({
  dsn: "___PUBLIC_DSN___",
  integrations: [
    Sentry.reactNativeErrorHandlersIntegration({
      onunhandledrejection: false, // Desactiva el rastreo de rechazos de promesas
    }),
  ],
});
```


<div id="engine-specific-behavior">
  ## Comportamiento específico del motor
</div>

<div id="hermes-engine">
  ### Motor Hermes
</div>

Al usar Hermes, Sentry utiliza las capacidades nativas del motor para el seguimiento de rechazos de promesas.

<Alert>

Habilitar el seguimiento de rechazos en Hermes sobrescribirá los hooks existentes debido a limitaciones del motor. Solo puede haber un rastreador de rechazos de promesas activo a la vez.

</Alert>

<div id="javascriptcore-jsc">
  ### JavaScriptCore (JSC)
</div>

Para entornos JSC, Sentry utiliza un polyfill de Promise con seguimiento de rechazos. Este enfoque también reemplaza los hooks existentes.

<Alert>

El polyfill de Promise se usa para garantizar la compatibilidad y ofrecer seguimiento de rechazos que puede no estar disponible de forma nativa en versiones antiguas de JSC.

</Alert>

<div id="react-native-web">
  ### React Native Web
</div>

Para React Native Web, Sentry aprovecha las capacidades nativas del navegador para rastrear los rechazos de promesas, ofreciendo una integración fluida con las herramientas de depuración web.

<div id="multiple-tools-and-logging">
  ## Varias herramientas y registro
</div>

Al usar varias herramientas para el seguimiento de rechazos de promesas, ten en cuenta que:

- **Hermes**: Solo puede estar activo un rastreador de rechazos. Sentry tendrá prioridad.
- **JSC**: El polyfill de Promise de Sentry reemplazará los controladores existentes.
- **React Native Web**: Puede coexistir mejor con otras herramientas de depuración basadas en el navegador.

<div id="example-using-sentry-with-other-debugging-tools">
  ### Ejemplo: usar Sentry con otras herramientas de depuración
</div>

```javascript
import * as Sentry from '@sentry/react-native';

// Para desarrollo, puedes deshabilitar el rastreo de Sentry
// para permitir que otras herramientas de depuración gestionen los rechazos de promesas
if (__DEV__) {
  Sentry.init({
    dsn: "___PUBLIC_DSN___",
    integrations: [
      Sentry.reactNativeErrorHandlersIntegration({
        onunhandledrejection: false, // Permite que otras herramientas lo gestionen en desarrollo
      }),
    ],
  });
} else {
  // En producción, usa el rastreo de Sentry
  Sentry.init({
    dsn: "___PUBLIC_DSN___",
    // Configuración por defecto con rastreo de promesas habilitado
  });
}
```


<div id="troubleshooting">
  ## Solución de problemas
</div>

Debido a un problema con las dependencias de React Native, los rechazos de promesas no gestionados podrían no ser detectados correctamente por Sentry cuando se usa el motor JavaScriptCore (JSC) o una versión del SDK de React Native anterior a `6.15.0`.

Si el controlador de rechazos de promesas no se adjuntó correctamente, nuestro SDK podría mostrar una advertencia:

> WARN: Es posible que Sentry no detecte los rechazos de promesas no gestionados. Consulta cómo solucionarlo en nuestra documentación de solución de problemas.

De lo contrario, te informaremos que el controlador está adjunto:

> [Sentry] Sentry detectará los rechazos de promesas no gestionados.

<div id="auto-patching-default-behavior">
  ### Aplicación automática de parches (comportamiento predeterminado)
</div>

De forma predeterminada, aplicaremos un parche a la instancia global de `Promise` para asegurarnos de que coincida exactamente con la versión que usa React Native.

<div id="using-with-other-polyfills">
  #### Uso con otros polyfills
</div>

Si usas una biblioteca de polyfills que modifica la instancia global de `Promise`, asegúrate de ejecutar el polyfill **después** de que se llame a `Sentry.init`.

```javascript
import allSettled from "promise.allsettled";

Sentry.init({
  dsn: "___PUBLIC_DSN___",
});
// Cualquier polyfill de Promise debe ocurrir DESPUÉS de Sentry.init
// Este paso aplica un parche global a Promise.
allSettled.shim();

// Ejemplo independiente de core-js
import "core-js/stable/promise/all-settled";
```

Puede que tu linter dé algunos errores aquí, pero este paso es necesario.


<div id="disable-auto-patching">
  #### Desactivar el parcheo automático
</div>

Puedes desactivar el parcheo global de promesas pasando `patchGlobalPromise: false` en `Sentry.init` o en la integración `ReactNativeErrorHandlers`. Ten en cuenta que, si desactivas nuestro parcheo automático, para garantizar que los rechazos no controlados se sigan capturando, tendrás que [forzar manualmente la resolución de un paquete](#manually-forcing-a-package-resolution).

<div id="manually-forcing-a-package-resolution">
  ### Forzar manualmente la resolución de un paquete
</div>

No necesitas realizar los pasos a continuación si no desactivas el [parcheo automático](#auto-patching-default-behavior). Debes asegurarte de que la versión de `promise` que uses coincida exactamente con la versión que utiliza React Native.

1. Verifica la versión de `promise` que usa tu versión de `react-native`. Puedes hacerlo yendo a `node_modules/react-native/package.json` y comprobando la versión allí; por ejemplo, encontramos que usa `^8.0.3`:

```json {filename:node_modules/react-native/package.json}
{
  "dependencies": {
    // ...
    "promise": "^8.0.3"
  }
}
```

2. Agrega una resolución de paquete con la misma versión que `react-native` en **tu** archivo `package.json`; esto forzará el uso de esa versión. Luego tendrás que ejecutar una instalación limpia con `yarn install` o `npm install` para aplicar la resolución de paquete que acabas de agregar.

```json {filename:package.json}
{
  "resolutions": {
    "promise": "^8.0.3"
  }
}
```

<Alert>
  Actualmente, las resoluciones de paquetes solo son compatibles con `yarn`. Si usas `npm`, puedes utilizar un paquete de terceros llamado [npm-force-resolutions](https://www.npmjs.com/package/npm-force-resolutions) para conseguirlo.
</Alert>

3. Si la solución funciona, nuestro SDK ya no mostrará la advertencia anterior e indicará que se capturarán las rechazos de promesas.


<div id="migration-from-older-versions">
  ## Migración desde versiones anteriores
</div>

Si estás actualizando desde una versión anterior de Sentry React Native:

1. Elimina cualquier resolución manual de polyfills de Promise en tu `package.json`
2. Elimina cualquier código personalizado para manejar rechazos de promesas
3. Actualiza a la versión más reciente de `@sentry/react-native`
4. Verifica que los rechazos de promesas se estén capturando correctamente

El nuevo enfoque específico del motor debería resolver automáticamente los problemas de compatibilidad previos.