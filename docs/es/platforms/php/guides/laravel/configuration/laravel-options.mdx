---
title: Opciones de Laravel
sidebar_order: 1
description: "Conoce la integración de Sentry con Laravel y sus opciones para breadcrumbs y tracing."
---

La mayor parte de la configuración de Laravel se realiza en tu archivo `.env`.
También puedes agregar opciones de configuración adicionales en tu archivo `config/sentry.php`.

<div id="breadcrumbs">
  ## Breadcrumbs
</div>

El SDK de Laravel creará [breadcrumbs](../../enriching-events/breadcrumbs/) para ciertos eventos que ocurren en el framework; la captura de esta información se puede configurar mediante las siguientes variables de entorno:

```php {filename:config/sentry.php}
'breadcrumbs' => [
    // Captura los logs de Laravel como breadcrumbs
    'logs' => env('SENTRY_BREADCRUMBS_LOGS_ENABLED', true),

    // Captura eventos de caché de Laravel (aciertos, escrituras, etc.) como breadcrumbs
    'cache' => env('SENTRY_BREADCRUMBS_CACHE_ENABLED', true),

    // Captura componentes de Livewire como rutas en breadcrumbs
    'livewire' => env('SENTRY_BREADCRUMBS_LIVEWIRE_ENABLED', true),

    // Captura consultas SQL como breadcrumbs
    'sql_queries' => env('SENTRY_BREADCRUMBS_SQL_QUERIES_ENABLED', true),

    // Captura los bindings (parámetros) de consultas SQL en breadcrumbs de consultas SQL
    'sql_bindings' => env('SENTRY_BREADCRUMBS_SQL_BINDINGS_ENABLED', false),

    // Captura información de trabajos de cola como breadcrumbs
    'queue_info' => env('SENTRY_BREADCRUMBS_QUEUE_INFO_ENABLED', true),

    // Captura información de comandos como breadcrumbs
    'command_info' => env('SENTRY_BREADCRUMBS_COMMAND_JOBS_ENABLED', true),

    // Captura información de solicitudes del cliente HTTP como breadcrumbs
    'http_client_requests' => env('SENTRY_BREADCRUMBS_HTTP_CLIENT_REQUESTS_ENABLED', true),

    // Captura el envío de notificaciones como breadcrumbs
    'notifications' => env('SENTRY_BREADCRUMBS_NOTIFICATIONS_ENABLED', true),
],
```

<div id="tracing">
  ## Seguimiento
</div>

Para habilitar el seguimiento, establece `SENTRY_TRACES_SAMPLE_RATE` en un valor mayor que `0.0`:

```bash {filename:.env}
# Puede que tengas que ajustar este valor en tu entorno de producción para evitar problemas de cuota
SENTRY_TRACES_SAMPLE_RATE=1.0
```

<div id="advanced-sample-rate">
  ### Frecuencia de muestreo avanzada
</div>

Si quieres más control sobre qué solicitudes se supervisan, puedes usar la opción [`traces_sampler`](/es/platforms/php/guides/laravel/configuration/options/#traces-sampler):

```php {filename:config/sentry.php}
'traces_sampler' => function (\Sentry\Tracing\SamplingContext $context): float {
    // Siempre muestreamos si el front-end indica que fue muestreada para tener trazas completas de extremo a extremo
    if ($context->getParentSampled()) {
        return 1.0;
    }

    if (some_condition()) {
        // Descarta esta transacción estableciendo su tasa de muestreo en 0
        return 0.0;
    }

    // Tasa de muestreo predeterminada para todas las demás transacciones
    return 0.25;
},
```

<Alert>
  Más información en [Closures and Config Caching](/es/platforms/php/guides/laravel/configuration/laravel-options/#closures-and-config-caching).
</Alert>

<div id="more-configuration">
  ### Más configuración
</div>

También puedes configurar qué partes de tu aplicación se rastrean automáticamente.
Estos ajustes no tienen efecto si `SENTRY_TRACES_SAMPLE_RATE` está configurado en `0.0` o si no se ha definido la variable de entorno:

```php {filename:config/sentry.php}
'tracing' => [
    // Rastrear los trabajos en cola como transacciones independientes (esto habilita el rastreo para los trabajos en cola)
    'queue_job_transactions' => env('SENTRY_TRACE_QUEUE_ENABLED', true),

    // Capturar los trabajos en cola como spans cuando se ejecuten con el driver sync
    'queue_jobs' => env('SENTRY_TRACE_QUEUE_JOBS_ENABLED', true),

    // Capturar las consultas SQL como spans
    'sql_queries' => env('SENTRY_TRACE_SQL_QUERIES_ENABLED', true),

    // Capturar los parámetros (bindings) de las consultas SQL en los spans de consultas SQL
    'sql_bindings' => env('SENTRY_TRACE_SQL_BINDINGS_ENABLED', false),

    // Capturar el origen de la consulta SQL en los spans de consultas SQL
    'sql_origin' => env('SENTRY_TRACE_SQL_ORIGIN_ENABLED', true),

    // Definir un umbral en milisegundos para resolver el origen de las consultas SQL
    'sql_origin_threshold_ms' => env('SENTRY_TRACE_SQL_ORIGIN_THRESHOLD_MS', 100),

    // Capturar las vistas renderizadas como spans
    'views' => env('SENTRY_TRACE_VIEWS_ENABLED', true),

    // Capturar los componentes de Livewire como spans
    'livewire' => env('SENTRY_TRACE_LIVEWIRE_ENABLED', true),

    // Capturar las solicitudes del cliente HTTP como spans
    'http_client_requests' => env('SENTRY_TRACE_HTTP_CLIENT_REQUESTS_ENABLED', true),

    // Capturar los eventos de caché de Laravel (hits, writes, etc.) como spans
    'cache' => env('SENTRY_TRACE_CACHE_ENABLED', true),

    // Capturar las operaciones de Redis como spans (esto habilita los eventos de Redis en Laravel)
    'redis_commands' => env('SENTRY_TRACE_REDIS_COMMANDS', false),

    // Capturar el origen del comando de Redis en los spans de comandos de Redis
    'redis_origin' => env('SENTRY_TRACE_REDIS_ORIGIN_ENABLED', true),

    // Capturar el envío de notificaciones como spans
    'notifications' => env('SENTRY_TRACE_NOTIFICATIONS_ENABLED', true),

    // Habilitar el rastreo para solicitudes sin una ruta coincidente (404)
    'missing_routes' => env('SENTRY_TRACE_MISSING_ROUTES_ENABLED', false),

    // Configura si el rastreo de rendimiento debe continuar, desde que se envía la respuesta al usuario hasta que la aplicación finaliza
    // Esto es necesario para capturar cualquier span creado después de enviar la respuesta, por ejemplo, trabajos en cola despachados con `dispatch(...)->afterResponse()`
    'continue_after_response' => env('SENTRY_TRACE_CONTINUE_AFTER_RESPONSE', true),

    // Habilitar las integraciones de rastreo proporcionadas por Sentry (recomendado)
    'default_integrations' => env('SENTRY_TRACE_DEFAULT_INTEGRATIONS_ENABLED', true),
],
```

<div id="closures-and-config-caching">
  ## Closures y caché de configuración
</div>

A veces, el SDK requiere un closure como valor de una opción. Sin embargo, esto genera problemas al usar `php artisan config:cache`, produciendo el error `Your configuration files are not serializable`.

Podemos evitarlo proporcionando un callable en lugar de un closure. En este ejemplo usamos la opción `traces_sampler`, pero esto se puede usar para cualquier otra opción que acepte un closure:

```php {filename:config/sentry.php}
'traces_sampler' => [App\Exceptions\Sentry::class, 'tracesSampler'],
```

Este callable apunta a la clase `App\Exceptions\Sentry` y al método `tracesSampler`:

```php {filename:app/Exceptions/Sentry.php}
<?php

namespace App\Exceptions;

use Sentry\Tracing\SamplingContext;

class Sentry
{
    public static function tracesSampler(SamplingContext $context): float
    {
        // El código que habrías colocado en el closure...
    }
}
```
