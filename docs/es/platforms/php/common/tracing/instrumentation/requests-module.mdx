---
title: Instrumentar solicitudes HTTP
sidebar_order: 2000
description: "Aprende a instrumentar manualmente tu código para usar el módulo Requests de Sentry."
---

Sentry ofrece un [panel de monitoreo de solicitudes](https://sentry.io/orgredirect/organizations/:orgslug/insights/backend/http/) que puede instrumentarse automáticamente con nuestro [SDK de Laravel](/es/platforms/php/guides/laravel/) y [SDK de Symfony](/es/platforms/php/guides/symfony/).

Si usas otro framework o biblioteca, puedes instrumentar manualmente tus solicitudes y usar Sentry para ver cómo rinden tus solicitudes a APIs siguiendo las instrucciones de configuración a continuación.

Asegúrate de que haya una transacción en curso cuando crees los spans. Consulta <PlatformLink to="/tracing/">Tracing</PlatformLink> para obtener más información.

<div id="custom-instrumentation">
  ## Instrumentación personalizada
</div>

Para obtener información detallada sobre qué datos pueden configurarse, consulta las [especificaciones del módulo Requests para desarrolladores](https://develop.sentry.dev/sdk/performance/modules/requests/) y las [convenciones de datos de spans HTTP](https://develop.sentry.dev/sdk/performance/span-data-conventions/#http).

<div id="using-the-guzzletracingmiddleware">
  ### Uso de `GuzzleTracingMiddleware`
</div>

Si usas [Guzzle](https://github.com/guzzle/guzzle), puedes inyectar el `GuzzleTracingMiddleware` de Sentry en tu `HandlerStack`.

```php
$stack = \GuzzleHttp\HandlerStack::create();
$stack->setHandler(new \GuzzleHttp\Handler\CurlHandler());
$stack->push(\Sentry\Tracing\GuzzleTracingMiddleware::trace());

$client = new \GuzzleHttp\Client(['handler' => $stack]);
$response = $client->get('https://example.com/');
```

<div id="wrap-http-requests-in-a-span">
  ### Envuelve las solicitudes HTTP en un span
</div>

Aquí tienes un ejemplo de cómo instrumentar una solicitud HTTP:

```php
$parentSpan = \Sentry\SentrySdk::getCurrentHub()->getSpan();

if ($parentSpan !== null) {
    $context = \Sentry\Tracing\SpanContext::make()
        ->setOp('http.client');
    $span = $parentSpan->startChild($context);

    // Establecer el span que acabamos de iniciar como el span actual
    \Sentry\SentrySdk::getCurrentHub()->setSpan($span);
    
    $client = new \Cake\Http\Client();
    $response = $client->get('https://example.com/');
    
    $span
        ->setDescription('GET https://example.com/')
        ->setStatus(\Sentry\Tracing\SpanStatus::createFromHttpStatusCode($response->getStatusCode()))
        ->setData([
            'http.request.method' => 'GET',
            'http.response.body.size' => $response->getBody()->getSize(),
            'http.response.status_code' => $response->getStatusCode(),
        ])
        ->finish();

    // Restaurar el span al span padre
    \Sentry\SentrySdk::getCurrentHub()->setSpan($parentSpan);
}
```
