---
title: Instrumentación de cachés
sidebar_order: 1000
description: "Aprende a instrumentar manualmente tu código para usar el módulo Caches de Sentry. "
---

Sentry ofrece un [panel de monitorización de cachés](https://sentry.io/orgredirect/organizations/:orgslug/insights/backend/caches/) que puede instrumentarse automáticamente con nuestro [SDK de Laravel](/es/platforms/php/guides/laravel/).

Si usas otra tecnología, puedes instrumentar manualmente tus operaciones de caché y utilizar Sentry para ver cómo rinde tu solución de caché siguiendo las instrucciones de configuración a continuación.

Para que Sentry pueda darte una visión general del rendimiento de tu caché, necesitas crear dos spans: uno que indique que algo se guarda en la caché y otro que indique que algo se obtiene de la caché.

Asegúrate de que haya una transacción en ejecución cuando crees los spans. Consulta <PlatformLink to="/tracing/">Tracing</PlatformLink> para obtener más información.

Para obtener información detallada sobre qué datos se pueden establecer, consulta la [especificación del módulo de caché para desarrolladores](https://develop.sentry.dev/sdk/performance/modules/caches/).

<div id="custom-instrumentation">
  ## Instrumentación personalizada
</div>

Si usas algo distinto de nuestro [SDK de Laravel](/es/platforms/php/guides/laravel/), tendrás que instrumentar manualmente el [módulo de caché](https://sentry.io/orgredirect/organizations/:orgslug/insights/backend/caches/) siguiendo los pasos a continuación.

<div id="add-span-when-putting-data-into-the-cache">
  ### Agregar un span al guardar datos en la caché
</div>

Si la caché que estás usando no es compatible con la instrumentación automática mencionada arriba, puedes seguir las instrucciones de instrumentación personalizada a continuación para emitir spans de caché:

1. Guarda el valor en la caché con la biblioteca de caché que estés usando.
2. Envuelve en un span la parte de tu aplicación que usa el valor en caché.
3. Establece `op` en `cache.put`.
4. Establece `cache.item_size` en un número entero que represente el tamaño del elemento en caché.

(Los pasos descritos arriba están documentados en el fragmento).

```php
$key = 'cache_key';
$value = 'cache_value';

$parentSpan = \Sentry\SentrySdk::getCurrentHub()->getSpan();

if ($parentSpan !== null) {
    $context = \Sentry\Tracing\SpanContext::make()
        ->setDescription($key)
        ->setOp('cache.put');

    $span = $parentSpan->startChild($context);

    \Sentry\SentrySdk::getCurrentHub()->setSpan($span);

    // Realiza la operación de caché
    Cache::put($key, $value);
    
    $span
        ->setData([
            // Describe el servidor de caché al que estás accediendo
            'network.peer.address' => '127.0.0.1',
            'network.peer.port' => 9000,
            // Agrega la clave que utilizaste
            'cache.key' => $key,
            // Opcionalmente, agrega el tamaño del valor que estableciste
            'cache.item_size' => strlen($value),
        ])
        ->finish();

    \Sentry\SentrySdk::getCurrentHub()->setSpan($parentSpan);
}
```

<div id="add-span-when-retrieving-data-from-the-cache">
  ### Agrega un span al recuperar datos de la caché
</div>

Si la caché que estás usando no es compatible con la autoinstrumentación mencionada arriba, puedes seguir las instrucciones de instrumentación personalizada a continuación para emitir spans de caché:

1. Obtén el valor desde la biblioteca de caché que estés usando.
2. Encapsula en un span la parte de tu aplicación que usa el valor en caché.
3. Establece `op` en `cache.get`.
4. Establece `cache.hit` en un valor booleano que indique si el valor se obtuvo correctamente de la caché o no.
5. Establece `cache.item_size` en un entero que represente el tamaño del elemento en caché.

(Los pasos descritos arriba están documentados en el snippet).

```php
$key = 'cache_key';
$value = null;

$parentSpan = \Sentry\SentrySdk::getCurrentHub()->getSpan();

if ($parentSpan !== null) {
    $context = \Sentry\Tracing\SpanContext::make()
        ->setOp('cache.get');

    $span = $parentSpan->startChild($context);

    \Sentry\SentrySdk::getCurrentHub()->setSpan($span);

    // Realiza la operación de caché
    $value = Cache::get($key);
    
    $span->setData([
        // Describe el servidor de caché al que estás accediendo
        'network.peer.address' => '127.0.0.1',
        'network.peer.port' => 9000,
        // Agrega la clave que acabas de obtener de la caché
        'cache.key' => $key
    ]);

    if ($value !== null) {
        $span->setData([
            // Si obtuviste un valor, fue un acierto de caché (cache hit)
            'cache.hit' => true,
            // Opcionalmente, agrega el tamaño del valor obtenido
            'cache.item_size' => strlen($value),
        ]);
    } else {
        $span->setData([
            // Si no pudiste obtener un valor, fue un fallo (cache miss)
            'cache.hit' => false,
        ]);
    }

    $span->finish();

    \Sentry\SentrySdk::getCurrentHub()->setSpan($parentSpan);
}
```

Ahora deberías tener los spans correctos en su lugar. Ve al [panel de caché](https://sentry.io/orgredirect/organizations/:orgslug/insights/backend/caches/) para ver cómo está rindiendo tu caché.
