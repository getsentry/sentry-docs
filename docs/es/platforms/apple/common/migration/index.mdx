---
title: Guía de migración
sidebar_order: 8000
---

Para actualizar de la versión 4.x del SDK a la 8.x, primero debes migrar de 4.x a 5.x, luego de 5.x a 6.x, después de 6.x a 7.x y, por último, de 7.x a 8.x.

<div id="migrating-from-7x-to-8x">
  ## Migración de 7.x a 8.x
</div>

La migración de 7.x a 8.x incluye algunos cambios incompatibles. Ofrecemos esta guía para ayudarte a actualizar tu SDK. Es importante señalar que esta versión agrega una dependencia de Swift y que cambiamos el nombre de la rama predeterminada en el [repositorio sentry-cocoa](https://github.com/getsentry/sentry-cocoa) de `master` a `main`.

<div id="changes-to-minimum-os-versions-and-xcode">
  ### Cambios en las versiones mínimas de los sistemas operativos y de Xcode
</div>

Las versiones mínimas de los sistemas operativos compatibles ahora son macOS 10.13, iOS 11, tvOS 11 y watchOS 4. También actualizamos la versión mínima de Xcode a la 13.

<div id="features-enabled-by-default">
  ### Funciones habilitadas de forma predeterminada
</div>

Las siguientes funciones ahora están habilitadas de forma predeterminada:

* <PlatformLink to="/tracing/instrumentation/automatic-instrumentation/#user-interaction-tracing"> Integración de trazado de la interacción del usuario </PlatformLink>
* <PlatformLink to="/tracing/instrumentation/automatic-instrumentation/#file-io-tracking"> Integración de trazado de E/S de archivos </PlatformLink>
* <PlatformLink to="/tracing/instrumentation/automatic-instrumentation/#core-data-tracing"> Integración de trazado de Core Data </PlatformLink>
* <PlatformLink to="/configuration/http-client-errors/"> Captura de solicitudes con error </PlatformLink>
* <PlatformLink to="/configuration/app-hangs/">Bloqueos de la app</PlatformLink> (no disponible para watchOS)

<div id="changes-to-grouping">
  ### Cambios en la agrupación
</div>

Es posible que los eventos de App Hang se agrupen de forma diferente, ya que ahora establecemos la propiedad de instantánea de la traza de la pila del evento en `true`.

<div id="rename-oom-to-watchdog-termination">
  ### Cambiar el nombre de OOM a Terminación por Watchdog
</div>

La integración OOM (out of memory) en realidad detecta [terminaciones por watchdog](https://developer.apple.com/documentation/xcode/addressing-watchdog-terminations) basadas en heurísticas. Cambiamos el nombre de la integración para reflejar mejor lo que hace.

### Cambios importantes

<div id="configuration-changes">
  #### Cambios de configuración
</div>

Esta versión incluye los siguientes cambios de configuración:

* Cambiar `SentryOptions.enableAutoPerformanceTracking` a `SentryOptions.enableAutoPerformanceTracing`
* Cambiar `SentryOptions.enableUIViewControllerTracking` a `SentryOptions.enableUIViewControllerTracing`
* Cambiar `SentryOptions.enablePreWarmedAppStartTracking` a `SentryOptions.enablePreWarmedAppStartTracing`
* Cambiar `SentryOptions.enableFileIOTracking` a `SentryOptions.enableFileIOTracing`
* Cambiar `SentryOptions.enableCoreDataTracking` a `SentryOptions.enableCoreDataTracing`
* Cambiar `SentryOptions.enableOutOfMemoryTracking` a `SentryOptions.enableWatchdogTerminationTracking`

<div id="swift-api-improvements">
  #### Mejoras en la API de Swift
</div>

Realizamos algunos cambios para que la API sea más ergonómica en Swift:

* Cambiar el nombre de `SentrySDK.addBreadcrumb(crumb:)` a `SentrySDK.addBreadcrumb(_ crumb:)`
* Cambiar el nombre de `SentryScope.add(_ crumb:)` a `SentryScope.addBreadcrumb(_ crumb:)`
* Cambiar el nombre de `SentryScope.add(_ attachment:)` a `SentryScope.addAttachment(_ attachment:)`
* Cambiar el nombre de `Client` a `SentryClient`

<div id="cleanup-public-classes">
  #### Limpieza de clases públicas
</div>

Hemos limpiado nuestras clases públicas eliminando algunas funciones y propiedades que no deberían ser públicas para que la API sea más clara. Si eliminamos algo que necesitas, por favor [abre un issue](https://github.com/getsentry/sentry-cocoa/issues/new/choose) en GitHub.

* Hacer que `SpanProtocol.data` no sea anulable
* Marcar `[SpanProtocol setExtraValue:forKey:]` como obsoleto
* Hacer que `SpanContext` sea inmutable
  * Eliminar las tags de `SpanContext`
  * Eliminar la propiedad context de `SentrySpan`
* Eliminar `SentryScope.apply(to:)`
* Eliminar `SentryScope.apply(to:maxBreadcrumb:)`
* Eliminar `[SentryOptions initWithDict:didFailWithError:]`
* Eliminar `[SentryOptions sdkInfo]`
* Hacer que `SentrySession` y `SentrySDKInfo` sean internas
* Eliminar el tipo de contenido predeterminado de los adjuntos
* Eliminar `captureEnvelope` de `SentryHub` y `SentryClient`
* Eliminar la etiqueta de transacción confusa

<div id="sdk-inits">
  #### Inicializaciones del SDK
</div>

Eliminamos la versión de `SentrySDK.startWithOptions` que recibía un diccionario y renombramos `SentrySDK.startWithOptionsObject` a `SentrySDK.startWithOptions`. La forma recomendada de inicializar Sentry no ha cambiado:

```swift {tabTitle:Swift}
import Sentry

SentrySDK.start { options in
    options.dsn = "___PUBLIC_DSN___"
    // ...
}
```

```objc {tabTitle:Objective-C}
@import Sentry;

[SentrySDK startWithConfigureOptions:^(SentryOptions *options) {
    options.dsn = @"___PUBLIC_DSN___";
    // ...
}];
```

<div id="sentrysdkclose-is-now-blocking">
  #### SentrySDK.close ahora es bloqueante
</div>

`SentrySDK.close` ahora llama a flush, que es una llamada de bloqueo.

<div id="migrating-from-6x-to-7x">
  ## Migrar de 6.x a 7.x
</div>

<Alert title="Importante">
  Recomendamos actualizar, como mínimo, a la versión [7.5.3](https://github.com/getsentry/sentry-cocoa/releases/tag/7.5.3), ya que la instrumentación HTTP puede causar bloqueos. Como alternativa, también puedes <PlatformLink to="/tracing/instrumentation/automatic-instrumentation/#network-tracking">desactivar esta función</PlatformLink>.
</Alert>

La migración de 6.x a 7.x incluye algunos cambios incompatibles. Te ofrecemos esta guía para ayudarte a actualizar tu SDK.

### Cambios de configuración

Esta versión incluye los siguientes cambios de configuración:

* Cambia el número máximo predeterminado de sobres en caché de 100 a 30. Ahora puedes configurar este valor con `SentryOptions.maxCacheItems`.
* Cuando se establece un valor de `SentryOptions.sampleRate` que no sea &gt;= 0.0 y &lt;= 1.0, el SDK lo ajusta al valor predeterminado de 1.0 en lugar de mantener el valor indicado.

<div id="breaking-changes">
  ### Cambios incompatibles
</div>

<div id="issue-grouping">
  #### Agrupación de incidencias
</div>

Esta versión introduce un cambio en la agrupación de incidencias. El SDK ahora establece la marca `inApp`
solo para los frames que provienen del ejecutable principal usando [CFBundleExecutable](https://developer.apple.com/documentation/bundleresources/information_property_list/cfbundleexecutable).
En versiones anteriores, todos los frames que se originaban en el paquete (bundle) de la aplicación se marcaban como `inApp`. Esto tenía la
desventaja de marcar como `inApp` los frames de frameworks privados dentro del paquete. Este problema ya está resuelto.
Las aplicaciones que usan frameworks estáticos no deberían verse afectadas por este cambio.
Para obtener más información, consulta [marcar frames in-app](/es/concepts/data-management/event-grouping/stack-trace-rules/#mark-in-app-frames).

<div id="cleanup-public-classes">
  #### Limpieza de clases públicas
</div>

Limpiamos nuestras clases públicas eliminando algunas funciones y propiedades que no deberían ser públicas, para que la API sea más clara. Si quitamos algo que necesitas, por favor [abre un issue](https://github.com/getsentry/sentry-cocoa/issues/new/choose) en GitHub.

* Eliminar `SentrySDK.currentHub` y `SentrySDK.setCurrentHub`.
* Eliminar `SentryClient.storeEnvelope`, que está reservado para SDK híbridos.
* Hacer privado `closeCachedSessionWithTimestamp`, reservado para uso interno.
* Eliminar el obsoleto `SentryHub.getScope`. Usa `SentryHub.scope` en su lugar.
* Reemplazar `SentryException.thread` por `SentryException.threadId` y `SentryException.stacktrace` para alinearse con la [API unificada](https://develop.sentry.dev/sdk/miscellaneous/unified-api/).
* Reemplazar el diccionario `SentryMechanism.meta` por la nueva clase `SentryMechanismMeta` y mover `SenryNSError` a `SentryMechanismMeta` para alinearse con la [API unificada](https://develop.sentry.dev/sdk/miscellaneous/unified-api/).
* Cambiar `SentryEvent.timestamp` a `nullable`.

<div id="sentryloglevel">
  ### SentryLogLevel
</div>

Reemplazamos `SentryLogLevel` por `SentryLevel`, renombramos `logLevel` a `diagnosticLevel`
en `SentryOptions` para alinearlo con otros SDK de Sentry y establecimos el `diagnosticLevel` predeterminado en
`SentryLevel.debug`. Además, eliminamos la configuración estática de `logLevel` en `SentrySDK`.
Utiliza `SentryOptions` para configurar el `diagnosticLevel`.

6.x

```swift
SentrySDK.start { options in
  options.logLevel = SentryLogLevel.verbose
}

// O

SentrySDK.logLevel = SentryLogLevel.verbose
```

7.x

```swift
SentrySDK.start { options in
  options.diagnosticLevel = SentryLevel.debug
}
```

<div id="migrating-from-5x-to-6x">
  ## Migración de 5.x a 6.x
</div>

La migración de 5.x a 6.x incluye algunos cambios incompatibles. Te ofrecemos esta guía para ayudarte a actualizar tu SDK.

### Cambios de configuración

Esta versión incluye los siguientes cambios de configuración:

* [Auto Session Tracking](https://github.com/getsentry/sentry-cocoa/blob/7876949ca78aebfe7883432e35727993c5c30829/Sources/Sentry/include/SentryOptions.h#L101) está activado de forma predeterminada. [Esta función](/es/product/releases/health/) recopila y envía datos de salud sobre el uso de tu
  aplicación.
* [Attach stack traces](https://github.com/getsentry/sentry-cocoa/blob/b5bf9769a158c66a34352556ade243e55f163a27/Sources/Sentry/Public/SentryOptions.h#L109) está activado de forma predeterminada.
* Aumentamos la versión mínima de iOS a 9.0.
* Se usa un BOOL en SentryOptions en lugar de NSNumber para almacenar valores booleanos.
* Anteriormente habíamos eliminado la opción [enabled](https://github.com/getsentry/sentry-cocoa/blob/5.2.2/Sources/Sentry/include/SentryOptions.h#L63) de SentryOptions, pero la volvimos a incluir en la versión 6.0.7 con una funcionalidad ligeramente modificada. Antes, establecer un DSN vacío o incorrecto también establecía `enabled` en `false`. Este efecto secundario se eliminó. Establecer el DSN no afecta a `enabled`. Si el DSN es nil o está vacío, o si `enabled` está establecido en `false`, el cliente no enviará ningún dato a Sentry.

### Cambios importantes

<div id="store-endpoint">
  #### Endpoint de Store
</div>

Esta versión usa el [endpoint de envelope](https://develop.sentry.dev/sdk/data-model/envelopes/). Si usas Sentry autohospedado, debes usar la versión de Sentry `>= v20.6.0` o una superior. Si usas sentry.io, no hay impacto. Con este cambio, ahora también almacenamos en caché los eventos en envelopes en el disco. Decidimos no migrar los pocos eventos en caché de la 5.x a la 6.x a envelopes; en su lugar, los eliminamos del disco. Como resultado, podrías perder algunos eventos en caché al actualizar.

<div id="sdk-inits">
  #### Inicializaciones del SDK
</div>

Eliminamos las [inicializaciones del SDK en desuso](https://github.com/getsentry/sentry-cocoa/blob/5.2.2/Sources/Sentry/include/SentrySDK.h#L35-L47). La forma recomendada de inicializar Sentry ahora es:

```swift {tabTitle:Swift}
importar Sentry

SentrySDK.start { options in
    options.dsn = "___PUBLIC_DSN___"
    // ...
}
```

```objc {tabTitle:Objective-C}
@import Sentry;

[SentrySDK startWithConfigureOptions:^(SentryOptions *options) {
    options.dsn = @"___PUBLIC_DSN___";
    // ...
}];
```

<div id="cleanup-public-headers">
  #### Limpieza de los Headers públicos
</div>

Hemos limpiado nuestros Headers públicos y hemos hecho privadas la mayoría de nuestras clases. Si no puedes acceder a alguna de las clases que necesitas, [abre un issue](https://github.com/getsentry/sentry-cocoa/issues/new/choose) y cuéntanos tu caso de uso para que podamos evaluar si conviene volver a hacer pública la clase o proporcionarte otra API.

<div id="new-type-sentryid-for-eventid">
  #### Nuevo tipo SentryId para eventId
</div>

En 5.x, usábamos un NSString anulable para representar un ID de evento. El SDK, el Hub y el Client devolvían este NSString anulable como ID de evento al capturar mensajes, eventos, errores, etc. En 6.x, tenemos un nuevo tipo, SentryId, que no es anulable, para representar un ID de evento. En lugar de devolver `nil` cuando un evento no puede ponerse en cola para su envío, devolvemos `SentryId.empty`.

Ejemplo en 5.x:

```swift {tabTitle:Swift}
import Sentry

let eventId = SentrySDK.capture(message: "Un mensaje")
if (nil != eventId) {
    // el evento se ha puesto en cola para su envío
} else {
    // el evento no se ha puesto en cola para su envío
}
```

```objc {tabTitle:Objective-C}
@import Sentry;

SentryId *eventId = [SentrySDK captureMessage:@"Un mensaje"];
if (nil != eventId) {
    // el evento se ha puesto en cola para su envío
} else {
    // el evento no se ha puesto en cola para su envío
}
```

Ejemplo en la 6.x:

```swift {tabTitle:Swift}
import Sentry

let eventId = SentrySDK.capture(message: "Un mensaje")
if (eventId != SentryId.empty) {
    // el evento se ha puesto en cola para su envío
} else {
    // el evento no se ha puesto en cola para su envío
}
```

```objc {tabTitle:Objective-C}
@import Sentry;

SentryId *eventId = [SentrySDK captureMessage:@"A message"];
if (eventId != SentryId.empty) {
    // el evento se ha puesto en cola para su envío
} else {
    // el evento no se ha puesto en cola para su envío
}
```

<div id="new-type-sentrymessage-for-eventmessage">
  #### Nuevo tipo SentryMessage para Event.message
</div>

En la versión 6.x, presentamos un nuevo tipo [SentryMessage](https://develop.sentry.dev/sdk/data-model/event-payloads/message/) para `event.message`. SentryMessage te permite enviar a Sentry una cadena de formato con parámetros, lo que puede ayudar a agrupar mensajes similares en la misma incidencia.

Ejemplo en 5.x:

```swift {tabTitle:Swift}
import Sentry

let event = Event()
event.message = "Hola, mundo"
```

```objc {tabTitle:Objective-C}
@import Sentry;

SentryEvent *event = [[SentryEvent alloc] init];
event.message = "Hola, Mundo";
```

Ejemplo en la 6.x:

```swift {tabTitle:Swift}
import Sentry

let event = Event()
event.message = SentryMessage(formatted: "Hola mundo")
```

```objc {tabTitle:Objective-C}
@import Sentry;

SentryEvent *event = [[SentryEvent alloc] init];
event.message = [SentryMessage messageWithFormatted:"Hola, mundo"];
```

<div id="make-scope-nonnull-for-capture-methods">
  #### Hacer que Scope sea no nulo para los métodos de captura
</div>

En 5.x, podías pasar un `Scope` anulable a los métodos de captura del SDK, Hub y Client, como `SentrySdk.captureMessage()`. En 6.x, cambiamos Scope a no nulo y proporcionamos sobrecargas para Hub y Client.

Consulta el [Changelog](https://github.com/getsentry/sentry-cocoa/blob/main/CHANGELOG.md) para ver la lista completa de cambios.

<div id="upgrading-from-4x-to-5x">
  ## Actualización de 4.x a 5.x
</div>

Los siguientes ejemplos muestran cómo funciona el SDK:

<div id="initialization">
  ### Inicialización
</div>

Ejemplo en 4.x:

```swift {tabTitle:Swift}
do {
    Client.shared = try Client(dsn: "___PUBLIC_DSN___")
    try Client.shared?.startCrashHandler()
} catch let error {
    print("\(error)")
}
```

```objc {tabTitle:Objective-C}
NSError *error = nil;
SentryClient *client = [[SentryClient alloc] initWithDsn:@"___PUBLIC_DSN___" didFailWithError:&error];
SentryClient.sharedClient = client;
[SentryClient.sharedClient startCrashHandlerWithError:&error];
if (nil != error) {
    NSLog(@"%@", error);
}
```

Ejemplo en la 5.x:

```swift {tabTitle:Swift}
SentrySDK.start(options: [
    "dsn": "___PUBLIC_DSN___",
    "debug": true
])
```

```objc {tabTitle:Objective-C}
[SentrySDK startWithOptions:@{
    @"dsn": @"___PUBLIC_DSN___",
    @"debug": @(YES)
}];
```

<div id="add-breadcrumb">
  ### Agregar migas de pan
</div>

Ejemplo en la versión 4.x:`

```swift {tabTitle:Swift}
Client.shared?.breadcrumbs.add(Breadcrumb(level: .info, category: "test"))
```

```objc {tabTitle:Objective-C}
[SentryClient.sharedClient.breadcrumbs addBreadcrumb:[[SentryBreadcrumb alloc] initWithLevel:kSentrySeverityInfo category:@"prueba"]];
```

Ejemplo en la versión 5.x:

```swift {tabTitle:Swift}
SentrySDK.addBreadcrumb(Breadcrumb(level: .info, category: "prueba"))
```

```objc {tabTitle:Objective-C}
[SentrySDK addBreadcrumb:[[SentryBreadcrumb alloc] initWithLevel:kSentrySeverityInfo category:@"test"]];
```

<div id="capturemessage-with-tagsenvironmentextra">
  ### CaptureMessage con etiquetas/entorno/extra
</div>

Ejemplo en la versión 4.x:

```swift {tabTitle:Swift}
let event = Event(level: .debug)
event.message = "Mensaje de prueba"
event.environment = "staging"
event.extra = ["ios": true]
Client.shared?.send(event: event)
```

```objc {tabTitle:Objective-C}
SentryEvent *event = [[SentryEvent alloc] initWithLevel:kSentrySeverityDebug];
event.message = @"Mensaje de prueba";
event.environment = @"preproducción";
event.extra = @{@"ios": @(YES)};
[SentryClient.sharedClient sendEvent:event withCompletionHandler:nil];
```

Ejemplo en la versión 5.x:

```swift {tabTitle:Swift}
SentrySDK.capture(message: "Mensaje de prueba") { (scope) in
    scope.setEnvironment("preproducción")
    scope.setExtras(["ios": true])
    let u = Sentry.User(userId: "1")
    u.email = "tony@example.com"
    scope.setUser(u)
}
```

```objc {tabTitle:Objective-C}
[SentrySDK captureMessage:@"Mensaje de prueba" withScopeBlock:^(SentryScope * _Nonnull scope) {
    [scope setEnvironment:@"preproducción"];
    [scope setExtras:@{@"ios": @(YES)}];
    SentryUser *user = [[SentryUser alloc] initWithUserId:@"1"];
    user.email = @"tony@ejemplo.com";
    [scope setUser:user];
}];
```

<div id="setuser">
  ### setUser
</div>

Ejemplo en 4.x:

```swift {tabTitle:Swift}
let u = User(userId: "1")
u.email = "tony@example.com"
Client.shared?.user = u
```

```objc {tabTitle:Objective-C}
SentryUser *user = [[SentryUser alloc] initWithUserId:@"1"];
user.email = @"tony@example.com";
SentryClient.sharedClient.user = user;
```

Ejemplo en la versión 5.x:

```swift {tabTitle:Swift}
let u = Sentry.User(userId: "1")
u.email = "tony@example.com"
SentrySDK.setUser(u)
```

```objc {tabTitle:Objective-C}
SentryUser *user = [[SentryUser alloc] initWithUserId:@"1"];
user.email = @"tony@example.com";
[SentrySDK setUser:user];
```
