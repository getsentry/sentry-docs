---
title: Bloqueos de la app
sidebar_order: 11
description: Aprende a agregar el reporte de detección de bloqueos de la app.
og_image: /og-images/platforms-apple-common-configuration-app-hangs.png
---

<Alert>
  Recomendamos desactivar esta función para Widgets y Live Activities porque podría detectar falsos positivos.

  Además, el SDK de Cocoa podría reportar bloqueos de la app cuando el SO abre un cuadro de diálogo del sistema solicitando permisos específicos,
  por ejemplo, si el usuario quiere permitir que tu app pegue desde el portapapeles. Como no podemos detectar de forma confiable estos escenarios,
  te aconsejamos [pausar y reanudar el seguimiento de bloqueos de la app](#pause-and-resume-app-hang-tracking) para evitar este problema.
</Alert>

Esta integración rastrea los bloqueos de la app. Esta función está disponible en iOS, tvOS y macOS.

Intentar usar una app que no responde es extremadamente frustrante para los usuarios. Hay muchas razones por las que una app puede dejar de responder, como código de ejecución prolongada, errores de bucle infinito, etc. Con el seguimiento de bloqueos de la app puedes detectarlos y solucionarlos.

La integración de detección de bloqueos de la app tiene un tiempo de espera predeterminado de dos (2) segundos, pero con la versión 7.24.0 hemos mejorado el algoritmo para detectar los bloqueos antes, pasando de `appHangTimeoutInterval * 2` a `appHangTimeoutInterval * 1.2`.

Para detectar bloqueos de la app, el SDK inicia un hilo watchdog dedicado llamado `io.sentry.AppHangTracker`, que encola periódicamente tareas en el hilo principal y verifica si el hilo principal las ejecuta dentro del tiempo de espera. Si la app no responde durante dos segundos o más, crea un evento de error. Este hilo también es usado por <PlatformLink to="/configuration/watchdog-terminations/">Watchdog Terminations</PlatformLink> y se iniciará incluso si `enableAppHangTracking` está deshabilitado.

Registrar la traza de pila exactamente cuando ocurre el bloqueo de la app funciona de manera confiable si la app está completamente atascada, pero si el hilo principal está extremadamente ocupado con diferentes partes del código, la detección del bloqueo puede activarse un poco tarde. Si esto sucede, el SDK puede registrar una traza de pila que no esté 100% relacionada con el código que causó el bloqueo. Cada evento incluye una traza de pila de todos los hilos en ejecución para que puedas detectar fácilmente dónde ocurrió el problema.

El SDK reporta un bloqueo de la app de inmediato, pero no informa la duración exacta porque el [watchdog](https://developer.apple.com/documentation/xcode/addressing-watchdog-terminations) podría cerrar la app en cualquier momento si está bloqueando el hilo principal.

Como la integración de detección de bloqueos de la app usa SentryCrashIntegration para capturar la traza de pila al crear eventos de bloqueo, SentryCrashIntegration debe estar habilitada para que la integración funcione.

Puedes filtrar y modificar eventos de bloqueo de la app en `beforeSend` comprobando el tipo de excepción del evento:

```swift {tabTitle:Swift}
import Sentry

SentrySDK.start { options in
    options.dsn = "___PUBLIC_DSN___"
    options.beforeSend = { event in
        if (event.exceptions?.first?.type == "App Hanging") {
          // modifica el evento aquí o devuelve nil para descartarlo
        }
        return event
    }
}
```

```objc {tabTitle:Objective-C}
@import Sentry;

[SentrySDK startWithConfigureOptions:^(SentryOptions *options) {
    options.dsn = @"___PUBLIC_DSN___";
    options.beforeSend = ^SentryEvent * _Nullable(SentryEvent * _Nonnull event) {
        if ([self.exceptions.count == 1 && event.exceptions.firstObject.type isEqualToString:@"App Hanging"]) {
          // modifica el evento aquí o devuelve nil para descartarlo
        }
        return event;
    }
}];
```

A partir de la versión 8.0.0, esta función está activada de forma predeterminada. Para desactivarla:

```swift {tabTitle:Swift}
import Sentry

SentrySDK.start { options in
    options.dsn = "___PUBLIC_DSN___"
    options.enableAppHangTracking = false
}
```

```objc {tabTitle:Objective-C}
@import Sentry;

[SentrySDK startWithConfigureOptions:^(SentryOptions *options) {
    options.dsn = @"___PUBLIC_DSN___";
    options.enableAppHangTracking = NO;
}];

```

Puedes ajustar el tiempo de espera cambiando la opción `appHangTimeoutInterval`:

```swift {tabTitle:Swift}
import Sentry

SentrySDK.start { options in
    options.dsn = "___PUBLIC_DSN___"
    options.appHangTimeoutInterval = 1
}
```

```objc {tabTitle:Objective-C}
@import Sentry;

[SentrySDK startWithConfigureOptions:^(SentryOptions *options) {
    options.dsn = @"___PUBLIC_DSN___";
    options.appHangTimeoutInterval = 1;
}];

```


<div id="pause-and-resume-app-hang-tracking">
  ### Pausar y reanudar el seguimiento de bloqueos de la app
</div>

A partir de la versión 8.30.0, puedes pausar y reanudar el seguimiento de bloqueos de la app en tiempo de ejecución con `SentrySDK.pauseAppHangTracking()` y `SentrySDK.resumeAppHangTracking()`.
Estos métodos no impiden que la integración de <PlatformLink to="/configuration/metric-kit">MetricKit</PlatformLink> informe [MXHangDiagnostic](https://developer.apple.com/documentation/metrickit/mxhangdiagnostic).

```swift {tabTitle:Swift}
import Sentry

SentrySDK.pauseAppHangTracking()

// Haz algo que pueda hacer que la app se cuelgue,
// y no quieres que el SDK de Cocoa lo reporte.

SentrySDK.resumeAppHangTracking()
```

```objc {tabTitle:Objective-C}
@import Sentry;

[SentrySDK pauseAppHangTracking];

// Haz algo que pueda provocar que la aplicación se cuelgue,
// y no quieres que el SDK de Cocoa lo informe.

[SentrySDK resumeAppHangTracking];

```


<div id="app-hangs-v2">
  ### Bloqueos de la app V2
</div>

A partir de la versión 8.50.0, puedes habilitar AppHangsV2, disponible en iOS y tvOS. La principal diferencia es que AppHangsV2 distingue entre bloqueos completamente bloqueantes y no completamente bloqueantes —que podrías optar por ignorar— y mide la duración de los bloqueos de la app. Un bloqueo completamente bloqueante ocurre cuando el hilo principal queda totalmente atascado y la app no puede renderizar ni un solo fotograma. Un bloqueo no completamente bloqueante ocurre cuando la app parece estar congelada para el usuario, pero aún puede renderizar algunos fotogramas. Los bloqueos completamente bloqueantes son más accionables porque el stack trace muestra la ubicación exacta del bloqueo en el hilo principal. Los bloqueos no completamente bloqueantes pueden tener un stack trace que no resalte la ubicación exacta del bloqueo, ya que el hilo principal no está completamente bloqueado.

El SDK establece `exception.type` en `App Hang Fully Blocked` o `App Hang Non Fully Blocked`, para que puedas filtrar los bloqueos de la app mediante `error.type` en Sentry.

Para habilitar la función:

```swift {tabTitle:Swift}
import Sentry

SentrySDK.start { options in
    options.dsn = "___PUBLIC_DSN___"
    options.enableAppHangTrackingV2 = true
}
```

```objc {tabTitle:Objective-C}
@import Sentry;

[SentrySDK startWithConfigureOptions:^(SentryOptions *options) {
    options.dsn = @"___PUBLIC_DSN___";
    options.enableAppHangTrackingV2 = YES;
}];
```


<div id="fatal-app-hangs">
  #### Bloqueos fatales de la app
</div>

A partir de la versión 8.50.0, el SDK detecta y reporta automáticamente los bloqueos fatales de la app. Si el usuario o el [watchdog del sistema](https://developer.apple.com/documentation/xcode/addressing-watchdog-terminations) finaliza tu app durante un bloqueo, el SDK lo reporta como un bloqueo fatal de la app en el siguiente inicio.

El SDK establece `exception.type` en `Fatal App Hang Fully Blocked` o `Fatal App Hang Non Fully Blocked`, para que puedas filtrar los bloqueos fatales de la app mediante `error.type` en Sentry.

<div id="non-fully-blocking-app-hangs">
  #### Bloqueos de la app que no son completamente bloqueantes
</div>

Dado que los stack traces pueden no ser 100% precisos en estos casos, puedes desactivarlos con la opción `enableReportNonFullyBlockingAppHangs`:

```swift {tabTitle:Swift}
import Sentry

SentrySDK.start { options in
    options.dsn = "___PUBLIC_DSN___"
    options.enableReportNonFullyBlockingAppHangs = false
}
```

```objc {tabTitle:Objective-C}
@import Sentry;

[SentrySDK startWithConfigureOptions:^(SentryOptions *options) {
    options.dsn = @"___PUBLIC_DSN___";
    options.enableReportNonFullyBlockingAppHangs = NO;
}];
```


<div id="app-hang-rate">
  ## Tasa de bloqueos de la app
</div>

<Alert level="info">

El SDK admite el cálculo de la tasa de bloqueos de la app a partir de la versión 8.50.0. Además, debes habilitar App Hangs V2 con `options.enableAppHangTrackingV2 = true` en la configuración del SDK.

</Alert>

Los bloqueos de la app ocurren cuando el hilo principal de la interfaz de usuario de una aplicación deja de responder. Si está configurado, el SDK de Apple de Sentry informa eventos de bloqueo y Sentry calcula una tasa de bloqueos basada en estos eventos y en las sesiones de usuario.

La tasa de bloqueos de la app es el porcentaje de usuarios únicos que han experimentado un **bloqueo fatal de la app** durante el período de tiempo especificado.

<Alert level="info">

La tasa de bloqueos en Sentry solo tiene en cuenta los **bloqueos fatales**: bloqueos que hacen que tu app se cierre, ya sea por acción del usuario o por el watchdog del sistema operativo. Los bloqueos no fatales se registran como eventos, pero no se incluyen en el cálculo de la tasa de bloqueos.

</Alert>

### Bloqueos fatales de la app

Los bloqueos fatales de la app son el tipo más crítico porque provocan la finalización de la app y afectan directamente la experiencia del usuario. Ocurren cuando:

- El usuario fuerza el cierre de la app durante un bloqueo
- El watchdog del sistema finaliza la app por falta de respuesta

Los bloqueos fatales de la app se distinguen por su `exception.type`:

- `Fatal App Hang Fully Blocked`: Un bloqueo completamente bloqueante que termina en finalización
- `Fatal App Hang Non Fully Blocked`: Un bloqueo parcialmente bloqueante que termina en finalización

<div id="viewing-your-app-hang-rate">
  ### Ver tu tasa de cuelgues de la app (App Hang Rate)
</div>

Para ver tu App Hang Rate en Sentry:

1. Ve a la página **Projects**
2. Haz clic en tu proyecto de Apple
3. Busca la tarjeta "App Hang Rate" en la sección "Project Details"
4. Haz clic en "View Issues" para ver una lista de incidencias de cuelgues de la app creadas en el intervalo de tiempo y el entorno seleccionados

La tarjeta de App Hang Rate muestra el porcentaje de usuarios afectados por cuelgues fatales de la app, lo que te ayuda a comprender el impacto en tu base de usuarios y a priorizar mejoras de rendimiento.

![App Hang Rate](./img/app-hang-rate.png)

Dado que App Hang Rate solo incluye cuelgues fatales de la app, representa los cuelgues más graves que afectan directamente la retención de usuarios y las valoraciones en la tienda de apps.

<div id="faq">
  #### Preguntas frecuentes
</div>

**¿Las sesiones sin fallos (Crash Free Sessions) y los usuarios sin fallos (Crash Free Users) incluyen bloqueos de la app (app hangs)?**

No, las sesiones sin fallos y los usuarios sin fallos no incluyen bloqueos de la app.

**¿La tasa de bloqueos de la app (App Hang Rate) incluye bloqueos no fatales?**

No, la tasa de bloqueos de la app no incluye bloqueos no fatales.

**¿Por qué la tasa de bloqueos de la app solo incluye bloqueos fatales?**

La tasa de bloqueos de la app solo incluye bloqueos fatales, porque son el tipo más crítico de bloqueo y afectan directamente la experiencia del usuario. Sin embargo, estamos considerando incluir también los bloqueos no fatales en la tasa de bloqueos de la app; por favor, dale tu voto a [este issue](https://github.com/getsentry/sentry-cocoa/issues/6325) para ayudarnos a priorizarlo.