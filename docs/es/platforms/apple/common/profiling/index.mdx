---
title: Configurar la generación de perfiles en Apple
sidebar_title: Generación de perfiles
description: "Aprende a habilitar la generación de perfiles en tu app."
sidebar_order: 5000
supported:
  - apple
  - apple.ios
  - apple.macos
notSupported:
  - apple.tvos
  - apple.watchos
  - apple.visionos
---

<PlatformContent includePath="profiling/index/preface" />

<PlatformContent includePath="profiling/index/why-profiling" />

<div id="enable-ui-profiling">
  ## Habilitar el perfilado de la UI
</div>

<Alert>
  El perfilado de la UI se introdujo en la versión 8.49.0 del SDK. Todas las API de perfilado anteriores están obsoletas y se eliminarán en una próxima versión principal del SDK.
</Alert>

Para configurar el perfilado, asigna un closure a `SentryOptions.configureProfiling` y establece las opciones deseadas en el objeto que se recibe como parámetro:

```swift {tabTitle:Swift}
import Sentry

SentrySDK.start { options in
    options.dsn = "___PUBLIC_DSN___"
    options.configureProfiling = {
        $0.sessionSampleRate = 1
    }
}
```

```objc {tabTitle:Objective-C}
@import Sentry;

[SentrySDK startWithConfigureOptions:^(SentryOptions *options) {
    options.dsn = @"___PUBLIC_DSN___";
    options.configureProfiling = ^(SentryProfileOptions *profiling) {
        profiling.sessionSampleRate = 1.f;
    };
}];
```

De forma predeterminada, `sessionSampleRate` es `0`, por lo que deberás configurarlo con un valor más alto para recibir datos de perfiles. `sessionSampleRate` se evalúa una vez por sesión de usuario y se aplica a cualquier intento de iniciar un perfil hasta que comience la siguiente sesión. Consulta la <PlatformLink to="/configuration/releases/#sessions">documentación de sesiones de usuario</PlatformLink> para obtener más información sobre las sesiones.

Consulta las subsecciones a continuación para conocer las distintas formas de iniciar y detener el generador de perfiles.


<div id="manual-lifecycle">
  ### Ciclo de vida manual
</div>

De forma predeterminada, el generador de perfiles solo puede iniciarse y detenerse manualmente mediante llamadas a `SentrySDK.startProfiler` y `SentrySDK.stopProfiler`. Todo el código que se ejecute en todos los hilos entre esas llamadas se registrará. Los fragmentos anteriores muestran cómo configurar el modo de generación de perfiles manual.

Por ejemplo, si quisieras perfilar todo lo que ocurre después de iniciar una solicitud de red y luego actualizar una vista de tabla con el contenido de la respuesta, podrías hacerlo así (suponiendo que ya iniciaste el SDK de Sentry con las opciones mostradas arriba):

```swift {tabTitle:Swift}
import Sentry

struct MyModel: Codable {
    // campos...
}
var model: MyModel?
var tableView: UITableView!

@IBAction func updateTable() {
    SentrySDK.startProfiler()
    URLSession.shared.dataTask(with: URLRequest(url: URL(string: "https://my.domain.tld/endpoint")!)) { data, response, error in
        self.model = try! JSONDecoder().decode(MyModel.self, from: data!)
        DispatchQueue.main.async {
            self.tableView.performBatchUpdates {
                // actualizar la vista de tabla con el modelo
            } completion: { finished in 
                SentrySDK.stopProfiler()
            }
        }
    }
}
```

Esto capturaría todos los stack traces en cada hilo implicado en realizar la solicitud de red, decodificar la respuesta y reconstruir las celdas de la tabla.


<div id="trace-lifecycle">
  ### Ciclo de vida del trace
</div>

El profiler se puede configurar para iniciarse cuando comience un nuevo span raíz y no exista ninguno previo, y para detenerse cuando ya no queden spans raíz. Para este modo, debes establecer la propiedad `SentryProfileOptions.lifecycle` en `SentryProfileLifecycleTrace` y asegurarte de que se muestreen algunas traces:

```swift {tabTitle:Swift}
import Sentry

SentrySDK.start { options in
    options.dsn = "___PUBLIC_DSN___"
    options.tracesSampleRate = 1
    options.configureProfiling = {
        $0.sessionSampleRate = 1
        $0.lifecycle = .trace
    }
}
```

```objc {tabTitle:Objective-C}
@import Sentry;

[SentrySDK startWithConfigureOptions:^(SentryOptions *options) {
    options.dsn = @"___PUBLIC_DSN___";
    options.tracesSampleRate = @1.f;
    options.configureProfiling = ^(SentryProfileOptions *profiling) {
        profiling.sessionSampleRate = 1.f;
        profiling.lifecycle = SentryProfileLifecycleTrace;
    };
}];
```

<Alert>
  El `sessionSampleRate` para perfiles es *relativo* al `tracesSampleRate`: si tanto `tracesSampleRate` como `sessionSampleRate` son `0.5`, entonces, en promedio, el 25% de los intentos de iniciar el profiler resultarán en una recopilación real de datos.
</Alert>

Consulta la <PlatformLink to="/tracing/">documentación de configuración de tracing</PlatformLink> para obtener más información sobre cómo configurar el muestreo en Sentry Tracing.


<div id="app-starts">
  ### Inicio de la app
</div>

Si se configura con ciclo de vida manual, un perfil comenzará en el siguiente inicio de la app y continuará hasta que llames a `SentrySDK.stopProfiler`.

Si se configura con ciclo de vida de trazas, los perfiles de inicio de la app se adjuntan a una operación especial de transacción de rendimiento llamada `app.launch` y se muestran en el producto como `launch`. Se detiene cuando se llama a `SentrySDK.startWithOptions` o, si está habilitado el seguimiento de <PlatformLink to="/tracing/instrumentation/automatic-instrumentation/#time-to-initial-display">Time to Initial Display (TTID)</PlatformLink>/<PlatformLink to="/tracing/instrumentation/automatic-instrumentation/#time-to-full-display">Time to Full Display (TTFD)</PlatformLink>, cuando el SDK determina que se alcanzó el TTID/TTFD.

<Alert>
El SDK debe haberse iniciado mediante una llamada a `SentrySDK.startWithOptions` para poder detener un profiler de inicio en ejecución. Si se inicia un perfil de inicio pero no el SDK, el profiler se ejecutará durante toda la sesión del usuario. Asegúrate de tener una configuración adecuada si inicias selectivamente el Sentry SDK junto con el perfilado de inicio, para no configurar nunca un perfil de inicio en un arranque en el que podrías decidir no iniciar el Sentry SDK.
</Alert>

<Alert>
Cada vez que se llama a `SentrySDK.startWithOptions` con el perfilado de inicio de la app configurado, se genera una decisión de muestreo independiente con `sessionSampleRate` y se almacena hasta el siguiente inicio de la app (y también con `tracesSampleRate` si está configurado el ciclo de vida de perfil de trazas). La misma decisión de muestreo se aplicará durante el resto de la sesión de perfil tras ese inicio posterior.
</Alert>

<div id="transaction-based-profiling-deprecated">
  ## Perfilado basado en transacciones (en desuso)
</div>

<Alert>
  La configuración de perfilado, explicada a continuación, se introdujo originalmente en la versión `8.12.0` del SDK. Ahora está en desuso en favor del perfilado en la interfaz (UI Profiling), introducido en la 8.49.0.
</Alert>

<Alert>
  El perfilado basado en transacciones depende de que el producto Tracing de Sentry esté habilitado previamente. Consulta la <PlatformLink to="/tracing/">documentación de configuración de tracing</PlatformLink> para obtener información detallada sobre cómo configurar el muestreo.
</Alert>

Configura las tasas de muestreo de trazas y perfiles para asegurarte de que no sean cero y así registrar algunos. La configuración <PlatformIdentifier name="profiles-sample-rate" /> es *relativa* a la configuración <PlatformIdentifier name="traces-sample-rate" />.

```swift {tabTitle:Swift}
import Sentry

SentrySDK.start { options in
    options.dsn = "___PUBLIC_DSN___"
    options.tracesSampleRate = 1.0 // el rastreo debe estar habilitado para el perfilado
    options.profilesSampleRate = 1.0 // consulta también `profilesSampler` si necesitas lógica de muestreo personalizada
}
```

```objc {tabTitle:Objective-C}
@import Sentry;

[SentrySDK startWithConfigureOptions:^(SentryOptions *options) {
    options.dsn = @"___PUBLIC_DSN___";
    options.tracesSampleRate = @1.0; // el rastreo debe estar habilitado para el perfilado
    options.profilesSampleRate = @1.0; // consulta también `profilesSampler` si necesitas lógica de muestreo personalizada
}];
```


<div id="launch-profiling-deprecated">
  ## Perfilado de inicio (en desuso)
</div>

<Alert>
  La configuración de perfilado de inicio, explicada a continuación, se introdujo originalmente en la versión 8.21.0 del SDK. Ahora está en desuso en favor de UI Profiling, lanzado en la 8.49.0.
</Alert>

Normalmente, un perfil solo puede capturarse durante un span de traza después de inicializar el SDK. Ahora puedes configurar el SDK para perfilar automáticamente ciertos inicios de la app.

Para configurar el perfilado de inicio, usa la opción `enableAppLaunchProfiling` y define las tasas de muestreo para trazas y perfiles con `SentrySDK.startWithOptions` para determinar si el siguiente inicio de la app debe perfilarse automáticamente. Esto te permite recopilar información sobre lo que ocurre en tu app incluso antes de que se llame a `main`, lo que facilita diagnosticar problemas con inicios lentos de la app.

Si usas `SentryOptions.tracesSampler` o `SentryOptions.profilesSampler`, se invocará después de llamar a `SentrySDK.startWithOptions`, con `SentryTransactionContext.forNextAppLaunch` establecido en `true`, indicando que está evaluando una decisión de muestreo para el perfil de inicio. Si en su lugar simplemente estableces `SentryOptions.tracesSampleRate` y `SentryOptions.profilesSampleRate`, esas tasas numéricas se usarán directamente.

Actualmente, los perfiles de inicio se adjuntan a una operación especial de transacción de rendimiento llamada `app.launch` y se muestran en el producto simplemente como `launch`.

```swift {tabTitle:Swift}
import Sentry

SentrySDK.start { options in
    options.dsn = "___PUBLIC_DSN___"
    options.tracesSampleRate = 1.0 // el rastreo debe estar habilitado para el perfilado
    options.profilesSampleRate = 1.0 // consulta también `profilesSampler` si necesitas lógica de muestreo personalizada
    options.enableAppLaunchProfiling = true
}
```

```objc {tabTitle:Objective-C}
@import Sentry;

[SentrySDK startWithConfigureOptions:^(SentryOptions *options) {
    options.dsn = @"___PUBLIC_DSN___";
    options.tracesSampleRate = @1.0; // el rastreo debe estar habilitado para el perfilado
    options.profilesSampleRate = @1.0; // consulta también `profilesSampler` si necesitas lógica de muestreo personalizada
    options.enableAppLaunchProfiling = YES;
}];
```


<div id="continuous-profiling-beta-deprecated">
  ## Beta de Continuous Profiling (en desuso)
</div>

<Alert>

La beta de Continuous Profiling, explicada a continuación, se introdujo originalmente en la versión 8.36.0 del SDK. Ahora está en desuso en favor de UI Profiling, lanzada en la 8.49.0.

</Alert>

La implementación actual de profiling detiene el profiler automáticamente después de 30 segundos (a menos que lo detengas manualmente antes). Como es natural, esta limitación dificulta obtener una cobertura completa de la ejecución de tu app. Ahora ofrecemos un modo continuo experimental, en el que los datos de profiling se cargan periódicamente mientras se ejecuta, sin límite de tiempo para la ejecución del profiler.

Antes, los perfiles solo se ejecutaban junto con transacciones de rendimiento que se iniciaban automáticamente o manualmente con `SentrySDK.startTransaction`. Ahora puedes iniciar y detener el profiler directamente con `SentrySDK.startProfiler` y `SentrySDK.stopProfiler`. También puedes iniciar un perfil en el arranque de la app configurando `SentryOptions.enableAppLaunchProfiling = true` en tu llamada a `SentrySDK.startWithOptions`.

El modo de continuous profiling está habilitado de forma predeterminada y no requiere cambios en `SentryOptions` cuando inicias el SDK para activarlo. Si antes habías configurado `SentryOptions.profilesSampleRate` o `SentryOptions.profilesSampler` para usar profiling basado en transacciones, elimina esas líneas de código de tu configuración.

Estas nuevas API no ofrecen ninguna funcionalidad de muestreo: cada llamada para iniciar el profiler lo pondrá en marcha, y lo mismo aplica para los perfiles de arranque si los has configurado. Si quieres reducir la cantidad de perfiles que se ejecutan, debes encargarte de hacerlo en los puntos de llamada.

El continuous profiling tiene implicaciones para la estructura de facturación de tu organización. Esta función solo está disponible para planes de suscripción que se dieron de alta después del 5 de junio de 2024.