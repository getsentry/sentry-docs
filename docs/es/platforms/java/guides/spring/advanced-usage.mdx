---
title: Registrar información de usuario
sidebar_order: 6
description: "Aprende a registrar o personalizar la captura de información de usuario."
---

Registra información de usuario a partir de una solicitud HTTP o registrando un bean de Spring para una captura personalizada.

<div id="recording-user-information-from-http-request">
  ## Registrar información del usuario desde la solicitud HTTP
</div>

Para registrar la dirección IP del usuario y `Principal#name` como nombre de usuario para poder verlo después en la [vista de trazas](/es/concepts/key-terms/tracing/trace-view/):

1. Establece el indicador de información personal de `@EnableSentry` en `true`.

```Java {tabTitle:Java (Spring 5)}
import org.springframework.context.annotation.Configuration;
import io.sentry.spring.EnableSentry;

@EnableSentry(dsn = "___PUBLIC_DSN___", sendDefaultPii = true)
@Configuration
class SentryConfiguration {
}
```

```Java {tabTitle:Java (Spring 6)}
import org.springframework.context.annotation.Configuration;
import io.sentry.spring.jakarta.EnableSentry;

@EnableSentry(dsn = "___PUBLIC_DSN___", sendDefaultPii = true)
@Configuration
class SentryConfiguration {
}
```

```kotlin {tabTitle:Kotlin (Spring 5)}
import org.springframework.context.annotation.Configuration
import io.sentry.spring.EnableSentry

@EnableSentry(dsn = "...", sendDefaultPii = true)
@Configuration
class SentryConfiguration
```

```kotlin {tabTitle:Kotlin (Spring 6)}
import org.springframework.context.annotation.Configuration
import io.sentry.spring.jakarta.EnableSentry

@EnableSentry(dsn = "...", sendDefaultPii = true)
@Configuration
class SentryConfiguration
```

2. Registra el bean de filtro de servlet `SentryUserFilter`:

```java {tabTitle:Java (Spring 5)}
import io.sentry.IHub;
import io.sentry.spring.SentryUserFilter;
import io.sentry.spring.SentryUserProvider;
import java.util.List;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;

@Configuration
public class SentryFilterConfig {

  @Bean
  public SentryUserFilter sentryUserFilter(
      final IHub hub, final List<SentryUserProvider> sentryUserProviders) {
    return new SentryUserFilter(hub, sentryUserProviders);
  }
}
```

```java {tabTitle:Java (Spring 6)}
import io.sentry.IHub;
import io.sentry.spring.jakarta.SentryUserFilter;
import io.sentry.spring.jakarta.SentryUserProvider;
import java.util.List;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;

@Configuration
public class SentryFilterConfig {

  @Bean
  public SentryUserFilter sentryUserFilter(
      final IHub hub, final List<SentryUserProvider> sentryUserProviders) {
    return new SentryUserFilter(hub, sentryUserProviders);
  }
}
```

```kotlin {tabTitle:Kotlin (Spring 5)}
import io.sentry.IHub
import io.sentry.spring.SentryUserProvider
import io.sentry.spring.SentryUserFilter
import org.springframework.context.annotation.Bean
import org.springframework.context.annotation.Configuration

@Configuration
class SentryFilterConfig {
    @Bean
    fun sentryUserFilter(hub: IHub, sentryUserProviders: List<SentryUserProvider>) = SentryUserFilter(hub, sentryUserProviders)
}
```

```kotlin {tabTitle:Kotlin (Spring 6)}
import io.sentry.IHub
import io.sentry.spring.jakarta.SentryUserProvider
import io.sentry.spring.jakarta.SentryUserFilter
import org.springframework.context.annotation.Bean
import org.springframework.context.annotation.Configuration

@Configuration
class SentryFilterConfig {
    @Bean
    fun sentryUserFilter(hub: IHub, sentryUserProviders: List<SentryUserProvider>) = SentryUserFilter(hub, sentryUserProviders)
}
```

3. Configura `SentryUserFilter` en `web.xml` o `WebApplicationInitializer` mediante `DelegatingFilterProxy`:

```java {tabTitle:Java (Spring 5)}
import javax.servlet.Filter;
import org.springframework.web.filter.DelegatingFilterProxy;
import org.springframework.web.filter.RequestContextFilter;
import org.springframework.web.servlet.support.AbstractAnnotationConfigDispatcherServletInitializer;

public class AppInitializer extends AbstractAnnotationConfigDispatcherServletInitializer {

  // ...

  @Override
  protected Filter[] getServletFilters() {
    // filtro requerido por Spring Security
    DelegatingFilterProxy springSecurityFilterChain = new DelegatingFilterProxy();
    springSecurityFilterChain.setTargetBeanName("springSecurityFilterChain");

    // establece la solicitud en RequestContextHolder
    // alternativamente, configura RequestContextListener
    RequestContextFilter requestContextFilter = new RequestContextFilter();

    // establece el usuario de Sentry en el ámbito
    DelegatingFilterProxy sentryUserFilterProxy = new DelegatingFilterProxy();
    sentryUserFilterProxy.setTargetBeanName("sentryUserFilter");

    return new Filter[] {
      springSecurityFilterChain, requestContextFilter, sentryUserFilterProxy
    };
  }
}
```

```java {tabTitle:Java (Spring 6)}
import jakarta.servlet.Filter;
import org.springframework.web.filter.DelegatingFilterProxy;
import org.springframework.web.filter.RequestContextFilter;
import org.springframework.web.servlet.support.AbstractAnnotationConfigDispatcherServletInitializer;

public class AppInitializer extends AbstractAnnotationConfigDispatcherServletInitializer {

  // ...

  @Override
  protected Filter[] getServletFilters() {
    // filtro requerido por Spring Security
    DelegatingFilterProxy springSecurityFilterChain = new DelegatingFilterProxy();
    springSecurityFilterChain.setTargetBeanName("springSecurityFilterChain");

    // establece la solicitud en RequestContextHolder
    // alternativamente, configura RequestContextListener
    RequestContextFilter requestContextFilter = new RequestContextFilter();

    // establece el usuario de Sentry en el ámbito
    DelegatingFilterProxy sentryUserFilterProxy = new DelegatingFilterProxy();
    sentryUserFilterProxy.setTargetBeanName("sentryUserFilter");

    return new Filter[] {
      springSecurityFilterChain, requestContextFilter, sentryUserFilterProxy
    };
  }
}
```

```kotlin {tabTitle:Kotlin (Spring 5)}
import org.springframework.web.filter.DelegatingFilterProxy
import org.springframework.web.filter.RequestContextFilter
import org.springframework.web.servlet.support.AbstractAnnotationConfigDispatcherServletInitializer
import javax.servlet.Filter

class AppInitializer : AbstractAnnotationConfigDispatcherServletInitializer() {

    // ...

    override fun getServletFilters(): Array<Filter> {
        // filtro requerido por Spring Security
        val springSecurityFilterChain = DelegatingFilterProxy()
        springSecurityFilterChain.setTargetBeanName("springSecurityFilterChain")

        // coloca la solicitud en RequestContextHolder
        // alternativamente, configura RequestContextListener
        val requestContextFilter = RequestContextFilter()

        // establece el usuario de Sentry en el scope
        val sentryUserFilterProxy = DelegatingFilterProxy()
        sentryUserFilterProxy.setTargetBeanName("sentryUserFilter")
        return arrayOf(
            springSecurityFilterChain, requestContextFilter, sentryUserFilterProxy
        )
    }
}
```

```kotlin {tabTitle:Kotlin (Spring 6)}
import org.springframework.web.filter.DelegatingFilterProxy
import org.springframework.web.filter.RequestContextFilter
import org.springframework.web.servlet.support.AbstractAnnotationConfigDispatcherServletInitializer
import jakarta.servlet.Filter

class AppInitializer : AbstractAnnotationConfigDispatcherServletInitializer() {

    // ...

    override fun getServletFilters(): Array<Filter> {
        // filtro requerido por Spring Security
        val springSecurityFilterChain = DelegatingFilterProxy()
        springSecurityFilterChain.setTargetBeanName("springSecurityFilterChain")

        // establece la solicitud en RequestContextHolder
        // alternativamente, configura RequestContextListener
        val requestContextFilter = RequestContextFilter()

        // establece el usuario de Sentry en el ámbito
        val sentryUserFilterProxy = DelegatingFilterProxy()
        sentryUserFilterProxy.setTargetBeanName("sentryUserFilter")
        return arrayOf(
            springSecurityFilterChain, requestContextFilter, sentryUserFilterProxy
        )
    }
}
```

De forma predeterminada, el nombre de usuario se obtiene de `HttpServletRequest#userPrincipal`. Para recuperarlo del contexto de Spring Security, registra el bean `SpringSecuritySentryUserProvider`:

```java {tabTitle:Java (Spring 5)}
import io.sentry.SentryOptions;
import io.sentry.spring.SpringSecuritySentryUserProvider;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;

@Configuration
class SecuritySentryConfig {
  @Bean
  public SpringSecuritySentryUserProvider springSecuritySentryUserProvider(
      SentryOptions sentryOptions) {
    return new SpringSecuritySentryUserProvider(sentryOptions);
  }
}
```

```java {tabTitle:Java (Spring 6)}
import io.sentry.SentryOptions;
import io.sentry.spring.jakarta.SpringSecuritySentryUserProvider;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;

@Configuration
class SecuritySentryConfig {
  @Bean
  public SpringSecuritySentryUserProvider springSecuritySentryUserProvider(
      SentryOptions sentryOptions) {
    return new SpringSecuritySentryUserProvider(sentryOptions);
  }
}
```

```kotlin {tabTitle:Kotlin (Spring 5)}
import io.sentry.SentryOptions
import io.sentry.spring.SpringSecuritySentryUserProvider
import org.springframework.context.annotation.Bean
import org.springframework.context.annotation.Configuration

@Configuration
class SecuritySentryConfig {
  @Bean
  fun springSecuritySentryUserProvider(sentryOptions: SentryOptions) = SpringSecuritySentryUserProvider(sentryOptions)
}
```

```kotlin {tabTitle:Kotlin (Spring 6)}
import io.sentry.SentryOptions
import io.sentry.spring.jakarta.SpringSecuritySentryUserProvider
import org.springframework.context.annotation.Bean
import org.springframework.context.annotation.Configuration

@Configuration
class SecuritySentryConfig {
  @Bean
  fun springSecuritySentryUserProvider(sentryOptions: SentryOptions) = SpringSecuritySentryUserProvider(sentryOptions)
}
```

<div id="recording-custom-user-information">
  ## Registro de información personalizada del usuario
</div>

Para registrar información personalizada del usuario, puedes registrar un bean que implemente la interfaz `SentryUserProvider`.

```java {tabTitle:Java (Spring 5)}
import org.springframework.stereotype.Component;
import io.sentry.protocol.User;
import io.sentry.spring.SentryUserProvider;

@Component
class CustomSentryUserProvider implements SentryUserProvider {
  public User provideUser() {
    User user = User();
    // ... configurar la información del usuario
    return user
  }
}
```

```java {tabTitle:Java (Spring 6)}
import org.springframework.stereotype.Component;
import io.sentry.protocol.User;
import io.sentry.spring.jakarta.SentryUserProvider;

@Component
class CustomSentryUserProvider implements SentryUserProvider {
  public User provideUser() {
    User user = User();
    // ... configurar información del usuario
    return user
  }
}
```

```kotlin {tabTitle:Kotlin (Spring 5)}
import org.springframework.stereotype.Component
import io.sentry.protocol.User
import io.sentry.spring.SentryUserProvider

@Component
class CustomSentryUserProvider : SentryUserProvider {
  override fun provideUser(): User? {
    val user = User()
    // ... configurar información del usuario
    return user
  }
}
```

```kotlin {tabTitle:Kotlin (Spring 6)}
import org.springframework.stereotype.Component
import io.sentry.protocol.User
import io.sentry.spring.jakarta.SentryUserProvider

@Component
class CustomSentryUserProvider : SentryUserProvider {
  override fun provideUser(): User? {
    val user = User()
    // ... configurar información del usuario
    return user
  }
}
```
