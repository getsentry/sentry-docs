---
title: Scopes y hubs
description: "En la mayoría de los casos, el SDK gestionará automáticamente los scopes por ti en las integraciones del framework. Aprende qué es un scope y cómo puedes usarlo a tu favor."
---

Cuando se captura un evento y se envía a Sentry, los SDK combinarán esos datos del evento con información adicional del scope actual. En la mayoría de los casos, el SDK gestionará automáticamente los scopes por ti en las integraciones del framework y no tendrás que preocuparte por ellos. Sin embargo, deberías saber qué es un scope y cómo puedes usarlo a tu favor.

<div id="whats-a-scope-whats-a-hub">
  ## Qué es un Scope, qué es un Hub
</div>

Puedes pensar en el hub como el punto central que nuestros SDK usan para enrutar un evento a Sentry. Cuando llamas a `init()`, se crea un hub y en él se inicializan un cliente y un scope en blanco. Ese hub se asocia con el hilo actual y, de forma interna, mantiene una pila de scopes.

El scope contiene información útil que debería enviarse junto con el evento. Por ejemplo, los [contexts](../context/) o los [breadcrumbs](../breadcrumbs/) se almacenan en el scope. Cuando se hace push de un scope, hereda todos los datos del scope padre y, cuando hace pop, se revierten todas las modificaciones.

Las integraciones predeterminadas del SDK harán push y pop de scopes de forma inteligente. Por ejemplo, las integraciones de frameworks web crearán y destruirán scopes alrededor de tus rutas o controladores.

<div id="how-the-scope-and-hub-work">
  ## Cómo funcionan el Scope y el Hub
</div>

Cuando empiezas a usar un SDK, se crean automáticamente un scope y un hub
de forma predeterminada. Es poco probable que interactúes directamente con el hub a menos que estés
escribiendo una integración o quieras crear o destruir scopes. Los scopes, por otro
lado, son más visibles para el usuario. Puedes llamar a <PlatformIdentifier name="configure-scope" /> en cualquier momento
para modificar los datos almacenados en el scope. Esto es útil para hacer cosas como
[modificar el contexto](../context/).

Cuando llamas a una función global como <PlatformIdentifier name="capture-event" />, Sentry
detecta el hub actual y le pide que capture un evento. Internamente, el hub
luego combinará el evento con los datos del scope superior.

<div id="configuring-the-scope">
  ## Configurar el scope
</div>

La operación más útil al trabajar con scopes es la función <PlatformIdentifier name="configure-scope" />. Puede usarse para reconfigurar el scope actual.

Por ejemplo, puedes añadir etiquetas personalizadas o informar a Sentry sobre el usuario que está autenticado actualmente.

<PlatformContent includePath="enriching-events/scopes/configure-scope" />

También puedes aplicar esta configuración al quitar al usuario al cerrar sesión:

<PlatformContent includePath="enriching-events/unset-user" />

Para saber qué información útil se puede asociar a los scopes, consulta
[la documentación sobre contexto](../context/).

<div id="local-scopes">
  ## Ámbitos locales
</div>

También es posible enviar y configurar un ámbito en una sola llamada. Esto suele
llamarse <PlatformIdentifier name="with-scope" />, <PlatformIdentifier name="push-scope" /> o implementarse como un parámetro de función en los métodos de captura, según el SDK. Es muy útil si
solo quieres enviar datos para un evento específico.

### Uso de <PlatformIdentifier name="with-scope" />

En el siguiente ejemplo usamos <PlatformIdentifier name="with-scope" /> para adjuntar un `level` y un `tag` a un único error concreto:

<PlatformContent includePath="enriching-events/scopes/with-scope" />

Aunque este ejemplo se parece a <PlatformIdentifier name="configure-scope" />, en realidad es muy diferente.
Las llamadas a <PlatformIdentifier name="configure-scope" /> cambian el ámbito activo actual; todas las llamadas posteriores a <PlatformIdentifier name="configure-scope" /> mantendrán los cambios establecidos previamente, a menos que se deshagan explícitamente.

Por otro lado, <PlatformIdentifier name="with-scope" /> crea un clon del ámbito actual y los cambios
realizados permanecerán aislados dentro de la función de devolución de llamada de <PlatformIdentifier name="with-scope" />. Esto te permite
aislar más fácilmente partes de la información de contexto en ubicaciones específicas de tu código o
incluso llamar a <PlatformIdentifier name="clear" /> para eliminar temporalmente toda la información de contexto.

<div id="using-scope-callback-parameter">
  ### Uso del parámetro de callback de scope
</div>

En el siguiente ejemplo usamos el parámetro de callback de scope, disponible para todos los métodos `capture`, para adjuntar un `level` y una `tag` a un único error específico:

<PlatformContent includePath="enriching-events/scopes/scope-callback-param" />

Antes de invocar el callback, el SDK crea un clon del scope actual, y los cambios
realizados permanecerán aislados dentro de la función de callback. Esto te permite
aislar más fácilmente fragmentos de información de contexto en ubicaciones específicas de tu código o
incluso llamar a `clear` para eliminar temporalmente toda la información de contexto.

<Alert title="Importante">

Cualquier excepción que ocurra dentro de la función de callback para configurar un scope local no será
capturada, y todos los errores que ocurran se ignorarán silenciosamente y **no** se reportarán.

</Alert>

<div id="kotlin-coroutines">
  ## Coroutines de Kotlin
</div>

El SDK de Sentry para Java almacena el scope y el contexto en una variable local del hilo. Para asegurarte de que una coroutine tenga acceso al contexto correcto de Sentry, debes proporcionar una instancia de `SentryContext` al iniciarla.

<div id="installation">
  ### Instalación
</div>

```xml {tabTitle:Maven}
<dependency>
    <groupId>io.sentry</groupId>
    <artifactId>sentry-kotlin-extensions</artifactId>
    <version>{{@inject packages.version('sentry.java.kotlin-extensions', '5.0.0') }}</version>
</dependency>
```

```groovy {tabTitle:Gradle}
implementation 'io.sentry:sentry-kotlin-extensions:{{@inject packages.version('sentry.java.kotlin-extensions', '5.0.0') }}'
```

```scala {tabTitle: SBT}
libraryDependencies += "io.sentry" % "sentry-kotlin-extensions" % "{{@inject packages.version('sentry.java.kotlin-extensions', '5.0.0') }}"
```


<div id="usage">
  ### Uso
</div>

```kotlin
import io.sentry.kotlin.SentryContext
import io.sentry.Sentry

launch(SentryContext()) {
  // la etiqueta definida en la corrutina padre es visible para la corrutina hija
  Sentry.setTag("parent-tag", "value")
  launch() {
    // la etiqueta definida en la corrutina hija no es visible en la corrutina padre
    Sentry.setTag("child-tag", "value")
  }
}
```
