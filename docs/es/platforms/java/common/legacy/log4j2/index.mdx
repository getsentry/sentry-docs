---
title: log4j 2.x
sidebar_order: 30
---

<Alert level="warning" title="Nota">
  Un [SDK de Java actualizado](/es/platforms/java/) sustituye a esta versión obsoleta. Sentry mantiene esta documentación para quienes siguen usando el cliente antiguo. Recomendamos usar el SDK de Java actualizado para proyectos nuevos.
</Alert>

La biblioteca `sentry-log4j2` ofrece compatibilidad con [Log4j 2](https://logging.apache.org/log4j/2.x/) para Sentry mediante un [Appender](https://logging.apache.org/log4j/2.x/log4j-core/apidocs/org/apache/logging/log4j/core/Appender.html) que envía a Sentry las excepciones registradas. Una vez configurada esta integración, *también* puedes usar la API estática de Sentry, [como se muestra en la página de uso](/es/platforms/java/legacy/usage), para hacer cosas como registrar breadcrumbs, establecer el usuario actual o enviar eventos manualmente.

El código fuente está disponible [en GitHub](https://github.com/getsentry/sentry-java/tree/master/sentry-log4j2).

<div id="installation">
  ### Instalación
</div>

```xml {tabTitle:Maven}
<dependency>
    <groupId>io.sentry</groupId>
    <artifactId>sentry-log4j2</artifactId>
    <version>1.7.30</version>
</dependency>
```

```groovy {tabTitle:Gradle}
implementation 'io.sentry:sentry-log4j2:1.7.30'
```

```scala {tabTitle: SBT}
libraryDependencies += "io.sentry" % "sentry-log4j2" % "1.7.30"
```

Para otros administradores de dependencias, consulta el [repositorio central de Maven](https://search.maven.org/artifact/io.sentry/sentry-log4j2).

<div id="usage">
  ### Uso
</div>

El siguiente ejemplo configura un `ConsoleAppender` que escribe en la salida estándar con nivel `INFO`, y un `SentryAppender` que envía registros al servidor de Sentry con nivel `WARN`. El `ConsoleAppender` se incluye únicamente como ejemplo de un appender ajeno a Sentry configurado con un umbral de registro distinto, parecido al que quizás ya tengas en tu proyecto.

Ejemplo de configuración con el formato `log4j2.xml`:

```xml
<?xml version="1.0" encoding="UTF-8"?>
<Configuration>

  <Appenders>
    <Console name="CONSOLE" target="SYSTEM_OUT">
      <PatternLayout pattern="%d{HH:mm:ss.SSS} [%t] %-5level %logger{36} - %msg%n"/>
    </Console>
    <Sentry name="SENTRY"/>
  </Appenders>

  <Loggers>
    <Root level="INFO">
      <AppenderRef ref="CONSOLE"/>
      <!-- Ten en cuenta que el umbral de registro de Sentry se reemplaza por el nivel WARN -->
      <AppenderRef ref="SENTRY" level="WARN"/>
    </Root>
  </Loggers>

</Configuration>
```

A continuación, **deberás configurar tu DSN** (clave de cliente) y, de forma opcional, otros valores como `environment` y `release`. [Consulta la página de configuración](/es/platforms/java/legacy/configuration/#setting-the-dsn) para conocer las distintas formas de hacerlo.

{/* <!-- TODO-AÑADIR EJEMPLO DE VERIFICACIÓN --> */}

<div id="additional-data">
  ### Datos adicionales
</div>

Es posible agregar datos adicionales a los eventos gracias al [sistema de marcadores](https://logging.apache.org/log4j/2.x/manual/markers.html) que ofrece Log4j 2.x.

<div id="mapped-tags">
  #### Etiquetas asignadas
</div>

De forma predeterminada, todos los parámetros de MDC se almacenan en la pestaña “Additional Data” de Sentry. Al especificar la opción `mdctags` en tu configuración, puedes elegir qué claves de MDC enviar como etiquetas; esto permite utilizarlas como filtros dentro de la interfaz de Sentry.

```java
void logWithExtras() {
  // Extras de ThreadContext ("MDC")
  ThreadContext.put("Environment", "Development");
  ThreadContext.put("OS", "Linux");

  // Esto envía un evento donde los valores MDC de Environment y OS se establecen como datos adicionales
  logger.error("This is a test");
}
```

```kotlin
fun logWithExtras() {
  // Extras de ThreadContext ("MDC")
  ThreadContext.put("Environment", "Development")
  ThreadContext.put("OS", "Linux")

  // Esto envía un evento donde los valores MDC de Environment y OS se establecen como datos adicionales
  logger.error("This is a test")
}
```

<div id="in-practice">
  ### En la práctica
</div>

```java
import org.apache.logging.log4j.LogManager;
import org.apache.logging.log4j.Logger;
import org.apache.logging.log4j.Marker;
import org.apache.logging.log4j.MarkerManager;

public class MyClass {
  private static final Logger logger = LogManager.getLogger(MyClass.class);
  private static final Marker MARKER = MarkerManager.getMarker("myMarker");

  void logSimpleMessage() {
    // Esto envía un evento simple a Sentry
    logger.error("Esto es una prueba");
  }

  void logWithBreadcrumbs() {
    // Registra un breadcrumb que se enviará con el/los siguiente(s) evento(s),
    // por defecto se conservan los últimos 100 breadcrumbs.
    Sentry.record(
        new BreadcrumbBuilder().setMessage("El usuario realizó una acción").build()
    );

    // Esto envía un evento simple a Sentry
    logger.error("Esto es una prueba");
  }

  void logWithTag() {
    // Esto envía un evento con una etiqueta llamada 'log4j2-Marker' a Sentry
    logger.error(MARKER, "Esto es una prueba");
  }

  void logWithExtras() {
    // Extras MDC
    ThreadContext.put("extra_key", "extra_value");
    // Los extras NDC se envían bajo 'log4j2-NDC'
    ThreadContext.push("Extra_details");
    // Esto envía un evento con datos adicionales a Sentry
    logger.error("Esto es una prueba");
  }

  void logException() {
    try {
      unsafeMethod();
    } catch (Exception e) {
      // Esto envía un evento de excepción a Sentry
      logger.error("Excepción capturada", e);
    }
  }

  void unsafeMethod() {
    throw new UnsupportedOperationException("¡No deberías llamar a esto!");
  }
}
```

```kotlin
import org.apache.logging.log4j.LogManager
import org.apache.logging.log4j.Logger
import org.apache.logging.log4j.Marker
import org.apache.logging.log4j.MarkerManager

class MyClass {
  fun logSimpleMessage() {
    // Esto envía un evento simple a Sentry
    logger.error("This is a test")
  }

  fun logWithBreadcrumbs() {
    // Registra un breadcrumb que se enviará con el/los siguiente(s) evento(s),
    // por defecto se mantienen los últimos 100 breadcrumbs.
    Sentry.record(
      BreadcrumbBuilder().setMessage("El usuario realizó una acción").build()
    )

    // Esto envía un evento simple a Sentry
    logger.error("This is a test")
  }

  fun logWithTag() {
    // Esto envía un evento con una etiqueta llamada 'log4j2-Marker' a Sentry
    logger.error(MARKER, "This is a test")
  }

  fun logWithExtras() {
    // Extras MDC
    ThreadContext.put("extra_key", "extra_value")
    // Los extras NDC se envían bajo 'log4j2-NDC'
    ThreadContext.push("Extra_details")
    // Esto envía un evento con datos extra a Sentry
    logger.error("This is a test")
  }

  fun logException() {
    try {
      unsafeMethod()
    } catch (e: java.lang.Exception) {
      // Esto envía un evento de excepción a Sentry
      logger.error("Exception caught", e)
    }
  }

  fun unsafeMethod() {
    throw UnsupportedOperationException("¡No deberías llamar a esto!")
  }

  companion object {
    private val logger: Logger = LogManager.getLogger(MyClass::class.java)
    private val MARKER: Marker = MarkerManager.getMarker("myMarker")
  }
}
```
