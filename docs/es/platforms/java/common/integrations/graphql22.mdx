---
title: Integración de GraphQL Java 22
description: "Aprende a capturar excepciones y a conocer el rendimiento de las consultas ejecutadas con GraphQL Java (versión 22)."
notSupported:
  - java.logback
  - java.log4j2
  - java.jul
---

La integración de [GraphQL Java](https://github.com/graphql-java/graphql-java/) de Sentry se ofrece a través de:

- `SentryGenericDataFetcherExceptionHandler`, que comprueba las excepciones arrojadas durante la ejecución de los data fetchers y luego las envía a `SentryInstrumentation`.
- `SentryInstrumentation`, que crea spans alrededor de cada ejecución de data fetcher, captura excepciones y añade breadcrumbs.

Nuestra integración de GraphQL puede configurarse automáticamente si usas `spring-graphql` junto con la integración `sentry-spring-boot-starter` o `sentry-spring-boot-jakarta-starter`.

<Alert>

Si usas la versión 21 o anteriores de `graphql-java`, consulta la <PlatformLink to="/integrations/graphql/">documentación de GraphQL</PlatformLink>.

</Alert>

<div id="install">
  ## Instalación
</div>

Para instalar, utiliza:

```groovy {tabTitle:Gradle Plugin}
plugins {
  id "io.sentry.jvm.gradle" version "{{@inject packages.version('sentry.java.android.gradle-plugin', '3.12.0') }}"
}
```

```groovy {tabTitle:Gradle}
implementation 'io.sentry:sentry-graphql-22:{{@inject packages.version('sentry.java.graphql-22', '8.0.0') }}'
```

```xml {tabTitle:Maven Plugin}{filename:pom.xml}
<plugin>
  <groupId>io.sentry</groupId>
  <artifactId>sentry-maven-plugin</artifactId>
  <version>{{@inject packages.version('sentry.java.maven-plugin', '0.0.2') }}</version>
  <!-- Necesario para permitir la instalación automática del SDK de Sentry y las integraciones -->
  <extensions>true</extensions>
</plugin>
```

```xml {tabTitle:Maven}
<dependency>
    <groupId>io.sentry</groupId>
    <artifactId>sentry-graphql-22</artifactId>
    <version>{{@inject packages.version('sentry.java.graphql-22', '8.0.0') }}</version>
</dependency>
```

```scala {tabTitle: SBT}
libraryDependencies += "io.sentry" % "sentry-graphql-22" % "{{@inject packages.version('sentry.java.graphql-22', '8.0.0') }}"
```

Para otros gestores de dependencias, consulta el [repositorio central de Maven](https://search.maven.org/artifact/io.sentry/sentry-graphql).


<div id="set-up">
  ## Configuración
</div>

Al crear una instancia de `GraphQL`:

* configura `defaultDataFetcherExceptionHandler` con una instancia de `SentryGenericDataFetcherExceptionHandler` y pasa al constructor el delegado que manejará la excepción.
* configura `instrumentation` con una instancia de `SentryInstrumentation`.

Puede que quieras filtrar algunos errores usando `beforeSend` o un `EventProcessor` (lee más sobre <PlatformLink to="/configuration/filtering/">Filtros</PlatformLink>).

```java
import graphql.GraphQL;
import graphql.execution.SimpleDataFetcherExceptionHandler;
import io.sentry.graphql.SentryGenericDataFetcherExceptionHandler;
import io.sentry.graphql22.SentryInstrumentation;

SimpleDataFetcherExceptionHandler defaultExceptionHandler = new SimpleDataFetcherExceptionHandler();
SentryGenericDataFetcherExceptionHandler sentryExceptionHandler = new SentryGenericDataFetcherExceptionHandler(defaultExceptionHandler);

GraphQL graphQL = GraphQL.newGraphQL(...)
    // ...
    .defaultDataFetcherExceptionHandler(sentryExceptionHandler)
    .instrumentation(new SentryInstrumentation(
      // Si no usas nuestra integración con Spring, proporciona NoOpSubscriptionHandler.getInstance() en su lugar.
      new SentrySpringSubscriptionHandler(),
      // Establece esto como false cuando uses Spring WebMVC
      true
    ))
    .build();
```

```kotlin
import graphql.GraphQL
import graphql.execution.SimpleDataFetcherExceptionHandler
import io.sentry.graphql.SentryGenericDataFetcherExceptionHandler
import io.sentry.graphql22.SentryInstrumentation

val defaultExceptionHandler = SimpleDataFetcherExceptionHandler()
val sentryExceptionHandler = SentryGenericDataFetcherExceptionHandler(defaultExceptionHandler)

val graphql = GraphQL.newGraphQL()
  .defaultDataFetcherExceptionHandler(sentryExceptionHandler)
	.instrumentation(SentryInstrumentation(
    // Si no usas nuestra integración con Spring, proporciona NoOpSubscriptionHandler.getInstance() en su lugar.
    SentrySpringSubscriptionHandler(),
    // Establece esto como false cuando uses Spring WebMVC
    true
  ))
  .build()
```

<Alert>
  `SentryDataFetcherExceptionHandler` ha quedado obsoleto. Actualiza a `SentryGenericDataFetcherExceptionHandler` y asegúrate de que `SentryInstrumentation` esté configurado para capturar más excepciones, ofrecer excepciones más detalladas, breadcrumbs y una mejor propagación del hub. Quizá quieras filtrar los errores usando `beforeSend` o un `EventProcessor` (más información sobre <PlatformLink to="/configuration/filtering/">Filtros</PlatformLink>).
</Alert>


<div id="capture-tracing-information">
  ## Capturar información de seguimiento
</div>

Para poder capturar transacciones, primero debes <PlatformLink to="/tracing/">configurar el seguimiento</PlatformLink>.

<div id="modify-or-drop-spans">
  ### Modificar o descartar spans
</div>

Los spans creados en torno a las solicitudes pueden modificarse devolviendo un Span modificado, o descartarse devolviendo `null`, usando `SentryInstrumentation.BeforeSpanCallback` pasado a `SentryInstrumentation`:

```java
import io.sentry.graphql22.SentryInstrumentation;

import graphql.GraphQL;

GraphQL graphQL = GraphQL.newGraphQL()
    // ...
    .instrumentation(new SentryInstrumentation((span, environment, result) -> {
      if ("/shows".equals(environment.getExecutionStepInfo().getPath().segmentToString())) {
        span.setTag("tag-name", "tag-value");
      }
      return span;
    }, new SentrySpringSubscriptionHandler(), true))
    .build();
```

```kotlin
import io.sentry.graphql22.SentryInstrumentation

import graphql.GraphQL

val graphql = GraphQL.newGraphQL()
  // ...
  .instrumentation(SentryInstrumentation({ span: ISpan, env: DataFetchingEnvironment, result: Any? ->
    if ("/shows" == env.executionStepInfo.path.segmentToString()) {
      span.setTag("tag-name", "tag-value")
    }
    span
  }, SentrySpringSubscriptionHandler(), true))
  .build()
```


<div id="use-with-netflix-dgs">
  ## Uso con Netflix DGS
</div>

[Netflix DGS](https://netflix.github.io/dgs) detecta y configura automáticamente los beans `Instrumentation` y `DataFetcherExceptionHandler`. Para usar la integración de Sentry con GraphQL, crea los beans `SentryGenericDataFetcherExceptionHandler` y `SentryInstrumentation`:

```java
import com.netflix.graphql.dgs.exceptions.DefaultDataFetcherExceptionHandler;
import io.sentry.graphql.SentryGenericDataFetcherExceptionHandler;
import io.sentry.graphql22.SentryInstrumentation;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;

@Configuration
class SentryConfiguration {

  @Bean
  SentryInstrumentation sentryInstrumentation() {
    return new SentryInstrumentation(new SentryDgsSubscriptionHandler(), true);
  }

  @Bean
  SentryGenericDataFetcherExceptionHandler sentryDataFetcherExceptionHandler() {
    // delega al manejador de excepciones predeterminado de Netflix DGS
    return new SentryGenericDataFetcherExceptionHandler(new DefaultDataFetcherExceptionHandler());
  }
}
```

```kotlin
import com.netflix.graphql.dgs.exceptions.DefaultDataFetcherExceptionHandler
import io.sentry.graphql.SentryGenericDataFetcherExceptionHandler
import io.sentry.graphql22.SentryInstrumentation
import org.springframework.context.annotation.Bean
import org.springframework.context.annotation.Configuration

@Configuration
class SentryConfiguration {

  @Bean
  fun sentryInstrumentation() = SentryInstrumentation(SentryDgsSubscriptionHandler(), true)

  @Bean
  fun sentryDataFetcherExceptionHandler() = SentryGenericDataFetcherExceptionHandler(DefaultDataFetcherExceptionHandler())
}
```
