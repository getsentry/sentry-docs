---
title: Instrumentación de cachés
sidebar_order: 1000
description: "Aprende a instrumentar manualmente tu código para usar el módulo Caches de Sentry. "
---

Una caché puede usarse para acelerar la recuperación de datos y así mejorar el rendimiento de la aplicación. En lugar de obtener datos de una capa potencialmente lenta, tu aplicación los obtendrá de la memoria (en el mejor de los casos). El almacenamiento en caché puede acelerar cargas de trabajo con muchas lecturas para aplicaciones como portales de preguntas y respuestas, videojuegos, compartición de medios y redes sociales.

Sentry ofrece un [panel de monitoreo de cachés](https://sentry.io/orgredirect/organizations/:orgslug/insights/backend/caches/). Por ahora, puedes instrumentar manualmente tu solución de caché y usar Sentry para ver cómo está funcionando siguiendo las instrucciones de configuración a continuación. Es posible que añadamos integraciones para hacerlo automáticamente; dirígete a [GitHub](https://github.com/getsentry/sentry-java) y cuéntanos qué solución de caché te gustaría que admitiéramos.

Para que Sentry pueda darte una vista general del rendimiento de tu caché, necesitas crear dos spans: uno que indique que algo se está guardando en la caché y otro que indique que algo se está obteniendo de la caché.

Asegúrate de que haya una transacción en ejecución cuando crees los spans. Si usas un framework web, esas transacciones se crearán automáticamente. Consulta <PlatformLink to="/performance/">Monitoreo de rendimiento</PlatformLink> para más información.

Para obtener información detallada sobre qué datos pueden configurarse, consulta la [Especificación para desarrolladores del módulo Caches](https://develop.sentry.dev/sdk/performance/modules/caches/).

<div id="manual-instrumentation">
  ## Instrumentación manual
</div>

Por ahora, tendrás que instrumentar manualmente el [módulo de caché](https://sentry.io/orgredirect/organizations/:orgslug/insights/backend/caches/) siguiendo los pasos a continuación.

<PlatformSection supported={["java.spring", "java.spring-boot"]}>
Si usas el caché de Spring, echa un vistazo a nuestro [PR de prueba de concepto](https://github.com/getsentry/sentry-java/pull/3457), donde se muestra cómo registrar un listener de caché y enviar spans de caché a Sentry.
</PlatformSection>

<div id="add-span-when-putting-data-into-the-cache">
  ### Agregar un span al poner datos en la caché
</div>

Puedes usar las instrucciones de instrumentación personalizada a continuación para emitir spans de caché:

1. Establece el valor en la caché con la biblioteca de caché que estés utilizando.
2. Envuelve con un span la parte de tu aplicación que usa el valor en caché.
3. Define `op` como `cache.put`.
4. Establece `cache.item_size` en un entero que represente el tamaño del elemento en caché.

(Los pasos descritos arriba están documentados en el fragmento).

```java
import java.util.Arrays;
import io.sentry.ISpan;
import io.sentry.Sentry;

@Override
public void put(String key, Object value) {
    final ISpan parentSpan = Sentry.getSpan();
    if (parentSpan == null) {
        delegate.put(key, value);
    } else {
        ISpan childSpan = parentSpan.startChild("cache.put", key);
        try {
            // Describe el servidor de caché al que estás accediendo
            childSpan.setData("network.peer.address", "cache.example.com/supercache");
            childSpan.setData("network.peer.port", 9000);

            // Agrega la clave que quieres establecer
            childSpan.setData("cache.key", Arrays.asList(key));

            // Define el tamaño del valor en caché
            childSpan.setData("cache.item_size", 123);

            delegate.put(key, value);
        } catch (Exception e) {
            childSpan.setThrowable(e);
            childSpan.setStatus(SpanStatus.INTERNAL_ERROR);
            throw e;
        } finally {
            childSpan.finish();
        }
    }
}
```


<div id="add-span-when-retrieving-data-from-the-cache">
  ### Agregar un span al recuperar datos de la caché
</div>

Puedes usar las instrucciones de instrumentación personalizada a continuación para emitir spans de caché:

1. Obtén el valor almacenado en la caché desde la biblioteca de caché que estés usando.
2. Envuelve la parte de tu aplicación que usa ese valor en caché con `with sentry_sdk.start_span(...)`.
3. Configura `op` como `cache.get`.
4. Configura `cache.hit` como un valor booleano que indique si el valor se obtuvo correctamente de la caché o no.
5. Configura `cache.item_size` como un entero que represente el tamaño del elemento en caché.

(Los pasos descritos arriba están documentados en el fragmento).

```java
import java.util.Arrays;
import io.sentry.ISpan;
import io.sentry.Sentry;

@Override
public Object get(String key) {
    final ISpan parentSpan = Sentry.getSpan();
    if (parentSpan == null) {
        return delegate.get(key);
    } else {
        ISpan childSpan = parentSpan.startChild("cache.get", key);
        try {
            // Describe el servidor de caché al que estás accediendo
            childSpan.setData("network.peer.address", "cache.example.com/supercache");
            childSpan.setData("network.peer.port", 9000);

            // Agrega la clave que quieres establecer
            childSpan.setData("cache.key", Arrays.asList(key));

            Object value = delegate.get(key);
            childSpan.setData("cache.hit", value != null);

            // Define el tamaño del valor almacenado en caché
            childSpan.setData("cache.item_size", 123);

            return value;
        } catch (Exception e) {
            childSpan.setThrowable(e);
            childSpan.setStatus(SpanStatus.INTERNAL_ERROR);
            throw e;
        } finally {
            childSpan.finish();
        }
    }
}
```

Ahora deberías tener los spans correctos en su lugar. Ve al [panel de caché](https://sentry.io/orgredirect/organizations/:orgslug/insights/caches/) para ver cómo está rindiendo tu caché.
