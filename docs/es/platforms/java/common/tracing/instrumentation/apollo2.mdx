---
title: Integración con Apollo 2
sidebar_order: 30
sdk: sentry.java.apollo
description: "Aprende a capturar información de trazas del cliente Apollo GraphQL."
notSupported:
  - java.logback
  - java.log4j2
  - java.jul
---

<Alert>

Para capturar transacciones, primero debes <PlatformLink to="/tracing/">configurar las trazas</PlatformLink> si aún no lo has hecho.

</Alert>

La integración de Sentry con Apollo proporciona `SentryApolloInterceptor`, que crea una traza (span) por cada solicitud HTTP saliente ejecutada con un cliente GraphQL de [Apollo Android](https://github.com/apollographql/apollo-android).

<Alert>

Esta integración es compatible con Apollo 2.x. Para Apollo 3.x, usa nuestra <PlatformLink to="/tracing/instrumentation/apollo3">integración con Apollo 3</PlatformLink>. Para Apollo 4.x, usa nuestra <PlatformLink to="/tracing/instrumentation/apollo4">integración con Apollo 4</PlatformLink>.

</Alert>

<div id="install">
  ## Instalación
</div>

```xml {tabTitle:Maven}
<dependency>
    <groupId>io.sentry</groupId>
    <artifactId>sentry-apollo</artifactId>
    <version>{{@inject packages.version('sentry.java.apollo', '5.2.0') }}</version>
</dependency>
```

```groovy {tabTitle:Gradle}
implementation 'io.sentry:sentry-apollo:{{@inject packages.version('sentry.java.apollo', '5.2.0') }}'
```

```scala {tabTitle: SBT}
libraryDependencies += "io.sentry" % "sentry-apollo" % "{{@inject packages.version('sentry.java.apollo', '5.2.0') }}"
```

Para otros administradores de dependencias, consulta el [repositorio central de Maven](https://search.maven.org/artifact/io.sentry/sentry-apollo).


<div id="configure">
  ## Configuración
</div>

Añade `SentryApolloInterceptor` al builder de Apollo:

```java
import com.apollographql.apollo.ApolloClient;
import io.sentry.apollo.SentryApolloInterceptor;

ApolloClient apollo = ApolloClient.builder()
    .serverUrl("https://tu-servidor-api/")
    .addApplicationInterceptor(new SentryApolloInterceptor())
    .build();
```

```kotlin
import com.apollographql.apollo.ApolloClient
import io.sentry.apollo.SentryApolloInterceptor

val apollo = ApolloClient.builder()
    .serverUrl("https://tu-servidor-api/")
    .addApplicationInterceptor(SentryApolloInterceptor())
    .build()
```

Apollo Android está desarrollado con coroutines de Kotlin. Esto significa que `SentryApolloInterceptor` puede usarse con Java únicamente en el modo Global Hub (un solo Hub utilizado por todos los hilos), con Kotlin usando el modo de Hub único, o con el <PlatformLink to="/enriching-events/scopes/#kotlin-coroutines">soporte de coroutines de Sentry</PlatformLink>.


<div id="using-with-java">
  ## Uso con Java
</div>

Configura el modo Global Hub:

```java
import io.sentry.Sentry;

Sentry.init(options -> {
  ..
}, true)
```

<Alert>
  En el modo Global Hub, todos los hilos usan el mismo Hub.
</Alert>


<div id="using-with-kotlin-coroutines">
  ## Uso con Kotlin Coroutines
</div>

Para asegurarte de que una coroutine tenga acceso al contexto correcto de Sentry, debes proporcionar una instancia de `SentryContext` al lanzar la coroutine.

```kotlin
import io.sentry.kotlin.SentryContext
import com.apollographql.apollo.exception.ApolloException
import kotlinx.coroutines.launch

launch(SentryContext()) {
  val response = try {
    apollo.query(..).toDeferred().await()
  } catch (e: ApolloException) {
    // manejar errores de protocolo
    return@launch
  }
}
```


<div id="modify-or-drop-spans">
  ## Modificar o descartar spans
</div>

Los spans creados en torno a las solicitudes pueden modificarse o descartarse usando `SentryApolloInterceptor.BeforeSpanCallback`, que se pasa a `SentryApolloInterceptor`:

```java
import com.apollographql.apollo.ApolloClient;
import io.sentry.apollo.SentryApolloInterceptor;

ApolloClient apollo = ApolloClient.builder()
    .serverUrl("https://tu-host-api/")
    .addApplicationInterceptor(new SentryApolloInterceptor(
      (span, request, response) -> {
        if ("aQuery".equals(request.operation.name().name())) {
          span.setTag("tag-name", "tag-value");
        }
        return span;
      }
    ))
    .build();
```

```kotlin
import com.apollographql.apollo.ApolloClient
import com.apollographql.apollo.interceptor.ApolloInterceptor.InterceptorRequest
import com.apollographql.apollo.interceptor.ApolloInterceptor.InterceptorResponse
import io.sentry.ISpan
import io.sentry.apollo.SentryApolloInterceptor
import io.sentry.apollo.SentryApolloInterceptor.BeforeSpanCallback

val apollo = ApolloClient.builder()
    .serverUrl("https://tu-servidor-api/")
    .addApplicationInterceptor(
        SentryApolloInterceptor(object : BeforeSpanCallback {
            override fun execute(span: ISpan, request: InterceptorRequest, response: InterceptorResponse?): ISpan {
                if ("aQuery" == request.operation.name().name()) {
                    span.setTag("tag-key", "tag-value")
                }
                return span
            }
        })
    )
    .build()
```
