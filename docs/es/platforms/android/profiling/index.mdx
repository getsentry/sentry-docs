---
title: Configurar el perfilado en Android
sidebar_title: Perfilado
description: "Aprende a habilitar el perfilado en tu app si aún no está configurado."
sidebar_order: 5000
---

<PlatformContent includePath="profiling/index/preface" />

<PlatformContent includePath="profiling/index/why-profiling" />

<Alert level="warning" title="Importante">
  El perfilado utiliza el `tracer` del runtime de Android para muestrear los hilos. Se conocen problemas en los que este `tracer` puede provocar bloqueos en ciertas circunstancias. Consulta esta entrada de <PlatformLink to="/profiling/troubleshooting#i-see-elevated-number-of-crashes-in-the-android-runtime-when-profiling-is-activated">solución de problemas</PlatformLink> para obtener más información.
</Alert>

<div id="installation">
  ## Instalación
</div>

Android UI Profiling está disponible a partir de la versión `8.7.0` del SDK.
El generador de perfiles basado en transacciones está disponible en las versiones `6.16.0` y posteriores del SDK a través de <PlatformLink to="/configuration/options/#transaction-based-profiling-options">sus opciones</PlatformLink>.

<div id="enabling-ui-profiling">
  ## Habilitar el perfilado de la interfaz de usuario
</div>

El perfilado de la interfaz de usuario admite dos modos: `manual` y `trace`. Estos modos son mutuamente excluyentes y no pueden usarse al mismo tiempo.

En el modo `manual`, la recopilación de datos de perfilado se puede gestionar mediante llamadas a `Sentry.profiler.startProfiler` y `Sentry.profiler.stopProfiler`. Tú controlas por completo cuándo se ejecuta el profiler.

En el modo `trace`, el profiler gestiona sus propias llamadas de inicio y detención basadas en spans: sigue ejecutándose mientras haya al menos un span muestreado activo y se detiene cuando no haya spans muestreados activos.

El SDK de Sentry admite un `profileSessionSampleRate` adicional que habilita o deshabilita el perfilado para toda la <PlatformLink to="/configuration/releases/#sessions">sesión</PlatformLink>. Esta decisión de muestreo se evalúa solo una vez por sesión.

<div id="enabling-trace-lifecycle-ui-profiling">
  ### Habilitar el perfilado de UI del ciclo de vida con Trace
</div>

Para habilitar el perfilado con Trace, establece el ciclo de vida en `trace`. El perfilado con Trace requiere que el tracing esté habilitado.

Consulta la <PlatformLink to="/tracing/">documentación de configuración de tracing</PlatformLink> para obtener más detalles sobre cómo configurar el muestreo. Establecer la tasa de muestreo en 1.0 significa que se capturarán todas las transacciones.

De forma predeterminada, algunas transacciones se crearán automáticamente para operaciones comunes como cargar un view controller/activity y el inicio de la app.

```xml {filename:AndroidManifest.xml}
<application>
  <meta-data android:name="io.sentry.dsn" android:value="___PUBLIC_DSN___" />
  <!-- Habilitar el rastreo, necesario para el modo de perfiles `trace`; ajusta en producción -->
  <meta-data android:name="io.sentry.traces.sample-rate" android:value="1.0" />
  <!-- Habilitar el perfilado de la IU; ajusta en producción. Esto se evalúa solo una vez por sesión -->
  <meta-data android:name="io.sentry.traces.profiling.session-sample-rate" android:value="1.0" />
  <meta-data android:name="io.sentry.traces.profiling.lifecycle" android:value="trace" />
  <!-- Habilitar el perfilado al iniciar la app. El perfil de inicio de la app se detendrá automáticamente cuando finalice el span raíz del inicio de la app -->
  <meta-data android:name="io.sentry.traces.profiling.start-on-app-start" android:value="true" />
</application>
```

```java
import io.sentry.ProfileLifecycle;
import io.sentry.android.core.SentryAndroid;

// Clase Application principal de la app
public class MyApplication extends Application {

  @Override
  public void onCreate() {
    super.onCreate();
     SentryAndroid.init(
        this,
        options -> {
          options.setDsn("___PUBLIC_DSN___");
          // Habilita el tracing, necesario para el modo de perfiles `trace`; ajusta en el entorno de producción
          options.setTracesSampleRate(1.0);
          // Habilita el perfilado de la UI; ajusta en el entorno de producción. Esto se evalúa solo una vez por sesión
          options.setProfileSessionSampleRate(1.0);
          options.setProfileLifecycle(ProfileLifecycle.TRACE);
          // Habilita el perfilado al iniciar la app. El perfil de inicio se detendrá automáticamente cuando finalice el span raíz del inicio de la app
          options.setStartProfilerOnAppStart(true);
        });
  }
}
```

```kotlin
import io.sentry.ProfileLifecycle
import io.sentry.android.core.SentryAndroid

// Clase Application principal de la app
class MyApplication : Application() {

  override fun onCreate() {
     super.onCreate()
     SentryAndroid.init(
        this,
        { options ->
          options.dsn = "___PUBLIC_DSN___"
          // Habilitar el tracing, necesario para el modo de perfilado `trace`; ajústalo en el entorno de producción
          options.tracesSampleRate = 1.0
          // Habilitar el perfilado de la IU; ajústalo en el entorno de producción. Esto se evalúa solo una vez por sesión
          options.profileSessionSampleRate = 1.0
          options.profileLifecycle = ProfileLifecycle.TRACE
          // Habilitar el perfilado al iniciar la app. El perfil de inicio de la app se detendrá automáticamente cuando finalice el span raíz del inicio de la app
          options.isStartProfilerOnAppStart = true
         })
  }
}
```


<div id="enabling-manual-lifecycle-ui-profiling">
  ### Activar el perfilado manual del ciclo de vida de la UI
</div>

Para activar el perfilado manual, establece el ciclo de vida en `manual`. El perfilado manual no requiere tener el tracing habilitado.

```xml {filename:AndroidManifest.xml}
<application>
  <meta-data android:name="io.sentry.dsn" android:value="___PUBLIC_DSN___" />
  <!-- Habilita el perfilado de la IU; ajusta esta configuración en producción. Esto se evalúa solo una vez por sesión -->
  <meta-data android:name="io.sentry.traces.profiling.session-sample-rate" android:value="1.0" />
  <meta-data android:name="io.sentry.traces.profiling.lifecycle" android:value="manual" />
  <!-- Habilita el perfilado al iniciar la app. El perfil de inicio de la app debe detenerse con Sentry.stopProfiler() -->
  <meta-data android:name="io.sentry.traces.profiling.start-on-app-start" android:value="true" />
</application>
```

```java
import io.sentry.ProfileLifecycle;
import io.sentry.Sentry;
import io.sentry.android.core.SentryAndroid;

// Clase Application principal de la app
public class MyApplication extends Application {

  @Override
  public void onCreate() {
    super.onCreate();
     SentryAndroid.init(
        this,
        options -> {
          options.setDsn("___PUBLIC_DSN___");
          // Habilita el perfilado de la UI; ajusta esto en producción. Se evalúa solo una vez por sesión
          options.setProfileSessionSampleRate(1.0);
          options.setProfileLifecycle(ProfileLifecycle.MANUAL);
          // Habilita el perfilado al iniciar la app. El perfil de inicio debe detenerse con Sentry.stopProfiler()
          options.setStartProfilerOnAppStart(true);
        });
    // Inicia el perfilado si el ciclo de vida está en `manual` y startProfilerOnAppStart está en `true`
    Sentry.startProfiler();
    // Detén el perfilado si el ciclo de vida está en `manual` y startProfilerOnAppStart está en `true`.
    // Esta llamada es opcional. Si no detienes el profiler, seguirá perfilando tu aplicación hasta que el proceso finalice.
    Sentry.stopProfiler();
  }
}
```

```kotlin
import io.sentry.ProfileLifecycle
import io.sentry.Sentry
import io.sentry.android.core.SentryAndroid

// Clase Application principal de la app
class MyApplication : Application() {

  override fun onCreate() {
     super.onCreate()
     SentryAndroid.init(
        this,
        { options ->
          options.dsn = "___PUBLIC_DSN___"
          // Habilita el perfilado de la IU; ajústalo en producción. Esto se evalúa solo una vez por sesión
          options.profileSessionSampleRate = 1.0
          options.profileLifecycle = ProfileLifecycle.MANUAL
          // Habilita el perfilado al iniciar la app. El perfil de inicio debe detenerse con Sentry.stopProfiler()
          options.isStartProfilerOnAppStart = true
         })
    // Inicia el perfilado si el ciclo de vida está configurado como `manual` y startProfilerOnAppStart está en `true`
    Sentry.startProfiler()
    // Detén el perfilado si el ciclo de vida está configurado como `manual` y startProfilerOnAppStart está en `true`.
    // Esta llamada es opcional. Si no detienes el generador de perfiles, seguirá perfilando tu aplicación hasta que el proceso termine.
    Sentry.stopProfiler()
  }
}
```


<div id="enabling-transaction-based-profiling">
  ### Habilitar el perfilado basado en transacciones
</div>

<Alert>
  Este modo se retirará próximamente y se recomienda actualizar a UI Profiling. El mismo comportamiento, sin la limitación de 30 segundos, puede lograrse con <PlatformLink to="/profiling/#enabling-trace-lifecycle-ui-profiling">Trace Lifecycle UI Profiling</PlatformLink>. Para actualizar a UI Profiling, también debes eliminar de tu configuración las <PlatformLink to="/configuration/options/#transaction-based-profiling-options">opciones de perfilado basado en transacciones</PlatformLink>.
  El perfilado basado en transacciones en Android está disponible desde la versión `6.16.0` del SDK y es compatible con API nivel 22 y superiores.
  El perfilado del inicio de la app está disponible desde la versión `7.3.0` del SDK.
</Alert>

El perfilado basado en transacciones solo se ejecuta junto con transacciones de rendimiento iniciadas automáticamente o manualmente con `Sentry.startTransaction`, y se detiene automáticamente a los 30 segundos (a menos que lo detengas antes de forma manual). Naturalmente, esta limitación dificulta obtener una cobertura completa de la ejecución de tu app.

```xml {filename:AndroidManifest.xml}
<application>
  <meta-data android:name="io.sentry.dsn" android:value="___PUBLIC_DSN___" />
  <!-- Habilitar el trazado; necesario para el perfilado heredado. Ajusta en producción -->
  <meta-data android:name="io.sentry.traces.sample-rate" android:value="1.0" />
  <!-- Habilitar el perfilado basado en transacciones. Ajusta en producción. Esto es relativo a la tasa de muestreo de trazado -->
  <meta-data android:name="io.sentry.traces.profiling.sample-rate" android:value="1.0" />
  <!-- Habilitar el perfilado al iniciar la aplicación -->
  <meta-data android:name="io.sentry.traces.profiling.enable-app-start" android:value="true" />
</application>
```

```java
import io.sentry.ProfileLifecycle;
import io.sentry.Sentry;
import io.sentry.android.core.SentryAndroid;

// Clase principal de Application de la app
public class MyApplication extends Application {

  @Override
  public void onCreate() {
    super.onCreate();
     SentryAndroid.init(
        this,
        options -> {
          options.setDsn("___PUBLIC_DSN___");
          // Habilita el tracing, necesario para el perfilado heredado; ajusta en el entorno de producción
          options.setTracesSampleRate(1.0);
          // Habilita el perfilado basado en transacciones; ajusta en el entorno de producción. Esto es relativo a la tasa de muestreo de trazas
          options.setProfilesSampleRate(1.0);
          // Habilita el perfilado al iniciar la app
          options.setEnableAppStartProfiling(true);
        });
  }
}
```

```kotlin
import io.sentry.ProfileLifecycle
import io.sentry.Sentry
import io.sentry.android.core.SentryAndroid

// Clase Application principal de la app
class MyApplication : Application() {
  override fun onCreate() {
     super.onCreate()
     SentryAndroid.init(
        this,
        { options ->
          options.dsn = "___PUBLIC_DSN___"
          // Habilita el rastreo, necesario para el modo `trace` de profiling, ajustar en entorno de producción
          options.tracesSampleRate = 1.0
          // Habilita el profiling basado en transacciones, ajustar en entorno de producción. Esto es relativo a la tasa de muestreo de trazas
          options.profilesSampleRate = 1.0
          // Habilita el profiling al iniciar la app
          options.isEnableAppStartProfiling = true
         })
  }
}
```

<Alert>
  El SDK no realizará el perfilado del inicio de la app la primera vez que esta se ejecute, ya que aún no habrá leído las opciones cuando deba iniciarse el perfil.
  El SDK establecerá el indicador `isForNextAppStart` en `TransactionContext` si el perfilado del inicio de la app está habilitado.
</Alert>
