---
title: Solución de problemas
description: "Soluciona y resuelve problemas comunes del SDK de Android."
sidebar_order: 9000
---

<div id="obfuscated-stack-traces-missing-android-specific-context">
  ## Rastros de pila ofuscados y falta de contexto específico de Android
</div>

Si los rastros de pila no se desofuscan correctamente, aunque <PlatformLink to="/enhance-errors/proguard/">los archivos de mapeo se hayan subido correctamente</PlatformLink>, o si falta información de contexto de Android en los eventos, una posible causa es que el SDK se inicializó con `Sentry.init` en lugar de `SentryAndroid.init`.

<Alert level="warning">
  Para la inicialización manual en Android, <PlatformLink to="/configuration/manual-init/#manual-initialization">usa siempre `SentryAndroid.init`</PlatformLink>.
</Alert>

A partir de la versión `8.0.0` del SDK, usar `Sentry.init` en Android lanzará un `IllegalArgumentException`.

<div id="excluding-unwanted-resources-from-apkaab">
  ## Excluir recursos no deseados del APK/AAB
</div>

El SDK de Sentry para Android incluye de forma transitiva algunos recursos del SDK de Sentry para Java que no son necesarios en apps de Android. No es posible excluir estos recursos al publicar el SDK, pero puedes añadir el siguiente fragmento a tu archivo `app/build.gradle` para reducir un poco el tamaño final del APK:

```kotlin
android {
  packagingOptions {
    resources {
      excludes += "META-INF/native-image/io.sentry/sentry/native-image.properties"
    }
  }
}
```

<div id="sentry-android-sdk-causes-anr-or-strictmode-violations">
  ## El SDK de Sentry para Android provoca ANR o infracciones de StrictMode
</div>

El SDK de Sentry para Android puede provocar ANR o infracciones de StrictMode debido a operaciones mínimas de E/S de archivos necesarias para procesar eventos y recopilar contexto.
Desde la versión `6.1.1` del SDK de Sentry para Android, puedes reducir estas infracciones desactivando la recopilación de contexto adicional:

```xml {tabTitle:AndroidManifest.xml}
<application>
  <meta-data android:name="io.sentry.additional-context" android:value="false" />
</application>
```

```java {tabTitle:MyApplication.java}
SentryAndroid.init(this, options -> {
    options.setDsn("___PUBLIC_DSN___");
    options.setCollectAdditionalContext(false);
});
```

```kotlin {tabTitle:MyApplication.kt}
SentryAndroid.init(this) { options ->
    options.dsn = "___PUBLIC_DSN___"
    options.collectAdditionalContext = false
}
```

Esto reduce las operaciones de E/S de archivos durante el procesamiento de eventos, pero perderás parte de la información de contexto del dispositivo, como el nivel de batería, el uso de memoria y el estado del almacenamiento.
Ten en cuenta que esto no eliminará todas las infracciones, ya que ciertas funciones, como la detección de bloqueos al iniciar la app, requieren un mínimo de operaciones de E/S de archivos.

La motivación es que algunas API de Android de las que depende el SDK de Sentry para agregar contexto adicional pueden ser lentas en ciertos dispositivos.

Por ejemplo, este stack trace muestra que la comprobación de conectividad provoca ANR:

```
  #00  pc 000000000007550c  /apex/com.android.runtime/lib64/bionic/libc.so (syscall+28)
  #00  pc 00000000001af800  /apex/com.android.art/lib64/libart.so (art::ConditionVariable::WaitHoldingLocks(art::Thread*)+148)
  #00  pc 0000000000669f3c  /apex/com.android.art/lib64/libart.so (art::GoToRunnable(art::Thread*)+460)
  #00  pc 0000000000669d2c  /apex/com.android.art/lib64/libart.so (art::JniMethodEnd(unsigned int, art::Thread*)+28)
  en android.os.BinderProxy.transactNative (método nativo)
  en android.os.BinderProxy.transact (BinderProxy.java:568)
  en android.net.IConnectivityManager$Stub$Proxy.getActiveNetwork (IConnectivityManager.java:2435)
  en android.net.ConnectivityManager.getActiveNetwork (ConnectivityManager.java:1033)
  en io.sentry.android.core.internal.util.ConnectivityChecker.getConnectionType (ConnectivityChecker.java:101)
  en io.sentry.android.core.DefaultAndroidEventProcessor.setDeviceIO (DefaultAndroidEventProcessor.java:375)
  en io.sentry.android.core.DefaultAndroidEventProcessor.getDevice (DefaultAndroidEventProcessor.java:285)
  en io.sentry.android.core.DefaultAndroidEventProcessor.setDevice (DefaultAndroidEventProcessor.java:173)
  en io.sentry.android.core.DefaultAndroidEventProcessor.setCommons (DefaultAndroidEventProcessor.java:140)
  en io.sentry.android.core.DefaultAndroidEventProcessor.process (DefaultAndroidEventProcessor.java:130)
  en io.sentry.SentryClient.processEvent (SentryClient.java:206)
  en io.sentry.SentryClient.captureEvent (SentryClient.java:88)
  en io.sentry.Hub.captureEvent (Hub.java:89)
  en io.sentry.Sentry.captureEvent (Sentry.java:262)
  en io.sentry.HubAdapter.captureEvent (HubAdapter.java:29)
  en io.sentry.IHub.captureEvent (IHub.java:39)
  en io.sentry.IHub$-CC.$default$captureEvent (IHub.java)
  en io.sentry.HubAdapter.captureEvent (HubAdapter.java:29)
```

Este muestra cómo comprobar el nivel de batería provoca ANR:

```
  #00  pc 0000000000086f8c  /apex/com.android.runtime/lib64/bionic/libc.so (syscall+28)
  #00  pc 00000000001b27a4  /apex/com.android.art/lib64/libart.so (art::ConditionVariable::WaitHoldingLocks(art::Thread*)+148)
  #00  pc 000000000067e9d0  /apex/com.android.art/lib64/libart.so (art::GoToRunnable(art::Thread*)+480)
  #00  pc 000000000067e7ac  /apex/com.android.art/lib64/libart.so (art::JniMethodEnd(unsigned int, art::Thread*)+28)
  at android.os.BinderProxy.transactNative (Native method)
  at android.os.BinderProxy.transact (BinderProxy.java:605)
  at android.app.IActivityManager$Stub$Proxy.registerReceiverWithFeature (IActivityManager.java:6380)
  at android.app.ContextImpl.registerReceiverInternal (ContextImpl.java:1696)
  at android.app.ContextImpl.registerReceiver (ContextImpl.java:1650)
  at android.app.ContextImpl.registerReceiver (ContextImpl.java:1638)
  at android.content.ContextWrapper.registerReceiver (ContextWrapper.java:686)
  at io.sentry.android.core.DefaultAndroidEventProcessor.getBatteryIntent (DefaultAndroidEventProcessor.java:434)
  at io.sentry.android.core.DefaultAndroidEventProcessor.setDeviceIO (DefaultAndroidEventProcessor.java:326)
  at io.sentry.android.core.DefaultAndroidEventProcessor.getDevice (DefaultAndroidEventProcessor.java:285)
  at io.sentry.android.core.DefaultAndroidEventProcessor.setDevice (DefaultAndroidEventProcessor.java:173)
  at io.sentry.android.core.DefaultAndroidEventProcessor.setCommons (DefaultAndroidEventProcessor.java:140)
  at io.sentry.android.core.DefaultAndroidEventProcessor.process (DefaultAndroidEventProcessor.java:130)
  at io.sentry.SentryClient.processEvent (SentryClient.java:206)
  at io.sentry.SentryClient.captureEvent (SentryClient.java:88)
  at io.sentry.Hub.captureEvent (Hub.java:89)
  at io.sentry.Sentry.captureEvent (Sentry.java:262)
  at io.sentry.HubAdapter.captureEvent (HubAdapter.java:29)
```

<div id="incorrect-line-numbers-in-kotlin">
  ## Números de línea incorrectos en Kotlin
</div>

Los elementos del stack trace que hacen referencia a funciones inline de Kotlin desde archivos distintos al sitio de llamada pueden apuntar a números de línea incorrectos.

Esto se debe a una [característica ausente en la JVM](https://youtrack.jetbrains.com/issue/KT-8628/Line-numbers-are-incorrect-in-exception-stack-trace). Los archivos `.class` con funciones inline contienen código de muchos archivos fuente y, cuando la JVM genera un stack trace, no sustituye la clase y la línea donde ocurrió el error por el archivo y el número de línea originales. Así, cuando se lanza una excepción en una función inline, el número de línea del stack trace de la excepción puede ser incorrecto.

Veamos un ejemplo. Aquí hay una Activity con una función inline que lanza una excepción.

```kotlin
class MyActivity : AppCompatActivity() {

    override fun onCreate(savedInstanceState: Bundle?) {
        super.onCreate(savedInstanceState)
        erroringFunction() // Línea 10
    }

    inline fun erroringFunction() {
        throw RuntimeException() // Línea 14
    }
}
 // Línea 17
```

La traza de la excepción apunta a la línea 18 de la clase `MyActivity.kt`.

```
java.lang.RuntimeException
	at io.sentry.samples.android.MyActivity.onCreate(MyActivity.kt:18)
	at android.app.Activity.performCreate(Activity.java:8305)
	at android.app.Activity.performCreate(Activity.java:8284)
	at android.app.Instrumentation.callActivityOnCreate(Instrumentation.java:1417)
	at android.app.ActivityThread.performLaunchActivity(ActivityThread.java:3626)
	at android.app.ActivityThread.handleLaunchActivity(ActivityThread.java:3782)
	at android.app.servertransaction.LaunchActivityItem.execute(LaunchActivityItem.java:101)
	at android.app.servertransaction.TransactionExecutor.executeCallbacks(TransactionExecutor.java:135)
	at android.app.servertransaction.TransactionExecutor.execute(TransactionExecutor.java:95)
	at android.app.ActivityThread$H.handleMessage(ActivityThread.java:2307)
	at android.os.Handler.dispatchMessage(Handler.java:106)
	at android.os.Looper.loopOnce(Looper.java:201)
	at android.os.Looper.loop(Looper.java:288)
	at android.app.ActivityThread.main(ActivityThread.java:7872)
	at java.lang.reflect.Method.invoke(Native Method)
	at com.android.internal.os.RuntimeInit$MethodAndArgsCaller.run(RuntimeInit.java:548)
	at com.android.internal.os.ZygoteInit.main(ZygoteInit.java:936)
```

<div id="ndk">
  ## NDK
</div>

Si usas una versión de `sentry-android` anterior a la 5.0, debido a limitaciones actuales en cómo funciona `sentry-native`, no puede identificar bibliotecas nativas cargadas directamente desde archivos `.apk`. En su lugar, necesita tener acceso a las bibliotecas extraídas en el sistema de archivos.
Esta funcionalidad está [deshabilitada de forma predeterminada](https://developer.android.com/studio/releases/gradle-plugin#extractNativeLibs)
al usar Android Gradle Plugin &gt;= v3.6.0, y debe habilitarse con la opción de configuración
[`extractNativeLibs`](https://developer.android.com/guide/topics/manifest/application-element#extractNativeLibs).

Si usas [Android App Bundle](https://developer.android.com/guide/app-bundle), establece `android.bundle.enableUncompressedNativeLibs=false` junto con la opción de configuración `extractNativeLibs`.

Además, `sentry-native` usa [tagged pointers](https://source.android.com/devices/tech/debug/tagged-pointers)
internamente. Como resultado, el SDK de Android no funcionará de inmediato en dispositivos con versiones más recientes de Android porque tienen su propio etiquetado de punteros en conflicto.

<Alert>
  Si usas una versión de `sentry-android` anterior a la 3.1, debes deshabilitar manualmente la opción de configuración [`allowNativeHeapPointerTagging`](https://developer.android.com/guide/topics/manifest/application-element#allowNativeHeapPointerTagging) porque `sentry-native` usa [tagged pointers](https://source.android.com/devices/tech/debug/tagged-pointers)
  internamente. Como resultado, esta opción no funcionará de inmediato en dispositivos con versiones más recientes de Android porque tienen su propio etiquetado de punteros en conflicto. Esto se solucionó en `sentry-android` a partir de la versión 3.1.
</Alert>

**Ejemplo de AndroidManifest.xml**:

```xml {filename:AndroidManifest.xml}
<application
    android:allowNativeHeapPointerTagging="false"
    android:extractNativeLibs="true">
</application>
```

**Ejemplo de gradle.properties**:

```properties {filename:gradle.properties}
android.bundle.enableUncompressedNativeLibs=false
```

<div id="the-sdk-is-not-sending-data">
  ## El SDK no está enviando datos
</div>

Si configuraste el SDK de Sentry y no está enviando ningún dato a Sentry:

* Verifica que configuraste un DSN y que lo estás pasando a la opción `dsn` en `SentryAndroid.init()` o en el `AndroidManifest`.
* Cuando ocurre un fallo o la app se cierra, el sistema solo concede un breve tiempo para gestionarlo antes de terminar el proceso. Es posible que el SDK no tenga tiempo suficiente para enviar el evento, los spans, el perfil o los datos de replay. En estos casos, simplemente volver a abrir la app debería permitir que el SDK envíe los datos pendientes.
* Un bloqueador de anuncios (por ejemplo, [App Tracking Protection de DuckDuckGo](https://duckduckgo.com/duckduckgo-help-pages/p-app-tracking-protection/what-is-app-tracking-protection)) o restricciones de red podrían estar impidiendo que el SDK se conecte con los servidores de Sentry. Como alternativa, puedes usar [tunneling](/es/platforms/javascript/troubleshooting/#using-the-tunnel-option) para canalizar los eventos de Sentry a través de tu propio servidor. Luego puedes agregar la [opción de proxy](/es/platforms/android/configuration/options/#proxy) a la configuración del SDK.
* Establece `debug: true` en `SentryAndroid.init()` o en las opciones del manifest y observa la salida de Logcat al iniciar tu aplicación. El SDK puede indicarte por qué no está enviando datos.
* Revisa las páginas de [Stats](https://sentry.io/orgredirect/organizations/:orgslug/stats/) y [Subscription](https://sentry.io/orgredirect/organizations/:orgslug/settings/billing/overview/) en Sentry. Es posible que hayas superado la cuota.

<div id="sentry-android-gradle-plugin-build-issues">
  ## Problemas de compilación del complemento de Gradle de Sentry para Android
</div>

<div id="proguard-mapping-upload-issues">
  ### Problemas al subir el mapeo de Proguard
</div>

Puedes establecer la bandera de registro de depuración como una variable de entorno, que será detectada por la [Sentry CLI](/es/cli/).
Además, activa la bandera `--stacktrace`:

```
export SENTRY_LOG_LEVEL=debug && ./gradlew app:uploadSentryProguardMappingsRelease --stacktrace
```

Con esta información, puede que quede más claro lo que está pasando. Si no, considera reportar estos problemas en [GitHub](https://github.com/getsentry/sentry-android-gradle-plugin/issues), para que podamos hacerles seguimiento.

<div id="auto-instrumentation-issues">
  ### Problemas de autoinstrumentación
</div>

El [plugin de Gradle para Sentry en Android](/es/platforms/android/configuration/gradle/) utiliza manipulación de bytecode para medir automáticamente el rendimiento de tu aplicación. Este proceso requiere revisar las dependencias de la aplicación y puede romper la compilación si hay bibliotecas compiladas/minificadas con un compilador de Java no predeterminado, como R8/D8.

Si ves el mensaje de error “[sentry] Error while instrumenting MyClassName”, puede que estés usando una biblioteca minificada que no se puede instrumentar porque su bytecode no cumple con la especificación de la JVM. Puedes excluir esa biblioteca de la instrumentación de la siguiente manera:

```groovy
sentry {
  tracingInstrumentation {
    enabled = true
    excludes = ['com/example/donotinstrument/**']
  }
}
```

```kotlin
sentry {
  tracingInstrumentation {
    enabled.set(true)
    excludes.set(setOf("com/example/donotinstrument/**"))
  }
}
```

También puedes desactivar una de nuestras instrumentaciones, como la [instrumentación de E/S de archivos](/es/platforms/android/integrations/file-io/), que suele ser la causa, de la siguiente manera:

```groovy
import io.sentry.android.gradle.extensions.InstrumentationFeature

sentry {
  tracingInstrumentation {
    enabled = true
    features = EnumSet.allOf(InstrumentationFeature) - InstrumentationFeature.FILE_IO
  }
}
```

```kotlin
import java.util.EnumSet
import io.sentry.android.gradle.extensions.InstrumentationFeature

sentry {
  tracingInstrumentation {
    enabled.set(true)
    features.set(EnumSet.allOf(InstrumentationFeature::class.java) - InstrumentationFeature.FILE_IO)
  }
}
```

Si desactivar la instrumentación de E/S de archivos no ayuda, también puedes desactivar toda la lógica de manipulación de bytecode mediante la bandera `tracingInstrumentation.enabled`:

```groovy
sentry {
  tracingInstrumentation {
    enabled = false
  }
}
```

```kotlin
sentry {
  tracingInstrumentation {
    enabled.set(false)
  }
}
```

Considera informar estos problemas en [GitHub](https://github.com/getsentry/sentry-android-gradle-plugin/issues), para que podamos hacerles seguimiento.

<div id="auto-installation-issues">
  ### Problemas de autoinstalación
</div>

El [plugin de Gradle de Sentry para Android](/es/platforms/android/configuration/gradle/) ofrece la instalación automatizada del SDK de Sentry para Android y de las integraciones con Fragment, Timber y OkHttp. Como modificamos el árbol de dependencias, esto puede generar problemas durante las fases de configuración y compilación de Gradle.

<div id="stackoverflowerror-during-sync-or-build">
  #### `StackOverflowError` durante la sincronización o la compilación
</div>

Si experimentas un `StackOverflowError` al intentar iniciar una sincronización de Gradle en Android Studio o durante la compilación de Gradle, lo más probable es que se trate de [este problema](https://issuetracker.google.com/issues/232075280) documentado en el sitio del Android Gradle Plugin (AGP). El problema solo está presente en la versión `7.2.0` de AGP y puede solucionarse de la siguiente manera:

Actualiza Sentry Android Gradle Plugin a la versión `3.1.3` o superior:

```groovy
plugins {
    id 'io.sentry.android.gradle' version '{{@inject packages.version('sentry.java.android.gradle-plugin', '3.1.3') }}'
}
```

O actualiza el complemento de Gradle para Android a la versión `7.2.1`:

```groovy
plugins {
  id 'com.android.application' version '7.2.1'
}
```

Si el problema persiste, lo más probable es que lo esté causando algún otro complemento de Gradle que procese archivos `.pom`. En ese caso, puedes resolverlo actualizando la dependencia `sentry-android` o `sentry-android-core` a la versión `6.3.0` o posterior:

```groovy
dependencies {
  implementation 'io.sentry:sentry-android:{{@inject packages.version('sentry.java.android', '6.3.0') }}' // o sentry-android-core si no usas el paquete NDK
}
```

<div id="runtime-crash-when-using-sentry-android-core-in-a-submodule">
  #### Error en tiempo de ejecución al usar `sentry-android-core` en un submódulo
</div>

Si declaras una dependencia `sentry-android-core:6.x` que **no está** en tu módulo principal `app`, sino en uno de los submódulos, y usas la versión `3.1.0` del complemento Sentry Android para Gradle, la aplicación fallará en tiempo de ejecución con un `NoSuchMethodError`. Esto se debe a que el complemento intentará instalar `sentry-android-ndk` con la versión incompatible `5.7.0`. Para solucionar este problema, puedes actualizar el complemento Sentry Android para Gradle a la versión `3.1.1` o posterior:

```groovy
plugins {
    id 'io.sentry.android.gradle' version '{{@inject packages.version('sentry.java.android.gradle-plugin', '3.1.1') }}'
}
```

Como alternativa, puedes indicarle al complemento que use tu versión de Sentry NDK:

```groovy
sentry {
  autoInstallation {
    sentryVersion = '6.0.0' // o la versión que utilices para `sentry-android-core`
  }
}
```

<Alert>
  Este problema solo afecta a estas versiones específicas: `sentry-android-core` versión `6.+` y `sentry-android-gradle-plugin` versión `3.1.0`.
</Alert>

Consulta [este informe](https://github.com/getsentry/sentry-android-gradle-plugin/issues/329) para más detalles.

<PageGrid />
