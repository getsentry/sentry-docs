---
title: Gradle
sidebar_order: 3
description: "Aprende a usar el Sentry Android Gradle Plugin."
---

El [Sentry Android Gradle Plugin](https://github.com/getsentry/sentry-android-gradle-plugin) es un complemento para los SDK principales de Android y los SDK híbridos (como React Native y Flutter) y ofrece
una integración perfecta con el sistema de compilación Gradle. Es compatible con las siguientes funciones:

* Carga de mapeos de ProGuard/R8
* Carga de contexto de código fuente de Java/Kotlin
* Carga de símbolos y código fuente nativos de depuración
* Trazas con autoinstrumentación mediante manipulación de bytecode
* Registro de breadcrumbs desde Logcat
* Instalación automática del Sentry Android SDK y sus integraciones
* Informe de dependencias externas

<div id="setup">
  ## Configuración
</div>

<div id="install">
  ### Instalación
</div>

Con Gradle (Android Studio), en tu `app/build.gradle`, agrega:

```groovy {filename:app/build.gradle}
plugins {
    id "com.android.application"
    id "io.sentry.android.gradle" version "{{@inject packages.version('sentry.java.android.gradle-plugin', '3.0.0') }}"
}
```

```kotlin {filename:app/build.gradle}
plugins {
    id("com.android.application")
    id("io.sentry.android.gradle") version "{{@inject packages.version('sentry.java.android.gradle-plugin', '3.0.0') }}"
}
```

<Alert>
  `io.sentry.android.gradle` &gt;= `3.0.0` requiere [Android Gradle Plugin &gt;= 7.0.0](https://developer.android.com/studio/releases/gradle-plugin#7-0-0). Para versiones anteriores del Android Gradle Plugin, usa `io.sentry.android.gradle:2.+`.
</Alert>

<div id="configure">
  ### Configurar
</div>

Define el token de autenticación como una variable de entorno para usarlo al ejecutar la compilación de lanzamiento.

<OrgAuthTokenNote />

```bash
export SENTRY_AUTH_TOKEN=___ORG_AUTH_TOKEN___
```

Exponemos los siguientes valores de configuración directamente en tu `app/build.gradle`:

````groovy
import io.sentry.android.gradle.extensions.InstrumentationFeature
import io.sentry.android.gradle.instrumentation.logcat.LogcatLevel

sentry {
    // Desactiva o activa la salida de registros de depuración, p. ej., para sentry-cli.
    // De forma predeterminada, está desactivado.
    debug = false

    // El identificador (slug) de la organización de Sentry que se usará para subir los mapeos de Proguard y los contextos de código fuente.
    org = "___ORG_SLUG___"

    // El identificador (slug) del proyecto de Sentry que se usará para subir los mapeos de Proguard y los contextos de código fuente.
    projectName = "___PROJECT_SLUG___"

    // El token de autenticación que se usará para subir los mapeos de Proguard y los contextos de código fuente.
    // ADVERTENCIA: No expongas este token en tus archivos build.gradle; en su lugar, define una
    // variable de entorno y léela en esta propiedad.
    authToken = System.getenv("SENTRY_AUTH_TOKEN")

    // La URL de tu instancia de Sentry. Si usas SaaS (no autoalojado), no tienes que
    // configurar esto. Si es autoalojado, puedes establecer aquí tu URL.
    url = null

    // Desactiva o activa el manejo del mapeo de Proguard para Sentry.
    // Si está activado, el plugin generará un UUID y se encargará de
    // subir el mapeo a Sentry. Si está desactivado, toda la lógica
    // relacionada con el mapeo de Proguard se excluirá.
    // De forma predeterminada, está activado.
    includeProguardMapping = true

    // Si el plugin debe intentar subir automáticamente el archivo de mapeo a Sentry o no.
    // Si está desactivado, el plugin ejecutará un dry-run y solo generará un UUID.
    // En este caso, el archivo de mapeo debe subirse manualmente mediante sentry-cli.
    // De forma predeterminada, está activado.
    autoUploadProguardMapping = true

    // Indicador experimental para activar la compatibilidad con la integración de las herramientas de GuardSquare (Dexguard y Proguard externo).
    // Si está activado, el plugin intentará consumir y subir el archivo de mapeo producido por Dexguard y Proguard externo.
    // De forma predeterminada, está desactivado.
    dexguardEnabled = false

    // Desactiva o activa la configuración automática de símbolos nativos
    // para Sentry. Esto ejecuta sentry-cli automáticamente para que
    // no tengas que hacerlo manualmente.
    // De forma predeterminada, está desactivado.
    uploadNativeSymbols = false

    // Si el plugin debe intentar subir automáticamente los símbolos de depuración nativos a Sentry o no.
    // Si está desactivado, el plugin ejecutará un dry-run.
    // De forma predeterminada, está activado.
    autoUploadNativeSymbols = true

    // Incluye o no el código fuente del código nativo para Sentry.
    // Esto ejecuta sentry-cli con el parámetro --include-sources automáticamente para que
    // no tengas que hacerlo manualmente.
    // Esta opción solo tiene efecto cuando [uploadNativeSymbols] está activado.
    // De forma predeterminada, está desactivado.
    includeNativeSources = false

    // Genera un paquete de fuentes de JVM (Java, Kotlin, etc.) y sube tu código fuente a Sentry.
    // Esto habilita el contexto de código fuente, lo que te permite ver tu código
    // como parte de las trazas de pila en Sentry.
    includeSourceContext = false

    // Configura directorios adicionales para incluir en el paquete de fuentes que se usa para
    // el contexto de código fuente. Los directorios deben especificarse en relación con la raíz del
    // módulo/proyecto de Gradle. Por ejemplo, si tienes un conjunto de fuentes personalizado junto a 'main', el parámetro sería
    // 'src/custom/java'.
    additionalSourceDirsForSourceContext = []

    // Activar o desactivar la instrumentación de trazas.
    // Realiza instrumentación automática de las funcionalidades especificadas mediante manipulación de bytecode.
    // De forma predeterminada, está activado.
    tracingInstrumentation {
      enabled = true

    // Especifica un conjunto de funcionalidades de instrumentación aptas para la manipulación de bytecode.
    // De forma predeterminada, incluye todos los valores disponibles de la clase enum InstrumentationFeature.
      features = [InstrumentationFeature.DATABASE, InstrumentationFeature.FILE_IO, InstrumentationFeature.OKHTTP, InstrumentationFeature.COMPOSE]

    // Activar o desactivar la instrumentación de logcat mediante manipulación de bytecode.
    // De forma predeterminada, está activado.
      logcat {
        enabled = true

    // Especifica un nivel mínimo de log para el registro de breadcrumbs de logcat.
    // De forma predeterminada, es LogcatLevel.WARNING.
        minLevel = LogcatLevel.WARNING
      }

    // Conjunto de patrones glob para excluir de la instrumentación. Las clases que coincidan con cualquiera de estos
    // patrones en las fuentes del proyecto y en los JAR de dependencias no serán instrumentadas por el
    // plugin de Gradle de Sentry.
      //
    // No incluyas la extensión de archivo. El filtrado se realiza sobre clases compiladas y
    // el sufijo .class no se incluye en la coincidencia de patrones.
      //
    // Ejemplo de uso:
      // ```
      // excludes = ['com/example/donotinstrument/**', '**/*Test']
      // ```
      //
      // Solo es compatible al usar la versión 7.4.0 o superior del plugin de Android para Gradle (AGP).
      excludes = []
    }

    // Activar la instalación automática de componentes de Sentry (SDK sentry-android e integraciones de okhttp, timber y fragment).
    // De forma predeterminada, está activado.
    // Disponible solo a partir de la v3.1.0.
    autoInstallation {
      enabled = true

      // Especifica una versión del SDK sentry-android y de las integraciones de fragment, timber y okhttp.
      //
      // Esto también es útil cuando ya tienes el SDK sentry-android incluido en una dependencia/módulo transitivo y quieres
      // alinear las versiones de las integraciones con él (si es una dependencia directa, se inferirá la versión).
      //
      // NOTA: si tienes una versión superior del SDK sentry-android o de las integraciones en el classpath, esta configuración no tendrá efecto
      // ya que Gradle la resolverá a la versión más reciente.
      //
      // De forma predeterminada, usa la última versión publicada de Sentry.
      sentryVersion = '{{@inject packages.version('sentry.java.android', '5.0.0') }}'
    }

    // Desactiva o activa el envío de metadatos de dependencias para Sentry.
    // Si está activado, el plugin recopilará dependencias externas y
    // las subirá a Sentry como parte de los eventos. Si está desactivado, toda la lógica
    // relacionada con el informe de metadatos de dependencias se excluirá.
    //
    // De forma predeterminada, está activado.
    includeDependenciesReport = true

    // Si el plugin debe enviar datos de telemetría a Sentry.
    // Si está desactivado, el plugin no enviará datos de telemetría.
    // Esto se desactiva automáticamente si se ejecuta contra una instancia autoalojada de Sentry.
    // De forma predeterminada, está activado.
    telemetry = true
}
````

````kotlin
import io.sentry.android.gradle.extensions.InstrumentationFeature

sentry {
    // Desactiva o activa la salida de registros de depuración, p. ej., para sentry-cli.
    // De forma predeterminada, está desactivado.
    debug.set(false)

    // El slug de la organización de Sentry para subir mapeos de Proguard/contextos de código fuente.
    org.set("___ORG_SLUG___")

    // El slug del proyecto de Sentry para subir mapeos de Proguard/contextos de código fuente.
    projectName.set("___PROJECT_SLUG___")

    // El token de autenticación para subir mapeos de Proguard/contextos de código fuente.
    // ADVERTENCIA: No expongas este token en tus archivos build.gradle; en su lugar, define una
    // variable de entorno y léela en esta propiedad.
    authToken.set(System.getenv("SENTRY_AUTH_TOKEN"))

    // La URL de tu instancia de Sentry. Si usas SaaS (no autoalojado), no tienes que
    // establecerla. Si te autoalojas, puedes indicar tu URL aquí.
    url = null

    // Desactiva o activa el manejo del mapeo de Proguard para Sentry.
    // Si está activado, el complemento generará un UUID y se encargará de
    // subir el mapeo a Sentry. Si está desactivado, toda la lógica
    // relacionada con el mapeo de Proguard se excluirá.
    // De forma predeterminada, está activado.
    includeProguardMapping.set(true)

    // Indica si el complemento debe intentar subir automáticamente el archivo de mapeo a Sentry.
    // Si está desactivado, el complemento ejecutará una simulación y solo generará un UUID.
    // En este caso, el archivo de mapeo debe subirse manualmente mediante sentry-cli.
    // De forma predeterminada, está activado.
    autoUploadProguardMapping.set(true)

    // Indicador experimental para activar la integración con las herramientas de GuardSquare (Dexguard y Proguard externo).
    // Si está activado, el complemento intentará consumir y subir el archivo de mapeo producido por Dexguard y Proguard externo.
    // De forma predeterminada, está desactivado.
    dexguardEnabled.set(false)

    // Desactiva o activa la configuración automática de símbolos nativos
    // para Sentry. Esto ejecuta sentry-cli automáticamente para que
    // no tengas que hacerlo manualmente.
    // De forma predeterminada, está desactivado.
    uploadNativeSymbols.set(false)

    // Indica si el complemento debe intentar subir automáticamente los símbolos de depuración nativos a Sentry.
    // Si está desactivado, el complemento ejecutará una simulación.
    // De forma predeterminada, está activado.
    autoUploadNativeSymbols.set(true)

    // Incluye o no el código fuente del código nativo para Sentry.
    // Esto ejecuta sentry-cli con el parámetro --include-sources automáticamente para que
    // no tengas que hacerlo manualmente.
    // De forma predeterminada, está desactivado.
    includeNativeSources.set(false)

    // Genera un paquete de fuentes de la JVM (Java, Kotlin, etc.) y sube tu código fuente a Sentry.
    // Esto habilita el contexto de código fuente, lo que te permite ver tu código
    // como parte de tus trazas de pila en Sentry.
    includeSourceContext.set(false)

    // Configura directorios adicionales que se incluirán en el paquete de fuentes que se usa para
    // el contexto de código fuente. Los directorios deben especificarse con respecto a la raíz
    // del módulo/proyecto de Gradle. Por ejemplo, si tienes un conjunto de fuentes personalizado junto a 'main', el parámetro sería
    // 'src/custom/java'.
    additionalSourceDirsForSourceContext.set(emptySet())

    // Activa o desactiva la instrumentación de trazas.
    // Realiza la autoinstrumentación de las funciones especificadas mediante manipulación de bytecode.
    // De forma predeterminada, está activado.
    tracingInstrumentation {
      enabled.set(true)

      // Especifica un conjunto de funciones de instrumentación aptas para la manipulación de bytecode.
      // De forma predeterminada, incluye todos los valores disponibles de la clase enum InstrumentationFeature.
      features.set(setOf(InstrumentationFeature.DATABASE, InstrumentationFeature.FILE_IO, InstrumentationFeature.OKHTTP, InstrumentationFeature.COMPOSE))

      // Activa o desactiva la instrumentación de logcat mediante manipulación de bytecode.
      // De forma predeterminada, está activado.
      logcat {
        enabled.set(true)

        // Especifica un nivel mínimo de registro para el registro de breadcrumbs de logcat.
        // De forma predeterminada, es LogcatLevel.WARNING.
        minLevel.set(LogcatLevel.WARNING)
      }

      // El conjunto de patrones glob para excluir de la instrumentación. Las clases que coincidan con cualquiera de estos
      // patrones en las fuentes del proyecto y en los JAR de dependencias no serán instrumentadas por el complemento
      // de Gradle de Sentry.
      //
      // No incluyas la extensión de archivo. El filtrado se realiza sobre clases compiladas y
      // el sufijo .class no se incluye en la coincidencia de patrones.
      //
      // Ejemplo de uso:
      // ```
      // excludes.set(setOf("com/example/donotinstrument/**", "**/*Test"))
      // ```
      //
      // Solo se admite al usar la versión 7.4.0 o superior del complemento de Gradle para Android (AGP).
      excludes.set(emptySet())
    }

    // Activa la instalación automática de componentes de Sentry (SDK sentry-android e integraciones de okhttp, timber, fragment y compose).
    // De forma predeterminada, está activado.
    // Disponible solo a partir de la v3.1.0.
    autoInstallation {
      enabled.set(true)

      // Especifica una versión del SDK sentry-android y de las integraciones de fragment, timber y okhttp.
      //
      // Esto también es útil cuando ya tienes el SDK sentry-android incluido en una dependencia/módulo transitivo y quieres
      // alinear las versiones de las integraciones con él (si es una dependencia directa, la versión se inferirá).
      //
      // NOTA: si tienes una versión superior del SDK sentry-android o integraciones en el classpath, esta configuración no tendrá efecto,
      // ya que Gradle lo resolverá a la última versión.
      //
      // De forma predeterminada, es la última versión publicada de Sentry.
      sentryVersion.set("{{@inject packages.version('sentry.java.android', '5.0.0') }}")
    }

    // Desactiva o activa el informe de metadatos de dependencias para Sentry.
    // Si está activado, el complemento recopilará dependencias externas y
    // las subirá a Sentry como parte de los eventos. Si está desactivado, toda la lógica
    // relacionada con el informe de metadatos de dependencias se excluirá.
    //
    // De forma predeterminada, está activado.
    //
    includeDependenciesReport.set(true)

    // Indica si el complemento debe enviar datos de telemetría a Sentry.
    // Si está desactivado, el complemento no enviará datos de telemetría.
    // Esto se desactiva automáticamente si se ejecuta contra una instancia autoalojada de Sentry.
    // De forma predeterminada, está activado.
    telemetry.set(true)
}
````

Ahora, cuando compiles tu app, el plugin subirá a Sentry los mapeos de ProGuard/R8, el paquete de código fuente y los símbolos nativos según los hayas configurado.

<div id="variant-filtering">
  ### Filtrado de variantes
</div>

Puedes especificar qué variante/sabor/tipo de compilación debe ignorar Sentry en tu archivo `app/build.gradle`:

```groovy
sentry {
    // Lista los tipos de compilación que deben ignorarse (p. ej., "release").
    ignoredBuildTypes = ["release"]

    // Lista los tipos de compilación que deben ignorarse (p. ej., "production").
    ignoredFlavors = ["production"]

    // Lista las variantes de compilación que deben ignorarse (p. ej., "productionRelease").
    ignoredVariants = ["productionRelease"]
}
```

```kotlin
sentry {
    // Lista los tipos de compilación que deben ignorarse (p. ej., "release").
    ignoredBuildTypes.set(setOf("release"))

    // Lista los flavors de compilación que deben ignorarse (p. ej., "production").
    ignoredFlavors.set(setOf("production"))

    // Lista las variantes de compilación que deben ignorarse (p. ej., "productionRelease").
    ignoredVariants.set(setOf("productionRelease"))
}
```

## ProGuard/R8 &amp; DexGuard

El complemento generará automáticamente los archivos de mapeo de ProGuard correspondientes y los subirá cuando ejecutes `gradle assemble{BuildVariant}`. Por ejemplo, `assembleRelease`. Release es el valor predeterminado, pero el complemento funciona con otros siempre que hayas habilitado ProGuard/R8. Las credenciales para el paso de carga se definen en la extensión de Gradle anterior o se cargan desde un archivo `sentry.properties` en tu proyecto.

Para usar las herramientas ProGuard o DexGuard de Guardsquare, tendrás que habilitar la opción `dexguardEnabled`. Obtén más información en la [documentación completa de `sentry-cli`](/es/cli/configuration/#configuration-values).

En lugar de proporcionar tus credenciales mediante la extensión de Gradle, puedes crear un archivo `sentry.properties` con el siguiente contenido en tu módulo `app`:

<OrgAuthTokenNote />

```bash
defaults.project=___PROJECT_SLUG___
defaults.org=___ORG_SLUG___
auth.token=___ORG_AUTH_TOKEN___
```

<Alert>
  Puedes encontrar tu token de autenticación en la página de configuración de [tokens de organización](https://sentry.io/orgredirect/organizations/:orgslug/settings/auth-tokens/). Para más información sobre las opciones de configuración disponibles, consulta la [documentación completa de sentry-cli](/es/cli/configuration/#configuration-values).
</Alert>

<div id="native-debug-symbols-and-sources">
  ## Símbolos nativos de depuración y código fuente
</div>

El complemento detectará y subirá automáticamente los símbolos nativos de depuración y el código fuente cuando ejecutes `gradle assemble{BuildVariant}`. `{BuildVariant}` debe ser un tipo de compilación no depurable, por ejemplo `Release`. Las credenciales para el paso de subida se cargan mediante variables de entorno o desde un archivo `sentry.properties` en la raíz de tu proyecto.

Obtén más información en la [documentación completa de sentry-cli](/es/cli/configuration/#configuration-values).

Como mínimo, necesitarás algo similar a:

<OrgAuthTokenNote />

```bash
defaults.project=___PROJECT_SLUG___
defaults.org=___ORG_SLUG___
auth.token=___ORG_AUTH_TOKEN___
```

<Alert>
  Puedes encontrar tu token de autenticación [en la página de la API de Sentry](https://sentry.io/api/). Para obtener más información sobre las opciones de configuración disponibles, consulta la [documentación completa de sentry-cli](/es/cli/configuration/#configuration-values).
</Alert>

<div id="javakotlin-source-context">
  ## Contexto de código fuente en Java/Kotlin
</div>

Este complemento puede cargar automáticamente tu código fuente en Sentry para que aparezca como parte de las trazas de pila.

```groovy
sentry {
    includeSourceContext = true
}
```

```kotlin
sentry {
    includeSourceContext.set(true)
}
```

Consulta la documentación completa sobre <PlatformLink to="/enhance-errors/source-context">Contexto de origen</PlatformLink> para obtener más información.

<div id="tracing-auto-instrumentation">
  ## Auto-instrumentación de trazas
</div>

El plugin utiliza el framework de [manipulación de bytecode](https://www.infoq.com/articles/Living-Matrix-Bytecode-Manipulation/) para inyectar un fragmento de código
que inicia y finaliza un [span](/es/concepts/key-terms/tracing/trace-view/#product-walkthrough-trace-view-page) en operaciones comunes que pueden provocar cuellos de botella de rendimiento.
Así, las operaciones potencialmente costosas se miden automáticamente sin necesidad de instrumentarlas manualmente.

<Alert>
  Para que estos datos se capturen, debes habilitar el [tracing](/es/platforms/android/tracing/).
</Alert>

El plugin admite las siguientes capacidades de auto-instrumentación:

```kotlin
enum class InstrumentationFeature {
    /**
     * Cuando está habilitado, el SDK creará spans para cualquier operación CRUD realizada por 'androidx.sqlite'
     * y 'androidx.room'. Esta función utiliza manipulación de bytecode.
     *
     * Requiere la versión 4.0.0 o superior del SDK de sentry-android
     */
    DATABASE,

    /**
     * Cuando está habilitado, el SDK creará spans para [java.io.FileInputStream],
     * [java.io.FileOutputStream], [java.io.FileReader], [java.io.FileWriter].
     * Esta función utiliza manipulación de bytecode y reemplaza las clases
     * mencionadas anteriormente con implementaciones específicas de Sentry.
     *
     * Requiere la versión 5.5.0 o superior del SDK de sentry-android
     */
    FILE_IO,

    /**
     * Cuando está habilitado, el SDK creará spans para solicitudes de red salientes y adjuntará
     * sentry-trace-header para rastreo distribuido.
     * Esta función utiliza manipulación de bytecode y adjunta SentryOkHttpInterceptor a todos los clientes OkHttp
     * del proyecto.
     *
     * Requiere la versión 5.0.0 o superior del SDK de sentry-android.
     * Solo disponible en la versión 3.1.0 o superior del plugin de Sentry Android Gradle.
     */
    OKHTTP,

    /**
     * Cuando está habilitado, el SDK creará breadcrumbs al navegar
     * usando [androidx.navigation.NavController].
     * Esta función utiliza manipulación de bytecode y agrega un OnDestinationChangedListener a todos los
     * controladores de navegación usados en Jetpack Compose.
     */
    COMPOSE
}
```

Consulta la página de [Integrations](/es/platforms/android/integrations/) para una explicación más detallada de cada funcionalidad de instrumentación.

<Alert>
  Para saber más sobre el funcionamiento interno de la auto-instrumentación, consulta esta [entrada del blog](https://blog.sentry.io/2021/12/14/bytecode-transformations-the-android-gradle-plugin).
</Alert>

<div id="auto-installation">
  ## Instalación automática
</div>

El plugin ofrece la instalación automatizada del Sentry Android SDK y de las integraciones [Fragment](/es/platforms/android/integrations/fragment/), [Timber](/es/platforms/android/integrations/timber/), [OkHttp](/es/platforms/android/integrations/okhttp/) y [Jetpack Compose](/es/platforms/android/integrations/jetpack-compose/). A partir de la versión 3.1.0, esta función está habilitada de forma predeterminada, por lo que no necesitas agregar ninguna dependencia: solo usa el plugin de Gradle de Sentry.

El algoritmo del plugin hace lo siguiente al definir las versiones de las dependencias:

1. Comprueba si el módulo/app tiene una dependencia directa del Sentry Android SDK:

   * Si la tiene, usa la versión de esa dependencia directa.

   * Si no la tiene, agrega automáticamente la dependencia sentry-android con la `sentryVersion` especificada en la configuración del plugin (de forma predeterminada, la última versión publicada del SDK).

2. Comprueba si el módulo/app tiene una dependencia directa de alguna de las integraciones (Fragment, Timber u OkHttp):

   * Si la tiene, mantiene la versión actual de esa dependencia directa.

   * Si no la tiene, agrega automáticamente la dependencia de la integración con la versión del Sentry Android SDK inferida anteriormente.

3. Si hay dependencias transitivas de cualquiera de las integraciones o del Sentry Android SDK, entonces sus versiones no se consideran. Sin embargo, si las versiones son superiores a las incluidas con el plugin de Gradle de Sentry, Gradle las elegirá en su lugar.