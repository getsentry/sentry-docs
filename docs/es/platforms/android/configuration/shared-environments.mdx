---
title: Uso de Sentry dentro de un SDK
description: "Aprende a usar el SDK de Sentry en un entorno compartido, p. ej., otro SDK."
sidebar_order: 2000
---

<Alert>
  Usar el SDK de Sentry dentro de otro SDK está [desaconsejado](/es/platforms/). Esto puede provocar comportamientos inesperados y posibles filtraciones de datos. Si necesitas usar Sentry dentro de otro SDK, sigue las mejores prácticas que se indican a continuación.
</Alert>

<Alert>
  Al configurar Sentry dentro de una biblioteca, la aplicación consumidora también podría usar el SDK de Sentry, por lo tanto **no debes usar `Sentry.init()`**, ya que esto contaminará el estado global.
</Alert>

Para evitar conflictos con otras instancias de Sentry, debes usar la API de `Scopes` para crear una nueva instancia de Sentry.
La API de Scopes funciona igual que la instancia global de Sentry, pero no es global y puede usarse dentro de tu componente. Si quieres capturar excepciones no controladas, puedes usar `UncaughtExceptionHandlerIntegration` para capturarlas. Como esto capturará todas las excepciones no controladas de una aplicación, debes usar `BeforeSendCallback` para aceptar solo los eventos que sean relevantes para tu SDK.

```kotlin
import io.sentry.Scope
import io.sentry.Scopes
import io.sentry.SentryOptions
import io.sentry.SentryOptions.BeforeSendCallback
import io.sentry.UncaughtExceptionHandlerIntegration

val options = SentryOptions().apply {
    dsn = "___PUBLIC_DSN___"
    isEnableUncaughtExceptionHandler = true
    setBeforeSend { event, _ ->
        // como las excepciones no capturadas se capturan de forma global,
        // solo debes aceptar los eventos que sean relevantes
        if (isRelevantForMySdk(event.throwable)) {
            return@setBeforeSend event
        }
        // descartar el evento
        return@setBeforeSend null
    }

}

val globalScope = Scope(options);
val isolationScope = Scope(options);
val scope = Scope(options);

globalScope.bindClient(new SentryClient(options));

Scopes scopes = Scopes(scope, isolationScope, globalScope, "MySentry.init");

val integration = UncaughtExceptionHandlerIntegration()
options.addIntegration(integration)
integration.register(scopes, options)
```

Una vez configurados los `Scopes`, puedes usarlos para capturar eventos:

```kotlin
scopes.captureException(IllegalStateException("Excepción de ejemplo"))
```

Si tu SDK se puede abrir y cerrar varias veces, también deberías cerrar los `Scopes` cuando termines:

```kotlin
scopes.close()
```
