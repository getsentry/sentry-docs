---
title: La aplicación no responde (ANR)
sidebar_order: 4
description: Aprende a desactivar o configurar ANR.
og_image: /og-images/platforms-android-configuration-app-not-respond.png
---

Los errores de “La aplicación no responde” (ANR) se generan cuando el hilo principal de la interfaz de usuario de una aplicación está bloqueado durante más de cinco segundos. El SDK de Android informa los errores ANR como eventos de Sentry. Además, Sentry calcula la [tasa de ANR](#anr-rate) en función de estos eventos y de las sesiones de usuario.

<div id="anr-implementation-details">
  ## Detalles de la implementación de ANR
</div>

El SDK de Android emplea distintas implementaciones para detectar ANR, según la versión de Android que ejecute el dispositivo:

* En Android 10 y anteriores: ejecución de un hilo Watchdog (v1)
* Android 11 y posteriores: lectura de [ApplicationExitInfo](https://developer.android.com/reference/android/app/ApplicationExitInfo) (v2)

La nueva implementación (v2) utiliza la misma fuente de datos que Google Play Console. Esto significa que los eventos de ANR informados y la [tasa de ANR](#anr-rate) deberían coincidir con lo que ves en Sentry. La nueva implementación también captura un volcado de hilos con información adicional, como bloqueos retenidos, para ayudarte a resolver ANR con mayor eficiencia.

Aunque el enfoque original de Watchdog (v1) arroja muchos falsos positivos y se basa en heurísticas, todavía tiene algunas ventajas frente a v2, como capturar capturas de pantalla y transacciones con perfiles en el momento del ANR.

<Alert>
  Estamos considerando compatibilidad del SDK para que ambos enfoques funcionen en paralelo en Android 11 y versiones posteriores. Por favor, apoya con tu voto en [esta discusión de GitHub](https://github.com/getsentry/sentry-java/discussions/2716) y comparte tus comentarios si tienes un caso para que v1 y v2 funcionen juntos.
</Alert>

Ambas implementaciones de detección de ANR se controlan con el mismo indicador:

```xml {filename:AndroidManifest.xml}
<application>
    <meta-data android:name="io.sentry.anr.enable" android:value="false" />
</application>
```

<div id="watchdog-v1">
  ### Watchdog (v1)
</div>

Cada vez que el hilo principal de la interfaz de usuario de la aplicación permanezca bloqueado por más de cinco segundos, el SDK notificará el problema al servidor.

La integración reporta eventos de ANR con `mechanism:ANR`.

<Alert>
  Sentry no reporta el ANR si la aplicación está en modo de depuración.
</Alert>

También puedes especificar cuánto tiempo debe estar bloqueado el hilo antes de reportar el ANR. Indica la duración en el atributo `io.sentry.anr.timeout-interval-millis` en tu `AndroidManifest.xml`:

```xml {filename:AndroidManifest.xml}
<application>
    <meta-data android:name="io.sentry.anr.timeout-interval-millis" android:value="2000" />
</application>
```

<div id="applicationexitinfo-v2">
  ### ApplicationExitInfo (v2)
</div>

Este enfoque lee la API [ApplicationExitInfo](https://developer.android.com/reference/android/app/ApplicationExitInfo) en el siguiente inicio de la app
y envía de forma asíncrona eventos de ANR a Sentry por cada ANR en el historial, enriqueciendo solo el más reciente con breadcrumbs, contextos, etiquetas, etc.

La integración informa eventos de ANR con `mechanism:AppExitInfo`.

<Alert>
  Si [ApplicationExitInfo#getTraceInputStream](https://developer.android.com/reference/android/app/ApplicationExitInfo#getTraceInputStream\(\)) devuelve `null`, el SDK dejará de informar un evento de ANR, ya que estos eventos no serán procesables sin ello.
</Alert>

![ANR](./img/app-not-respond.png)

<div id="historical-anrs">
  #### ANR históricas
</div>

De forma predeterminada, el SDK solo reporta y enriquece la última ANR, y es la única que se contabiliza para la tasa de ANR. Sin embargo, también hay una opción `setReportHistoricalAnrs` disponible en `SentryOptions` que permite al SDK reportar todas las ANR de la lista [getHistoricalExitReasons](https://developer.android.com/reference/android/app/ActivityManager?hl=en#getHistoricalProcessExitReasons\(java.lang.String,%20int,%20int\)):

```kotlin
SentryAndroid.init(context) { options ->
  options.isReportHistoricalAnrs = true
}
```

```java
SentryAndroid.init(context) { options ->
  options.setReportHistoricalAnrs(true)
}
```

Esta opción es útil después de actualizar el SDK a la versión en la que se introdujo la nueva implementación de ANR, para reportar todos los ANR que ocurrieron antes de la actualización del SDK. Fuera de eso, el SDK siempre recogerá el ANR más reciente de la lista histórica de motivos de salida en el siguiente reinicio de la aplicación, y no habrá ANR históricos que reportar.

La integración reporta eventos ANR con `mechanism:HistoricalAppExitInfo`.

<div id="attaching-thread-dump">
  #### Adjuntar volcado de hilos
</div>

El SDK permite enviar el volcado de hilos de ANR desde [ApplicationExitInfo#getTraceInputStream](https://developer.android.com/reference/android/app/ApplicationExitInfo#getTraceInputStream\(\)) como un adjunto. Esto es útil para realizar investigaciones más profundas utilizando toda la información disponible del sistema operativo (además de que el SDK analiza el volcado de hilos en hilos con rastreos de pila):

```kotlin
SentryAndroid.init(context) { options ->
  options.isAttachAnrThreadDump = true
}
```

```java
SentryAndroid.init(context) { options ->
  options.setAttachAnrThreadDump(true)
}
```

![Volcado de hilos ANR](./img/app-not-respond-thread-dump.png)

<div id="anr-root-cause-analysis">
  ## Análisis de causa raíz de ANR
</div>

Sentry realiza varios análisis de causa raíz para darte información sobre por qué podrían aparecer ciertos ANR. Si se detecta una posible causa raíz, se mostrará en una nueva sección debajo del stack trace del ANR. Sentry puede detectar las siguientes causas raíz:

<div id="performance-issues">
  ### Problemas de rendimiento
</div>

Si un ANR está relacionado con uno de los problemas de rendimiento detectados por Sentry (por ejemplo, [File I/O on Main Thread](/es/product/issues/issue-details/performance-issues/file-main-thread-io/) o [DB on Main Thread](/es/product/issues/issue-details/performance-issues/db-main-thread-io/)), el span problemático se vinculará al evento de ANR y te mostrará exactamente qué operación lenta es la responsable.

![Causa raíz del ANR: File I/O](./img/anr-rootcause-fileio.png)

<div id="common-patterns">
  ### Patrones comunes
</div>

Este detector analiza la traza de pila de un ANR e intenta identificar errores frecuentes, como acceder a archivos, recursos (assets) o recursos pesados en el hilo principal. Si se encuentra un marco de pila problemático, se resaltará en la traza con información sobre cómo prevenir este tipo de ANR:

![Marco sospechoso de la causa raíz del ANR](./img/anr-rootcause-frame.png)

<div id="deadlock-detection">
  ### Detección de interbloqueos
</div>

Sentry intentará detectar interbloqueos y señalar posibles causas. Si, por ejemplo, el hilo principal está bloqueado esperando un objeto de bloqueo que está en manos de otro hilo, se resaltará el marco sospechoso que está esperando el bloqueo. También se mostrará el seguimiento de pila del hilo infractor que mantiene el bloqueo, así como el marco infractor de ese hilo:

![ANR Root Cause Deadlock](./img/anr-rootcause-deadlock.png)

<div id="anr-rate">
  ## Tasa de ANR
</div>

La tasa de ANR es el porcentaje de usuarios únicos que han experimentado un ANR durante el período especificado.

<Alert level="info">
  Como existen dos implementaciones para la detección de ANR, Sentry calcula la tasa de ANR según la implementación. En Android 11 y versiones posteriores, Sentry solo considera los **ANR fatales**: ANR que hacen que tu app se cierre, ya sea por el usuario o por el sistema operativo. En Android 10 y versiones anteriores, tanto los ANR fatales como los no fatales contribuyen al cálculo de la tasa de ANR.
</Alert>

<div id="user-perceived-anr-rate">
  ### Tasa de ANR percibida por el usuario
</div>

La tasa de ANR percibida por el usuario es un indicador vital de Android y se define, de forma más precisa, como el porcentaje único de usuarios que han experimentado falta de respuesta ante un evento de entrada en una app durante más de cinco segundos.

Una tasa de ANR percibida por el usuario superior al 0,47% se considera por encima del [umbral de mal comportamiento](https://developer.android.com/topic/performance/vitals#what_are_the_bad_behavior_thresholds) establecido por Google. Si tu app supera este umbral, Google Play puede optar por reducir su visibilidad en la tienda.

<div id="foreground-anr-rate">
  ### Tasa de ANR en primer plano
</div>

En Sentry, podemos monitorear la tasa de ANR en primer plano, que es el porcentaje de usuarios únicos que han experimentado un evento ANR de más de cinco segundos mientras la app estaba en primer plano. Como es más evidente para el usuario, un ANR en primer plano es más probable que se perciba como una molestia.

Si bien las tasas de ANR en primer plano pueden no coincidir exactamente con las tasas de ANR percibidas por el usuario, pueden servir como un buen indicador. En Sentry, el gráfico de la tasa de ANR en primer plano incluye una línea de umbral de mal comportamiento para comparación.

Para ver tu tasa de ANR en Sentry:

1. Ve a la página **Projects**
2. Haz clic en tu proyecto de Android
3. Busca la tarjeta &quot;ANR Rate&quot; en la sección &quot;Project Details&quot;
4. Haz clic en &quot;View Issues&quot; para ver una lista de incidencias de ANR creadas en el intervalo de tiempo y entorno seleccionados

También puedes ver un gráfico de la tasa de ANR en una tarjeta aparte. Al abrir el menú &quot;Display&quot; podrás alternar entre las vistas &quot;ANR Rate&quot; y &quot;Foreground ANR Rate&quot;.

![ANR Rate](./img/anr-rate.png)

El SDK de Android de Sentry, versión 6.13.0 y posteriores, informa errores de ANR si el hilo principal de la interfaz de usuario de tu aplicación está bloqueado por más de cinco segundos.