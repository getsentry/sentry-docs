---
title: ESM (MJS)
sidebar_order: 10
description: "Obtén información sobre cómo ejecutar Sentry en una aplicación ESM."
supported:
  - javascript.node
  - javascript.connect
  - javascript.express
  - javascript.fastify
  - javascript.hapi
  - javascript.hono
  - javascript.koa
noindex: true
---

<Alert>
  ¿No estás seguro de si deberías usar este método de instalación? Revisa nuestros
  [métodos de instalación](../).
</Alert>

Cuando ejecutes tu aplicación en modo ESM, no puedes usar `require()` para cargar módulos. En su lugar, debes usar la opción de línea de comandos `--import` para cargar un módulo antes de que la aplicación se inicie.

Debes crear un archivo llamado `instrument.mjs` que importe e inicialice Sentry:

```javascript {tabTitle:ESM} {filename: instrument.mjs}
import * as Sentry from "@sentry/node";

// Asegúrate de llamar a esto antes de importar cualquier otro módulo.
Sentry.init({
  dsn: "___PUBLIC_DSN___",

  // Activa el rastreo configurando tracesSampleRate
  // Recomendamos ajustar este valor en producción
  tracesSampleRate: 1.0,
});
```

Ajusta la llamada a Node.js de tu aplicación para usar el parámetro [--import](https://nodejs.org/api/cli.html#--importmodule) y que apunte a `instrument.js`, donde está tu código de `Sentry.init()`:

```bash
# Nota: Esto solo está disponible a partir de Node v18.19.0.
node --import ./instrument.mjs app.mjs
```

Si no te es posible pasar la opción `--import` al binario de Node.js, puedes usar la variable de entorno `NODE_OPTIONS` de la siguiente manera:

```bash
NODE_OPTIONS="--import ./instrument.mjs" npm run start
```

No ofrecemos compatibilidad con ESM en versiones de Node anteriores a la 18.19.0.


<div id="troubleshooting-instrumentation">
  ## Solución de problemas de la instrumentación
</div>

De forma predeterminada, todos los paquetes se envuelven internamente con
[import-in-the-middle](https://www.npmjs.com/package/import-in-the-middle) para
facilitar su instrumentación.

Si `import-in-the-middle` encuentra problemas al envolver un paquete, es posible que veas
errores de sintaxis en tiempo de ejecución o errores registrados en la consola:

```logs
SyntaxError: El módulo solicitado '...' no ofrece una exportación llamada '...'
(node:3368) Error: 'import-in-the-middle' no logró interceptar 'file://../../path/to/file.js'
```

Para confirmar que estos errores son causados por `import-in-the-middle`,
desactícalo configurando `registerEsmLoaderHooks` en false. Ten en cuenta que esto también
desactivará la instrumentación de trazado:

```javascript {tabTitle:ESM} {filename: instrument.mjs} {4}
import * as Sentry from "@sentry/node";

Sentry.init({
  registerEsmLoaderHooks: false,
});
```

Si estás iniciando Sentry con `--import`, puedes indicar a `import-in-the-middle`
que solo envuelva los paquetes que Sentry instrumenta específicamente. Para ello, puedes
configurar `onlyIncludeInstrumentedModules` en `true`:

```javascript {tabTitle:ESM} {filename: instrument.mjs} {4-6}
import * as Sentry from "@sentry/node";

Sentry.init({
  registerEsmLoaderHooks: {
    onlyIncludeInstrumentedModules: true,
  },
});
```
