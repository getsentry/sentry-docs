---
title: Inicialización tardía (ESM o CJS)
sidebar_order: 12
description: "Aprende a ejecutar Sentry en una aplicación ESM o CJS, en escenarios donde no puedes ejecutar init temprano."
supported:
  - javascript.node
  - javascript.connect
  - javascript.express
  - javascript.fastify
  - javascript.hapi
  - javascript.hono
  - javascript.koa
---

<Alert>
  ¿No estás seguro de si deberías usar este método de instalación? Revisa nuestros
  [métodos de instalación](../).
</Alert>

Para que la autoinstrumentación funcione, por lo general se requiere ejecutar `Sentry.init()` lo antes posible, antes de importar cualquier otra cosa en tu aplicación.

Sin embargo, en algunos casos esto puede no ser posible; por ejemplo, si obtienes tu DSN de una fuente externa. En ese caso, puedes usar el hook `@sentry/node/preload` para asegurarte de que los módulos se envuelvan temprano, lo que te permite llamar a `Sentry.init()` más tarde, cuando tú elijas.

<Alert>
  Recomendamos usar este método solo si es estrictamente necesario. En la mayoría de los casos,
  es mejor encontrar una manera de ejecutar `Sentry.init()` temprano en tu aplicación
  para asegurarte de que ningún error quede sin informar.
</Alert>

Este método de inicialización está disponible a partir de la versión **8.5.0**.

<div id="late-initialization-with-commonjs-cjs">
  ## Inicialización diferida con CommonJS (CJS)
</div>

En tu aplicación CJS, usa el gancho `@sentry/node/preload` con `--require` para asegurarte de que los módulos se instrumenten lo antes posible:

```bash
node --require @sentry/node/preload app.js
```

Luego, en tu aplicación puedes invocar `Sentry.init()` más adelante:

```javascript {filename: main.js}
const startApp = require("./app");
const fetchDsn = require("./utils/fetchDsn");
const Sentry = require("@sentry/node");

startApp();

const dsn = fetchDsn();
Sentry.init({
  dsn,

  // Agrega Tracing configurando tracesSampleRate
  // Recomendamos ajustar este valor en producción
  tracesSampleRate: 1.0,
});

// A partir de ahora, Sentry está inicializado,
// pero la aplicación sigue auto-instrumentada
```


<div id="late-initialization-with-esm">
  ## Inicialización tardía con ESM
</div>

En tu aplicación ESM, usa el hook `@sentry/node/preload` con `--import` para asegurarte de que los módulos se envuelvan lo antes posible:

```bash
# Nota: Esto solo está disponible desde Node v18.19.0 en adelante.
node --import @sentry/node/preload app.js
```

Luego, en tu aplicación, puedes llamar a `Sentry.init()` más adelante:

```javascript {filename: main.js}
import startApp from "./app";
import fetchDsn from "./utils/fetchDsn";
import * as Sentry from "@sentry/node";

startApp();

const dsn = fetchDsn();
Sentry.init({
  dsn,

  // Agrega Tracing configurando tracesSampleRate
  // Recomendamos ajustar este valor en producción
  tracesSampleRate: 1.0,
});

// A partir de ahora, Sentry está inicializado,
// pero la app aún se auto-instrumenta
```


<div id="what-does-preloading-mean">
  ## ¿Qué significa la precarga?
</div>

Las integraciones que se precargan garantizan que los módulos necesarios se “envolvan” con antelación, antes de que tu aplicación pueda importarlos. En este punto, los módulos ya están envueltos, pero no harán nada: no emitirán ni capturarán nada.

Una vez que llames a `Sentry.init()`, los módulos envueltos comenzarán automáticamente a emitir datos de rendimiento que se enviarán a Sentry.

<div id="what-is-preloaded">
  ## ¿Qué es Preloaded?
</div>

De forma predeterminada, toda la instrumentación de rendimiento se precarga al usar el hook `@sentry/node/preload`.

Opcionalmente, puedes configurar que solo se precarguen ciertas integraciones definiendo la variable de entorno `SENTRY_PRELOAD_INTEGRATIONS`. Esta variable debe contener una lista de integraciones separadas por comas para precargar. Por ejemplo, para precargar solo las integraciones `Http` y `Express`, puedes establecer la variable de entorno de la siguiente manera:

```bash
SENTRY_PRELOAD_INTEGRATIONS="Http,Express" node --require @sentry/node/preload app.js
```

Puedes pasar los nombres de cualquiera de las siguientes integraciones:

* `Http`
* `Express`
* `Connect`
* `Fastify`
* `Hapi`
* `Koa`
* `Nest`
* `Mongo`
* `Mongoose`
* `Mysql`
* `Mysql2`
* `Postgres`
* `Graphql`

Ten en cuenta que no es necesario precargar `NodeFetch`; siempre se instrumentará.


<div id="debugging-preload">
  ## Depuración de la precarga
</div>

También puedes definir la variable de entorno `SENTRY_DEBUG` para obtener registros de depuración del gancho de precarga. Esto puede ser útil para entender qué ocurre durante el proceso de precarga.

```bash
SENTRY_DEBUG=1 node --require @sentry/node/preload app.js
```
