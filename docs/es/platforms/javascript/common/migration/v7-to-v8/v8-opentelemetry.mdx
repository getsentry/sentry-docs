---
title: Compatibilidad con OpenTelemetry
sidebar_order: 8930
description: "Conoce la compatibilidad con OpenTelemetry en el SDK 8.x"
supported:
  - javascript.node
  - javascript.aws-lambda
  - javascript.azure-functions
  - javascript.connect
  - javascript.express
  - javascript.fastify
  - javascript.gcp-functions
  - javascript.hapi
  - javascript.hono
  - javascript.koa
  - javascript.nestjs
  - javascript.bun
---

En la versión `8.x`, las API de trazas del SDK se han rediseñado por completo. Ahora están impulsadas por [OpenTelemetry](https://opentelemetry.io/).

No necesitas saber ni entender qué es OpenTelemetry para usar Sentry. Nosotros lo configuramos por ti.

Si quieres, puedes usar las API nativas de OpenTelemetry para iniciar spans y Sentry lo detectará todo automáticamente.

<div id="accessing-the-opentelemetry-tracer">
  ### Acceder al tracer de OpenTelemetry
</div>

Puedes acceder a la instancia del tracer para añadir spans o contexto personalizados a tus trazas. Esto significa que puedes usar las API de OpenTelemetry para iniciar spans, y Sentry capturará todo automáticamente.

```JavaScript
const tracer = Sentry.getClient().tracer;

const span1 = tracer.startSpan('work-1');
// Realizar algún trabajo
span1.end();
```

Recomendamos usar las [APIs de monitoreo del rendimiento](../v8-new-performance-api/) de Sentry, ya que son más fáciles de usar y ofrecen funciones adicionales.


<div id="custom-opentelemetry-instrumentation">
  ### Instrumentación personalizada de OpenTelemetry
</div>

Aunque incluimos cierta instrumentación de OpenTelemetry verificada lista para usar, también puedes añadir tu propia instrumentación sobre esa base. Para ello, instala un paquete de instrumentación y llama al método `addOpenTelemetryInstrumentation`:

```JavaScript
const { GenericPoolInstrumentation } = require('@opentelemetry/instrumentation-generic-pool');

Sentry.init({
  dsn: '___PUBLIC_DSN___',
});

// Luego, puedes agregar instrumentación adicional:
Sentry.addOpenTelemetryInstrumentation(new GenericPoolInstrumentation());
```


<div id="custom-opentelemetry-setup">
  ### Configuración personalizada de OpenTelemetry
</div>

El SDK también permite personalizar por completo tu configuración de OpenTelemetry.

En este caso, debes establecer `skipOpenTelemetrySetup: true` en la configuración de `Sentry.init` y asegurarte de configurar tú mismo todos los componentes que Sentry necesita.

1. Primero, instala el paquete `@sentry/opentelemetry`.

```bash {tabTitle:npm}
npm install @sentry/opentelemetry --save
```

```bash {tabTitle:yarn}
yarn add @sentry/opentelemetry
```

```bash {tabTitle:pnpm}
pnpm add @sentry/opentelemetry
```

```bash {tabTitle:bun}
bun add @sentry/opentelemetry
```

2. Luego, agrega `SentrySpanProcessor`, `SentryPropagator`, `SentryContextManager` y `SentrySampler` a la inicialización de tu SDK de OpenTelemetry.

```JavaScript
// Asegúrate de inicializar Sentry antes que OpenTelemetry
Sentry.init({
  dsn: '___PUBLIC_DSN___',
  // Asegúrate de configurar esto para desactivar la configuración automática de OpenTelemetry
  skipOpenTelemetrySetup: true,
});

const { SentrySpanProcessor, SentryPropagator, SentryContextManager, SentrySampler } = require('@sentry/opentelemetry');

// Necesitamos agregar un procesador de spans para enviar los spans a Sentry
provider.addSpanProcessor(new SentrySpanProcessor());

// Necesitamos un propagador y un gestor de contexto personalizados
// Esto permite el rastreo distribuido y el aislamiento de contexto
provier.register({
  propagator: new SentryPropagator(),
  contextManager: new SentryContextManager(),
});

// Opcionalmente, si deseas usar `tracesSamplingRate` u opciones relacionadas con el muestreo de Sentry,
// también necesitas usar un muestreador personalizado al configurar tu proveedor
const provider = new BasicTracerProvider({
  sampler: new SentrySampler(Sentry.getClient()),
});
```
