---
title: Instrumentar agentes de IA
sidebar_order: 500
description: "Aprende a instrumentar manualmente tu código para usar el módulo Agents de Sentry."
supported:
  - javascript.node
  - javascript.aws-lambda
  - javascript.azure-functions
  - javascript.connect
  - javascript.express
  - javascript.fastify
  - javascript.gcp-functions
  - javascript.hapi
  - javascript.hono
  - javascript.koa
  - javascript.nestjs
  - javascript.bun
  - javascript.deno
  - javascript.nextjs
  - javascript.nuxt
  - javascript.astro
  - javascript.solidstart
  - javascript.sveltekit
  - javascript.remix
  - javascript.cloudflare
  - javascript.tanstackstart-react
---

Con <Link to="/product/insights/ai/agents/dashboard/">Sentry AI Agent Monitoring</Link>, puedes monitorizar y depurar tus sistemas de IA con contexto full‑stack. Podrás seguir información clave como el uso de tokens, la latencia, el uso de herramientas y las tasas de error. Los datos de AI Agent Monitoring estarán completamente conectados con tus otros datos de Sentry, como registros, errores y trazas.

Como requisito previo para configurar AI Agent Monitoring con JavaScript, primero necesitas <PlatformLink to="/tracing/">configurar el tracing</PlatformLink>. Una vez hecho esto, el SDK de JavaScript instrumentará automáticamente los agentes de IA creados con las bibliotecas compatibles. Si eso no se ajusta a tu caso de uso, puedes usar la instrumentación personalizada descrita a continuación.

<div id="automatic-instrumentation">
  ## Instrumentación automática
</div>

El SDK de JavaScript ofrece instrumentación automática para algunas bibliotecas de IA. Te recomendamos añadir sus integraciones a tu configuración de Sentry para capturar automáticamente spans de agentes de IA.

<PlatformLink to="/configuration/integrations/vercelai/">
  - Vercel AI SDK
</PlatformLink>

<PlatformLink
  to="/configuration/integrations/openai/"
  notSupported={["javascript.deno"]}
>
  - OpenAI
</PlatformLink>

<PlatformLink
  to="/configuration/integrations/anthropic/"
  notSupported={["javascript.deno"]}
>
  - Anthropic
</PlatformLink>

<PlatformLink
  to="/configuration/integrations/google-genai/"
  notSupported={["javascript.deno"]}
>
  - Google Gen AI SDK
</PlatformLink>

<PlatformLink
  to="/configuration/integrations/langchain/"
  notSupported={["javascript.deno"]}
>
  - LangChain
</PlatformLink>

<div id="manual-instrumentation">
  ## Instrumentación manual
</div>

Si usas una biblioteca que Sentry no instrumenta automáticamente, puedes instrumentar tu código manualmente para capturar spans. Para que los datos de tus agentes de IA aparezcan en Sentry [AI Agents Insights](https://sentry.io/orgredirect/organizations/:orgslug/insights/ai/agents/), deben crearse dos spans con nombres y atributos de datos bien definidos. Consulta lo siguiente.

<div id="spans">
  ## Tramos
</div>

<div id="invoke-agent-span">
  ### Span de invocación del agente
</div>

<Expandable title="Atributos del span de invocación del agente">
  <Include name="tracing/ai-agents-module/invoke-agent-span" />
</Expandable>

<div id="example-of-an-invoke-agent-span">
  #### Ejemplo de un tramo de Invoke Agent:
</div>

```javascript
// implementación de agente de ejemplo para demostración
const myAgent = {
  name: "Agente del tiempo",
  modelProvider: "openai",
  model: "o3-mini",
  async run() {
    // Implementación del agente
    return {
      output: "En París hace sol",
      usage: {
        inputTokens: 15,
        outputTokens: 8,
      },
    };
  },
};

Sentry.startSpan(
  {
    op: "gen_ai.invoke_agent",
    name: `invoke_agent ${myAgent.name}`,
    attributes: {
      "gen_ai.operation.name": "invoke_agent",
      "gen_ai.system": myAgent.modelProvider,
      "gen_ai.request.model": myAgent.model,
      "gen_ai.agent.name": myAgent.name,
    },
  },
  async (span) => {
    // ejecutar el agente
    const result = await myAgent.run();

    // establecer la respuesta del agente
    // suponemos que result.output es una cadena
    // el tipo de `gen_ai.response.text` debe ser una cadena
    span.setAttribute("gen_ai.response.text", JSON.stringify([result.output]));

    // establecer el uso de tokens
    // suponemos que el resultado incluye los tokens utilizados
    span.setAttribute("gen_ai.usage.input_tokens", result.usage.inputTokens);
    span.setAttribute("gen_ai.usage.output_tokens", result.usage.outputTokens);

    return result;
  }
);
```


<div id="ai-client-span">
  ### Span del cliente de IA
</div>

<Expandable title="Atributos del span del cliente de IA">
  <Include name="tracing/ai-agents-module/ai-client-span" />
</Expandable>

<div id="example-ai-client-span">
  #### Ejemplo de tramo del cliente de IA
</div>

```javascript
// implementación de ejemplo para mostrar su funcionamiento
const myAi = {
  modelProvider: "openai",
  model: "o3-mini",
  modelConfig: {
    temperature: 0.1,
    presencePenalty: 0.5,
  },
  async createMessage(messages, maxTokens) {
    // implementación de IA
    return {
      output:
        "Aquí tienes un chiste: ¿Por qué los científicos no confían en los átomos? ¡Porque lo componen todo!",
      usage: {
        inputTokens: 12,
        outputTokens: 24,
      },
    };
  },
};

Sentry.startSpan(
  {
    op: "gen_ai.chat",
    name: `chat ${myAi.model}`,
    attributes: {
      "gen_ai.operation.name": "chat",
      "gen_ai.system": myAi.modelProvider,
      "gen_ai.request.model": myAi.model,
    },
  },
  async (span) => {
    // preparar los mensajes para el LLM
    const maxTokens = 1024;
    const prompt = "Cuéntame un chiste";
    const messages = [{ role: "user", content: prompt }];

    // configurar los datos de la solicitud de chat
    span.setAttribute("gen_ai.request.messages", JSON.stringify(messages));
    span.setAttribute("gen_ai.request.max_tokens", maxTokens);
    span.setAttribute(
      "gen_ai.request.temperature",
      myAi.modelConfig.temperature
    );
    span.setAttribute(
      "gen_ai.request.presence_penalty",
      myAi.modelConfig.presencePenalty
    );

    // consultar al LLM
    const result = await myAi.createMessage(messages, maxTokens);

    // establecer la respuesta
    // suponemos que result.output es una cadena
    // el tipo de `gen_ai.response.text` debe ser una cadena
    span.setAttribute("gen_ai.response.text", JSON.stringify([result.output]));

    // establecer el uso de tokens
    // suponemos que el resultado incluye los tokens usados
    span.setAttribute("gen_ai.usage.input_tokens", result.usage.inputTokens);
    span.setAttribute("gen_ai.usage.output_tokens", result.usage.outputTokens);

    return result;
  }
);
```


<div id="execute-tool-span">
  ### Span de ejecución de herramienta
</div>

<Expandable title="Atributos del span de ejecución de herramienta">
  <Include name="tracing/ai-agents-module/execute-tool-span" />
</Expandable>

<div id="example-execute-tool-span">
  #### Ejemplo de tramo de la herramienta Execute
</div>

```javascript
// implementación de ejemplo para demostración
const myAi = {
  modelProvider: "openai",
  model: "o3-mini",
  async createMessage(messages, maxTokens) {
    // Implementación de IA que devuelve llamadas a herramientas
    return {
      toolCalls: [
        {
          name: "random_number",
          description: "Generar un número aleatorio"
          arguments: { max: 10 },
        },
      ],
    };
  },
};

const prompt = "Genera un número aleatorio entre 0 y 10";
const messages = [{ role: "user", content: prompt }];

// Primero, realiza la llamada a la IA
const result = await Sentry.startSpan(
  { op: "gen_ai.chat", name: `chat ${myAi.model}` },
  () => myAi.createMessage(messages, 1024)
);

// Comprueba si debemos llamar a una herramienta
if (result.toolCalls && result.toolCalls.length > 0) {
  const tool = result.toolCalls[0];

  await Sentry.startSpan(
    {
      op: "gen_ai.execute_tool",
      name: `execute_tool ${tool.name}`,
      attributes: {
        "gen_ai.system": myAi.modelProvider,
        "gen_ai.request.model": myAi.model,
        "gen_ai.tool.type": "function",
        "gen_ai.tool.name": tool.name,
        "gen_ai.tool.description": tool.description,
        "gen_ai.tool.input": JSON.stringify(tool.arguments),
      },
    },
    async (span) => {
      // ejecutar la herramienta (implementación de ejemplo)
      const toolResult = Math.floor(Math.random() * tool.arguments.max);

      // establecer el resultado de la herramienta
      span.setAttribute("gen_ai.tool.output", String(toolResult));

      return toolResult;
    }
  );
}
```


<div id="handoff-span">
  ### Span de traspaso
</div>

<Expandable title="Atributos del span de traspaso">
  <Include name="tracing/ai-agents-module/handoff-span" />
</Expandable>

<div id="example-of-a-handoff-span">
  #### Ejemplo de un intervalo de traspaso
</div>

```javascript
// implementación de agente de ejemplo para demostración
const myAgent = {
  name: "Weather Agent",
  modelProvider: "openai",
  model: "o3-mini",
  async run() {
    // Implementación del agente
    return {
      handoffTo: "Travel Agent",
      output:
        "Necesito derivar al agente de viajes para obtener recomendaciones de reservas",
    };
  },
};

const otherAgent = {
  name: "Travel Agent",
  modelProvider: "openai",
  model: "o3-mini",
  async run() {
    // Implementación de otro agente
    return { output: "Aquí tienes algunas recomendaciones de viaje..." };
  },
};

// Primera ejecución del agente
const result = await Sentry.startSpan(
  { op: "gen_ai.invoke_agent", name: `invoke_agent ${myAgent.name}` },
  () => myAgent.run()
);

// Comprobar si debemos derivar a otro agente
if (result.handoffTo) {
  // Crear el span de derivación
  await Sentry.startSpan(
    {
      op: "gen_ai.handoff",
      name: `handoff from ${myAgent.name} to ${otherAgent.name}`,
      attributes: {
        "gen_ai.system": myAgent.modelProvider,
        "gen_ai.request.model": myAgent.model,
      },
    },
    () => {
      // el span de derivación solo marca la derivación
      // aquí no se realiza ningún trabajo real
    }
  );

  // Ejecutar el otro agente
  await Sentry.startSpan(
    { op: "gen_ai.invoke_agent", name: `invoke_agent ${otherAgent.name}` },
    () => otherAgent.run()
  );
}
```

<Expandable title="Atributos comunes de los spans">
  <Include name="tracing/ai-agents-module/common-span-attributes" />
</Expandable>
