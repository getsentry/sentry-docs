---
title: Instrumentar cachés
sidebar_order: 1000
description: "Aprende a instrumentar manualmente tu código para usar el módulo Cache de Sentry."
supported:
  - javascript.node
  - javascript.aws-lambda
  - javascript.azure-functions
  - javascript.connect
  - javascript.express
  - javascript.fastify
  - javascript.gcp-functions
  - javascript.hapi
  - javascript.hono
  - javascript.koa
  - javascript.nestjs
  - javascript.bun
  - javascript.deno
  - javascript.nextjs
  - javascript.nuxt
  - javascript.astro
  - javascript.solidstart
  - javascript.sveltekit
  - javascript.remix
  - javascript.cloudflare
  - javascript.tanstackstart-react
---

Una caché puede usarse para acelerar la recuperación de datos y así mejorar el rendimiento de la aplicación. En lugar de obtener datos de una capa potencialmente lenta, tu aplicación los obtendrá de la memoria (en el mejor de los casos). El almacenamiento en caché puede acelerar cargas de trabajo intensivas en lectura para aplicaciones como portales de preguntas y respuestas, videojuegos, intercambio de contenido y redes sociales.

Sentry ofrece un [panel de monitoreo de cachés](https://sentry.io/orgredirect/organizations/:orgslug/insights/backend/caches/) que puede instrumentarse automáticamente usando la integración de Redis de Sentry (pronto habrá más).

<div id="instrumentation-with-redis-clients">
  ## Instrumentación con clientes de Redis
</div>

Si usas un cliente de Redis como `ioredis` o `redis` para almacenar en caché tus datos, debes especificar `cachePrefixes` dentro de las opciones de `redisIntegration`. Esta configuración permite que Sentry clasifique los accesos a claves con los prefijos definidos como “operaciones de caché”.

```javascript
Sentry.init({
  integrations: [
    redisIntegration({
      cachePrefixes: ["publicaciones:", "autores:"],
    }),
  ],
});
```


<div id="manual-instrumentation">
  ## Instrumentación manual
</div>

Si usas algo distinto a la integración de Redis de Sentry, tendrás que instrumentar manualmente el [módulo de caché](https://sentry.io/orgredirect/organizations/:orgslug/insights/backend/caches/) siguiendo los pasos a continuación.

Deberás crear dos spans: uno que indique que algo se está guardando en la caché y otro que indique que algo se está recuperando de la caché.

<PlatformSection supported={["javascript.node", "javascript.deno", "javascript.bun"]}>

Asegúrate de que haya un span activo antes de crear tus spans de caché. Si usas un framework web como Express, se creará un span automáticamente. Consulta <PlatformLink to="/tracing/">Tracing</PlatformLink> para más información.

</PlatformSection>

Para obtener información detallada sobre qué datos se pueden establecer, consulta la [Especificación del módulo de caché para desarrolladores](https://develop.sentry.dev/sdk/performance/modules/caches/).

<div id="step-1-add-span-when-putting-data-into-the-cache">
  ### Paso 1: Añade un span al guardar datos en la caché
</div>

Sigue estas instrucciones de instrumentación personalizada para emitir spans de configuración de caché:

1. Establece el valor en la caché con la biblioteca de caché que estés utilizando.
2. Rodea la parte de tu aplicación que usa el valor en caché con `Sentry.startSpan(...)`.
3. Define `name` con algo descriptivo, como &quot;Setting auth cache&quot;.
4. Define `op` como `cache.set`.
5. Define `cache.key` como un arreglo de cadenas que represente la(s) clave(s) que estás configurando.
6. Opcionalmente, puedes definir otros atributos como `cache.item_size`. (Consulta [Convenciones de datos de span del módulo de caché](https://develop.sentry.dev/sdk/performance/modules/caches/#span-data) para más información).

(Los pasos descritos arriba también están documentados en el fragmento).

```javascript {filename: my-cache.js}
const key = "myCacheKey123";
const value = "The value I want to cache.";

Sentry.startSpan(
  {
    name: key,
    attributes: {
      "cache.key": [key],
      "cache.item_size": JSON.stringify(value).length, // Advertencia: si el valor es muy grande, esto podría consumir mucha memoria
      "network.peer.address": "cache.example.com/supercache",
      "network.peer.port": 9000,
    },
    op: "cache.put",
  },
  (span) => {
    // Establece una clave en tu caché usando tu solución de almacenamiento en caché personalizada
    my_caching.set(key, value);
  }
);
```


<div id="step-2-add-span-when-retrieving-data-from-the-cache">
  ### Paso 2: Agrega un span al recuperar datos de la caché
</div>

Si la caché que estás usando no es compatible con la autoinstrumentación mencionada arriba, puedes usar las instrucciones de instrumentación personalizada a continuación para emitir spans de caché en su lugar:

1. Obtén el valor almacenado en caché de la biblioteca de caché que estés utilizando.
2. Envuelve la parte de tu aplicación que obtiene datos de la caché con `Sentry.startSpan(...)`.
3. Establece `name` en algo descriptivo, como &quot;Obteniendo caché de auth&quot;.
4. Establece `op` en `cache.get`.
5. Establece `cache.key` en un arreglo de cadenas que represente la(s) clave(s) que estás estableciendo.
6. Establece `cache.hit` en un valor booleano que indique si el valor se recuperó correctamente de la caché o no.
7. Opcionalmente, puedes establecer otros atributos como `cache.item_size`. (Consulta [Cache Module Span Data Conventions](https://develop.sentry.dev/sdk/performance/modules/caches/#span-data) para obtener más información.)
   (Los pasos descritos arriba también están documentados en el fragmento).

```javascript {filename: my-cache.js}
const key = "myCacheKey123";

Sentry.startSpan(
  {
    name: key,
    attributes: {
      "cache.key": [key],
      "network.peer.address": "cache.example.com/supercache",
      "network.peer.port": 9000,
    },
    op: "cache.get",
  },
  (span) => {
    // Establece una clave en tu caché usando tu solución de almacenamiento en caché personalizada
    const value = my_caching.get(key);
    const cacheHit = Boolean(value);
    if (cacheHit) {
      span.setAttribute("cache.item_size", JSON.stringify(value).length, // Advertencia: si el valor es muy grande, esto podría consumir mucha memoria);
    }
    span.setAttribute("cache.hit", cacheHit);
  }
);
```

Ahora deberías tener los spans correctos en su lugar. Ve al [panel de caché](https://sentry.io/orgredirect/organizations/:orgslug/insights/backend/caches/) para ver cómo está rindiendo tu caché.
