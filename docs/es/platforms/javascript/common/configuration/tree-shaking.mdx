---
title: Tree Shaking
sidebar_order: 70
description: "Aprende a reducir el tamaño del bundle de Sentry mediante tree shaking del código no utilizado."
notSupported:
  - javascript.aws-lambda
  - javascript.gcp-functions

keywords: ["bundle size", "webpack", "rollup", "debug"]
---

El SDK de Sentry admite [tree shaking](https://developer.mozilla.org/en-US/docs/Glossary/Tree_shaking) de varias maneras.
Para aprovechar al máximo las capacidades de tree shaking de los bundlers modernos como webpack o Rollup, es necesario aplicar algunas configuraciones adicionales.
Si quieres minimizar el tamaño del bundle del SDK de Sentry, te recomendamos leer esta página y aplicar las configuraciones de tree shaking tal como se muestran.

<div id="tree-shaking-optional-code">
  ## Eliminación de código opcional mediante tree shaking
</div>

El SDK de Sentry se distribuye con código que no es estrictamente necesario para recopilar tus errores. Esto incluye, por ejemplo, código para depurar tu configuración de Sentry o para habilitar el tracing. Aunque el código de depuración puede ser muy útil en entornos de desarrollo, normalmente no hace falta incluirlo en tus bundles de producción, donde ocupa espacio valioso. El SDK de JavaScript incluye indicadores especiales en sus distribuciones CommonJS y ESM que pueden usarse para facilitar el tree shaking (eliminación) de este tipo de código durante el proceso de compilación.

<Alert>
  Todo lo que no importes y uses se eliminará <i>automáticamente</i>
  mediante tree shaking al usar cualquier bundler moderno como Webpack, Rollup,
  Vite o similares. Esto significa que integraciones opcionales como Replay,
  BrowserTracing, BrowserProfiling y cualquier método utilitario no utilizado no se
  incluirán en tu bundle a menos que los importes y los uses. El resto
  de esta página trata sobre formas de aplicar tree shaking al código interno
  del SDK, lo cual no es estrictamente necesario a menos que uses ciertas
  funcionalidades.
</Alert>

<PlatformSection notSupported={["javascript.nextjs", "javascript.nuxt", "javascript.solidstart", "javascript.sveltekit", "javascript.remix", "javascript.astro", "javascript.tanstackstart-react"]}>

<div id="tree-shaking-with-sentry-bundler-plugins">
  ### Tree Shaking con los plugins del bundler de Sentry
</div>

_Esta configuración está disponible a partir de la versión v2.9.0 de los plugins del bundler._

Si usas uno de nuestros plugins del bundler, puedes usar la opción de configuración `bundleSizeOptimizations` para aplicar tree shaking al código opcional:

<PlatformCategorySection supported={['browser']}>
```javascript
// Por ejemplo, @sentry/webpack-plugin pasado a la configuración de webpack
sentryPlugin({
  // otra configuración
  bundleSizeOptimizations: {
    excludeDebugStatements: true,
    // Solo relevante si añadiste `browserTracingIntegration`
    excludePerformanceMonitoring: true,
    // Solo relevante si añadiste `replayIntegration`
    excludeReplayIframe: true,
    excludeReplayShadowDom: true,
    excludeReplayWorker: true,
  },
});
```
</PlatformCategorySection>

<PlatformCategorySection supported={['server']}>
```javascript
// Por ejemplo, @sentry/webpack-plugin pasado a la configuración de webpack
sentryPlugin({
  // otra configuración
  bundleSizeOptimizations: {
    excludeDebugStatements: true,
    excludePerformanceMonitoring: true,
  },
});
```
</PlatformCategorySection>

Para más detalles, consulta la documentación del plugin del bundler específico que estés usando:

- [Sentry Webpack Plugin](https://www.npmjs.com/package/@sentry/webpack-plugin)
- [Sentry Vite Plugin](https://www.npmjs.com/package/@sentry/vite-plugin)
- [Sentry Esbuild Plugin](https://www.npmjs.com/package/@sentry/esbuild-plugin)
- [Sentry Rollup Plugin](https://www.npmjs.com/package/@sentry/rollup-plugin)

</PlatformSection>

<PlatformSection supported={["javascript.nextjs"]}>

<div id="tree-shaking-with-nextjs">
  ### Tree Shaking con Next.js
</div>

Para aplicar tree shaking al código de depuración de Sentry en proyectos Next.js, usa el [DefinePlugin](https://webpack.js.org/plugins/define-plugin/) de webpack en tu configuración de Next.js, como en el siguiente ejemplo:

```javascript {filename:next.config.(js|mjs)}
const nextConfig = {
  webpack: (config, { webpack }) => {
    config.plugins.push(
      new webpack.DefinePlugin({
        __SENTRY_DEBUG__: false,
        __SENTRY_TRACING__: false,
        __RRWEB_EXCLUDE_IFRAME__: true,
        __RRWEB_EXCLUDE_SHADOW_DOM__: true,
        __SENTRY_EXCLUDE_REPLAY_WORKER__: true,
      })
    );

    // devuelve la configuración modificada
    return config;
  },
};
```

Para más información sobre configuraciones personalizadas de webpack en Next.js, consulta [Custom Webpack Config](https://nextjs.org/docs/api-reference/next.config.js/custom-webpack-config) en la documentación de Next.js.

</PlatformSection>

<div id="manual-tree-shaking">
  ### Tree Shaking manual
</div>

Si quieres eliminar código opcional mediante tree shaking, quita ese código del resultado de tu compilación reemplazando varias flags en el SDK de Sentry. Ten en cuenta que, si ya configuraste el tree shaking con los Sentry Bundler Plugins, no necesitas hacerlo manualmente: los plugins se encargarán por ti.

**Están disponibles las siguientes flags:**

`__SENTRY_DEBUG__`

Reemplazar esta flag por `false` eliminará mediante tree shaking cualquier código del SDK relacionado con el registro de depuración.

`__SENTRY_TRACING__`

Reemplazar esta flag por `false` eliminará mediante tree shaking cualquier código del SDK relacionado con el tracing.

<Alert>
  No se debe reemplazar `__SENTRY_TRACING__` por `false` cuando estés usando
  cualquier funcionalidad del SDK relacionada con tracing (por ejemplo, `Sentry.startSpan()`). Esta
  flag está pensada para usarse junto con paquetes como `@sentry/next`
  o `@sentry/sveltekit`, que incluyen automáticamente la funcionalidad de tracing.
</Alert>

<PlatformCategorySection supported={["browser"]}>
  Esto no tiene efecto si no agregaste `browserTracingIntegration`.
</PlatformCategorySection>

<PlatformCategorySection supported={['browser']}>
<PlatformSection notSupported={["javascript.wasm", "javascript.cordova", "javascript.bun", "javascript.deno"]}>

`__RRWEB_EXCLUDE_IFRAME__`

Reemplazar esta flag por `true` eliminará mediante tree shaking cualquier código del SDK relacionado con la captura de contenido de iframes con Session Replay. Solo es relevante cuando usas <PlatformLink to="/session-replay">Session Replay</PlatformLink>. Activa esta flag si no quieres grabar ningún iframe. Esto no tiene efecto si no agregaste `replayIntegration`.

`__RRWEB_EXCLUDE_SHADOW_DOM__`

Reemplazar esta flag por `true` eliminará mediante tree shaking cualquier código del SDK relacionado con la captura de elementos del Shadow DOM con Session Replay. Solo es relevante cuando usas <PlatformLink to="/session-replay">Session Replay</PlatformLink>. Activa esta flag si no quieres grabar ningún elemento del Shadow DOM. Esto no tiene efecto si no agregaste `replayIntegration`.

`__SENTRY_EXCLUDE_REPLAY_WORKER__`

Reemplazar esta flag por `true` eliminará mediante tree shaking cualquier código del SDK relacionado con el web worker de compresión incluido para Session Replay. Solo es relevante cuando usas <PlatformLink to="/session-replay">Session Replay</PlatformLink>. Activa esta flag si quieres alojar tú mismo un worker de compresión. Consulta <PlatformLink to="/session-replay/configuration/#using-a-custom-compression-worker">Using a Custom Compression Worker</PlatformLink> para más detalles. **No recomendamos activar esta flag a menos que proporciones una URL de worker personalizada.** Esto no tiene efecto si no agregaste `replayIntegration`.

</PlatformSection>
</PlatformCategorySection>

<PlatformSection notSupported={["javascript.nextjs", "javascript.nuxt", "javascript.solidstart", "javascript.sveltekit", "javascript.remix", "javascript.astro", "javascript.tanstackstart-react"]}>

<div id="tree-shaking-with-webpack">
  ### Tree Shaking con Webpack
</div>

Para eliminar el código de depuración de Sentry en tus bundles de webpack mediante tree shaking, recomendamos usar el [DefinePlugin](https://webpack.js.org/plugins/define-plugin/) de webpack:

<PlatformCategorySection supported={['browser']}>
```javascript {filename:webpack.config.js}
const webpack = require("webpack");

module.exports = {
// ... other options
plugins: [
new webpack.DefinePlugin({
__SENTRY_DEBUG__: false,
__SENTRY_TRACING__: false,
__RRWEB_EXCLUDE_IFRAME__: true,
__RRWEB_EXCLUDE_SHADOW_DOM__: true,
__SENTRY_EXCLUDE_REPLAY_WORKER__: true,
}),
// ... other plugins
],
};

````
</PlatformCategorySection>

<PlatformCategorySection supported={['server']}>
```javascript {filename:webpack.config.js}
const webpack = require("webpack");

module.exports = {
  // ... other options
  plugins: [
    new webpack.DefinePlugin({
      __SENTRY_DEBUG__: false,
      __SENTRY_TRACING__: false,
    }),
    // ... other plugins
  ],
};
````

</PlatformCategorySection>

</PlatformSection>

<PlatformSection notSupported={["javascript.nextjs", "javascript.nuxt", "javascript.solidstart", "javascript.sveltekit", "javascript.remix", "javascript.astro", "javascript.tanstackstart-react"]}>

<div id="tree-shaking-with-rollup">
  ### Tree Shaking con Rollup
</div>

Si usas `rollup.js`, te recomendamos el [plugin `replace` de Rollup](https://github.com/rollup/plugins/tree/master/packages/replace):

<PlatformCategorySection supported={['browser']}>
```javascript {filename:rollup.config.js}
import replace from "@rollup/plugin-replace";
import { terser } from "rollup-plugin-terser";

export default {
  // ... otras opciones
  treeshake: "smallest", // recomendado para obtener el mejor tree shaking
  plugins: [
    replace({
      __SENTRY_DEBUG__: false,
      __SENTRY_TRACING__: false,
      __RRWEB_EXCLUDE_IFRAME__: true,
      __RRWEB_EXCLUDE_SHADOW_DOM__: true,
      __SENTRY_EXCLUDE_REPLAY_WORKER__: true,
    }),
    // ... otros plugins (mejor colocar después)
  ],
};
```
</PlatformCategorySection>

<PlatformCategorySection supported={['server']}>
```javascript {filename:rollup.config.js}
import replace from "@rollup/plugin-replace";
import { terser } from "rollup-plugin-terser";

export default {
  // ... otras opciones
  treeshake: "smallest", // recomendado para obtener el mejor tree shaking
  plugins: [
    replace({
      __SENTRY_DEBUG__: false,
      __SENTRY_TRACING__: false,
    }),
    // ... otros plugins (mejor colocar después)
  ],
};
```
</PlatformCategorySection>

</PlatformSection>

<PlatformCategorySection supported={['browser']}>
<div id="tree-shaking-default-integrations">
  ## Tree Shaking de integraciones predeterminadas
</div>

De forma predeterminada, el SDK de Sentry configura una lista de [integraciones predeterminadas](../integrations) que amplían la funcionalidad de tu SDK. También puedes añadir integraciones [adicionales](../integrations) o [personalizadas](../integrations/custom) a la configuración de tu SDK.
Si no quieres incluir las integraciones predeterminadas en tu configuración, puedes [deshabilitarlas](../options/#integration-configuration) y añadir tu propio arreglo de integraciones.
Sin embargo, si también quieres aplicar tree shaking a las integraciones predeterminadas no utilizadas, puedes hacerlo creando tú mismo un `Client`. Al hacerlo, básicamente omites `Sentry.init`, que normalmente crea un `Client` por ti.

El siguiente ejemplo muestra cómo crear y vincular un `Client` que habilita el tree shaking de las integraciones predeterminadas no utilizadas:

```javascript {filename:main.js}
import {
  BrowserClient,
  breadcrumbsIntegration,
  dedupeIntegration,
  defaultStackParser,
  getCurrentScope,
  globalHandlersIntegration,
  makeFetchTransport,
  linkedErrorsIntegration,
} from "@sentry/browser";

const client = new BrowserClient({
  // todas las opciones que normalmente pasas a Sentry.init
  dsn: "your DSN",
  // ...
  transport: makeFetchTransport,
  stackParser: defaultStackParser,
  // Solo se usarán las integraciones listadas aquí
  integrations: [
    breadcrumbsIntegration(),
    globalHandlersIntegration(),
    linkedErrorsIntegration(),
    dedupeIntegration(),
  ],
});

getCurrentScope().setClient(client);
client.init();
```

<Alert>

A diferencia de `Sentry.init`, el constructor de `Client` espera opciones del tipo `ClientOptions` en lugar de `Options`. Esto significa que la propiedad `ClientOptions.integrations` es el arreglo definitivo de todas las integraciones que se utilizarán.

</Alert>
</PlatformCategorySection>

<PlatformSection supported={[
  'javascript.node',
  'javascript.azure-functions',
  'javascript.connect',
  'javascript.express',
  'javascript.fastify',
  'javascript.hapi',
  'javascript.hono',
  'javascript.koa',
  'javascript.nestjs'
]}>

## Tree shaking de integraciones predeterminadas

De forma predeterminada, el SDK de Sentry configura una lista de [integraciones predeterminadas](../integrations) que amplían la funcionalidad de tu SDK. También puedes agregar [integraciones adicionales](../integrations) o [personalizadas](../integrations/custom) a la configuración de tu SDK.
Si no quieres incluir las integraciones predeterminadas en tu configuración, puedes usar `Sentry.initWithoutDefaultIntegrations()` y pasar manualmente las integraciones que quieras:

```javascript
const Sentry = require("@sentry/node");

// ¡Esto no agregará _ninguna_ integración de forma predeterminada!
Sentry.initWithoutDefaultIntegrations({
  dsn: "___PUBLIC_DSN___",
  integrations: [
    Sentry.httpIntegration(),
    Sentry.consoleIntegration(),
    Sentry.dedupeIntegration(),
    Sentry.inboundFiltersIntegration(),
  ],
});
```

<div id="setting-up-sentry-without-performance-integrations">
  ## Configurar Sentry sin integraciones de rendimiento
</div>

Si quieres usar Sentry solo para el monitoreo de errores y no te interesan las funciones de monitoreo de rendimiento, puedes usar el siguiente método de inicialización para asegurarte de que cualquier integración específica de rendimiento no se incluya en tu bundle y pueda ser eliminada mediante tree shaking por un bundler:

```javascript
const Sentry = require("@sentry/node");

// ¡Esto no agregará _ninguna_ integración de forma predeterminada!
Sentry.initWithoutDefaultIntegrations({
  dsn: "___PUBLIC_DSN___",
  integrations: [
    // Agrega todas las integraciones predeterminadas
    // excepto las que solo son relevantes para rendimiento
    ...Sentry.getDefaultIntegrationsWithoutPerformance(),
  ],
});
```

</PlatformSection>