---
title: Wrangler
description: "Carga los mapas de origen de Cloudflare Workers con Wrangler y Sentry CLI."
sidebar_order: 10
supported:
  - javascript.cloudflare
---

<Include name="debug-id-requirement.mdx" />

<Alert level="info">
  Esta guía es específicamente para Cloudflare Workers que usan Wrangler. Para otras herramientas de compilación, como Vite con Cloudflare, usa la guía correspondiente de Vite.

  Recomendamos usar Vite para compilar tu worker y así lograr una configuración más sencilla y confiable. Obtén más información sobre la [configuración de Vite para Cloudflare](https://developers.cloudflare.com/workers/vite-plugin/get-started/).
</Alert>

<div id="automatic-setup">
  ## Configuración automática
</div>

La manera más sencilla de configurar la subida de source maps con Wrangler es usando el Sentry Wizard:

<Include name="sourcemaps-wizard-instructions.mdx" />

Si prefieres configurar los source maps manualmente, sigue los pasos a continuación.

<div id="manual-setup">
  ## Configuración manual
</div>

<div id="1-install-sentry-cli">
  ### 1. Instala Sentry CLI
</div>

Primero, instala Sentry CLI como dependencia de desarrollo:

```bash {tabTitle:npm}
npm install --save-dev @sentry/cli
```

```bash {tabTitle:yarn}
yarn add --dev @sentry/cli
```

```bash {tabTitle:pnpm}
pnpm add --save-dev @sentry/cli
```

<div id="2-configure-sentry-cli">
  ### 2. Configurar Sentry CLI
</div>

Para obtener más información sobre la configuración de `sentry-cli`, visita la [documentación de configuración de Sentry CLI](/es/cli/configuration/).

Asegúrate de que `sentry-cli` esté configurado para tu proyecto. Para ello, puedes usar variables de entorno:

```bash {filename:.env.local}
SENTRY_ORG=example-org
SENTRY_PROJECT=example-project
SENTRY_AUTH_TOKEN=sntrys_TU_TOKEN_AQUI
```

<div id="3-modify-your-deploy-script">
  ### 3. Modifica tu script de despliegue
</div>

Actualiza el script de despliegue de Wrangler en `package.json` para incluir las opciones necesarias para generar y subir el mapa de código fuente:

```json {filename:package.json}
{
  "scripts": {
    "deploy": "wrangler deploy --outdir dist --upload-source-maps --var SENTRY_RELEASE:$(sentry-cli releases propose-version)"
  }
}
```

Las banderas clave son:

* `--outdir dist`: Especifica el directorio de salida donde se generarán los mapas de origen (source maps)
* `--upload-source-maps`: Obliga a Wrangler a generar mapas de origen
* `--var SENTRY_RELEASE:$(sentry-cli releases propose-version)`: Inyecta la versión de la publicación (release) como una variable de entorno

<div id="4-create-a-source-map-upload-script">
  ### 4. Crea un script para subir los mapas de código
</div>

Agrega un script para subir los source maps a Sentry en tu `package.json`:

```json {filename:package.json}
{
  "scripts": {
    "sentry:sourcemaps": "_SENTRY_RELEASE=$(sentry-cli releases propose-version) && sentry-cli releases new $_SENTRY_RELEASE --org=tu-org --project=tu-proyecto && sentry-cli sourcemaps upload --org=tu-org --project=tu-proyecto --release=$_SENTRY_RELEASE --strip-prefix 'dist/..' dist"
  }
}
```

Reemplaza `your-org` y `your-project` por los slugs reales de tu organización y proyecto en Sentry.

<div id="5-add-a-post-deploy-hook">
  ### 5. Agrega un hook de post-despliegue
</div>

Crea un script de postdespliegue que cargue automáticamente los mapas de origen después del despliegue:

```json {filename:package.json}
{
  "scripts": {
    "deploy": "wrangler deploy --outdir dist --upload-source-maps --var SENTRY_RELEASE:$(sentry-cli releases propose-version)",
    "postdeploy": "npm run sentry:sourcemaps"
  }
}
```

Esto garantiza que los source maps se carguen en Sentry inmediatamente después de un despliegue correcto.

<div id="6-configure-your-sentry-sdk">
  ### 6. Configura tu SDK de Sentry
</div>

Asegúrate de que la configuración de tu SDK de Sentry incluya la información de la versión:

```typescript {filename:index.ts}
import * as Sentry from "@sentry/cloudflare";

export default Sentry.withSentry(
  (env: Env) => ({
    dsn: "YOUR_DSN_HERE",
    // El nombre de la versión debe coincidir con el utilizado durante la carga del mapa de origen
    release: env.SENTRY_RELEASE,
    // otras opciones...
  }),
  {
    async fetch(request, env, ctx) {
      // Aquí va la lógica de tu worker
      return new Response("¡Hola, mundo!");
    },
  } satisfies ExportedHandler<Env>
);
```

<div id="7-deploy-your-application">
  ### 7. Implementa tu aplicación
</div>

Ejecuta el comando de implementación:

```bash
npm run deploy
```

Esto hará lo siguiente:

1. Compilar tu worker con los mapas de origen habilitados
2. Desplegar en Cloudflare con la versión de la release inyectada
3. Subir automáticamente los mapas de origen a Sentry mediante el hook posterior al despliegue

<div id="8-verify-source-maps-upload">
  ### 8. Verifica la carga de los mapas de origen
</div>

Puedes confirmar que tus mapas de origen se cargaron correctamente haciendo lo siguiente:

1. Ve a **Project Settings &gt; Source Maps** en Sentry
2. Busca tu versión en la pestaña &quot;Artifact Bundles&quot;
3. Confirma que los mapas de origen funcionan provocando un error y verificando que el stack trace muestre tu código fuente original

<div id="troubleshooting">
  ## Resolución de problemas
</div>

<div id="source-maps-not-working">
  ### Los source maps no funcionan
</div>

Si los source maps no funcionan como esperas:

1. Verifica que la variable de entorno `SENTRY_RELEASE` se esté configurando correctamente en tu worker
2. Comprueba que el nombre de la release en la configuración del SDK de Sentry coincida con el utilizado durante la carga
3. Asegúrate de que los source maps se estén generando en el `--outdir` especificado

<div id="build-errors">
  ### Errores de compilación
</div>

Si encuentras errores de compilación al agregar indicadores de source map:

1. Asegúrate de usar Wrangler `3.x` o posterior
2. Verifica que la estructura de tu proyecto sea compatible con el indicador `--outdir`
3. Considera cambiar a Vite para contar con una canalización de compilación más sólida

<div id="additional-resources">
  ## Recursos adicionales
</div>

* [Documentación de Cloudflare Wrangler](https://developers.cloudflare.com/workers/wrangler/)
* [Complemento de Vite para Cloudflare](https://developers.cloudflare.com/workers/vite-plugin/get-started/)
* [Uso de sentry-cli para cargar mapas de código fuente](/es/cli/releases/#sentry-cli-sourcemaps)