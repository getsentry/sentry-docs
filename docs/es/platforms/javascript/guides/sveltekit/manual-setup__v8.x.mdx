---
title: Configuración manual
sidebar_order: 1
description: "Aprende a configurar el SDK manualmente."
noindex: true
---

Si no puedes (o prefieres no) ejecutar la <PlatformLink to="/#install">configuración automática</PlatformLink>, sigue las instrucciones a continuación para configurar el SDK de Sentry SvelteKit en tu aplicación. Esta guía también resulta útil para ajustar la configuración predeterminada si usaste el asistente de instalación para la configuración automática.

<div id="install">
  ## Instalación
</div>

```bash {tabTitle:npm}
npm install @sentry/sveltekit --save
```

```bash {tabTitle:yarn}
yarn add @sentry/sveltekit
```

```bash {tabTitle:pnpm}
pnpm add @sentry/sveltekit
```

Si estás actualizando tu SDK de Sentry a la última versión, consulta nuestra [guía de migración](https://github.com/getsentry/sentry-javascript/blob/master/MIGRATION.md) para obtener más información sobre los cambios que rompen la compatibilidad.


<div id="configure">
  ## Configurar
</div>

El SDK de Sentry debe inicializarse y configurarse en tres lugares: en el cliente, en el servidor y en la configuración de Vite.

<div id="client-side-setup">
  ### Configuración del lado del cliente
</div>

Si aún no tienes un archivo de [hooks del cliente](https://kit.svelte.dev/docs/hooks#shared-hooks), crea uno nuevo en `src/hooks.client.(js|ts)`.

En la parte superior de tu archivo de hooks del cliente, importa e inicializa el SDK de Sentry como se muestra en el siguiente fragmento. Consulta la página de [Opciones básicas](../configuration/options/) para ver otras opciones de configuración del SDK.
Además, agrega la función `handleErrorWithSentry` al [hook `handleError`](https://kit.svelte.dev/docs/hooks#shared-hooks-handleerror):

```javascript {filename:hooks.client.(js|ts)} {1, 3-14, 20}
import * as Sentry from "@sentry/sveltekit";

Sentry.init({
  dsn: "___PUBLIC_DSN___",

  // Recomendamos ajustar este valor en producción o usar tracesSampler
  // para un control más preciso
  tracesSampleRate: 1.0,

  // Opcional: inicializar Session Replay:
  integrations: [Sentry.replayIntegration()],
  replaysSessionSampleRate: 0.1,
  replaysOnErrorSampleRate: 1.0,
});

const myErrorHandler = ({ error, event }) => {
  console.error("Se produjo un error en el cliente:", error, event);
};

export const handleError = Sentry.handleErrorWithSentry(myErrorHandler);

// O, alternativamente, si no tienes un controlador de errores personalizado:
// export const handleError = handleErrorWithSentry();
```


<div id="server-side-setup">
  ### Configuración del lado del servidor
</div>

Si aún no tienes un archivo de [server hooks](https://kit.svelte.dev/docs/hooks#server-hooks), crea uno nuevo en `src/hooks.server.(js|ts)`.

En la parte superior de tu archivo de server hooks, importa e inicializa el SDK de Sentry como se muestra en el fragmento a continuación. Consulta la página de [Opciones básicas](../configuration/options/) para ver otras opciones de configuración del SDK.
Añade la función `handleErrorWithSentry` al hook [`handleError`](https://kit.svelte.dev/docs/hooks#shared-hooks-handleerror) y añade el manejador de solicitudes de Sentry al hook [`handle`](https://kit.svelte.dev/docs/hooks#server-hooks-handle).
Si ya estás usando tus propios manejadores, utiliza la función [`sequence`](https://kit.svelte.dev/docs/modules#sveltejs-kit-hooks-sequence) de SvelteKit para añadir el manejador de Sentry antes de tus manejadores.

```javascript {filename:hooks.server.(js|ts)} {1, 3-9, 15, 19}
import * as Sentry from "@sentry/sveltekit";

Sentry.init({
  dsn: "___PUBLIC_DSN___",

  // Recomendamos ajustar este valor en producción o usar tracesSampler
  // para un control más preciso
  tracesSampleRate: 1.0,
});

const myErrorHandler = ({ error, event }) => {
  console.error("Se produjo un error del lado del servidor:", error, event);
};

export const handleError = Sentry.handleErrorWithSentry(myErrorHandler);
// o, si no tienes un controlador de errores personalizado:
// export const handleError = handleErrorWithSentry();

export const handle = Sentry.sentryHandle();
// O usa `sequence`:
// export const handle = sequence(Sentry.sentryHandle(), yourHandler());
```


<div id="vite-setup">
  ### Configuración de Vite
</div>

Añade los complementos `sentrySvelteKit` a tu archivo `vite.config.(js|ts)` para que el SDK de Sentry pueda aplicar funcionalidades en tiempo de compilación.
Asegúrate de añadirlos *antes* del plugin de SvelteKit:

```javascript {filename:vite.config.(js|ts)} {2,5}
import { sveltekit } from "@sveltejs/kit/vite";
import { sentrySvelteKit } from "@sentry/sveltekit";

export default {
  plugins: [sentrySvelteKit(), sveltekit()],
  // ... el resto de tu configuración de Vite
};
```

La función `sentrySvelteKit()` añade plugins de Vite a tu configuración de Vite para:

* Subir automáticamente los mapas de código fuente a Sentry
* Instrumentar automáticamente las funciones `load` para el rastreo


<div id="source-maps-upload">
  ### Carga de source maps
</div>

De forma predeterminada, `sentrySvelteKit()` añadirá una instancia del [Sentry Vite Plugin](https://www.npmjs.com/package/@sentry/vite-plugin) para subir los source maps de las compilaciones tanto del servidor como del cliente. Esto significa que cuando ejecutes una compilación de producción (`npm run build`), se generarán los source maps y se subirán a Sentry, de modo que obtengas trazas de pila legibles en tus issues de Sentry.

Sin embargo, aún debes especificar tu token de autenticación de Sentry, así como los slugs de tu organización y proyecto. Hay dos maneras de configurarlos.

Puedes configurarlos como variables de entorno, por ejemplo en un archivo `.env`:

* `SENTRY_ORG` el slug de tu organización en Sentry
* `SENTRY_PROJECT` el slug de tu proyecto en Sentry
* `SENTRY_AUTH_TOKEN` tu token de autenticación de Sentry (puede obtenerse en los [Organization Token Settings](https://sentry.io/orgredirect/organizations/:orgslug/settings/auth-tokens/))
* `SENTRY_URL` la URL de tu instancia de Sentry. Solo es necesario si usas tu propia instancia de Sentry (en lugar de `https://sentry.io`).

O bien, puedes configurarlos pasando un objeto `sourceMapsUploadOptions` a `sentrySvelteKit`, como se muestra en el ejemplo a continuación. Todas las opciones disponibles están documentadas en el [repositorio del plugin Sentry Vite](https://www.npmjs.com/package/@sentry/vite-plugin/v/2.14.2#options).

<OrgAuthTokenNote />

```bash {filename:.env}
SENTRY_AUTH_TOKEN=___ORG_AUTH_TOKEN___
```

```javascript {filename:vite.config.(js|ts)} {7-16}
import { sveltekit } from "@sveltejs/kit/vite";
import { sentrySvelteKit } from "@sentry/sveltekit";

export default {
  plugins: [
    sentrySvelteKit({
      sourceMapsUploadOptions: {
        org: "___ORG_SLUG___",
        project: "___PROJECT_SLUG___",
        authToken: process.env.SENTRY_AUTH_TOKEN,
        sourcemaps: {
          assets: ["./build/*/**/*"],
          ignore: ["**/build/client/**/*"],
          filesToDeleteAfterUpload: ["./build/**/*.map"],
        },
      },
    }),
    sveltekit(),
  ],
  // ... el resto de la configuración de Vite
};
```

Usar el objeto `sourceMapsUploadOptions` es útil si la carga de mapas de origen predeterminada no funciona de inmediato; por ejemplo, si tienes una configuración de compilación personalizada o si usas el SDK con un adaptador de SvelteKit distinto de los [adaptadores compatibles](../#compatibility).


<div id="overriding-sveltekit-adapter-detection">
  #### Sobrescribir la detección del adaptador de SvelteKit
</div>

De forma predeterminada, `sentrySvelteKit` intentará detectar tu adaptador de SvelteKit para configurar correctamente la carga de los mapas de código fuente.
Si no estás usando uno de los [adaptadores compatibles](../#compatibility) o se detecta el incorrecto, puedes sobrescribir la detección del adaptador pasando la opción `adapter` a `sentrySvelteKit`:

```javascript {filename:vite.config.(js|ts)} {7}
import { sveltekit } from "@sveltejs/kit/vite";
import { sentrySvelteKit } from "@sentry/sveltekit";

export default {
  plugins: [
    sentrySvelteKit({
      adapter: "vercel",
    }),
    sveltekit(),
  ],
  // ... resto de tu configuración de Vite
};
```


<div id="disable-source-maps-upload">
  #### Desactivar la subida de source maps
</div>

Puedes desactivar la subida automática de source maps en tu configuración de Vite:

```javascript {filename:vite.config.(js|ts)} {7}
import { sveltekit } from "@sveltejs/kit/vite";
import { sentrySvelteKit } from "@sentry/sveltekit";

export default {
  plugins: [
    sentrySvelteKit({
      autoUploadSourceMaps: false,
    }),
    sveltekit(),
  ],
  // ... el resto de tu configuración de Vite
};
```

Si desactivas la subida automática de source maps, debes establecer explícitamente un valor para `release` en tu configuración de `Sentry.init()`. También puedes omitir el paso de configuración de `sentry-cli` que se muestra a continuación.


<div id="optional-configuration">
  ## Configuración opcional
</div>

A continuación se explican opciones de configuración adicionales y personalizaciones más avanzadas para tu SDK de Sentry SvelteKit.

<div id="auto-instrumentation">
  ### Auto-instrumentación
</div>

El SDK utiliza principalmente los [hooks de SvelteKit](https://kit.svelte.dev/docs/hooks) para recopilar datos de errores y rendimiento. Sin embargo, SvelteKit todavía no ofrece un hook para llamadas a la función `load` universales o solo del lado del servidor. Por lo tanto, el SDK usa un plugin de Vite para auto-instrumentar las funciones `load`, de modo que no tengas que añadir manualmente un wrapper de Sentry a cada función.

La auto-instrumentación está habilitada de forma predeterminada cuando agregas la llamada a la función `sentrySvelteKit()` en tu `vite.config.(js|ts)`. No obstante, puedes personalizar el comportamiento o desactivarlo por completo. Si lo desactivas, aún puedes envolver manualmente funciones `load` específicas con la función `withSentry`.

<Alert>

El SDK solo auto-instrumentará funciones `load` en archivos `+page` o `+layout` que no contengan ningún código de Sentry.
Si tienes código de Sentry personalizado en estos archivos, tendrás que añadir [manualmente](#instrument-load-functions-manually) el wrapper de Sentry a tus funciones `load`.

</Alert>

<div id="customize-auto-instrumentation">
  #### Personalizar la auto-instrumentación
</div>

Al pasar la opción `autoInstrument` a `sentrySvelteKit`, puedes desactivar por completo la auto-instrumentación o personalizar qué funciones `load` deben instrumentarse:

```javascript {filename:vite.config.(js|ts)} {7-10}
import { sveltekit } from "@sveltejs/kit/vite";
import { sentrySvelteKit } from "@sentry/sveltekit";

export default {
  plugins: [
    sentrySvelteKit({
      autoInstrument: {
        load: true,
        serverLoad: false,
      },
    }),
    sveltekit(),
  ],
  // ... el resto de tu configuración de Vite
};
```


<div id="disable-auto-instrumentation">
  #### Desactivar la instrumentación automática
</div>

Si configuras la opción `autoInstrument` en `false`, el SDK no instrumentará automáticamente ninguna función `load`. Aún puedes [instrumentar manualmente](#instrument-load-functions-manually) funciones `load` específicas.

```javascript {filename:vite.config.(js|ts)} {7}
import { sveltekit } from '@sveltejs/kit/vite';
import { sentrySvelteKit } from '@sentry/sveltekit';

export default {
  plugins: [
    sentrySvelteKit({
      autoInstrument: false;
    }),
    sveltekit(),
  ],
  // ... el resto de tu configuración de Vite
};
```


<div id="configure-csp-for-client-side-fetch-instrumentation">
  ### Configurar la CSP para la instrumentación de `fetch` en el cliente
</div>

<Alert>
  Disponible desde la versión `7.91.0`
</Alert>

La función `sentryHandle` que agregaste al hook `handle` en `hooks.server.ts` durante la [configuración en el servidor](#server-side-setup) inyecta una etiqueta `<script>` en línea en la respuesta HTML del servidor.
Este script intenta interceptar todas las llamadas `fetch` del lado del cliente, para que las llamadas `fetch` dentro de tus funciones `load` sean capturadas por el SDK.
Sin embargo, si configuraste reglas de CSP para bloquear scripts en línea de forma predeterminada, este script será [bloqueado por el navegador](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Content-Security-Policy/script-src#unsafe_inline_script).

Para habilitar el script, agrega una excepción para `sentryHandle` añadiendo el hash del script a tus reglas de origen de scripts de la CSP.

Si tu CSP está definida en `svelte.config.js`, puedes agregar el hash al arreglo `csp.directives.script-src`:

```javascript {filename:svelte.config.js} {5-7}
const config = {
  kit: {
    csp: {
      directives: {
        "script-src": ["sha256-y2WkUILyE4eycy7x+pC0z99aZjTZlWfVwgUAfNc1sY8="], // + el resto de tus valores
      },
    },
  },
};
```

Para configuraciones de CSP externas, añade el siguiente hash a tu directiva `script-src`:

```txt
'sha256-y2WkUILyE4eycy7x+pC0z99aZjTZlWfVwgUAfNc1sY8='
```

No haremos cambios en este script en el corto plazo, por lo que el hash seguirá siendo el mismo.

<Alert>
  Versiones anteriores de esta documentación recomendaban establecer un nonce en las opciones de `sentryHandle`.
  Ya no recomendamos este enfoque debido a problemas de seguridad al reutilizar nonces.
  En su lugar, recomendamos establecer el hash como se indicó arriba.
  Si actualmente estás definiendo `fetchProxyScriptNonce` en tus opciones de `sentryHandle`, seguirá funcionando como se espera.
</Alert>


<div id="disable-client-side-fetch-proxy-script">
  #### Desactivar el script proxy de `fetch` del lado del cliente
</div>

Si no quieres inyectar el script encargado de instrumentar las llamadas a `fetch` del lado del cliente, puedes desactivar la inyección pasando `injectFetchProxyScript: false` a `sentryHandle`:

```javascript {filename:hooks.server.(js|ts)}
export const handle = sentryHandle({ injectFetchProxyScript: false });
```

Ten en cuenta que si deshabilitas el script proxy de `fetch`, el SDK no podrá capturar spans de las llamadas a `fetch` realizadas por tus funciones `load` en el cliente.
Esto también significa que los spans que pueda crear el servidor para esas llamadas a `fetch` no estarán vinculados al trace del lado del cliente.


<div id="manual-instrumentation">
  ### Instrumentación manual
</div>

En lugar de —o además de— la [instrumentación automática](#auto-instrumentation), puedes instrumentar manualmente determinadas funciones específicas de SvelteKit con el SDK:

<div id="instrument-load-functions">
  #### Instrumentar funciones `load`
</div>

Las funciones `load` universales y de servidor de SvelteKit se instrumentan automáticamente de forma predeterminada.
Si no quieres usar la autoinstrumentación de `load`, puedes [desactivarla](#disable-auto-instrumentation) e instrumentar manualmente funciones `load` específicas con los envoltorios de funciones `load` del SDK.

<div id="universal-load-functions">
  ##### Funciones `load` universales
</div>

Usa la función `wrapLoadWithSentry` para envolver funciones `load` universales declaradas en `+page.(js|ts)` o `+layout.(js|ts)`

```javascript {filename:+(page|layout).(js|ts)} {1,3}
import { wrapLoadWithSentry } from "@sentry/sveltekit";

export const load = wrapLoadWithSentry(async ({ fetch }) => {
  const res = await fetch("/api/data");
  const data = await res.json();
  return { data };
});
```


<div id="server-only-load-functions">
  ##### Funciones `load` solo en el servidor
</div>

O utiliza la función `wrapServerLoadWithSentry` para envolver funciones `load` exclusivas del lado del servidor declaradas en `+page.server.(js|ts)` o `+layout.server.(js|ts)`

```javascript {filename:+(page|layout).server.(js|ts)} {1,3}
import { wrapServerLoadWithSentry } from "@sentry/sveltekit";

export const load = wrapServerLoadWithSentry(async ({ fetch }) => {
  const res = await fetch("/api/data");
  const data = await res.json();
  return { data };
});
```


<div id="instrument-server-routes">
  #### Instrumentar rutas del servidor
</div>

<Alert>
  Disponible desde la `8.25.0`
</Alert>

También puedes instrumentar manualmente [rutas del servidor (API)](https://kit.svelte.dev/docs/routing#server) con el SDK.
Esto es útil si tienes rutas de servidor personalizadas que quieres rastrear o si quieres capturar llamadas a `error()` dentro de tus rutas de servidor:

```javascript {filename:+server.(js|ts)} {1,3}
import { wrapServerRouteWithSentry } from "@sentry/sveltekit";

export const GET = wrapServerRouteWithSentry(async () => {
  // lógica de tu endpoint
  return new Response("Hola, mundo");
});
```
