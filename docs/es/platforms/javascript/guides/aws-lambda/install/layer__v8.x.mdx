---
title: Capa de Lambda - CJS
description: >-
  Aprende a agregar la capa Sentry Node para usar Sentry en tus funciones Lambda
  que se ejecutan en CommonJS (CJS)
sidebar_order: 1
noindex: true
og_image: /og-images/platforms-javascript-guides-aws-lambda-install-layer__v8.x.png
---

La manera más fácil de empezar con Sentry es usar la [capa de Lambda](https://docs.aws.amazon.com/Lambda/latest/dg/configuration-layers.html) de Sentry en lugar de agregar `@sentry/aws-serverless` con `npm` o `yarn` [manualmente](../install/npm).
Si sigues esta guía, no tendrás que preocuparte por desplegar las dependencias de Sentry junto con el código de tu función.
Para iniciar el SDK, puedes elegir entre configurarlo mediante variables de entorno o en el código de tu función Lambda. Recomendamos usar variables de entorno, ya que es la forma más sencilla de empezar. [Inicializar el SDK en el código](#alternative-initialize-the-sdk-in-code), en lugar de establecer variables de entorno, te da más control sobre la configuración del SDK si lo necesitas.

<Alert>
  Este método de instalación **no** funciona con funciones Lambda que se ejecutan en modo EcmaScript Modules (ESM), usando la sintaxis `import`. Si estás ejecutando tu función en ESM, sigue la [guía de ESM](../install/npm).
</Alert>

<div id="1-prerequisites">
  ## 1. Requisitos previos
</div>

Antes de comenzar, asegúrate de contar con lo siguiente:

* Tienes una función Lambda que se ejecuta en modo CommonJS (CJS), usando la sintaxis `require`.
* Conoces la región de AWS en la que está implementada tu función.

<div id="2-add-the-sentry-lambda-layer">
  ## 2. Agrega la capa de Sentry para Lambda
</div>

Agrega la capa de Sentry navegando a tu función Lambda. Selecciona **Layers** y luego **Add a Layer**.

![](./img/lambda_view.png)

Ve a la pestaña **Specify an ARN** como se muestra:

![](./img/add_layer.png)

Modifica y copia el valor del ARN correspondiente a tu región en el campo de entrada; por ejemplo, para la región `us-west-1` y la versión actual v8 de la capa de Lambda `7`:

```
arn:aws:Lambda:us-west-1:943013980633:layer:SentryNodeServerlessSDKv8:7
```

<Alert>
  Anteriormente, la capa de Lambda v8 se publicaba con el nombre `SentryNodeServerlessSDK`.
  Este destino ya no recibirá actualizaciones.

  Si necesitas seguir usando la v8, utiliza la capa `SentryNodeServerlessSDKv8` como se indicó arriba.
</Alert>

<br />

<div id="3-initialize-the-sdk-with-environment-variables">
  ## 3. Inicializa el SDK con variables de entorno
</div>

La forma más sencilla de configurar el SDK es iniciarlo y configurarlo usando variables de entorno. Así no tienes que modificar el código de tu función Lambda.

Además de capturar errores, puedes supervisar las interacciones entre varios servicios o aplicaciones [habilitando el trazado](/es/concepts/key-terms/tracing/).

Selecciona qué funciones de Sentry quieres instalar, además de Error Monitoring, para obtener a continuación las instrucciones correspondientes de instalación y configuración.

<OnboardingOptionButtons options={["error-monitoring", "performance"]} />

Configura las siguientes variables de entorno en la configuración de tu función Lambda:

```bash
NODE_OPTIONS="-r @sentry/aws-serverless/awslambda-auto"
SENTRY_DSN="___PUBLIC_DSN___"
# ___PRODUCT_OPTION_START___ performance
SENTRY_TRACES_SAMPLE_RATE="1.0"
# ___PRODUCT_OPTION_END___ performance
```

Para configurar variables de entorno, ve a tu función Lambda, selecciona **Configuration** y luego **Environment variables**:

![](./img/cjs_env_vars.png)

<div id="alternative-initialize-the-sdk-in-code">
  ## Alternativa: inicializar el SDK en el código
</div>

En lugar de [el paso 3, configurar variables de entorno](#3-initialize-the-sdk-with-environment-variables), también puedes inicializar manualmente el SDK en el código de tu función Lambda.
Así podrás personalizar aún más la configuración del SDK.
Ten en cuenta que no necesitas instalar un paquete de NPM para que esto funcione, ya que el paquete ya viene incluido en la Lambda Layer.

Asegúrate de haber completado el [paso 1](#1-prerequisites) y el [paso 2](#2-add-the-sentry-lambda-layer) antes de continuar.

```javascript {filename:index.js}
const Sentry = require("@sentry/aws-serverless");

Sentry.init({
  dsn: "___PUBLIC_DSN___",
  // ___PRODUCT_OPTION_START___ performance
  // Agrega Tracing configurando tracesSampleRate y agregando la integración
  // Establece tracesSampleRate en 1.0 para capturar el 100% de las transacciones
  // Recomendamos ajustar este valor en producción
  // Más información en
  // https://docs.sentry.io/platforms/javascript/configuration/options/#traces-sample-rate
  tracesSampleRate: 1.0,
  // ___PRODUCT_OPTION_END___ performance
});

exports.handler = Sentry.wrapHandler(async (event, context) => {
  // Tu código del handler
});
```

Es importante agregar ambos: la llamada a `Sentry.init` fuera de la función del controlador y el wrapper `Sentry.wrapHandler` alrededor de tu función para capturar automáticamente errores y datos de rendimiento.

¡Listo, ya quedó todo configurado!
