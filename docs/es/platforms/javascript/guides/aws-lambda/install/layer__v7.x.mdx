---
title: Capa de Lambda - CJS
description: >-
  Aprende a agregar la capa Sentry Node Lambda para usar Sentry en tus funciones
  Lambda que se ejecutan con CommonJS (CJS)
sidebar_order: 1
noindex: true
og_image: /og-images/platforms-javascript-guides-aws-lambda-install-layer__v7.x.png
---

La forma más fácil de empezar con Sentry es usar la [capa de Lambda](https://docs.aws.amazon.com/Lambda/latest/dg/configuration-layers.html) de Sentry en lugar de agregar `@sentry/serverless` con `npm` o `yarn` manualmente.
Si sigues esta guía, no tendrás que preocuparte por implementar las dependencias de Sentry junto con el código de tu función.
Para iniciar el SDK, puedes elegir entre configurarlo mediante variables de entorno o en el código de tu función Lambda. Recomendamos usar variables de entorno porque es la forma más sencilla de empezar. [Inicializar el SDK en el código](#alternative-initialize-the-sdk-in-code), en lugar de usar variables de entorno, te da más control sobre la configuración del SDK si lo necesitas.

<Alert>
  Este método de instalación **no** funciona con funciones de Lambda que se ejecutan en modo ECMAScript Modules (ESM), usando la sintaxis `import`.
</Alert>

<div id="1-prerequisites">
  ## 1. Requisitos previos
</div>

Antes de comenzar, asegúrate de contar con lo siguiente:

* Tienes una función Lambda que se ejecuta en modo CommonJS (CJS), usando la sintaxis `require`.
* Conoces la región de AWS en la que está desplegada tu función.

<div id="2-add-the-sentry-lambda-layer">
  ## 2. Agrega la capa de Sentry para Lambda
</div>

Agrega la capa de Sentry yendo a tu función Lambda. Selecciona **Layers** y luego **Add a layer**.

![](./img/lambda_view.png)

Pestaña **Specify an ARN**, como se muestra:

![](./img/add_layer.png)

Modifica y copia el valor del ARN correspondiente a tu región en el campo de entrada; por ejemplo, para la región `us-west-1` y la versión actual v7 de la capa de Lambda `10`:

```
arn:aws:Lambda:us-west-1:943013980633:layer:SentryNodeServerlessSDKv7:10
```

<br />

<div id="3-initialize-the-sdk-with-environment-variables">
  ## 3. Inicializa el SDK con variables de entorno
</div>

La forma más fácil de configurar el SDK es iniciarlo y configurarlo usando variables de entorno. Así no tienes que modificar el código de tu función Lambda.

Además de capturar errores, puedes supervisar las interacciones entre varios servicios o aplicaciones [habilitando el tracing](/es/concepts/key-terms/tracing/).

Selecciona qué funciones de Sentry quieres instalar, además de la monitorización de errores, para obtener a continuación las instrucciones correspondientes de instalación y configuración.

<OnboardingOptionButtons options={["error-monitoring", "performance"]} />

Define las siguientes variables de entorno en la configuración de tu función Lambda:

```bash
NODE_OPTIONS="-r @sentry/serverless/dist/awslambda-auto"
SENTRY_DSN="___PUBLIC_DSN___"
# ___PRODUCT_OPTION_START___ rendimiento
SENTRY_TRACES_SAMPLE_RATE="1.0"
# ___PRODUCT_OPTION_END___ rendimiento
```

Para configurar variables de entorno, ve a tu función de Lambda, selecciona **Configuration** y luego **Environment variables**.

<div id="alternative-initialize-the-sdk-in-code">
  ## Alternativa: inicializar el SDK en el código
</div>

En lugar de [el paso 3, configurar variables de entorno](#3-initialize-the-sdk-with-environment-variables), también puedes inicializar manualmente el SDK en el código de tu función Lambda.
Así podrás personalizar aún más la configuración del SDK.
Ten en cuenta que no necesitas instalar un paquete de NPM para que esto funcione, ya que el paquete ya está incluido en la capa de Lambda.

Asegúrate de haber completado el [paso 1](#1-prerequisites) y el [paso 2](#2-add-the-sentry-lambda-layer) antes de continuar.

```javascript {filename:index.js}
const Sentry = require("@sentry/serverless");

Sentry.init({
  dsn: "___PUBLIC_DSN___",
  // ___PRODUCT_OPTION_START___ performance
  // Agrega Tracing configurando tracesSampleRate y agregando la integración
  // Establece tracesSampleRate en 1.0 para capturar el 100% de las transacciones
  // Recomendamos ajustar este valor en producción
  // Más información en
  // https://docs.sentry.io/platforms/javascript/configuration/options/#traces-sample-rate
  tracesSampleRate: 1.0,
  // ___PRODUCT_OPTION_END___ performance
});

exports.handler = Sentry.wrapHandler(async (event, context) => {
  // Tu código del handler
});
```

Es importante agregar ambos: la llamada a `Sentry.init` fuera de la función controladora y el envoltorio `Sentry.wrapHandler` alrededor de tu función para capturar automáticamente errores y datos de rendimiento.

¡Listo, ya quedó todo!
