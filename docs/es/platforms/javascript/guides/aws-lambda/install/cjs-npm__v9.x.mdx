---
title: Paquete NPM - CJS
description: >-
  Aprende a configurar Sentry manualmente para funciones Lambda que se ejecutan
  en CommonJS (CJS) usando el paquete NPM del SDK AWS Serverless de Sentry
sidebar_order: 2
og_image: /og-images/platforms-javascript-guides-aws-lambda-install-cjs-npm__v9.x.png
---

En esta guía aprenderás a configurar el SDK `@sentry/aws-serverless` para funciones de AWS Lambda que se ejecutan en modo CommonJS (CJS).
Recomendamos iniciar el SDK automáticamente mediante variables de entorno para que solo tengas que hacer cambios mínimos en el código de tu función Lambda.
Si necesitas más control sobre la configuración del SDK, también puedes [inicializar el SDK en código](#alternative-initialize-the-sdk-in-code).

Sin embargo, tendrás que modificar tu código y desplegar las dependencias de Sentry junto con el código de tu función. Si buscas la forma más sencilla de configurar Sentry, quizá prefieras usar la [Lambda Layer](./layer__v9.x).

<div id="1-prerequisites">
  ## 1. Requisitos previos
</div>

Antes de comenzar, asegúrate de lo siguiente:

* Tienes una función Lambda que se ejecuta en modo CommonJS (CJS), usando la sintaxis `require`.
* Puedes desplegar las dependencias (es decir, `node_modules`) junto con el código de tu función en AWS Lambda.

<div id="2-install">
  ## 2. Instalar
</div>

Además de capturar errores, puedes supervisar las interacciones entre varios servicios o aplicaciones [habilitando el tracing](/es/concepts/key-terms/tracing/). También puedes recopilar y analizar perfiles de rendimiento de usuarios reales con [profiling](/es/product/explore/profiling/).

Selecciona qué funcionalidades de Sentry quieres instalar, además de Error Monitoring, para obtener a continuación las instrucciones correspondientes de instalación y configuración.

<OnboardingOptionButtons options={["error-monitoring", "performance", "profiling"]} />

Instala el SDK `@sentry/aws-serverless` usando el gestor de paquetes de tu preferencia:

<OnboardingOption optionId="profiling" hideForThisOption>
  ```bash {tabTitle:npm}
  npm install @sentry/aws-serverless
  ```

  ```bash {tabTitle:yarn}
  yarn add @sentry/aws-serverless
  ```

  ```bash {tabTitle:pnpm}
  pnpm add @sentry/aws-serverless
  ```
</OnboardingOption>

<OnboardingOption optionId="profiling">
  ```bash {tabTitle:npm}
  npm install @sentry/aws-serverless @sentry/profiling-node
  ```

  ```bash {tabTitle:yarn}
  yarn add @sentry/aws-serverless @sentry/profiling-node
  ```

  ```bash {tabTitle:pnpm}
  pnpm add @sentry/aws-serverless @sentry/profiling-node
  ```
</OnboardingOption>

## 3. Envuelve tu handler

Añade el wrapper `Sentry.wrapHandler` a tu función handler para capturar automáticamente errores y datos de rendimiento:

```javascript {filename:index.js}{1, 3}
const Sentry = require("@sentry/aws-serverless");

exports.handler = Sentry.wrapHandler(async (event, context) => {
  // Tu código del manejador
});
```

<div id="4-set-environment-variables">
  ## 4. Configurar variables de entorno
</div>

Para inicializar y configurar el SDK, debes definir las siguientes variables de entorno en la configuración de tu función de AWS Lambda:

```bash
NODE_OPTIONS="-r @sentry/aws-serverless/awslambda-auto"
SENTRY_DSN="___PUBLIC_DSN___"
# ___PRODUCT_OPTION_START___ rendimiento
SENTRY_TRACES_SAMPLE_RATE="1.0"
# ___PRODUCT_OPTION_END___ rendimiento
```

Para configurar variables de entorno, ve a tu función de Lambda, selecciona **Configuration** y luego **Environment variables**:

![](./img/cjs_env_vars.png)

¡Listo! Asegúrate de volver a desplegar tu función y ya está.

<div id="alternative-initialize-the-sdk-in-code">
  ## Alternativa: inicializar el SDK en código
</div>

Para personalizar aún más la configuración del SDK, también puedes inicializar manualmente el SDK en tu función Lambda. Debes inicializar el SDK en un archivo aparte y cargarlo antes de que tu función se inicie.
La ventaja de este método de instalación es que puedes personalizar por completo la configuración del SDK de Sentry en una llamada a `Sentry.init`.

<div id="1-install">
  ### 1. Instalar
</div>

Sigue los pasos 1 y 2 anteriores para [instalar el paquete NPM del SDK](#2-install) en tu proyecto.

<div id="2-initialize-the-sdk">
  ### 2. Inicializa el SDK
</div>

Crea un archivo nuevo, por ejemplo `instrument.js`, para inicializar el SDK:

```javascript {filename:instrument.js}
const Sentry = require("@sentry/aws-serverless");
// ___PRODUCT_OPTION_START___ profiling
const { nodeProfilingIntegration } = require("@sentry/profiling-node");

// ___PRODUCT_OPTION_END___ profiling
Sentry.init({
  dsn: "___PUBLIC_DSN___",

  // Agrega encabezados de solicitud e IP para usuarios, para más información visita:
  // https://docs.sentry.io/platforms/javascript/guides/aws-lambda/configuration/options/#sendDefaultPii
  sendDefaultPii: true,

  // ___PRODUCT_OPTION_START___ profiling
  integrations: [nodeProfilingIntegration()],
  // ___PRODUCT_OPTION_END___ profiling

  // ___PRODUCT_OPTION_START___ performance
  // Agrega Tracing configurando tracesSampleRate y agregando la integración
  // Establece tracesSampleRate en 1.0 para capturar el 100% de las transacciones
  // Te recomendamos ajustar este valor en producción
  // Más información en
  // https://docs.sentry.io/platforms/javascript/configuration/options/#traces-sample-rate
  tracesSampleRate: 1.0,
  // ___PRODUCT_OPTION_END___ performance
  // ___PRODUCT_OPTION_START___ profiling

  // Establece la tasa de muestreo para profiling - esto es relativo a tracesSampleRate
  profilesSampleRate: 1.0,
  // ___PRODUCT_OPTION_END___ profiling
});
```

<div id="3-wrap-your-handler">
  ### 3. Envuelve tu handler
</div>

Añade el wrapper `Sentry.wrapHandler` a tu handler de función para capturar automáticamente errores y datos de rendimiento:

```javascript {filename:index.js}{1,3}
const Sentry = require("@sentry/aws-serverless");

exports.handler = Sentry.wrapHandler(async (event, context) => {
  // Tu código del manejador
});
```

<div id="4-load-the-sdk">
  ### 4. Carga el SDK
</div>

Para cargar el SDK antes de que se inicie tu función, debes precargar `instrument.js` configurando la variable de entorno `NODE_OPTIONS`:

```bash
NODE_OPTIONS="--require ./instrument.js"
```

Para configurar variables de entorno, ve a tu función de Lambda, selecciona **Configuration** y luego **Environment variables**:

![](./img/cjs_manual_env_vars.png)

¡Listo! Asegúrate de volver a desplegar tu función y todo quedará preparado.

<div id="using-the-v7-sdk">
  ## Uso del SDK v7
</div>

Las instrucciones anteriores están escritas para la versión más reciente del SDK.
En las versiones del SDK anteriores a la 8, el paquete `@sentry/aws-serverless` se llamaba `@sentry/serverless`. Si usas una versión anterior, puedes seguir esta guía, pero sustituye el paquete por `@sentry/serverless`.