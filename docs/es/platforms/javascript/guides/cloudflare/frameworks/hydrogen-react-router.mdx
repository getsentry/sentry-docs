---
title: Hydrogen con React Router
description: Aprende a usar el SDK de Sentry para React Router para instrumentar tu app de Hydrogen (versiones 2025.5.0+).
---

<Alert level="info" title="Versión de Hydrogen">
  Esta guía se aplica a las versiones de Hydrogen **2025.5.0 y posteriores** que usan React Router 7 (modo framework). Para versiones anteriores de Hydrogen que usan Remix v2, consulta la [guía de Remix](/es/platforms/javascript/guides/cloudflare/frameworks/hydrogen-remix/).
</Alert>

A partir de la versión 2025.5.0 de Hydrogen, Shopify cambió de Remix v2 a React Router 7 (modo framework). Puedes usar el SDK de Sentry para React Router con compatibilidad con Cloudflare para añadir instrumentación de Sentry a tu app de Hydrogen.

<div id="installing-sentry-react-router-and-cloudflare-sdks">
  ## Instalación de los SDK de Sentry React Router y Cloudflare
</div>

Primero, instala los SDK de Sentry React Router y Cloudflare con tu administrador de paquetes:

```bash {tabTitle:npm}
npm install @sentry/react-router @sentry/cloudflare --save
```

```bash {tabTitle:yarn}
yarn add @sentry/react-router @sentry/cloudflare
```

```bash {tabTitle:pnpm}
pnpm add @sentry/react-router @sentry/cloudflare
```

<div id="instrumenting-your-server">
  ## Instrumentación del servidor
</div>

Crea un archivo `instrument.server.mjs` para inicializar Sentry en el servidor:

```js {filename:instrument.server.mjs}
import * as Sentry from "@sentry/react-router";

Sentry.init({
  dsn: "YOUR_DSN_HERE",
  // Agrega los encabezados de la solicitud y la IP de los usuarios; para más información, visita:
  // https://docs.sentry.io/platforms/javascript/guides/react-router/configuration/options/#sendDefaultPii
  sendDefaultPii: true,
  tracesSampleRate: 1.0,
});
```

Actualiza tu archivo `server.ts` para usar el método `wrapRequestHandler` de `@sentry/cloudflare`:

```ts {filename:server.ts}
import { wrapRequestHandler } from '@sentry/cloudflare';
// ...other imports

/**
 * Exporta un controlador de fetch en formato de módulo.
 */
export default {
  async fetch(
    request: Request,
    env: Env,
    executionContext: ExecutionContext
  ): Promise<Response> {
    return wrapRequestHandler(
      {
        options: {
          dsn: "YOUR_DSN_HERE",
          tracesSampleRate: 1.0,
        },
        request: request as any,
        context: executionContext,
      },
      async () => {
        // Tu lógica existente del servidor de Hydrogen
        const handleRequest = createRequestHandler({
          // @ts-ignore
          build: await import('virtual:react-router/server-build'),
          mode: process.env.NODE_ENV,
          getLoadContext: (): AppLoadContext => ({
            // tu contexto de carga
          }),
        });

        return handleRequest(request);
      }
    );
  },
};
```

<div id="instrumenting-your-client">
  ## Instrumentación del cliente
</div>

Inicializa Sentry en el archivo `entry.client.tsx`:

```tsx {filename:app/entry.client.tsx}
import { HydratedRouter } from 'react-router/dom';
import * as Sentry from '@sentry/react-router/cloudflare';
import { StrictMode, startTransition } from 'react';
import { hydrateRoot } from 'react-dom/client';

Sentry.init({
  dsn: "___PUBLIC_DSN___",
  integrations: [Sentry.reactRouterTracingIntegration()],
  tracesSampleRate: 1.0,
});

startTransition(() => {
  hydrateRoot(
    document,
    <StrictMode>
      <HydratedRouter />
    </StrictMode>,
  );
});
```

<div id="server-side-rendering-with-trace-injection">
  ## Renderizado del lado del servidor con inyección de trazas
</div>

Para habilitar el trazado distribuido, envuelve la función `handleRequest` en el archivo `entry.server.tsx` e inyecta metaetiquetas de trazas:

```tsx {filename:app/entry.server.tsx}
import './instrument.server';
import { HandleErrorFunction, ServerRouter } from 'react-router';
import type { EntryContext } from '@shopify/remix-oxygen';
import { renderToReadableStream } from 'react-dom/server';
import * as Sentry from '@sentry/react-router/cloudflare';

async function handleRequest(
  request: Request,
  responseStatusCode: number,
  responseHeaders: Headers,
  reactRouterContext: EntryContext,
) {
  const body = Sentry.injectTraceMetaTags(await renderToReadableStream(
    <ServerRouter context={reactRouterContext} url={request.url} />,
    {
      signal: request.signal,
    },
  ));

  responseHeaders.set('Content-Type', 'text/html');

  return new Response(body, {
    headers: responseHeaders,
    status: responseStatusCode,
  });
}

export const handleError: HandleErrorFunction = (error, { request }) => {
  // React Router puede abortar algunas solicitudes interrumpidas; no registres esas
  if (!request.signal.aborted) {
    Sentry.captureException(error);
    console.error(error);
  }
};

export default Sentry.wrapSentryHandleRequest(handleRequest);
```

<div id="configuration">
  ## Configuración
</div>

<div id="vite-configuration">
  ### Configuración de Vite
</div>

Añade el complemento de Sentry a tu `vite.config.ts`:

```ts {filename:vite.config.ts}
import { reactRouter } from '@react-router/dev/vite';
import { hydrogen } from '@shopify/hydrogen/vite';
import { oxygen } from '@shopify/mini-oxygen/vite';
import { defineConfig } from 'vite';
import { sentryReactRouter } from '@sentry/react-router';

export default defineConfig(config => ({
  plugins: [
    hydrogen(),
    oxygen(),
    reactRouter(),
    sentryReactRouter({
      org: "tu-organización-slug",
      project: "tu-proyecto-slug",
      authToken: process.env.SENTRY_AUTH_TOKEN,
    }, config),
    // ... otros plugins
  ],
}));
```

<div id="build-configuration">
  ### Configuración de compilación
</div>

Dado que el hook `buildEnd` no se ejecutará en Hydrogen, deberás subir manualmente los mapas de origen usando la [CLI de Sentry](/es/cli/).

```bash
# Inyectar IDs de depuración
sentry-cli sourcemaps inject /path/to/build/dir
# Cargar sourcemaps
sentry-cli sourcemaps upload /path/to/build/dir
```
