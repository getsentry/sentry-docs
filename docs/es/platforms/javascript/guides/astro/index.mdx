---
title: Astro
description: Astro es un framework web para crear sitios centrados en contenido, incluidos blogs, sitios de marketing y tiendas de comercio electrónico. Aprende a configurarlo con Sentry.
sdk: sentry.javascript.astro
categories:
  - javascript
  - browser
  - server
  - server-node
---

El SDK de Astro de Sentry permite el reporte automático de errores y datos de rendimiento en tu aplicación de Astro.
Nuestra integración para Astro instrumenta tanto el cliente como el servidor de tu aplicación.
Esta página te guía para agregar Sentry a tu proyecto de Astro, configurarlo, añadir trazas de pila legibles y verificar tu configuración.

<div id="prerequisites">
  ## Requisitos previos
</div>

Antes de empezar, asegúrate de tener lo siguiente:

* Una [cuenta](https://sentry.io/signup/) de Sentry y un [proyecto](/es/product/projects/)
* Un proyecto de Astro que use Astro `3.0.0` o una versión posterior.
* Un entorno de ejecución de Node:
  * Este SDK actualmente solo funciona en entornos de ejecución de Node (p. ej., adaptador de Node, Vercel con funciones Lambda).
    Los entornos que no son de Node, como el entorno Edge de Vercel o Cloudflare Pages, no están admitidos por ahora.
* Si usas el adaptador de Netlify para Astro (`@astrojs/netlify`), necesitas la versión `5.0.0` o posterior.

<div id="install">
  ## Instalación
</div>

<OnboardingOptionButtons
  options={[
"error-monitoring",
"performance",
"profiling",
"session-replay",
"user-feedback",
"logs",
]}
/>

Sentry recopila datos mediante un SDK dentro del entorno de ejecución de tu aplicación.

Instala el SDK con la CLI de `astro`:

```bash {tabTitle:npm}
npx astro add @sentry/astro
```

```bash {tabTitle:yarn}
yarn astro add @sentry/astro
```

```bash {tabTitle:pnpm}
pnpm astro add @sentry/astro
```

La CLI de `astro` instala el paquete del SDK y añade la integración de Sentry a tu archivo `astro.config.mjs`.

<OnboardingOption optionId="profiling">
  ```bash {tabTitle:npm}
  npm install @sentry/profiling-node
  ```

  ```bash {tabTitle:yarn}
  yarn add @sentry/profiling-node
  ```

  ```bash {tabTitle:pnpm}
  pnpm add @sentry/profiling-node
  ```
</OnboardingOption>

Para completar la configuración, configura la integración de Sentry.

<div id="configure">
  ## Configurar
</div>

Para configurar el SDK de Sentry, registra la integración de Sentry e inicializa el SDK para el cliente y el servidor en el directorio raíz de tu proyecto:

<div id="astro-integration-setup">
  ### Configuración de la integración de Astro
</div>

```javascript {filename:astro.config.mjs}
import { defineConfig } from "astro/config";
import sentry from "@sentry/astro";

export default defineConfig({
  integrations: [
    sentry({
      project: "___PROJECT_SLUG___",
      org: "___ORG_SLUG___",
      authToken: process.env.SENTRY_AUTH_TOKEN,
    }),
  ],
});
```

<Alert level="warning">
  Pasar opciones de configuración específicas del tiempo de ejecución (`dsn`, `release`,
  `environment`, `sampleRate`, `tracesSampleRate`, `replaysSessionSampleRate`,
  `replaysOnErrorSampleRate`) a la integración de Sentry quedará obsoleto en
  versiones futuras. Recomendamos pasar tu configuración directamente a las
  llamadas correspondientes a `Sentry.init()` en `sentry.client.config.js` y
  `sentry.server.config.js` en su lugar.
</Alert>

<div id="client-side-setup">
  ### Configuración del lado del cliente
</div>

```javascript {filename:sentry.client.config.js}
import * as Sentry from "@sentry/astro";

Sentry.init({
  dsn: "___PUBLIC_DSN___",

  // Agrega encabezados de la solicitud y la IP de los usuarios. Para más información, visita:
  // https://docs.sentry.io/platforms/javascript/guides/astro/configuration/options/#sendDefaultPii
  sendDefaultPii: true,

  integrations: [
    // ___PRODUCT_OPTION_START___ performance
    Sentry.browserTracingIntegration(),
    // ___PRODUCT_OPTION_END___ performance
    // ___PRODUCT_OPTION_START___ session-replay
    Sentry.replayIntegration(),
    // ___PRODUCT_OPTION_END___ session-replay
    // ___PRODUCT_OPTION_START___ user-feedback
    Sentry.feedbackIntegration({
      // La configuración adicional del SDK va aquí; por ejemplo:
      colorScheme: "system",
    }),
    // ___PRODUCT_OPTION_END___ user-feedback
  ],
  // ___PRODUCT_OPTION_START___ logs

  // Habilita el envío de logs a Sentry
  enableLogs: true,
  // ___PRODUCT_OPTION_END___ logs

  // ___PRODUCT_OPTION_START___ performance
  // Define la probabilidad de muestreo de las trazas. Ajusta este valor en producción
  // o usa tracesSampler para tener un control más preciso.
  tracesSampleRate: 1.0,
  // ___PRODUCT_OPTION_END___ performance
  // ___PRODUCT_OPTION_START___ session-replay

  // Esto establece la tasa de muestreo en un 10 %. Puede que quieras que sea del 100 % durante
  // el desarrollo y muestrear a una tasa más baja en producción.
  replaysSessionSampleRate: 0.1,

  // Si no se muestrea toda la sesión, usa la siguiente tasa para muestrear
  // las sesiones cuando ocurra un error.
  replaysOnErrorSampleRate: 1.0,
  // ___PRODUCT_OPTION_END___ session-replay
});
```

<div id="server-side-setup">
  ### Configuración del servidor
</div>

```javascript {filename:sentry.server.config.js}
import * as Sentry from "@sentry/astro";
// ___PRODUCT_OPTION_START___ profiling
import { nodeProfilingIntegration } from "@sentry/profiling-node";
// ___PRODUCT_OPTION_END___ profiling

Sentry.init({
  dsn: "___PUBLIC_DSN___",

  // Agrega encabezados de solicitud y la IP de los usuarios; para más información, visita:
  // https://docs.sentry.io/platforms/javascript/guides/astro/configuration/options/#sendDefaultPii
  sendDefaultPii: true,
  // ___PRODUCT_OPTION_START___ profiling

  integrations: [
    // Agrega nuestra integración de perfiles
    nodeProfilingIntegration(),
  ],
  // ___PRODUCT_OPTION_END___ profiling
  // ___PRODUCT_OPTION_START___ logs

  // Habilita el envío de logs a Sentry
  enableLogs: true,
  // ___PRODUCT_OPTION_END___ logs

  // ___PRODUCT_OPTION_START___ performance
  // Define la probabilidad de muestreo de trazas. Ajusta este valor en producción
  // o usa tracesSampler para un control más preciso.
  tracesSampleRate: 1.0,
  // ___PRODUCT_OPTION_END___ performance
  // ___PRODUCT_OPTION_START___ profiling

  // Establece la tasa de muestreo para perfiles
  // Esto es relativo a tracesSampleRate
  profilesSampleRate: 1.0,
  // ___PRODUCT_OPTION_END___ profiling
});
```

Si quieres configurar tu SDK con variables de entorno, asegúrate de seguir la documentación de Astro sobre [el uso de variables de entorno](https://docs.astro.build/en/guides/environment-variables/).

<div id="add-readable-stack-traces-to-errors">
  ## Agrega trazas de pila legibles a los errores
</div>

Para obtener trazas de pila legibles en tus compilaciones de producción, establece la variable de entorno `SENTRY_AUTH_TOKEN` en tu entorno de compilación. También puedes añadirla a un archivo `.env.sentry-build-plugin` en la raíz de tu proyecto.

<OrgAuthTokenNote />

```bash {filename:.env.sentry-build-plugin}
SENTRY_AUTH_TOKEN=___TOKEN_DE_AUTENTICACIÓN_DE_LA_ORG___
```

Esto, junto con la configuración de tu integración de `sentry`, <PlatformLink to="/sourcemaps">subirá los mapas de origen</PlatformLink> a Sentry cada vez que generes una build de producción.

<div id="verify">
  ## Verificar
</div>

Este fragmento incluye un error intencional para que puedas comprobar que todo funciona en cuanto lo configures.

Genera un error de prueba en algún lugar de tu app de Astro, por ejemplo, en una de tus páginas:

```html {filename: home.astro}
<button onclick="throw new Error('Este es un error de prueba')">
  Generar error de prueba
</button>
```

<Alert>
  Los errores generados desde las DevTools del navegador están aislados y no activarán
  un controlador de errores. En su lugar, coloca el fragmento directamente en tu código.
</Alert>

<Alert>
  Obtén más información sobre cómo capturar manualmente un error o un mensaje en nuestra{" "}
  <PlatformLink to="/usage/">documentación de uso</PlatformLink>.
</Alert>

Para ver y resolver el error registrado, inicia sesión en [sentry.io](https://sentry.io) y selecciona tu proyecto. Al hacer clic en el título del error, se abrirá una página donde puedes ver información detallada y marcarlo como resuelto.

<div id="advanced-configuration-options">
  ## Opciones de configuración avanzadas
</div>

<div id="changing-config-files-location">
  ### Cambiar la ubicación de los archivos de configuración
</div>

Sentry detecta automáticamente los archivos de configuración llamados `sentry.(client|server).config.js` en la raíz de tu proyecto. Puedes cambiarles el nombre o moverlos a una carpeta personalizada dentro de tu proyecto.
Para modificar su ubicación o sus nombres, especifica las rutas en las opciones de la integración de Sentry para Astro en tu `astro.config.mjs`:

```javascript {filename:astro.config.mjs}
export default defineConfig({
  // Otras opciones del proyecto Astro
  integrations: [
    sentry({
      clientInitPath: ".config/sentryClientInit.js",
      serverInitPath: ".config/sentryServerInit.js",
    }),
  ],
});
```

<div id="server-instrumentation">
  ### Instrumentación del servidor
</div>

<Alert>
  La auto-instrumentación solo funciona con Astro 3.5.2 o versiones posteriores. Si usas una versión anterior, debes [agregar manualmente el middleware de Sentry](#manually-add-server-instrumentation).
</Alert>

En aplicaciones de Astro configuradas en modo SSR o híbrido, la integración de Sentry para Astro añadirá automáticamente un manejador de solicitudes de [middleware de Astro](https://docs.astro.build/en/guides/middleware/) a tu código del servidor. Este middleware mejora los datos que Sentry recopila en el lado del servidor al:

* Recopilar spans de rendimiento para las solicitudes entrantes
* Habilitar el trazado distribuido entre el cliente y el servidor
* Enriquecer los errores capturados con información adicional

<div id="manually-add-server-instrumentation">
  ### Agregar manualmente la instrumentación del servidor
</div>

Para las versiones de Astro anteriores a la 3.5.2, debes agregar manualmente el middleware de Sentry al archivo `src/middleware.js`:

```javascript {filename:src/middleware.(js|ts)}
import * as Sentry from "@sentry/astro";
import { sequence } from "astro:middleware";

export const onRequest = sequence(
  Sentry.handleRequest()
  // otros manejadores de middleware
);
```

Si tienes varios controladores de solicitudes, asegúrate de agregar el middleware de Sentry como el primer controlador de la secuencia.

<div id="customize-server-instrumentation">
  ### Personalizar la instrumentación del servidor
</div>

El middleware de Sentry para Astro te permite controlar qué datos adicionales se agregan a los spans de las solicitudes que se registran.

Para personalizar la instrumentación del servidor, agrega el middleware de Sentry a tu archivo `src/middleware.js`:

```javascript {filename:src/middleware.(js|ts)}
import * as Sentry from "@sentry/astro";
import { sequence } from "astro:middleware";

export const onRequest = sequence(
  Sentry.handleRequest({
    trackClientIp: true, // el valor predeterminado es false
    trackHeaders: true, // el valor predeterminado es false
  })
  // otros controladores de middleware
);
```

Si usas Astro 3.5.2 o una versión posterior, asegúrate de desactivar también la instrumentación automática como se muestra a continuación.

<div id="disable-auto-server-instrumentation">
  ### Desactivar la instrumentación automática del servidor
</div>

En Astro 3.5.2 o versiones posteriores, puedes desactivar la instrumentación automática del servidor deshabilitando la opción de auto-instrumentación `requestHandler`:

```javascript {filename:astro.config.mjs}
import { defineConfig } from "astro/config";
import sentry from "@sentry/astro";

export default defineConfig({
  integrations: [
    sentry({
      autoInstrumentation: {
        requestHandler: false,
      },
    }),
  ],
  output: "server",
});
```
