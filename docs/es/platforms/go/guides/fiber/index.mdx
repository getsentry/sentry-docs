---
title: Fiber
description: "Aprende a agregar instrumentación de Sentry a programas que usan el paquete Fiber."
---

Para una consulta rápida, hay un [ejemplo completo](https://github.com/getsentry/sentry-go/tree/master/_examples/fiber) en el repositorio del código fuente del SDK de Go.

También está disponible la [documentación de la API al estilo Go Dev](https://godoc.org/github.com/getsentry/sentry-go/fiber).

<div id="install">
  ## Instalación
</div>

```bash
go get github.com/getsentry/sentry-go
go get github.com/getsentry/sentry-go/fiber
```

<Break />


<div id="configure">
  ## Configuración
</div>

<div id="initialize-the-sentry-sdk">
  ### Inicializa el SDK de Sentry
</div>

<PlatformContent includePath="getting-started-config" />

<div id="options">
  ### Opciones
</div>

`sentryfiber` acepta una estructura `Options` que te permite configurar cómo se comportará el controlador.

```go
// Repanic configura si Sentry debe volver a lanzar el pánico después de la recuperación; en la mayoría de los casos debe establecerse en true,
// ya que fiber incluye su propio middleware Recover que maneja las respuestas http.
Repanic bool
// WaitForDelivery configura si deseas bloquear la solicitud antes de continuar con la respuesta.
// Dado que el manejador `Recover` de Fiber no reinicia la aplicación,
// es seguro omitir esta opción o establecerla en `false`.
WaitForDelivery bool
// Timeout para las solicitudes de entrega de eventos.
Timeout time.Duration
```

<Break />

```go
sentryHandler := sentryfiber.New(sentryfiber.Options{
    // puedes modificar estas opciones
    Repanic:         true,
    WaitForDelivery: false,
    Timeout:         5 * time.Second,
})

app := fiber.New()
app.Use(sentryHandler)
```


<div id="verify">
  ## Verificar
</div>

```go
app := fiber.New()

app.Use(sentryfiber.New(sentryfiber.Options{
// especifica las opciones aquí...
}))

app.All("/", func(ctx *fiber.Ctx) error {
	// captura un error intencionalmente para simular el uso
	sentry.CaptureMessage("¡Funciona!")
	
	return ctx.SendStatus(fiber.StatusOK)
})

if err := app.Listen(":3000"); err != nil {
	panic(err)
}
```


<div id="usage">
  ## Uso
</div>

`sentryfiber` adjunta una instancia de `*sentry.Hub` (https://godoc.org/github.com/getsentry/sentry-go#Hub) al contexto de la solicitud, lo que la deja disponible durante el resto del ciclo de vida de la solicitud.
Puedes acceder a ella usando el método `sentryfiber.GetHubFromContext()` en el propio contexto, en cualquiera de tus middleware y rutas posteriores.
Este método debe usarse en lugar de las llamadas globales `sentry.CaptureMessage`, `sentry.CaptureException` u otras, ya que mantiene la separación de datos entre solicitudes.

**Ten en cuenta que `*sentry.Hub` no estará disponible en el middleware que se ejecute antes de `sentryfiber`.**

```go
func enhanceSentryEvent := func(ctx *fiber.Ctx) error {
	if hub := sentryfiber.GetHubFromContext(ctx); hub != nil {
		hub.Scope().SetTag("someRandomTag", "quizásLoNecesites")
	}
	return ctx.Next()
}

// Más adelante en el código
sentryHandler := sentryfiber.New(sentryfiber.Options{
	Repanic:         true,
	WaitForDelivery: true,
})

defaultHandler := func(ctx *fiber.Ctx) error {
	if hub := sentryfiber.GetHubFromContext(ctx); hub != nil {
		hub.WithScope(func(scope *sentry.Scope) {
			scope.SetExtra("unwantedQuery", "algúnDatoDeConsultaTalVez")
			hub.CaptureMessage("El usuario proporcionó una cadena de consulta no deseada, pero nos recuperamos sin problemas")
		})
	}
	return ctx.SendStatus(fiber.StatusOK)
}

fooHandler := enhanceSentryEvent(func(ctx *fiber.Ctx) {
	panic("¿y por qué?")
})

app.All("/foo", fooHandler)
app.All("/", defaultHandler)

if err := app.Listen(":3000"); err != nil {
	panic(err)
}

fmt.Println("Escuchando y atendiendo HTTP en :3000")
```


<div id="accessing-context-in-beforesend-callback">
  ### Acceder al contexto en el callback `BeforeSend`
</div>

```go
sentry.Init(sentry.ClientOptions{
	Dsn: "___PUBLIC_DSN___",
	BeforeSend: func(event *sentry.Event, hint *sentry.EventHint) *sentry.Event {
		if hint.Context != nil {
			if ctx, ok := hint.Context.Value(sentry.RequestContextKey).(*fiber.Ctx); ok {
				// Tienes acceso al Context original si se produjo un pánico
				fmt.Println(utils.CopyString(ctx.Hostname()))
			}
		}
		return event
	},
})
```
