---
title: Instrumentación de cachés
sidebar_order: 1000
description: "Aprende a instrumentar manualmente tu código para usar el módulo Caches de Sentry."
---

Sentry ofrece un panel de monitoreo de cachés que algunos SDK pueden instrumentar automáticamente. Si usas Go, puedes instrumentar manualmente tus operaciones de caché y usar Sentry para monitorear su rendimiento y obtener una idea de cómo está funcionando tu solución de caché siguiendo las instrucciones de configuración a continuación.

Para permitir que Sentry haga seguimiento del rendimiento de la caché, debes crear dos spans:

- Uno para cuando se inserta un elemento en la caché.
- Otro para cuando se recupera un elemento de la caché.

Asegúrate de que haya una transacción activa al crear los spans. Para más información, consulta [Tracing](../..).

Para información detallada sobre los datos disponibles, consulta la especificación para desarrolladores del módulo Cache.

<div id="custom-instrumentation">
  ## Instrumentación personalizada
</div>

Como el SDK de Go no admite la instrumentación automática de la caché, deberás instrumentar manualmente el módulo de caché como se describe a continuación.

<div id="add-span-when-putting-data-into-the-cache">
  ### Añade un span al insertar datos en la caché
</div>

Usa instrumentación personalizada para emitir spans de datos en caché.

- Establece el valor en la caché usando tu biblioteca de caché preferida.
- Envuelve en un span la parte de tu aplicación que inserta datos en la caché.
- Establece `op` en `cache.put`.
- Opcionalmente, establece `cache.item_size` en el tamaño del elemento en caché.

<div id="example-go">
  #### Ejemplo (Go)
</div>

```go
key := "cache_key"
value := "cache_value"

parentSpan := sentry.StartSpan(context.Background(), "parent_span")

if parentSpan != nil {
    span := parentSpan.StartChild("cache.put")
    defer span.Finish()

    // Realizar la operación de caché
    err := cache.Put(key, value)

    span.SetData("network.peer.address", "127.0.0.1")
    span.SetData("network.peer.port", 9000)
    span.SetData("cache.key", key)
    span.SetData("cache.item_size", len(value))

    if err != nil {
        span.SetTag("error", err.Error())
    }
}
```


<div id="add-span-when-retrieving-data-from-the-cache">
  ### Agregar un span al recuperar datos de la caché
</div>

Para soluciones de caché no compatibles, usa instrumentación personalizada para emitir spans de caché:

Obtén el valor en caché con tu biblioteca de caché preferida.
Envuelve en un span la parte de tu aplicación que recupera datos de la caché.
Establece op en cache.get.
Establece cache.hit en true o false, según si se encontró el valor.
Opcionalmente, establece cache.item&#95;size al tamaño del elemento recuperado.

Ejemplo:

```go
key := "cache_key"
var value string

parentSpan := sentry.StartSpan(context.Background(), "parent_span")

if parentSpan != nil {
    span := parentSpan.StartChild("cache.get")
    defer span.Finish()

    // Realizar la operación de caché
    value, err := cache.Get(key)

    span.SetData("network.peer.address", "127.0.0.1")
    span.SetData("network.peer.port", 9000)
    span.SetData("cache.key", key)

    if err == nil && value != "" {
        span.SetData("cache.hit", true)
        span.SetData("cache.item_size", len(value))
    } else {
        span.SetData("cache.hit", false)
    }
}
```

Ahora deberías tener los spans correctos. Ve al [panel de caché](https://sentry.io/orgredirect/organizations/:orgslug/insights/backend/caches/) para ver cómo está rindiendo tu caché.
