---
title: Concurrencia
description: "Obtén más información sobre cómo usar el SDK desde goroutines concurrentes."
sidebar_order: 5
---

Los programas concurrentes en Go usan goroutines, una forma de hilo ligero administrado por el runtime de Go. Como las goroutines se ejecutan de manera concurrente, cada una debe mantener localmente sus propios datos relacionados con Sentry. De lo contrario, las condiciones de carrera pueden introducir errores sutiles en tus programas, y las consecuencias van desde que no ocurra nada aparente hasta fallos inesperados o, peor aún, mezclar accidentalmente los datos almacenados en el `Scope`. Más sobre esto en la sección [Scopes and Hubs](../../enriching-events/scopes/).

La manera más sencilla de manejar esto es crear un nuevo `Hub` para cada goroutine que inicies; sin embargo, eso requeriría volver a enlazar el `Client` actual y gestionar el `Scope` tú mismo. Por eso ofrecemos un método auxiliar llamado `Clone`. Se encarga de crear un `Hub`, clonar el `Scope` existente y reasignarlo junto con el `Client` a la instancia recién creada.

Una vez clonado, el `Hub` queda completamente aislado y puede usarse de forma segura en llamadas concurrentes. No obstante, en lugar de usar métodos expuestos globalmente, deben invocarse directamente sobre el `Hub`.

Aquí hay dos ejemplos:

* una llamada determinista recomendada en `Hub` que es segura

```go
// Ejemplo de uso __CORRECTO__ de scopes dentro de una Goroutine

go func(localHub *sentry.Hub) {
	// como argumento de goroutine
	localHub.ConfigureScope(func(scope *sentry.Scope) {
		scope.SetTag("secretTag", "go#1")
	})
	localHub.CaptureMessage("¡Hola desde Goroutine! #1")
}(sentry.CurrentHub().Clone())

go func() {
	// o creado localmente
	localHub := sentry.CurrentHub().Clone()
	localHub.ConfigureScope(func(scope *sentry.Scope) {
		scope.SetTag("secretTag", "go#2")
	})
	localHub.CaptureMessage("¡Hola desde Goroutine! #2")
}()
```

* una llamada no determinista no recomendada en `Hub` que podría filtrar información entre hilos

```go
// Ejemplo de uso __INCORRECTO__ de scopes dentro de una Goroutine - ¡NO LO USES!

go func() {
	sentry.ConfigureScope(func(scope *sentry.Scope) {
		scope.SetTag("secretTag", "go#1")
	})
	sentry.CaptureMessage("¡Hola desde Goroutine! #1")
}()

go func() {
	sentry.ConfigureScope(func(scope *sentry.Scope) {
		scope.SetTag("secretTag", "go#2")
	})
	sentry.CaptureMessage("¡Hola desde Goroutine! #2")
}()

// en este punto ambos eventos pueden tener la etiqueta `go#1` o `go#2`. Nunca lo sabremos.
```
