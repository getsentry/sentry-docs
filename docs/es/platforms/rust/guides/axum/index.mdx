---
title: axum
description: "Aprende a monitorear tu aplicación de axum con Sentry."
---

El SDK de Sentry ofrece un middleware para el framework [axum](https://github.com/tokio-rs/axum) que permite:

* Reportar errores y panics con la correlación de la solicitud adecuada.
* Iniciar una [transacción](/es/concepts/key-terms/tracing/) por cada ciclo de solicitud-respuesta.

La integración, de hecho, es compatible con cualquier crate basado en [tower](https://github.com/tower-rs/tower), no solo con `axum`.

<div id="install">
  ## Instalación
</div>

<OnboardingOptionButtons options={["error-monitoring", "performance"]} />

Para añadir Sentry con la integración de `axum` a tu proyecto de Rust, agrega una nueva dependencia en tu `Cargo.toml`:

```toml {filename:Cargo.toml}
[dependencies]
axum = "0.8.4"
tower = "0.5.2"
tokio = { version = "1.45.0", features = ["full"] }
sentry = { version = "{{@inject packages.version('sentry.rust') }}", features = ["tower-axum-matched-path"] }
```

<div id="configure">
  ## Configurar
</div>

Inicializa y configura el cliente de Sentry. Esto habilitará un conjunto de integraciones predeterminadas, como el informe de pánicos.
Luego, inicializa `axum` con el middleware de Sentry.

Este fragmento configura un servicio que siempre entra en pánico, para que puedas comprobar que todo funciona en cuanto lo pongas en marcha.

<Alert level="warning">
  Las macros como `#[tokio::main]` no son compatibles. El cliente de Sentry debe inicializarse antes de iniciar el runtime asíncrono, como se muestra a continuación.
</Alert>

```rust {filename:main.rs}
use axum::{body::Body, http::Request, routing::get, Router};
use sentry::integrations::tower::{NewSentryLayer, SentryHttpLayer};
use std::io;
use tower::ServiceBuilder;

async fn failing() -> () {
    panic!("¡Todo está en llamas!")
}

fn main() -> io::Result<()> {
    let _guard = sentry::init((
        "___PUBLIC_DSN___",
        sentry::ClientOptions {
            release: sentry::release_name!(),
            # ___PRODUCT_OPTION_START___ performance
            // Captura todas las trazas y spans. Establece un valor más bajo en producción
            traces_sample_rate: 1.0,
            # ___PRODUCT_OPTION_END___ performance
            // Captura IPs de usuarios y encabezados potencialmente sensibles al usar integraciones de servidor HTTP
            // consulta https://docs.sentry.io/platforms/rust/data-management/data-collected para más información
            send_default_pii: true,
            ..Default::default()
        },
    ));

    let app = Router::new().route("/", get(failing)).layer(
        ServiceBuilder::new()
            .layer(NewSentryLayer::<Request<Body>>::new_from_top()) // Vincula un nuevo Hub por solicitud para asegurar la correlación correcta entre error y solicitud
            # ___PRODUCT_OPTION_START___ performance
            .layer(SentryHttpLayer::new().enable_transaction()), // Inicia una transacción (span raíz de Sentry) para cada solicitud
            // Si vinculas las capas directamente en el `Router`, vincúlalas en el orden opuesto, de lo contrario podrías tener una fuga de memoria
            # ___PRODUCT_OPTION_END___ performance
    );

    tokio::runtime::Builder::new_multi_thread()
        .enable_all()
        .build()?
        .block_on(async {
            let listener = tokio::net::TcpListener::bind("127.0.0.1:3001")
                .await
                .unwrap();
            axum::serve(listener, app.into_make_service())
                .await
                .unwrap();
        });

    Ok(())
}
```

<div id="verify">
  ## Verificar
</div>

Envía una solicitud a la aplicación. Sentry capturará el pánico.

```bash
curl http://localhost:3001/
```

<Alert>
  Obtén más información sobre cómo capturar manualmente un error o un mensaje en nuestra <PlatformLink to="/usage/">documentación de uso</PlatformLink>.
</Alert>

Para ver y resolver el pánico registrado, inicia sesión en [sentry.io](https://sentry.io) y selecciona tu proyecto. Ve a Issues y luego a Errors &amp; Outages en la barra lateral, donde encontrarás la incidencia recién creada. Al hacer clic en el título de la incidencia se abrirá una página donde podrás ver información detallada y marcarla como resuelta.
