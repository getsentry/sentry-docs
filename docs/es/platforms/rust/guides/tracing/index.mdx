---
title: tokio-rs/tracing
description: "Aprende a monitorear tu aplicación Rust con la integración tokio-rs/tracing de Sentry."
---

El SDK de Sentry ofrece una integración para el ecosistema [tracing](https://github.com/tokio-rs/tracing) de tokio que permite:

- Enviar eventos de `tracing` a Sentry como eventos, breadcrumbs o logs.
- Enviar spans de `tracing` a Sentry.
- Reportar errores y pánicos con la correlación de trazas correcta.

<div id="install">
  ## Instalación
</div>

<OnboardingOptionButtons options={["error-monitoring", "performance", "logs"]} />

Para integrar Sentry con `tracing` en tu proyecto de Rust, agrega las dependencias necesarias a tu `Cargo.toml`:

```toml {filename:Cargo.toml}
[dependencies]
tracing = "0.1.41"
tracing-subscriber = "0.3.19"
sentry = { version = "{{@inject packages.version('sentry.rust') }}", features = [
  "tracing",
  # ___PRODUCT_OPTION_START___ logs
  "logs",
  # ___PRODUCT_OPTION_END___ logs
] }
tokio = { version = "1.45.0", features = ["full"] }
```


<div id="configure">
  ## Configuración
</div>

Inicializa el SDK de Sentry y registra la capa de Sentry para empezar a enviar eventos y spans de `tracing` a Sentry:

<Alert level="warning">
  No se admiten macros como `#[tokio::main]` y `#[actix_web::main]`. El cliente de Sentry debe inicializarse antes de que se inicie el runtime asíncrono, como se muestra a continuación.
</Alert>

```rust
use tracing_subscriber::prelude::*;

fn main() {
    // Inicializar Sentry
    let _guard = sentry::init((
        "___PUBLIC_DSN___",
        sentry::ClientOptions {
            release: sentry::release_name!(),
            # ___PRODUCT_OPTION_START___ performance
            // Captura todas las trazas y spans. Usa un valor más bajo en producción
            traces_sample_rate: 1.0,
            # ___PRODUCT_OPTION_END___ performance
            # ___PRODUCT_OPTION_START___ logs
            enable_logs:true
            # ___PRODUCT_OPTION_END___ logs
            ..sentry::ClientOptions::default()
        },
    });

    // Registrar la capa de tracing de Sentry
    tracing_subscriber::registry()
        .with(tracing_subscriber::fmt::layer())
        .with(sentry::integrations::tracing::layer())
        .init();

    tokio::runtime::Builder::new_multi_thread()
        .enable_all()
        .build()?
        .block_on(async {
            // Los Futures deben estar vinculados a un Hub
            // Más información en https://docs.rs/sentry-core/latest/sentry_core/#parallelism-concurrency-and-async
            fail().bind_hub(sentry::Hub::current()).await;
        });
}

# ___PRODUCT_OPTION_START___ performance
#[tracing::instrument] // Captura un span raíz (transacción) alrededor de la ejecución de esta función
# ___PRODUCT_OPTION_END___ performance
async fn fail() {
    tracing::debug!("Haciendo trabajo"); // Añade un breadcrumb
    # ___PRODUCT_OPTION_START___ performance
    let _span = tracing::info_span("Span hijo").entered(); // Captura un span hijo
    # ___PRODUCT_OPTION_END___ performance
    tracing::error!("¡Todo está en llamas!");
}
```

De forma predeterminada, los eventos de nivel error de `tracing` se capturan como eventos de Sentry, mientras que los eventos de nivel info o superior se añaden al ámbito actual como breadcrumbs.

Además, si el feature flag `logs` del crate `sentry` está habilitado y el SDK se inicializa con `enable_logs: true`, entonces los eventos de `tracing` de nivel info o superior también se capturan como [logs estructurados](https://docs.sentry.io/product/explore/logs/).

Este comportamiento se puede personalizar aplicando un `event_filter` personalizado al crear la capa.
El siguiente fragmento muestra el `event_filter` predeterminado que se aplica al usar el crate `sentry` con el feature flag `logs`.

```rust
use sentry::integrations::tracing::EventFilter;

let sentry_layer =
    sentry::integrations::tracing::layer().event_filter(|md| match *md.level() {
        // Captura eventos de nivel error y warn como registros y eventos en Sentry
        tracing::Level::ERROR => EventFilter::Event | EventFilter::Log,
        // Ignora eventos de nivel trace, ya que son demasiado verbosos
        tracing::Level::TRACE => EventFilter::Ignore,
        // Captura todo lo demás como breadcrumb y registro
        _ => EventFilter::Breadcrumb | EventFilter::Log,
    });
```


<div id="verify">
  ## Verificar
</div>

<Alert>

Obtén más información sobre cómo capturar manualmente un error o mensaje en nuestra <PlatformLink to="/usage/">documentación de uso</PlatformLink>.

</Alert>

Para ver y resolver el error registrado, inicia sesión en [sentry.io](https://sentry.io) y selecciona tu proyecto. Elige Issues y luego Errors & Outages en la barra lateral, donde encontrarás el issue recién creado. Al hacer clic en el título del issue, se abrirá una página donde podrás ver información detallada y marcarlo como resuelto.

Si estás usando tracing (la función de Sentry), puedes ver los traces y spans registrados seleccionando Explore y luego Traces en la barra lateral.

Si estás usando logs, puedes ver los logs registrados seleccionando Explore y luego Logs en la barra lateral.