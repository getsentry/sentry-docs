---
title: Instrumentación incluida
sidebar_order: 20
description: "Descubre qué transacciones se capturan después de habilitar el tracing."
---

<Alert>
  Para capturar transacciones, primero debes <PlatformLink to="/tracing/">configurar el tracing</PlatformLink> si aún no lo has hecho. También necesitarás habilitar la <PlatformLink to="/">integración básica de Sentry</PlatformLink>.
</Alert>

La integración de ASP.NET, una vez habilitada, captura cada solicitud HTTP entrante y la convierte en una transacción con la ayuda de un middleware personalizado. Para habilitar el tracing en ASP.NET, debes actualizar tu archivo `Global.asax.cs` de la siguiente manera:

```csharp
using System;
using System.Configuration;
using System.Web.Mvc;
using System.Web.Routing;
using Sentry.AspNet;

namespace AspNetMvc
{
    public class MvcApplication : System.Web.HttpApplication
    {
        private IDisposable _sentry;

        protected void Application_Start()
        {
            // Configura el SDK de Sentry
            _sentry = SentrySdk.Init(o =>
            {
                // Guardamos el DSN en Web.config; ¡asegúrate de usar tu propio DSN!
                o.Dsn = ___PUBLIC_DSN___

                // Habilita la integración con ASP.NET
                o.AddAspNet();

                // Al configurar por primera vez, para ver qué hace el SDK:
                o.Debug = true;

                // Agrega la URL y los encabezados de la solicitud, la IP y el nombre de los usuarios, etc.
                o.SendDefaultPii = true;

                // Ejemplo de tasa de muestreo para tus transacciones: captura el 10% de las transacciones
                o.TracesSampleRate = 0.1;
            });
        }

        // Captura global de errores
        protected void Application_Error() => Server.CaptureLastError();

        protected void Application_End()
        {
            // Cierra el SDK de Sentry (envía a Sentry los eventos en cola)
            _sentry?.Dispose();
        }

        protected void Application_BeginRequest()
        {
            // Inicia una transacción que abarque la solicitud actual
            Context.StartSentryTransaction();
        }

        protected void Application_EndRequest()
        {
            Context.FinishSentryTransaction();
        }
    }
}
```

Los nombres de las transacciones siguen el patrón `<HTTP method> <Route>`; por ejemplo, una solicitud a la siguiente acción creará una transacción llamada `GET /person/{id}`:

```csharp
using System;
using System.Web.Mvc;

public class HomeController : Controller
{
    [HttpGet("/person/{id}")]
    public ActionResult Person(string id) { /* ... */ }
}
```

Las transacciones creadas por esta integración se añaden automáticamente al ámbito actual. Si quieres iniciar tus propios spans a partir de la transacción creada automáticamente, puedes usar el siguiente enfoque:

```csharp
using System;
using System.Web.Mvc;

public class HomeController : Controller
{
    [HttpGet("/person/{id}")]
    public ActionResult Person(string id)
    {
        var childSpan = SentrySdk.GetSpan()?.StartChild("additional-work");
        try
        {
            // Realiza el trabajo que se va a medir.

            childSpan?.Finish(SpanStatus.Ok);
        }
        catch (Exception e)
        {
            childSpan?.Finish(e);
            throw;
        }
    }
}
```
