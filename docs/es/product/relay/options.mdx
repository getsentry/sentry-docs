---
title: Opciones de configuración
description: "Configura Relay para adaptarlo a las necesidades de tu organización."
sidebar_order: 3
---

La configuración de Relay suele guardarse en el archivo `.relay/config.yml` (relativo al directorio de trabajo). Las opciones de configuración pueden sobrescribirse mediante variables de entorno. Para cambiar la ubicación del archivo de configuración, pasa la opción `--config` a cualquier comando de Relay:

```shell
❯ ./relay run --config /ruta/a/carpeta
```

Todas las claves de configuración usan `snake_case`.

<div id="credentials">
  ## Credenciales
</div>

Las credenciales pueden iniciarse como se describe en la [página de introducción](/es/product/relay/getting-started/), pero pueden anularse configurando las siguientes variables de entorno:

* Clave secreta: `RELAY_SECRET_KEY`.
* Clave pública: `RELAY_PUBLIC_KEY`.
* ID: `RELAY_ID`.

<div id="relay">
  ## Relay
</div>

| key                        | type    | value                                                                                         | description                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| -------------------------- | ------- | --------------------------------------------------------------------------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| relay.mode                 | String  | default value: `managed` possible values: `managed, proxy` optional: `false` | Controla cómo Relay obtiene la configuración del proyecto para los eventos. Para una explicación detallada de estos modos, consulta [Relay Modes](/es/product/relay/modes/). `Variable de entorno: "RELAY_MODE".`                                                                                                                                                                                                                                   |
| relay.upstream             | String  | default value: `https://sentry.io` optional: `false`                                          | URL totalmente cualificada del Relay ascendente o de la instancia de Sentry. `Variable de entorno: "RELAY_UPSTREAM_URL".` <Alert level="warning" title="Importante"> Relay no comprueba ciclos. No configures esta opción con un endpoint que haga que los eventos vuelvan a circular hasta aquí. </Alert>                                                                                                                                        |
| relay.host                 | String  | default value: `0.0.0.0  in Docker, otherwise  127.0.0.1` optional: `false`                   | El host al que debe enlazarse Relay (interfaz de red). `Variable de entorno: "RELAY_HOST".`                                                                                                                                                                                                                                                                                                                                                     |
| relay.port                 | Integer | default value: `3000` optional: `false`                                                       | El puerto al que debe enlazarse Relay para el servidor HTTP de Relay sin cifrar. `Variable de entorno: "RELAY_PORT".`                                                                                                                                                                                                                                                                                                                           |
| relay.override&#95;project&#95;ids | Boolean | optional: `true`                                                                              | Sobrescribe los identificadores de proyecto indicados en los DSN del cliente con el identificador usado en el Sentry ascendente. De forma predeterminada, Relay rechaza los datos cuando hay una discrepancia en el ID de proyecto. Establece esta opción en `true` cuando Relay redirige tráfico a una instancia de Sentry migrada, como al pasar de self-hosted a Sentry SaaS. La validación de identificadores de proyecto puede omitirse con seguridad en estos casos y puedes seguir usando los DSN anteriores en tus servicios. |

<div id="http">
  ## HTTP
</div>

Estos ajustes controlan las configuraciones relacionadas con la red.

| key                     | type    | value           | description                                                                                                                                                                                                                                 |
| ----------------------- | ------- | --------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| http.timeout            | Integer | default: `5`    | Tiempo de espera para solicitudes al upstream en segundos. Este tiempo de espera abarca desde que se envía una solicitud hasta que se reciben los encabezados de la respuesta. No cubre el proceso de conexión, los handshakes ni la lectura del cuerpo de la respuesta.   |
| http.connection&#95;timeout | Integer | default: `3`    | Tiempo de espera para establecer conexiones con el upstream en segundos. Relay reutiliza las conexiones cuando el upstream admite keep-alive. Las conexiones se mantienen como máximo durante 75 segundos de actividad o 15 segundos de inactividad. |
| http.max&#95;retry&#95;interval | Integer | default: `60`   | Intervalo máximo entre reintentos de solicitudes fallidas, en segundos.                                                                                                                                                                      |
| http.host&#95;header        | String  | default: `null` | Encabezado HTTP Host personalizado que se enviará al upstream.                                                                                                                                                                              |

<div id="caching">
  ## Caché
</div>

Estos ajustes perfeccionan la caché de los estados del proyecto.

| key                        | type    | value                             | description                                                                                                                                                                                                                                         |
| -------------------------- | ------- | --------------------------------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| cache.project&#95;expiry       | Integer | default: `300 (5 minutes)`        | El tiempo de expiración de la caché para las configuraciones del proyecto, en segundos. No aplica si usas el “simple proxy mode”, donde la configuración del proyecto se almacena en archivos locales.                                              |
| cache.project&#95;grace&#95;period | Integer | default: `0 (seconds)`            | Los segundos durante los cuales puedes seguir usando esta configuración del proyecto tras expirar la caché mientras se obtiene un nuevo estado. Esto se suma a `cache.project_expiry` y `cache.miss_expiry`.                                        |
| cache.relay&#95;expiry         | Integer | default: `3600 (1 hour)`          | El tiempo de expiración de la caché para la información de Relay downstream (claves públicas), en segundos. Solo es relevante si piensas conectar más Relays a este.                                                                                |
| cache.envelope&#95;expiry      | Integer | default: `600 (10 minutes)`       | El tiempo máximo que Relay mantiene en búfer las cargas entrantes en su caché en caso de problemas de red o acumulaciones. Aplica a todo tipo de datos enviados a Relay, incluidos eventos, adjuntos y sesiones. Consulta también `cache.envelope_buffer_size`. |
| cache.miss&#95;expiry          | Integer | default: `60 (1 minute)`          | El tiempo de expiración de la caché para entradas inexistentes.                                                                                                                                                                                     |
| cache.batch&#95;interval       | Integer | default: `100 (100 milliseconds)` | El tiempo de espera del búfer para consultas por lotes antes de enviarlas upstream, en milisegundos.                                                                                                                                                |
| cache.batch&#95;size           | Integer | default: `500`                    | El número máximo de configuraciones de proyecto que se obtendrán de Sentry a la vez.                                                                                                                                                                |
| cache.file&#95;interval        | Integer | default: `10 (10 seconds)`        | El intervalo, en segundos, para vigilar archivos locales que sobrescriben la caché.                                                                                                                                                                 |
| cache.envelope&#95;buffer&#95;size | Integer | default: `1000`                   | El número máximo de cargas entrantes que se mantienen en búfer si hay problemas de red o acumulaciones. Aplica a todo tipo de datos enviados a Relay, incluidos eventos, adjuntos y sesiones. Consulta también `cache.envelope_expiry`.            |
| cache.eviction&#95;interval    | Integer | default: `60 (seconds)`           | El intervalo para desalojar de la memoria las configuraciones de proyecto obsoletas.                                                                                                                                                                |

<div id="spooling">
  ## Spooling
</div>

| key                             | type    | value            | description                                                                                                                                                                                                                     |
| ------------------------------- | ------- | ---------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| spool.envelopes.path            | String  | default: `null`  | La ruta al archivo de spool utilizado para guardar sobres en el disco. Si se especifica, habilita el spooling en disco. Relay creará la estructura de directorios si es necesario. Ten en cuenta que `~` se interpreta literalmente y no como el directorio personal. |
| spool.envelopes.max&#95;memory&#95;size | String  | default: `500MB` | El tamaño máximo del búfer en memoria para sobres entrantes. El búfer se pasará al disco cuando se alcance el tamaño configurado.                                                                                               |
| spool.envelopes.max&#95;disk&#95;size   | String  | default: `500MB` | El tamaño máximo del spool en disco.                                                                                                                                                                                             |
| spool.envelopes.max&#95;connections | Integer | default: `20`    | El número máximo de conexiones en el pool para gestionar el spooling en disco.                                                                                                                                                  |
| spool.envelopes.min&#95;connections | Integer | default: `10`    | El número mínimo de conexiones en el pool para gestionar el spooling en disco.                                                                                                                                                  |

<div id="size-limits">
  ## Límites de tamaño
</div>

Estos ajustes controlan límites relacionados con HTTP. Todos los valores son enteros o cadenas legibles por personas que combinan un número con una unidad, por ejemplo:

* `500B`
* `1kB` (*1.000* bytes)
* `1KB` o `1KiB` (*1.024* bytes)
* `1MB` (*1.000.000* bytes)
* `1MiB` (*1.048.576* bytes)

| key                              | type    | value                     | description                                                                                                                                                                                                                                                                                                            |
| -------------------------------- | ------- | ------------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| limits.max&#95;concurrent&#95;requests   | Integer | default: `100`            | Número máximo de conexiones simultáneas con el upstream. Si el upstream lo admite, Relay mantiene la conexión activa (keep-alive).                                                                                                                                                                                    |
| limits.max&#95;concurrent&#95;queries    | Integer | default: `5`              | Número máximo de consultas que se pueden enviar simultáneamente desde Relay al upstream antes de que Relay empiece a poner en cola las solicitudes. Las consultas son todas las solicitudes realizadas al upstream para obtener información y excluyen explícitamente el envío de eventos. La concurrencia de consultas también está limitada por `max_concurrent_requests`. |
| limits.max&#95;event&#95;size            | String  | default: `1MiB`           | Tamaño máximo de la carga útil para eventos.                                                                                                                                                                                                                                                                           |
| limits.max&#95;attachment&#95;size       | String  | default: `100MiB`          | Tamaño máximo de un adjunto.                                                                                                                                                                                                                                                                                           |
| limits.max&#95;attachments&#95;size      | String  | default: `100MiB`          | Tamaño máximo combinado de todos los adjuntos en un sobre o solicitud.                                                                                                                                                                                                                                                |
| limits.max&#95;envelope&#95;size         | String  | default: `100MiB`          | Tamaño máximo de la carga útil para un sobre completo. Siguen aplicándose los límites individuales.                                                                                                                                                                                                                   |
| limits.max&#95;session&#95;count         | Integer | default: `100`            | Número máximo de elementos de sesión por sobre.                                                                                                                                                                                                                                                                        |
| limits.max&#95;api&#95;payload&#95;size      | String  | default: `20MiB`          | Tamaño máximo de la carga útil para solicitudes generales de la API.                                                                                                                                                                                                                                                   |
| limits.max&#95;api&#95;file&#95;upload&#95;size  | String  | default: `40MiB`          | Tamaño máximo de la carga útil para subidas de archivos y fragmentos.                                                                                                                                                                                                                                                  |
| limits.max&#95;api&#95;chunk&#95;upload&#95;size | String  | default: `100MiB`         | Tamaño máximo de la carga útil para fragmentos.                                                                                                                                                                                                                                                                        |
| limits.max&#95;thread&#95;count          | Integer | default: `number of cpus` | Número máximo de hilos creados por cada CPU y trabajador web. El número total de hilos creados será aproximadamente `2 * limits.max_thread_count + N`, donde `N` es un conjunto fijo de hilos de gestión.                                                                                                              |
| limits.query&#95;timeout             | Integer | default: `30 (seconds)`   | Número máximo de segundos que puede tardar una consulta, incluidos los reintentos. Las solicitudes individuales tienen tiempos de espera menores.                                                                                                                                                                      |
| limits.shutdown&#95;timeout          | Integer | default: `10 (seconds)`   | Número máximo de segundos que tendrás que esperar por eventos pendientes tras recibir una señal de apagado. `Environment variable: "SHUTDOWN_TIMEOUT".`                                                                                                                                                                 |

<div id="logging">
  ## Registro
</div>

| key                         | type    | value                                                                   | description                                                                                                                                                                                                                             |
| --------------------------- | ------- | ----------------------------------------------------------------------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| logging.level               | String  | default: `info` possible values: `off, error, warn, info, debug, trace`. | El nivel de registro para Relay. <Alert level="warning" title="Advertencia"> En los niveles `debug` y `trace`, Relay emite mensajes extremadamente detallados que pueden afectar gravemente el rendimiento de la aplicación. </Alert>. Variable de entorno: &quot;RELAY&#95;LOG&#95;LEVEL&quot; |
| logging.format              | String  | default: `auto` possible values: `auto, pretty, simplified, json`       | Controla el formato del registro. `auto`: detección automática (pretty para TTY, simplified para otros) `pretty`: formato legible con colores `simplified`: salida de registro simplificada y legible `json`: registros en JSON, adecuados para software de registro |
| logging.enable&#95;backtraces   | Boolean | default: `true`                                                         | Escribe trazas inversas (backtraces) de todos los errores internos en el flujo de registro y las incluye en los errores de Sentry.                                                                                                      |

<div id="statsd-metrics">
  ## Métricas de StatsD
</div>

| key                  | type                      | value                   | description                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| -------------------- | ------------------------- | ----------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| metrics.statsd       | String                    | optional: `true`        | Si se configura con una cadena host/puerto, las métricas se enviarán a esa instancia de StatsD.                                                                                                                                                                                                                                                                                                                                                                   |
| metrics.prefix       | String                    | default: `sentry.relay` | Prefijo que se añadirá a todas las métricas.                                                                                                                                                                                                                                                                                                                                                                                                                       |
| metrics.default&#95;tags | Map of strings to strings | default: `empty`        | Conjunto de etiquetas predeterminadas que se adjuntarán a todas las métricas salientes de StatsD.                                                                                                                                                                                                                                                                                                                                                                 |
| metrics.hostname&#95;tag | String                    | optional: `true`        | Si se establece, añade una etiqueta con el nombre indicado y la asigna al nombre de host de la máquina que ejecuta Relay. Esta configuración es útil para distinguir múltiples instancias de Relay.                                                                                                                                                                                                                                                                |
| metrics.buffering    | Boolean                   | default: `true`         | Indica si las métricas emitidas se almacenarán en búfer antes de enviarlas al servidor de StatsD. Esto generalmente mejora el rendimiento, pero conlleva que, con poco volumen de tráfico, las métricas puedan tardar algunos segundos más en propagarse.                                                                                                                                                                                                          |
| metrics.sample&#95;rate  | Float                     | default: `1.0`          | Tasa de muestreo global para todas las métricas emitidas. Debe estar entre 0.0 y 1.0. Si está fuera de ese rango, el valor se normalizará (los valores negativos se convertirán en 0.0 y los mayores que 1.0 se convertirán en 1.0). Por ejemplo, un valor de 0.3 significa que solo se enviará el 30% de las métricas emitidas. Ten en cuenta que el método de muestreo implementado no tiene en cuenta el tipo de métrica. Por ejemplo, no reescalará los contadores cuando la tasa de muestreo sea inferior a 1.0. |

<div id="internal-error-reporting">
  ## Reporte interno de errores
</div>

Configura el reporte de errores que ocurren dentro de Relay. Desactivado de forma predeterminada.

| key            | type    | value            | description                                                                                                                                                                                                                 |
| -------------- | ------- | ---------------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| sentry.enabled | Boolean | default: `false` | Determina si se deben reportar errores internos a un DSN independiente. `false` significa que no se enviarán errores internos, pero sí se registrarán en los logs.                                                         |
| sentry.dsn     | String  | optional: `true` | DSN de Sentry al que puedes reportar fallos internos de Relay. Recomendamos configurarlo con un valor que envíe los errores de Relay directamente a Sentry en lugar de enviarlos primero a sí mismo.                        |

<div id="geoip">
  ## GeoIP
</div>

De forma predeterminada, Relay no incluye información de ubicación geográfica en los eventos. Define la ruta del archivo de la base de datos de MaxMind para agregar información de GeoIP a los eventos.

| clave      | tipo   | valor           | descripción                                                                                                              |
| ---------- | ------ | --------------- | ------------------------------------------------------------------------------------------------------------------------ |
| geoip.path | String | default: `null` | Ruta al archivo de la base de datos MaxMind GeoIP City. Cuando se configure, se añadirá información adicional de GeoIP a los eventos. |