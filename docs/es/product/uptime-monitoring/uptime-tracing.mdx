---
title: Trazado distribuido con Uptime
sidebar_order: 52
description: Aprende a usar el trazado distribuido para solucionar caídas.
og_image: /og-images/product-uptime-monitoring-uptime-tracing.png
---

El monitoreo de Uptime de Sentry usa [trazado distribuido](/es/product/tracing/#whats-distributed-tracing) para seguir el flujo y el tiempo de las solicitudes y operaciones durante las comprobaciones de disponibilidad. Esto te ayuda a encontrar rápidamente la causa raíz de una caída al conectar errores relacionados y datos de rendimiento.

Cuando se realizan comprobaciones de disponibilidad, Sentry crea un **trazado** que muestra el ciclo de vida completo de la solicitud. Este trazado contiene:

* **Spans de solicitud de Uptime**: Un [conjunto predeterminado de spans raíz](/es/product/uptime-monitoring/#uptime-request-spans) que identifica esto como una comprobación de disponibilidad
* **Spans de la aplicación**: Operaciones individuales como consultas a la base de datos, llamadas a API y operaciones de caché, configuradas mediante trazado distribuido
* **Eventos de error**: Cualquier excepción o fallo que ocurra durante la solicitud

El **trazado de errores** captura cuándo algo sale mal, mientras que el **trazado de spans** muestra el rendimiento y el flujo de las operaciones. Juntos, brindan visibilidad completa de por qué falló una comprobación de disponibilidad. El trazado de spans está deshabilitado de forma predeterminada para las comprobaciones de Uptime, pero se puede habilitar permitiendo el muestreo en tu [configuración de alertas de Uptime](/es/product/alerts/create-alerts/uptime-alert-config/). Los errores más spans se enfocan en los problemas, mientras que el monitoreo de Uptime más spans se enfoca en el rendimiento.

<div id="how-uptime-tracing-works">
  ## Cómo funciona Uptime Tracing
</div>

Sentry Uptime Tracing agrega automáticamente un header `sentry-trace` a cada solicitud saliente realizada a la URL definida en la configuración de tu Uptime Alert. Este header propaga un identificador de traza.

Si uno de los SDK de backend compatibles de Sentry está configurado para la aplicación que maneja la solicitud de verificación de disponibilidad entrante, la traza continuará a través de tu aplicación. Obtén más información sobre [cómo funciona el tracing distribuido](/es/product/tracing/).

Ejemplo de solicitud de verificación de Uptime:

```HTTP
GET /example-uptime-endpoint HTTP/1.1
Host: sentry.io
User-Agent: SentryUptimeBot/1.0 (+http://docs.sentry.io/product/uptime-monitoring/)
Sentry-Trace: 32d4011600324838afcd666edadc1d09-8d5ca7419a02ca36
```

<div id="tracing-errors">
  ## Rastreo de errores
</div>

El rastreo de errores está habilitado de forma predeterminada para las comprobaciones de disponibilidad (uptime). Cuando se detecta inactividad, se crea un [Uptime Issue](/es/product/issues/issue-details/uptime-issues/). Luego puedes ir a la página [**Trace Explorer**](/es/product/explore/traces/) de Sentry para ver cualquier error relacionado.

Como las solicitudes de disponibilidad no sustituyen la tasa de muestreo de errores de tu SDK, es posible que algunos errores no aparezcan en los rastreos si esa tasa está configurada por debajo de 1.

<Expandable permalink title="Deshabilitar el rastreo de errores de Uptime">
  Para deshabilitar el rastreo de errores para las comprobaciones de disponibilidad, configura un filtro [before send](/es/platform-redirect/?next=/configuration/filtering/) en tu SDK para ignorar los errores cuyo `User-Agent` sea el de Sentry. Aquí tienes un ejemplo:

  ```typescript {tabTitle: Node.js Express} {filename: instrument.mjs}
  import * as Sentry from "@sentry/node";

  Sentry.init({
    dsn: "___PUBLIC_DSN___",
    // Filtering example for a Node.js Express app
    beforeSend(event) {
      const userAgent = event.request?.headers?.["user-agent"];

      // Ignore events captured in a request from SentryUptimeBot
      if (userAgent && userAgent.includes("SentryUptimeBot")) {
        return null;
      }

      // Process other events
      return event;
    },
  });
  ```
</Expandable>

<div id="tracing-spans">
  ## Trazas de spans
</div>

Hay dos conjuntos de spans disponibles para las comprobaciones de disponibilidad (uptime):

1. **Spans de solicitud de uptime**. Sentry los crea automáticamente para cada solicitud de comprobación de disponibilidad. Puedes encontrarlos como la raíz del trace de cualquier incidencia de disponibilidad.
2. **Spans de aplicación**. Son spans configurados mediante trazabilidad distribuida. Puedes encontrarlos como hijos de los spans de solicitud de uptime.

A diferencia del rastreo de errores, el rastreo de spans que configuras está **deshabilitado** de forma predeterminada para las comprobaciones de disponibilidad, pero se puede habilitar permitiendo el muestreo en tu [configuración de alertas de uptime](/es/product/alerts/create-alerts/uptime-alert-config/). Habilitar el rastreo de spans puede ser útil porque ofrece una vista detallada del tiempo y el flujo de solicitudes y operaciones durante las comprobaciones de disponibilidad, lo cual es especialmente útil para diagnosticar timeouts o problemas de rendimiento.

<div id="enabling-uptime-tracing-for-spans">
  ### Habilitar el rastreo de Uptime para spans
</div>

Para habilitar el rastreo de spans, modifica la configuración de tu Uptime Alert con la opción &quot;Allow Sampling&quot;. Esto hará que Sentry delegue la decisión de muestreo a tu SDK, que seguirá la tasa de muestreo de trazas que hayas configurado.

Como las solicitudes de uptime no reemplazarán la tasa de muestreo de errores de tu SDK, algunos errores pueden no aparecer en las trazas si esa tasa está por debajo de 1.

![Configuración de Allow Sampling en Uptime Alert](./img/allow-sampling-new.png)

<Alert>
  Los spans de solicitudes de uptime siempre estarán activos, incluso si el muestreo está deshabilitado. Los spans de solicitudes de uptime son gratuitos y no contarán para tu [cuota de spans](/es/pricing/quotas/manage-transaction-quota/).
</Alert>

<div id="custom-sampling">
  ### Muestreo personalizado
</div>

Para asegurarte de que se muestre(n) todos los spans de las verificaciones de uptime, incluso si la tasa de muestreo de trazas de tu SDK es inferior a 1, puedes configurar una [función de muestreo](/es/platform-redirect/?next=/configuration/sampling/). Aquí tienes un ejemplo:

```typescript {tabTitle: Node.js Express} {filename: instrument.mjs}
import * as Sentry from "@sentry/node";

Sentry.init({
  dsn: "___PUBLIC_DSN___",
  // Función de muestreo personalizada para una app de Node.js con Express
  tracesSampler: ({ name, attributes, parentSampled }) => {
    const userAgent = attributes?.["http.user_agent"];

    if (
      typeof userAgent === "string" &&
      userAgent.includes("SentryUptimeBot")
    ) {
      // Muestra el 100% de los spans de SentryUptimeBot
      return 1;
    }

    // Muestra el 50% de los demás spans
    return 0.5;
  },
});
```

<div id="billing-considerations">
  ## Consideraciones de facturación
</div>

Los errores y spans capturados durante las comprobaciones de disponibilidad se [facturan como eventos normales](https://sentry.io/pricing/) en Sentry. Configura el muestreo con criterio para controlar los costos.