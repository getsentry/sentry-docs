---
title: E/S de archivos en el hilo principal
sidebar_order: 20
description: >-
  Obtén más información sobre la E/S de archivos en el hilo principal y cómo
  diagnosticar y solucionar estos problemas.
og_image: >-
  /og-images/product-issues-issue-details-performance-issues-file-main-thread-io.png
---

El hilo principal de la interfaz de usuario en una aplicación móvil gestiona eventos de la interfaz como pulsaciones de botones y desplazamientos de página. Para evitar bloqueos de la app y errores de “la aplicación no responde” (ANR), no se debe usar el hilo principal de la UI para realizar operaciones de larga duración, como la E/S de archivos. Este tipo de operaciones bloquea toda la interfaz hasta que terminan y dificultan la interacción de la persona usuaria con la app.

<div id="detection-criteria">
  ## Criterios de detección
</div>

El detector de este problema de rendimiento calcula la duración total no superpuesta de los spans de E/S de archivos. Si supera los 16 ms, se crea un problema de rendimiento.

Puedes configurar los umbrales del detector para E/S de archivos en problemas del hilo principal en **Project Settings > Performance**:

![Configuración del umbral del detector de E/S de archivos en el hilo principal](./img/file-main-thread-io-detector-settings.png)

<div id="span-evidence">
  ## Evidencia de spans
</div>

La evidencia de spans identifica la causa raíz del problema de File I/O en el hilo principal mostrando tres aspectos principales:

- Nombre de la transacción
- Span padre: dónde ocurrieron los spans de I/O de archivos
- Span problemático: los spans que realmente están realizando I/O de archivos en el hilo principal

![Evidencia de spans de File I/O](./img/file-io.png)

Consúltala yendo a la página de **Issues** en Sentry, seleccionando tu proyecto de Android, haciendo clic en el error de I/O de archivos que quieras examinar y luego desplazándote hasta la sección "Span Evidence" en la pestaña "Details".

<div id="example">
  ## Ejemplo
</div>

Aquí tienes dos ejemplos de cómo puede aparecer un error de E/S de archivos en tu código si usas Swift o Kotlin y cómo podrías solucionarlos.

Esto es lo que podrías ver al abrir un archivo para obtener su contenido si usas Swift:

```swift
if let path = Bundle.main.path(forResource: "LoremIpsum", ofType: "txt") {
    let content = String(contentsOfFile: path)
    label.text = content
}
```

Para resolver este problema de rendimiento, puedes usar una cola de despacho:

```swift
let dispatchQueue = DispatchQueue(label: "ViewController", attributes: .concurrent) {
    dispatchQueue.async {
        if let path = Bundle.main.path(forResource: "LoremIpsum", ofType: "txt") {
            let content = String(contentsOfFile: path)
                DispatchQueue.main.async {
                    label.text = content
                }
        }
    }
}
```

Esto es lo que podrías ver si usas Kotlin:

```kotlin
val archivo = File(context.cacheDir, "LoremIpsum.txt")
val contenido = archivo.readText()
```

Para resolver este problema de rendimiento, puedes inicializar otro hilo para leer el archivo en su lugar.

```kotlin
suspend fun readFile(): String = withContext(Dispatchers.IO) {
    val file = File(context.cacheDir, "LoremIpsum.txt")
    val content = file.readText()
    return content
}
```
