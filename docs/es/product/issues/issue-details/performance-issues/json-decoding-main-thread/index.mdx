---
title: Decodificación de JSON en el hilo principal
sidebar_order: 30
description: >-
  Obtén más información sobre los problemas de decodificación de JSON en el hilo principal y cómo diagnosticarlos y solucionarlos.
og_image: >-
  /og-images/product-issues-issue-details-performance-issues-json-decoding-main-thread.png
---

El hilo principal (o de la interfaz) de una app móvil se encarga de manejar toda la interacción del usuario y debe poder responder a gestos y toques en tiempo real. Si una operación de larga duración bloquea el hilo principal, la app queda sin respuesta, lo que impacta la calidad de la experiencia de usuario.

El proceso de decodificar un blob JSON en una estructura de datos es un ejemplo de operación de larga duración que puede afectar la capacidad de respuesta de la app. Si se detecta una decodificación de JSON prolongada en el hilo principal, Sentry la marcará como un problema.

La decodificación de un blob JSON en una estructura de datos puede ser una operación prolongada, especialmente con blobs grandes. Este tipo de problema se crea cuando detectamos una decodificación de JSON de larga duración en el hilo principal.

<div id="detection-criteria">
  ## Criterios de detección
</div>

[Profiling](/es/product/explore/profiling/) debe estar habilitado para que Sentry detecte problemas de decodificación de JSON en el hilo principal. Sentry busca funciones relacionadas con la decodificación de JSON que hayan estado ejecutándose en el hilo principal durante al menos 40 ms. Este umbral garantiza que la función aparezca en un número suficiente de muestras recopiladas por el perfil (~10 ms por muestra × 4 = ~40 ms en total) antes de que se detecte como un problema.

<div id="function-evidence">
  ## Evidencia de función
</div>

Para encontrar información adicional sobre tu problema de JSON Decoding on Main Thread, ve a la página de **Issue Details** y desplázate hasta la sección &quot;Evidencia de función&quot;, que muestra lo siguiente:

* **Transaction Name:** El nombre de la transacción en la que se detectó el problema.
* **Suspect function:** La función que provocó la detección del problema (en este caso, una función de decodificación de JSON).
* **Duration:** El tiempo que tardó la función en ejecutarse y la cantidad de muestras consecutivas recopiladas por el generador de perfiles que la contenían.

![Evidencia de función de JSON Decoding on Main Thread](./img/json-decoding-function-evidence.png)

Para ver el perfil completo asociado con el problema, haz clic en el botón “View Profile”.

El perfil indicará desde dónde se llamó a la función sospechosa, junto con otras funciones llamadas *por* la función sospechosa:

![Perfil de JSON Decoding on Main Thread](./img/json-decoding-profile.png)

<div id="stack-trace">
  ## Trazas de pila
</div>

La sección “Trazas de pila” muestra una traza completa de la pila desde donde se llamó a la función detectada de decodificación de JSON:

![Trazas de pila de decodificación de JSON en el hilo principal](./img/json-decoding-stack-trace.png)

<div id="example">
  ## Ejemplo
</div>

<div id="ios">
  ### iOS
</div>

El siguiente código actualiza una vista llamando a `JSONDecoder.decode<T>` para decodificar JSON en el hilo principal:

```swift
func updatePersonView(json: Data) throws {
  personView.person = try JSONDecoder().decode(Person.self, from: json)
}
```

Se podría mejorar el rendimiento moviendo la decodificación de JSON a una cola en segundo plano:

```swift
func updatePersonView(json: Data) {
	DispatchQueue.global(qos: .userInitiated).async {
    do {
			let person = try JSONDecoder().decode(Person.self, from: json)
			DispatchQueue.main.async {
				personView.person = person
			}
    catch let error {
			print(error) // manejar el error
    }
	}
}
```

<div id="android">
  ### Android
</div>

El siguiente código actualiza una vista llamando a `Gson.fromJson()` para decodificar JSON en el hilo de la interfaz de usuario:

```kotlin
fun updatePersonView(json: String) {
	personView.person = Gson().fromJson(json, Person::class.java)
}
```

El rendimiento podría mejorar si se mueve la decodificación de JSON a una corrutina:

```kotlin
fun updatePersonView(json: String) {
	lifecycleScope.launch(Dispatchers.IO) {
	  val person = Gson().fromJson(json, Person::class.java)

    withContext(Dispatchers.Main) {
      personView.person = person
    }
  }
}
```
