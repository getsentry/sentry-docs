---
title: Instrument AI Agents
sidebar_order: 500
description: "Learn how to manually instrument your code to use Sentry's Agents module."
supported:
  - javascript.node
  - javascript.aws-lambda
  - javascript.azure-functions
  - javascript.connect
  - javascript.express
  - javascript.fastify
  - javascript.gcp-functions
  - javascript.hapi
  - javascript.hono
  - javascript.koa
  - javascript.nestjs
  - javascript.bun
  - javascript.deno
  - javascript.nextjs
  - javascript.nuxt
  - javascript.astro
  - javascript.solidstart
  - javascript.sveltekit
  - javascript.remix
  - javascript.cloudflare
  - javascript.tanstackstart-react
---

With <Link to="/product/insights/ai/agents/dashboard/">Sentry AI Agent Monitoring</Link>, you can monitor and debug your AI systems with full-stack context. You'll be able to track key insights like token usage, latency, tool usage, and error rates. AI Agent Monitoring data will be fully connected to your other Sentry data like logs, errors, and traces.

As a prerequisite to setting up AI Agent Monitoring with JavaScript, you'll need to first <PlatformLink to="/tracing/">set up tracing</PlatformLink>. Once this is done, the JavaScript SDK will automatically instrument AI agents created with supported libraries. If that doesn't fit your use case, you can use custom instrumentation described below.

## Automatic Instrumentation

The JavaScript SDK supports automatic instrumentation for some AI libraries. We recommend adding their integrations to your Sentry configuration to automatically capture spans for AI agents.

- <PlatformLink to="/configuration/integrations/vercelai/">Vercel AI SDK</PlatformLink>
- <PlatformLink to="/configuration/integrations/openai/"notSupported={["javascript.deno"]}>OpenAI</PlatformLink>
- <PlatformLink
    to="/configuration/integrations/anthropic/"
  notSupported={["javascript.deno"]}>Anthropic</PlatformLink>
- <PlatformLink to="/configuration/integrations/google-genai/" notSupported={["javascript.deno"]}>Google Gen AI SDK</PlatformLink>
- <PlatformLink to="/configuration/integrations/langchain/" notSupported={["javascript.deno"]}>LangChain</PlatformLink>
- <PlatformLink to="/configuration/integrations/langgraph/" notSupported={["javascript.deno"]}>LangGraph</PlatformLink>

## Manual Instrumentation

If you're using a library that Sentry does not automatically instrument, you can manually instrument your code to capture spans. For your AI agents data to show up in the Sentry [AI Agents Insights](https://sentry.io/orgredirect/organizations/:orgslug/insights/ai/agents/), two spans must be created and have well-defined names and data attributes. See below.

## Spans

### LLM Call Span

<Expandable title="LLM Call span attributes">
  <Include name="tracing/ai-agents-module/ai-client-span" />
</Expandable>

#### Example LLM Call Span

```javascript
const messages = [{ role: "user", content: "Tell me a joke" }];

await Sentry.startSpan(
  {
    op: "gen_ai.chat",
    name: "chat o3-mini",
    attributes: {
      "gen_ai.system": "openai",
      "gen_ai.request.model": "o3-mini",
      "gen_ai.request.messages": JSON.stringify(messages),
    },
  },
  async (span) => {
    // Call your LLM here
    const result = await client.chat.completions.create({
      model: "o3-mini",
      messages,
    });

    span.setAttribute(
      "gen_ai.response.text",
      JSON.stringify([result.choices[0].message.content])
    );
    // Set token usage
    span.setAttribute("gen_ai.usage.input_tokens", result.usage.prompt_tokens);
    span.setAttribute(
      "gen_ai.usage.output_tokens",
      result.usage.completion_tokens
    );
  }
);
```

### Invoke Agent Span

<Expandable title="Invoke Agent span attributes">
  <Include name="tracing/ai-agents-module/invoke-agent-span" />
</Expandable>

#### Example Invoke Agent Span

```javascript
await Sentry.startSpan(
  {
    op: "gen_ai.invoke_agent",
    name: "invoke_agent Weather Agent",
    attributes: {
      "gen_ai.system": "openai",
      "gen_ai.request.model": "o3-mini",
      "gen_ai.agent.name": "Weather Agent",
    },
  },
  async (span) => {
    // Run the agent
    const result = await myAgent.run();

    span.setAttribute("gen_ai.response.text", JSON.stringify([result.output]));
    // Set token usage
    span.setAttribute("gen_ai.usage.input_tokens", result.usage.inputTokens);
    span.setAttribute("gen_ai.usage.output_tokens", result.usage.outputTokens);
  }
);
```

### Execute Tool Span

<Expandable title="Execute Tool span attributes">
  <Include name="tracing/ai-agents-module/execute-tool-span" />
</Expandable>

#### Example Execute Tool Span

```javascript
await Sentry.startSpan(
  {
    op: "gen_ai.execute_tool",
    name: "execute_tool get_weather",
    attributes: {
      "gen_ai.tool.name": "get_weather",
      "gen_ai.tool.input": JSON.stringify({ location: "Paris" }),
    },
  },
  async (span) => {
    // Call the tool
    const result = await getWeather({ location: "Paris" });

    span.setAttribute("gen_ai.tool.output", JSON.stringify(result));
  }
);
```

### Handoff Span

<Expandable title="Handoff span attributes">
  <Include name="tracing/ai-agents-module/handoff-span" />
</Expandable>

#### Example Handoff Span

```javascript
await Sentry.startSpan(
  { op: "gen_ai.handoff", name: "handoff from Weather Agent to Travel Agent" },
  () => {} // Handoff span just marks the transition
);

await Sentry.startSpan(
  { op: "gen_ai.invoke_agent", name: "invoke_agent Travel Agent" },
  async () => {
    // Run the target agent here
  }
);
```

<Expandable title="Common span attributes">
  <Include name="tracing/ai-agents-module/common-span-attributes" />
</Expandable>
