---
title: Astro
description: Learn how to manually set up Sentry in your Astro app and capture your first errors.
sdk: sentry.javascript.astro
categories:
  - javascript
  - browser
  - server
  - server-node
---

## Prerequisites

You need:

- A Sentry [account](https://sentry.io/signup/) and [project](/product/projects/)
- Your application up and running
- Astro `3.0.0` or above
- If you're using Astro's Netlify adapter (`@astrojs/netlify`), you need version `5.0.0` or above

<Alert level="warning" title="What runtime do you use?">
  This SDK currently only works on Node runtimes, such as Node adapter or Vercel
  with Lambda functions. If you use Cloudflare Pages, refer to our [Astro on
  Cloudflare guide](/platforms/javascript/guides/cloudflare/frameworks/astro/).
  Other non-Node runtimes, like Vercel's Edge runtime, are currently **not
  supported**.
</Alert>

## Step 1: Install

Choose the features you want to configure, and this guide will show you how:

<OnboardingOptionButtons
  options={[
    "error-monitoring",
    "performance",
    "profiling",
    "session-replay",
    "user-feedback",
    "logs",
  ]}
/>

<PlatformContent includePath="getting-started-features-expandable" />

### Install the Sentry SDK

Install and add the Sentry integration using the `astro` CLI:

```bash {tabTitle:npm}
npx astro add @sentry/astro
```

```bash {tabTitle:yarn}
yarn astro add @sentry/astro
```

```bash {tabTitle:pnpm}
pnpm astro add @sentry/astro
```

<OnboardingOption optionId="profiling">

Next, install the Profiling package using your preferred package manager:

```bash {tabTitle:npm}
npm install @sentry/profiling-node
```

```bash {tabTitle:yarn}
yarn add @sentry/profiling-node
```

```bash {tabTitle:pnpm}
pnpm add @sentry/profiling-node
```

</OnboardingOption>

## Step 2: Configure

### Apply Instrumentation to Your App

Register the Sentry integration in your `astro.config.mjs` file:

```javascript {filename:astro.config.mjs}
import { defineConfig } from "astro/config";
import sentry from "@sentry/astro";

export default defineConfig({
  integrations: [sentry()],
});
```

### Configure Client-side Sentry

Create a `sentry.client.config.(ts|js)` file in the root of your project. In this file, import and initialize Sentry for the client:

```javascript {filename:sentry.client.config.(ts|js)}
import * as Sentry from "@sentry/astro";

Sentry.init({
  dsn: "___PUBLIC_DSN___",

  // Adds request headers and IP for users, for more info visit:
  // https://docs.sentry.io/platforms/javascript/guides/astro/configuration/options/#sendDefaultPii
  sendDefaultPii: true,

  integrations: [
    // ___PRODUCT_OPTION_START___ performance
    Sentry.browserTracingIntegration(),
    // ___PRODUCT_OPTION_END___ performance
    // ___PRODUCT_OPTION_START___ session-replay
    Sentry.replayIntegration(),
    // ___PRODUCT_OPTION_END___ session-replay
    // ___PRODUCT_OPTION_START___ user-feedback
    Sentry.feedbackIntegration({
      // Additional SDK configuration goes in here, for example:
      colorScheme: "system",
    }),
    // ___PRODUCT_OPTION_END___ user-feedback
  ],
  // ___PRODUCT_OPTION_START___ performance

  // Define how likely traces are sampled. Adjust this value in production,
  // or use tracesSampler for greater control.
  tracesSampleRate: 1.0,
  // ___PRODUCT_OPTION_END___ performance
  // ___PRODUCT_OPTION_START___ session-replay

  // This sets the sample rate to be 10%. You may want this to be 100% while
  // in development and sample at a lower rate in production
  replaysSessionSampleRate: 0.1,

  // If the entire session is not sampled, use the below sample rate to sample
  // sessions when an error occurs.
  replaysOnErrorSampleRate: 1.0,
  // ___PRODUCT_OPTION_END___ session-replay
  // ___PRODUCT_OPTION_START___ logs

  // Enable logs to be sent to Sentry
  enableLogs: true,
  // ___PRODUCT_OPTION_END___ logs
});
```

<Expandable title="Want to change your Sentry config files location or name?">

Sentry automatically detects configuration files named `sentry.(client|server).config.(ts|js)` in the root of your project. You can rename these files or move them to a custom folder within your project.
To change their location or names, specify the paths in the Sentry Astro integration options in your `astro.config.mjs`:

```javascript {filename:astro.config.mjs}
export default defineConfig({
  // Other Astro project options
  integrations: [
    sentry({
      clientInitPath: ".config/sentryClientInit.js",
      serverInitPath: ".config/sentryServerInit.js",
    }),
  ],
});
```

</Expandable>

### Configure Server-side Sentry

Create a `sentry.server.config.(ts|js)` file in the root of your project. In this file, import and initialize Sentry for the server:

```javascript {filename:sentry.server.config.(ts|js)}
import * as Sentry from "@sentry/astro";
// ___PRODUCT_OPTION_START___ profiling
import { nodeProfilingIntegration } from "@sentry/profiling-node";
// ___PRODUCT_OPTION_END___ profiling

Sentry.init({
  dsn: "___PUBLIC_DSN___",

  // Adds request headers and IP for users, for more info visit:
  // https://docs.sentry.io/platforms/javascript/guides/astro/configuration/options/#sendDefaultPii
  sendDefaultPii: true,
  // ___PRODUCT_OPTION_START___ profiling

  integrations: [
    // Add our Profiling integration
    nodeProfilingIntegration(),
  ],
  // ___PRODUCT_OPTION_END___ profiling
  // ___PRODUCT_OPTION_START___ performance

  // Define how likely traces are sampled. Adjust this value in production,
  // or use tracesSampler for greater control.
  tracesSampleRate: 1.0,
  // ___PRODUCT_OPTION_END___ performance
  // ___PRODUCT_OPTION_START___ profiling

  // Define how many user sessions have profiling enabled.
  profileSessionSampleRate: 1.0,
  // ___PRODUCT_OPTION_END___ profiling
  // ___PRODUCT_OPTION_START___ logs

  // Enable logs to be sent to Sentry
  enableLogs: true,
  // ___PRODUCT_OPTION_END___ logs
});
```

## Step 3: Server Instrumentation

### Manually Add Server Instrumentation (Astro `<3.5.2`)

For Astro versions below `3.5.2`, you need to manually add the Sentry middleware to your `src/middleware.js` file:

```javascript {filename:src/middleware.(js|ts)}
import * as Sentry from "@sentry/astro";
import { sequence } from "astro:middleware";

export const onRequest = sequence(
  Sentry.handleRequest()
  // other middleware handlers
);
```

If you have multiple request handlers, make sure to add the Sentry middleware as the first handler in the sequence.

### Customize Server Instrumentation for Manual Middleware (Optional)

Sentry's Astro middleware lets you control which additional data should be added to recorded request spans.

To customize the server instrumentation, add the Sentry middleware to your `src/middleware.(ts|js)` file:

```javascript {filename:src/middleware.(js|ts)}
import * as Sentry from "@sentry/astro";
import { sequence } from "astro:middleware";

export const onRequest = sequence(
  Sentry.handleRequest({
    trackClientIp: true, // defaults to false
    trackHeaders: true, // defaults to false
  })
  // other middleware handlers
);
```

If you're using Astro `3.5.2` or newer, make sure to also disable auto instrumentation as shown below.

### Disable Automatic Instrumentation (Optional)

For Astro version `3.5.2` and up, you can optionally disable the automatic server instrumentation by turning off the `requestHandler` auto instrumentation option:

```javascript {filename:astro.config.mjs}
import { defineConfig } from "astro/config";
import sentry from "@sentry/astro";

export default defineConfig({
  integrations: [
    sentry({
      autoInstrumentation: {
        requestHandler: false,
      },
    }),
  ],
  output: "server",
});
```

## Step 4: Add Readable Stack Traces With Source Maps

To upload source maps for clear error stack traces, add your Sentry auth token, organization, and project slugs in the `sentry` options inside `astro.config.mjs`:

```javascript {filename:astro.config.mjs}
import { defineConfig } from "astro/config";
import sentry from "@sentry/astro";

export default defineConfig({
  integrations: [
    sentry({
      org: "___ORG_SLUG___",
      project: "___PROJECT_SLUG___",
      // store your auth token in an environment variable
      authToken: process.env.SENTRY_AUTH_TOKEN,
    }),
  ],
});
```

To keep your auth token secure, set the `SENTRY_AUTH_TOKEN` environment variable in your build environment:

<OrgAuthTokenNote />

```bash {filename:.env.sentry-build-plugin}
SENTRY_AUTH_TOKEN=___ORG_AUTH_TOKEN___
```

## Step 5: Avoid Ad Blockers With Tunneling (Optional)

<PlatformContent includePath="getting-started-tunneling" />

## Step 6: Verify Your Setup

Let's test your setup and confirm that Sentry is working correctly and sending data to your Sentry project.

### Issues

To verify that Sentry captures errors and creates issues in your Sentry project, create a test page, for example, at `src/pages/test.astro` with two buttons:

```html {filename: test.astro}
<script>
  function throwTestError() {
    throw new Error("Sentry Example Frontend Error");
  }

  async function throwApiError() {
    await fetch("/api/test-error");
  }
</script>

<button type="button" onclick="throwTestError()">Throw a frontend error</button>
<button type="button" onclick="throwApiError()">Throw an API error</button>
```

Then also create the route we're calling in our test page, like `src/pages/api/test-error.(js|ts)`:

```javascript {filename: test-error.(js|ts)}
export async function GET() {
  throw new Error("Sentry Example API Route Error");
}
```

Open the page in a browser and click the buttons to trigger a frontend error and an error in the API route.

<PlatformContent includePath="getting-started-browser-sandbox-warning" />

<OnboardingOption optionId="performance">

### Tracing

To test tracing, create a custom span to measure the time it takes for the API request to complete:

```html {filename: test.astro}
<script>
  import * as Sentry from "@sentry/astro";

  async function throwApiError() {
    await Sentry.startSpan(
      {
        name: "Example Frontend Span",
        op: "test",
      },
      async () => {
        await fetch("/api/test-error");
      }
    );
  }
</script>

<button type="button" onclick="throwApiError()">
  Throw an API error with a trace
</button>
```

</OnboardingOption>

### View Captured Data in Sentry

Now, head over to your project on [Sentry.io](https://sentry.io) to view the collected data (it takes a couple of moments for the data to appear).

<PlatformContent includePath="getting-started-verify-locate-data" />

## Next Steps

At this point, you should have integrated Sentry into your Astro application and should already be sending data to your Sentry project.

Now's a good time to customize your setup and look into more advanced topics.
Our next recommended steps for you are:

- Continue to <PlatformLink to="/configuration">customize your configuration</PlatformLink>
- Learn how to <PlatformLink to="/usage">manually capture errors</PlatformLink>
- Learn more about [deploying Astro apps to Cloudflare Pages](/platforms/javascript/guides/cloudflare/frameworks/astro/)
- Get familiar with [Sentry's product features](/product/) like tracing, insights, and alerts

<Expandable permalink={false} title="Are you having problems setting up the SDK?">

- Find various topics in <PlatformLink to="/troubleshooting">Troubleshooting</PlatformLink>
- [Get support](https://sentry.zendesk.com/hc/en-us/)

</Expandable>
