---
title: Set Up Metrics
sidebar_title: Metrics
description: "Track custom counters, gauges, and distributions from your Next.js application."
sidebar_order: 8
sidebar_section: features
beta: true
---

Sentry Metrics let you track custom application data beyond errors and traces. Track business metrics like orders processed, API response times, or cache hit rates across all Next.js runtimes.

<Alert>
Metrics is in open beta. [Share feedback on GitHub](https://github.com/getsentry/sentry-javascript/discussions/18055).
</Alert>

## Usage

<SplitLayout>
<SplitSection>
<SplitSectionText>

### Metric Types

| Type | Use For |
|------|---------|
| `count` | Events (orders, clicks, API calls) |
| `gauge` | Current values (queue depth, connections) |
| `distribution` | Value ranges (response times, payload sizes) |

No setup required beyond SDK initialization. Works in client, server, and edge runtimes.

</SplitSectionText>
<SplitSectionCode>

```typescript
import * as Sentry from "@sentry/nextjs";

// Count occurrences
Sentry.metrics.count("orders_created", 1);

// Track current values
Sentry.metrics.gauge("active_connections", 42);

// Track distributions
Sentry.metrics.distribution("api_latency", 187, {
  unit: "millisecond",
});
```

</SplitSectionCode>
</SplitSection>
</SplitLayout>

## Next.js Patterns

<SplitLayout>
<SplitSection>
<SplitSectionText>

### API Routes

Track request timing and business events in your route handlers.

</SplitSectionText>
<SplitSectionCode>

```typescript {filename:app/api/orders/route.ts}
import * as Sentry from "@sentry/nextjs";

export async function POST(request: Request) {
  const start = Date.now();

  try {
    const order = await createOrder(request);

    Sentry.metrics.count("orders_created", 1, {
      attributes: { status: "success" },
    });

    return Response.json(order);
  } catch (error) {
    Sentry.metrics.count("orders_created", 1, {
      attributes: { status: "failed" },
    });
    throw error;
  } finally {
    Sentry.metrics.distribution("order_latency", Date.now() - start, {
      unit: "millisecond",
    });
  }
}
```

</SplitSectionCode>
</SplitSection>

<SplitSection>
<SplitSectionText>

### Server Actions

Track form submissions and mutations.

</SplitSectionText>
<SplitSectionCode>

```typescript {filename:app/actions.ts}
"use server";

import * as Sentry from "@sentry/nextjs";

export async function submitCheckout(formData: FormData) {
  Sentry.metrics.count("checkout_attempts", 1);

  try {
    const result = await processCheckout(formData);
    Sentry.metrics.count("checkout_success", 1);
    return result;
  } catch (error) {
    Sentry.metrics.count("checkout_failures", 1);
    throw error;
  }
}
```

</SplitSectionCode>
</SplitSection>

<SplitSection>
<SplitSectionText>

### Proxy / Middleware

Track request patterns at the edge.

Next.js 16+ uses `proxy.ts`, while earlier versions use `middleware.ts`. The pattern is the same.

</SplitSectionText>
<SplitSectionCode>

```typescript {tabTitle:Proxy} {filename:proxy.ts}
import { NextResponse } from "next/server";
import type { NextRequest } from "next/server";
import * as Sentry from "@sentry/nextjs";

export function proxy(request: NextRequest) {
  Sentry.metrics.count("requests", 1, {
    attributes: {
      path: request.nextUrl.pathname,
      method: request.method,
    },
  });

  return NextResponse.next();
}
```

```typescript {tabTitle:Middleware} {filename:middleware.ts}
import { NextResponse } from "next/server";
import type { NextRequest } from "next/server";
import * as Sentry from "@sentry/nextjs";

export function middleware(request: NextRequest) {
  Sentry.metrics.count("requests", 1, {
    attributes: {
      path: request.nextUrl.pathname,
      method: request.method,
    },
  });

  return NextResponse.next();
}
```

</SplitSectionCode>
</SplitSection>
</SplitLayout>

## Attributes

<SplitLayout>
<SplitSection>
<SplitSectionText>

### Filtering and Grouping

Attributes let you filter and group metrics in Sentry. Use them for:
- Environment segmentation
- Feature flag tracking
- User tier analysis

Each metric has a **2KB size limit**. If you exceed this, the metric will be dropped.

</SplitSectionText>
<SplitSectionCode>

```typescript
Sentry.metrics.count("api_calls", 1, {
  attributes: {
    endpoint: "/api/orders",
    user_tier: "pro",
    region: "us-west",
    user_id: user.id,
    order_id: order.id,
  },
});
```

</SplitSectionCode>
</SplitSection>
</SplitLayout>

## Options

Configure these options in **all three runtime files** (`instrumentation-client.ts`, `sentry.server.config.ts`, `sentry.edge.config.ts`).

<SplitLayout>
<SplitSection>
<SplitSectionText>

### beforeSendMetric

Filter or modify metrics before sending. Return `null` to drop a metric.

</SplitSectionText>
<SplitSectionCode>

```typescript
Sentry.init({
  dsn: "___PUBLIC_DSN___",
  beforeSendMetric: (metric) => {
    // Drop specific metrics
    if (metric.name === "debug_metric") {
      return null;
    }

    // Add attributes
    metric.attributes = {
      ...metric.attributes,
      processed: true,
    };

    return metric;
  },
});
```

</SplitSectionCode>
</SplitSection>

<SplitSection>
<SplitSectionText>

### Disable Metrics

Set `enableMetrics: false` to disable metrics collection entirely.

### Flush Metrics

Metrics are buffered and sent periodically. To flush immediately:

</SplitSectionText>
<SplitSectionCode>

```typescript
// Disable metrics
Sentry.init({
  dsn: "___PUBLIC_DSN___",
  enableMetrics: false,
});

// Flush all pending metrics
await Sentry.flush();
```

</SplitSectionCode>
</SplitSection>
</SplitLayout>

## Default Attributes

Sentry automatically attaches these attributes to every metric:

| Attribute | Description |
|-----------|-------------|
| `sentry.environment` | Environment from SDK config |
| `sentry.release` | Release version from SDK config |
| `sentry.sdk.name` | SDK name (`sentry.javascript.nextjs`) |
| `sentry.sdk.version` | SDK version |

**If user is set:**
- `user.id`, `user.name`, `user.email`

**Client-side:**
- `browser.name`, `browser.version`, `sentry.replay_id`

**Server-side:**
- `server.address`

## Quick Reference

| Metric Type | Method | Example Use Case |
|-------------|--------|------------------|
| Counter | `Sentry.metrics.count()` | Orders, signups, errors |
| Gauge | `Sentry.metrics.gauge()` | Queue depth, active users |
| Distribution | `Sentry.metrics.distribution()` | Response times, payload sizes |

| Option | Description |
|--------|-------------|
| `attributes` | Key-value pairs for filtering |
| `unit` | Display unit (`millisecond`, `byte`, etc.) |

## Viewing Metrics

Once you're sending metrics, view them in Sentry at [**Explore â†’ Metrics**](https://sentry.io/orgredirect/organizations/:orgslug/explore/metrics/).
