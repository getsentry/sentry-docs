---
title: Cloudflare
description: "Learn how to manually set up Sentry for Cloudflare Workers and Cloudflare Pages and capture your first errors."
sdk: sentry.javascript.cloudflare
categories:
  - javascript
  - server
  - server-edge
  - serverless
---

Use this guide for general instructions on using the Sentry SDK with Cloudflare. If you're using any of the listed frameworks, follow their specific setup instructions:

- **[Astro](frameworks/astro/)**
- **[Hono](frameworks/hono/)**
- **[Hydrogen](frameworks/hydrogen/)**
- **[Nuxt](frameworks/nuxt/)**
- **[Remix](frameworks/remix/)**
- **[SvelteKit](frameworks/sveltekit/)**

<PlatformContent includePath="getting-started-prerequisites" />

## Step 1: Install

Choose the features you want to configure, and this guide will show you how:

<OnboardingOptionButtons
  options={["error-monitoring", "performance", "logs"]}
/>

<PlatformContent includePath="getting-started-features-expandable" />

### Install the Sentry SDK

Run the command for your preferred package manager to add the Sentry SDK to your application:

<PlatformContent includePath="getting-started-install" />

## Step 2: Configure

The main Sentry configuration should happen as early as possible in your app's lifecycle.

### Wrangler Configuration

<PlatformContent includePath="getting-started-config" />

### Setup for Cloudflare Workers

<PlatformContent
  includePath="getting-started-config"
  platform="javascript.cloudflare.workers"
/>

<Expandable title="Don't have access to onRequest?">
If you don't have access to the `onRequest` middleware API, you can use the `wrapRequestHandler` API instead. For example:

```javascript
// hooks.server.js
import * as Sentry from "@sentry/cloudflare";

export const handle = ({ event, resolve }) => {
  const requestHandlerOptions = {
    options: {
      dsn: event.platform.env.SENTRY_DSN,
      tracesSampleRate: 1.0,
    },
    request: event.request,
    context: event.platform.ctx,
  };
  return Sentry.wrapRequestHandler(requestHandlerOptions, () => resolve(event));
};
```

</Expandable>

### Setup for Cloudflare Pages

To use the Sentry SDK, add the `sentryPagesPlugin` as [middleware to your Cloudflare Pages application](https://developers.cloudflare.com/pages/functions/middleware/).
For this, we recommend you create a `functions/_middleware.js` file to set up the middleware for your entire app:

```javascript {filename:functions/_middleware.js}
import * as Sentry from "@sentry/cloudflare";

export const onRequest = [
  // Make sure Sentry is the first middleware
  Sentry.sentryPagesPlugin((context) => {
    const { id: versionId } = env.CF_VERSION_METADATA;

    return {
      dsn: "___PUBLIC_DSN___",

      release: versionId,

      // Adds request headers and IP for users, for more info visit:
      // https://docs.sentry.io/platforms/javascript/guides/cloudflare/configuration/options/#sendDefaultPii
      sendDefaultPii: true,
      // ___PRODUCT_OPTION_START___ logs

      // Enable logs to be sent to Sentry
      enableLogs: true,
      // ___PRODUCT_OPTION_END___ logs
      // ___PRODUCT_OPTION_START___ performance

      // Set tracesSampleRate to 1.0 to capture 100% of spans for tracing.
      // Learn more at
      // https://docs.sentry.io/platforms/javascript/guides/cloudflare/configuration/options/#tracesSampleRate
      tracesSampleRate: 1.0,
      // ___PRODUCT_OPTION_END___ performance
    };
  }),
  // Add more middlewares here
];
```

## Step 3: Add Readable Stack Traces With Source Maps (Optional)

The stack traces in your Sentry errors probably won't look like your actual code. To fix this, upload your source maps to Sentry.

First, set the `upload_source_maps` option to `true` in your `wrangler.(jsonc|toml)` config file to enable source map uploading:

```jsonc {tabTitle:JSON} {filename:wrangler.jsonc}
{
  "upload_source_maps": true,
}
```

```toml {tabTitle:Toml} {filename:wrangler.toml}
upload_source_maps = true
```

Next, run the Sentry Wizard to finish your setup:

```bash
npx @sentry/wizard@latest -i sourcemaps
```

## Step 4: Verify Your Setup

Let's test your setup and confirm that Sentry is working correctly and sending data to your Sentry project.

### Issues

First, let's make sure Sentry is correctly capturing errors and creating issues in your project.

#### Cloudflare Workers

Add the following code snippet to your main worker file to create a `/debug-sentry` route that triggers an error when called:

```javascript {filename:index.js}
export default {
  async fetch(request) {
    const url = new URL(request.url);

    if (url.pathname === "/debug-sentry") {
      throw new Error("My first Sentry error!");
    }

    // Your existing routes and logic here...
    return new Response("...");
  },
};
```

#### Cloudflare Pages

Create a new route that throws an error when called by adding the following code snippet to a file in your `functions` directory, such as `functions/debug-sentry.js`:

```javascript {filename:debug-sentry.js}
export async function onRequest(context) {
  throw new Error("My first Sentry error!");
}
```

<OnboardingOption optionId="performance">
### Tracing
To test your tracing configuration, update the previous code snippet by starting a trace to measure the time it takes to run your code.

#### Cloudflare Workers

```javascript {filename:index.js}
export default {
  async fetch(request) {
    const url = new URL(request.url);

    if (url.pathname === "/debug-sentry") {
      await Sentry.startSpan(
        {
          op: "test",
          name: "My First Test Transaction",
        },
        async () => {
          await new Promise((resolve) => setTimeout(resolve, 100)); // Wait for 100ms
          throw new Error("My first Sentry error!");
        }
      );
    }

    // Your existing routes and logic here...
    return new Response("...");
  },
};
```

#### Cloudflare Pages

```javascript {filename:debug-sentry.js}
export async function onRequest(context) {
  await Sentry.startSpan(
    {
      op: "test",
      name: "My First Test Transaction",
    },
    async () => {
      await new Promise((resolve) => setTimeout(resolve, 100)); // Wait for 100ms
      throw new Error("My first Sentry error!");
    }
  );
}
```

</OnboardingOption>

### View Captured Data in Sentry

Now, head over to your project on [Sentry.io](https://sentry.io) to view the collected data (it takes a couple of moments for the data to appear).

<PlatformContent includePath="getting-started-verify-locate-data" />

## Next Steps

At this point, you should have integrated Sentry and should already be sending data to your Sentry project.

Now's a good time to customize your setup and look into more advanced topics. Our next recommended steps for you are:

- Learn how to [manually capture errors](/platforms/javascript/guides/cloudflare/usage/)
- Continue to [customize your configuration](/platforms/javascript/guides/cloudflare/configuration/)
- Make use of [Cloudflare-specific features](/platforms/javascript/guides/cloudflare/features)
- Get familiar with [Sentry's product features](/product) like tracing, insights, and alerts

<Expandable permalink={false} title="Are you having problems setting up the SDK?">

- Check out setup instructions for popular [frameworks on Cloudflare](/platforms/javascript/guides/cloudflare/frameworks/)
- Find various support topics in <PlatformLink to="/troubleshooting">troubleshooting</PlatformLink>
- [Get support](https://sentry.zendesk.com/hc/en-us/)

</Expandable>
