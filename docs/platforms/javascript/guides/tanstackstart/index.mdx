---
title: TanStack Start
description: "Learn how to set up and configure Sentry in your TanStack Start application, capturing your first errors, and viewing them in Sentry."
---

<PlatformContent includePath="getting-started-prerequisites" />

## Step 1: Install

Choose the features you want to configure, and this guide will show you how:

<OnboardingOptionButtons
  options={["error-monitoring", "performance", "session-replay"]}
/>

<Expandable title="Want to learn more about these features?">

- [**Issues**](/product/issues) (always enabled): Sentry's core error monitoring product that automatically reports errors,
  uncaught exceptions, and unhandled rejections. If you have something that
  looks like an exception, Sentry can capture it.
- [**Tracing**](/product/tracing): Track software performance while seeing the
  impact of errors across multiple systems. For example, distributed tracing
  allows you to follow a request from the frontend to the backend and back.
- [**Session Replay**](/product/explore/session-replay/web):
  Get to the root cause of an issue faster by viewing a video-like reproduction
  of what was happening in the user's browser before, during, and after the
  problem.

</Expandable>

### Install the Sentry SDK

Run the command for your preferred package manager to add the Sentry SDK to your application:

```bash {tabTitle:npm}
npm install @sentry/tanstackstart --save
```

```bash {tabTitle:yarn}
yarn add @sentry/tanstackstart
```

```bash {tabTitle:pnpm}
pnpm add @sentry/tanstackstart
```

## Step 2: Configure

### Apply Instrumentation to Your App

Extend your app's default TanStack Start configuration by adding `wrapVinxiConfigWithSentry` to your `app.config.ts` file:

```TypeScript {filename:app.config.ts}
import { defineConfig } from "@tanstack/react-start/config";
import { wrapVinxiConfigWithSentry } from "@sentry/tanstackstart";

const config = defineConfig({
    // ... your other TanStack Start config
})

export default wrapVinxiConfigWithSentry(config, {
  org: "___ORG_SLUG___",
  project: "___PROJECT_SLUG___",

  // Only print logs for uploading source maps in CI
  // Set to `true` to suppress logs
  silent: !process.env.CI,
});
```

### Initialize Sentry Client-Side and Server-Side SDKs

Add the following initialization code to your `app/client.tsx` file to initialize Sentry on the client:

```tsx {filename:app/client.tsx} {"onboardingOptions": {"performance": "15, 18-24", "session-replay": "16,25-31"}}
/// <reference types="vinxi/types/client" />

import { hydrateRoot } from "react-dom/client";
import { StartClient } from "@tanstack/react-start";
import { createRouter } from "./router";

import * as Sentry from "@sentry/tanstackstart";

const router = createRouter();

Sentry.init({
  dsn: "___PUBLIC_DSN___",

  integrations: [
    Sentry.tanstackRouterBrowserTracingIntegration(router),
    Sentry.replayIntegration(),
  ],

  // Set tracesSampleRate to 1.0 to capture 100%
  // of transactions for tracing.
  // We recommend adjusting this value in production.
  // Learn more at https://docs.sentry.io/platforms/javascript/configuration/options/#traces-sample-rate
  tracesSampleRate: 1.0,

  // Capture Replay for 10% of all sessions,
  // plus for 100% of sessions with an error.
  // Learn more at https://docs.sentry.io/platforms/javascript/session-replay/configuration/#general-integration-configuration
  replaysSessionSampleRate: 0.1,
  replaysOnErrorSampleRate: 1.0,
});

hydrateRoot(document, <StartClient router={router} />);
```

Wrap TanStack Start's `createRootRoute` function using `wrapCreateRootRouteWithSentry` to apply tracing to Server-Side Rendering (SSR):

```tsx {filename:app/routes/__root.tsx} {5}
import type { ReactNode } from "react";
import { createRootRoute } from "@tanstack/react-router";

// (Wrap `createRootRoute`, not its return value!)
export const Route = wrapCreateRootRouteWithSentry(createRootRoute)({
  // ...
});
```

Add the following initialization code anywhere in your `app/ssr.tsx` file to initialize Sentry on the server:

```tsx {filename:app/ssr.tsx} {"onboardingOptions": {"performance": "5-11"}}
import * as Sentry from "@sentry/tanstackstart";

Sentry.init({
  dsn: "___PUBLIC_DSN___",

  // Set tracesSampleRate to 1.0 to capture 100%
  // of transactions for tracing.
  // We recommend adjusting this value in production
  // Learn more at
  // https://docs.sentry.io/platforms/javascript/configuration/options/#traces-sample-rate
  tracesSampleRate: 1.0,
});
```

Wrap TanStack Start's `defaultStreamHandler` function using `wrapStreamHandlerWithSentry` to instrument requests to your server:

```tsx {filename:app/ssr.tsx} {12}
import {
  createStartHandler,
  defaultStreamHandler,
} from "@tanstack/react-start/server";
import { getRouterManifest } from "@tanstack/react-start/router-manifest";
import { createRouter } from "./router";
import * as Sentry from "@sentry/tanstackstart";

export default createStartHandler({
  createRouter,
  getRouterManifest,
})(Sentry.wrapStreamHandlerWithSentry(defaultStreamHandler));
```

Add the `sentryGlobalServerMiddlewareHandler` to your global middlewares to instrument your server function invocations:

<Alert level="info">

If you haven't done so, create a `app/global-middleware.ts` file as outlined in the [TanStack Start Docs for Global Middleware](https://tanstack.com/start/latest/docs/framework/react/middleware#global-middleware).

</Alert>

```ts {filename:app/global-middleware.ts}
import {
  createMiddleware,
  registerGlobalMiddleware,
} from "@tanstack/react-start";
import * as Sentry from "@sentry/tanstackstart";

registerGlobalMiddleware({
  middleware: [
    createMiddleware().server(Sentry.sentryGlobalServerMiddlewareHandler()),
  ],
});
```

## Step 3: Capture React Render Errors (TODO?)

To capture React render errors, you need to add error components for the App Router and the Pages Router.

### App Router

Create or update the `global-error.(tsx|jsx)` file to define a [custom Next.js GlobalError component](https://nextjs.org/docs/app/building-your-application/routing/error-handling):

```tsx {filename:global-error.tsx}
"use client";

import * as Sentry from "@sentry/nextjs";
import NextError from "next/error";
import { useEffect } from "react";

export default function GlobalError({
  error,
}: {
  error: Error & { digest?: string };
}) {
  useEffect(() => {
    Sentry.captureException(error);
  }, [error]);

  return (
    <html>
      <body>
        {/* `NextError` is the default Next.js error page component. Its type
        definition requires a `statusCode` prop. However, since the App Router
        does not expose status codes for errors, we simply pass 0 to render a
        generic error message. */}
        <NextError statusCode={0} />
      </body>
    </html>
  );
}
```

```jsx {filename:global-error.jsx}
"use client";

import * as Sentry from "@sentry/nextjs";
import NextError from "next/error";
import { useEffect } from "react";

export default function GlobalError({ error }) {
  useEffect(() => {
    Sentry.captureException(error);
  }, [error]);

  return (
    <html>
      <body>
        {/* This is the default Next.js error component. */}
        <NextError />
      </body>
    </html>
  );
}
```

## Step 5: Add Readable Stack Traces With Source Maps (TODO)

Sentry can automatically provide readable stack traces for errors using source maps, requiring a Sentry auth token.

Update your `next.config.(js|mjs)` file with the following options:

```javascript {tabTitle:ESM} {filename:next.config.mjs}
export default withSentryConfig(nextConfig, {
  org: "___ORG_SLUG___",
  project: "___PROJECT_SLUG___",

  // Pass the auth token
  authToken: process.env.SENTRY_AUTH_TOKEN,
  // Upload a larger set of source maps for prettier stack traces (increases build time)
  widenClientFileUpload: true,
});
```

```javascript {tabTitle:CJS} {filename:next.config.js}
module.exports = withSentryConfig(nextConfig, {
  org: "___ORG_SLUG___",
  project: "___PROJECT_SLUG___",

  // Pass the auth token
  authToken: process.env.SENTRY_AUTH_TOKEN,
  // Upload a larger set of source maps for prettier stack traces (increases build time)
  widenClientFileUpload: true,
});
```

Alternatively, set the `SENTRY_AUTH_TOKEN` environment variable in your `.env` file:

```sh {filename:.env}
SENTRY_AUTH_TOKEN=___ORG_AUTH_TOKEN___
```

<Alert level="warning" title="Important">

Make sure to keep your auth token secret and out of version control.

</Alert>

## Step 6: Avoid Ad Blockers With Tunneling (Optional)

You can prevent ad blockers from blocking Sentry events using tunneling. Use the `tunnelRoute` option to add an API endpoint in your application that forwards Sentry events to Sentry servers.

Update `withSentryConfig` in your `next.config.(js|mjs)` file with the following options:

```javascript {tabTitle:ESM} {filename:next.config.mjs}
export default withSentryConfig(nextConfig, {
  // Route browser requests to Sentry through a Next.js rewrite to circumvent ad-blockers.
  // This can increase your server load as well as your hosting bill.
  // Note: Check that the configured route will not match with your Next.js middleware, otherwise reporting of client-side errors will fail.
  tunnelRoute: "/monitoring",
});
```

```javascript {tabTitle:CJS} {filename:next.config.js}
module.exports = withSentryConfig(nextConfig, {
  // Route browser requests to Sentry through a Next.js rewrite to circumvent ad-blockers.
  // This can increase your server load as well as your hosting bill.
  // Note: Check that the configured route will not match with your Next.js middleware, otherwise reporting of client-side errors will fail.
  tunnelRoute: "/monitoring",
});
```

<Alert level="warning" title="Complications with Next.js middleware">
  Client-side event recording will fail if your Next.js middleware intercepts
  the configured route. To prevent this, exclude the tunnel route by adding a
  negative matcher to your middleware like `(?!monitoring-tunnel)`.
</Alert>

## Step 7: Configure Server-side Auto-instrumentation (Optional)

The SDK will automatically instrument API routes and server-side [Next.js data fetching methods](https://nextjs.org/docs/basic-features/data-fetching/overview) with error and tracing.

### Disable API Route, Middleware and Data Fetching Auto-instrumentation Entirely

To disable the automatic instrumentation of API route handlers and server-side data fetching functions, set the `autoInstrumentServerFunctions` to `false`.

```javascript {tabTitle:ESM} {filename:next.config.mjs}
export default withSentryConfig(nextConfig, {
  autoInstrumentServerFunctions: false,
});
```

```javascript {tabTitle:CJS} {filename:next.config.js}
module.exports = withSentryConfig(nextConfig, {
  autoInstrumentServerFunctions: false,
});
```

With this option, under the hood, the SDK is using a webpack loader to wrap all your API route handlers and data fetching methods.

### Opt Out of Sentry SDK bundling in Client- or Server-Side (TODO)

If you want the Sentry SDK to be available in your server-side and not in client-side, you can simply delete `sentry.client.config.js`. This will prevent webpack from pulling in the Sentry related files when generating the browser bundle.
Similarly, to opt out of server-side SDK bundling, you can simply delete the `sentry.server.config.js` and `sentry.edge.config.js` files. Make sure to remove any imports of these files from `instrumentation.ts`.

## Step 10: Verify (TODO)

<Include name="nextjs-turbopack-warning-expandable.mdx" />

Let's test your setup and confirm that Sentry is working correctly and sending data to your Sentry project.

### Issues

To verify that Sentry captures errors and creates issues in your Sentry project, add a test button to an existing page or create a new one:

```jsx
<button
  type="button"
  onClick={() => {
    throw new Error("Sentry Test Error");
  }}
>
  Break the world
</button>
```

<OnboardingOption optionId="performance" hideForThisOption>
  Open the page in a browser (for most Next.js applications, this will be at
  localhost) and click the button to trigger a frontend error.
</OnboardingOption>

<Alert level="warning" title="Important">

Errors triggered from within your browser's developer tools (like the browser console) are sandboxed, so they will not trigger Sentry's error monitoring.

</Alert>

<OnboardingOption optionId="performance">
### Tracing

To test tracing, create a test API route like `/api/sentry-example-api`:

```javascript
import { NextResponse } from "next/server";
export const dynamic = "force-dynamic";

// A faulty API route to test Sentry's error monitoring
export function GET() {
  throw new Error("Sentry Example API Route Error");
  return NextResponse.json({ data: "Testing Sentry Error..." });
}
```

Next, update your test button to call this route and throw an error if the response isn't `ok`:

```tsx
<button
  type="button"
  onClick={async () => {
    await Sentry.startSpan(
      {
        name: "Example Frontend Span",
        op: "test",
      },
      async () => {
        const res = await fetch("/api/sentry-example-api");
        if (!res.ok) {
          throw new Error("Sentry Example Frontend Error");
        }
      }
    );
  }}
>
  Break the world
</button>
```

Open the page in a browser (for most Next.js applications, this will be at localhost) and click the button to trigger two errors:

- a frontend error
- an error within the API route

Additionally, this starts a performance trace to measure the time it takes for the API request to complete.

</OnboardingOption>

### View Captured Data in Sentry

Now, head over to your project on [Sentry.io](https://sentry.io) to view the collected data (it takes a couple of moments for the data to appear).

<Expandable title="Need help locating the captured errors in your Sentry project?">

1. Open the [**Issues**](https://sentry.io/orgredirect/organizations/:orgslug/issues) page and select an error from the issues list to view the full details and context of this error. For an interactive UI walkthrough, click [here](/product/sentry-basics/integrate-frontend/generate-first-error/#ui-walkthrough).
2. Open the [**Traces**](https://sentry.io/orgredirect/organizations/:orgslug/traces) page and select a trace to reveal more information about each span, its duration, and any errors. For an interactive UI walkthrough, click [here](/product/sentry-basics/distributed-tracing/generate-first-error/#ui-walkthrough).
3. Open the [**Replays**](https://sentry.io/orgredirect/organizations/:orgslug/replays) page and select an entry from the list to get a detailed view where you can replay the interaction and get more information to help you troubleshoot.

</Expandable>

## Next Steps

At this point, you should have integrated Sentry into your Next.js application and should already be sending data to your Sentry project.

Now's a good time to customize your setup and look into more advanced topics.
Our next recommended steps for you are:

- Instrument Next.js server actions
- Configure [server-side auto-instrumentation](/platforms/javascript/guides/nextjs/configuration/build/#nextjs-specific-options)
- Learn how to [manually capture errors](/platforms/javascript/guides/nextjs/usage/)
- Continue to [customize your configuration](/platforms/javascript/guides/nextjs/configuration/)
- Learn more about our [Vercel integration](/organization/integrations/deployment/vercel/)

<Expandable permalink={false} title="Are you having problems setting up the SDK?">

- [Get support](https://sentry.zendesk.com/hc/en-us/)

</Expandable>
