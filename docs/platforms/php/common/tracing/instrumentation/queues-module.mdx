---
title: Instrument Queues
sidebar_order: 3000
description: "Learn how to manually instrument your code to use Sentry's Queues module. "
---
Sentry comes with a [queue-monitoring dashboard](https://sentry.io/orgredirect/organizations/:orgslug/insights/queues/)  that can be auto-instrumented by our <PlatformLink to="/guides/laravel/">Laravel SDK</PlatformLink>.

If you're using something else, you can manually instrument your queue producers and consumers to ensure that you have performance data about your messaging queues.

## Producer Instrumentation

Wrap your queue producer code into a span. Your span `op` must be set to `queue.publish`. Include the following span data to enrich your producer spans with additional metrics:

| Data Attribute | Type | Description |
|:--|:--|:--|
| `messaging.message.id ` | string | The message identifier |
| `messaging.destination.name` | string | The queue or topic name |
| `messaging.message.body.size` | int | Size of the message body in bytes |

Make sure that there's a transaction running when you create the spans. See <PlatformLink to="/tracing/">Tracing</PlatformLink> for more information.

You must also include Sentry's trace headers (`sentry-trace` and `baggage`) in your queue job's payload so that your consumers can continue your trace once your job is picked up.


```php

```


## Consumer Instrumentation

Wrap your queue consumer code into a span. Your span `op` must be set to `queue.process`. Include the following span data to enrich your consumer spans with additional metrics:

| Data Attribute | Type | Description |
|:--|:--|:--|
| `messaging.message.id ` | string | The message identifier |
| `messaging.destination.name` | string | The queue or topic name |
| `messaging.message.body.size` | number | Size of the message body in bytes |
| `messaging.message.retry.count ` | number | The number of times a message was attempted to be processed |
| `messaging.message.receive.latency ` | number | The time in milliseconds that a message awaited processing in queue |

Make sure that there's a transaction running when you create the spans. See <PlatformLink to="/tracing/">Tracing</PlatformLink> for more information.

Use `\Sentry\continueTrace()` to connect your consumer spans to their associated producer spans, and `$span->setStatus()` to mark the trace of your message as success or failed.


```php

```
