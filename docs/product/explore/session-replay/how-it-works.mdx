---
title: "How Session Replay Sampling Works"
sidebar_order: 15
description: "Understand the internal mechanism of Session Replay sampling and memory buffering"
---

# How Session Replay Sampling Works

Understanding how Sentry's Session Replay sampling mechanism works internally can help you optimize your configuration and predict what data will be captured.

## Overview

Session Replay uses two sampling rates that work together:

- **`replaysSessionSampleRate`**: Percentage of users who get their entire session recorded
- **`replaysOnErrorSampleRate`**: Percentage of error-encountering users whose sessions get recorded

The key to understanding how these work together is the **memory buffer**.

## Memory Buffer System

### What Gets Stored

Contrary to what you might expect, Session Replay doesn't store actual video files in memory. Instead, it stores **event logs** in a structured format:
```javascript
// Example event log entries
{ time: 1234, type: 'click', x: 100, y: 200 }
{ time: 1235, type: 'input', value: 'cat' }
{ time: 1236, type: 'scroll', x: 0, y: 500 }
```

These event logs are:
- **Lightweight**: Approximately 2-5MB for 60 seconds of activity
- **Structured**: JSON-like format capturing DOM mutations, user interactions, and console logs
- **Reconstructible**: Sentry's server automatically converts these logs into video-like replays

### Buffer Duration and Size

- **Duration**: 60 seconds of the most recent activity
- **Memory footprint**: 2-5MB typically
- **Storage location**: In-memory ring buffer (overwrites old data)
- **Network impact**: Only sent to Sentry when conditions are met

## How Sampling Decisions Work

### Configuration Example
```javascript
Sentry.init({
  dsn: 'YOUR_DSN',
  replaysSessionSampleRate: 0.1,  // 10% of users
  replaysOnErrorSampleRate: 1.0,  // 100% of error-encountering users
});
```

### Decision Flow

When a user visits your application:

1. **Initial Sampling Decision**
   - A random number determines if the user is selected for `replaysSessionSampleRate`
   - If selected (10% chance): Full session recording starts immediately ‚Üí sent to Sentry in real-time
   - If not selected (90% chance): Recording starts but stays in memory buffer only

2. **Error Trigger**
   - If an error occurs and `replaysOnErrorSampleRate` condition is met:
     - The buffered 60 seconds *before* the error is captured
     - Recording continues until the session ends
     - Everything is sent to Sentry

## User Scenarios

### üëÆ Scenario A: Full Session Recording (No Error)

**User type**: Selected for `replaysSessionSampleRate` (10% probability)
```
1. User visits site
2. Random selection ‚Üí Selected (10% chance)
3. Recording starts ‚Üí Sent to Sentry in real-time
4. User browses for 5 minutes
5. Session ends normally
6. ‚úÖ Full 5-minute replay available in Sentry
```

**Result**: Complete session visible in Sentry dashboard

---

### ü•∑ Scenario B: Not Selected, No Error

**User type**: Not selected for `replaysSessionSampleRate` (90% probability)
```
1. User visits site
2. Random selection ‚Üí Not selected (90% chance)
3. Recording starts ‚Üí Stored in 60-second memory buffer only
4. User browses normally (no errors)
5. Session ends
6. Memory buffer discarded
7. ‚ùå No replay in Sentry
```

**Result**: No session data sent to Sentry (saves quota)

---

### üë∞ Scenario C: Not Selected Initially, But Error Occurs

**User type**: Not selected initially, but encounters error
```
1. User visits site
2. Random selection ‚Üí Not selected (90% chance)
3. Recording starts ‚Üí Stored in 60-second memory buffer only
4. User browses for 2 minutes
5. üö® Error occurs!
6. Check replaysOnErrorSampleRate (1.0 = 100%)
7. Memory buffer (last 60 seconds) ‚Üí Sent to Sentry
8. Continue recording until session ends
9. ‚úÖ Replay available showing 60s before error + everything after
```

**Result**: Error replay with valuable context before the error occurred

---

## Key Technical Points

### Why Event Logs Instead of Video?

1. **Privacy**: Text can be masked, images can be blocked
2. **Size**: Event logs are much smaller than video
3. **Flexibility**: Can redact sensitive data before sending
4. **Performance**: Minimal impact on browser performance

### When Data Is Sent to Sentry

| Scenario | When Data Leaves Browser |
|----------|-------------------------|
| Selected for session sampling | Immediately, in real-time chunks |
| Not selected, no error | Never (discarded) |
| Not selected, error occurs | After error + buffer is sent |

### Memory Management

The 60-second buffer is managed as a **ring buffer**:
- Old events are automatically overwritten
- No memory leak concerns
- Stops recording after 60 minutes (hard limit)
- Pauses when internet connection is lost

## Best Practices

### Recommended Configuration
```javascript
Sentry.init({
  dsn: 'YOUR_DSN',
  
  // Capture 10% of sessions for general monitoring
  replaysSessionSampleRate: 0.1,
  
  // Capture 100% of sessions where errors occur
  replaysOnErrorSampleRate: 1.0,
});
```

This configuration:
- ‚úÖ Monitors general user behavior (10% sample)
- ‚úÖ Captures critical error scenarios (100% of errors)
- ‚úÖ Manages quota efficiently
- ‚úÖ Provides valuable debugging context

### Adjusting for Your Needs

- **High-traffic site**: Lower `replaysSessionSampleRate` to 0.01 (1%)
- **Development**: Set both to 1.0 for comprehensive testing
- **Privacy-sensitive**: Keep both low, rely more on error capture
- **Budget-conscious**: Start with errors only (`replaysSessionSampleRate: 0`)

## Further Reading

- [Session Replay Setup Guide](/platforms/javascript/session-replay/)
- [Privacy Configuration](/platforms/javascript/session-replay/privacy/)
- [Performance Overhead](/product/explore/session-replay/web/#performance-overhead)