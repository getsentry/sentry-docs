---
title: Plataforma de incidencias
sidebar_order: 30
og_image: /og-images/backend-issue-platform.jpg
---

La plataforma de incidencias permite a los desarrolladores crear nuevos tipos de incidencia a partir de fuentes de datos arbitrarias. Si tienes datos sobre algo que quieres seguir mediante una incidencia, puedes construirlo en la plataforma de incidencias. Por ejemplo, crear incidencias de perfilado en la plataforma de incidencias nos permitió convertir cosas como “decodificación de JSON en el hilo principal” en sus propios tipos de incidencia.

Para usar la plataforma de incidencias, necesitas:

1. <Link to="#writing-a-detector">Escribir un detector</Link>
2. <Link to="#register-an-issue-type">Registrar un tipo de incidencia</Link>
3. <Link to="#send-payloads-to-the-issue-platform">Enviar cargas útiles a la plataforma de incidencias</Link>
4. <Link to="#releasing-your-issue-type">Publicar</Link>

<div id="writing-a-detector">
  ## Crear un detector
</div>

El primer paso para introducir un nuevo tipo de incidencia en Sentry es determinar qué tipo de incidencia quieres detectar. Puede venir de cualquier flujo de datos, siempre que puedas generar una <Link to="#issue-occurrence-schema">Occurrence</Link> que represente la incidencia.

Crear un detector es la parte más difícil de definir un nuevo tipo de incidencia. Consulta <Link to="/backend/issue-platform-detectors/">esta guía</Link> para obtener consejos sobre cómo escribir uno.

<div id="register-an-issue-type">
  ## Registrar un tipo de incidencia
</div>

Para registrar un nuevo tipo de incidencia, debes crear una subclase de <Link to="https://github.com/getsentry/sentry/blob/ef76b0765f6c057af12b1cd0dc2de6b42a938c02/src/sentry/issues/grouptype.py#L98-L108">`GroupType`</Link>

Al registrar la clase, establece los siguientes atributos obligatorios en la clase:

* `type_id`: Un entero único para identificar tu tipo de incidencia.
* `slug`: Un identificador (slug) único para tu tipo de incidencia. Se usa para buscar por tipo de incidencia en el flujo de incidencias.
* `description`: Una descripción en lenguaje natural de tu tipo de incidencia.
* `category`: La categoría general a la que pertenece tu tipo de incidencia. Puedes <Link to="#register-a-category">registrar una categoría</Link> si las existentes no se ajustan a tu tipo de incidencia.

También puedes establecer estos atributos opcionales:

* `released`: Indica si este tipo de incidencia se ha publicado para todos los clientes. Consulta <Link to="#releasing-your-issue-type">Publicar tu tipo de incidencia</Link>
* `noise_config`: Un `NoiseConfig` que te permite definir la política sobre cuántas veces debe aparecer una huella en un período de tiempo antes de que se cree una incidencia. NoiseConfig tiene dos atributos:
  * `ignore_limit`: Cuántas ocurrencias deben darse antes de crear una nueva incidencia
  * `expiry_time`: El período de tiempo en el que deben producirse las ocurrencias antes de que reiniciemos el conteo
* `enable_auto_resolve`: Indica si este tipo de incidencia puede resolverse automáticamente tras un número de días sin eventos. La ventana de auto&#95;resolve se puede configurar en la configuración de cada proyecto. De forma predeterminada, este atributo está establecido en true.
* `enable_escalation_detection`: Indica si este tipo de incidencia puede escalar usando el <Link to="https://docs.sentry.io/product/issues/states-triage/escalating-issues/">algoritmo de escalado de incidencias</Link>. De forma predeterminada, este atributo está establecido en true.

Aquí tienes un ejemplo de tipo de incidencia:

```python
@dataclass(frozen=True)
class ProfileFileIOGroupType(GroupType):
    type_id = 2001
    slug = "profile_file_io_main_thread"
    description = "E/S de archivos en el hilo principal"
    category = GroupCategory.PROFILE.value
```

y aquí tienes uno con `noise_config` configurado

```python
@dataclass(frozen=True)
class ProfileFileIOGroupType(GroupType):
    type_id = 2001
    slug = "profile_file_io_main_thread"
    description = "E/S de archivos en el hilo principal"
    category = GroupCategory.PROFILE.value
    noise_config = NoiseConfig(5, timedelta(days=2))
```


<div id="register-a-category">
  ### Registrar una categoría
</div>

Quizás también quieras registrar una categoría nueva relacionada con tu tipo de incidencia. Esto te permite agrupar tipos de incidencia relacionados. Para hacerlo, añade tu categoría a <Link to="https://github.com/getsentry/sentry/blob/97f4174c28041357aa190f27012dc33c1c7bafc7/src/sentry/issues/grouptype.py#L17-L22">este enum</Link>

<div id="send-payloads-to-the-issue-platform">
  ## Enviar payloads a la plataforma de incidencias
</div>

Si trabajas dentro del código de Sentry, puedes llamar a <Link to="https://github.com/getsentry/sentry/blob/master/src/sentry/issues/producer.py#L41-L46">sentry.issues.produce_occurrence_to_kafka</Link> con los siguientes parámetros opcionales:

- `payload_type`: <Link to="#payload-type">PayloadType</Link>
- uno de los siguientes, según `payload_type`
  - `occurrence`: <Link to="https://github.com/getsentry/sentry/blob/d262bbd9d8d3a2747d5251bee35c016c13ca050a/src/sentry/issues/issue_occurrence.py#L58">IssueOccurrence</Link>
  - `status_change`: <Link to="https://github.com/getsentry/sentry/blob/7fd40bc33607e727ea2fac0183bd04f4ad298ba3/src/sentry/issues/status_change_message.py#L15">StatusChange</Link>
- `event_data`: Dict[str, Any]

Si trabajas desde un servicio externo, pasa un payload JSON que cumpla con el <Link to="#issue-occurrence-schema">esquema de ocurrencia de incidencias</Link> al tópico `ingest-occurrences` en el <Link to="https://github.com/getsentry/getsentry/blob/97039335a29517a7e48149148cdd7a30a60971e7/getsentry/conf/settings/prod.py#L567-L571">cluster de Kafka de ocurrencias de incidencias</Link>

<div id="payload-type">
  ### Tipo de payload
</div>

Determina el tipo de payload que se envía a la plataforma de incidencias. De forma predeterminada, `payload_type` está establecido en `OCCURRENCE`.

La enumeración <Link to="https://github.com/getsentry/sentry/blob/2e5a39ff3dd4afbd33f2ff7d2ba161285107afe4/src/sentry/issues/producer.py#L23">PayloadType</Link> tiene dos tipos:

- `OCCURRENCE`: para enviar una ocurrencia
- `STATUS_CHANGE`: para enviar una actualización de estado

<div id="issue-occurrence-schema">
  ### Esquema de ocurrencia de incidencia
</div>

<Link to="https://github.com/getsentry/sentry/blob/ccfb37212102945df5f35e8f55fe38891b70036b/src/sentry/issues/issue_occurrence.py#L23-L36">
  Schema
</Link>

Obligatorio:

- `id`: str. Un UUID generado por el usuario en formato de cadena que representa un identificador único para esta ocurrencia.
  En general, es buena idea generarlo por separado del id del evento.
- `project_id`: int. Id del proyecto en el que ocurrió
- `fingerprint`: Sequence[str]. Identificador único de la causa raíz de este problema.
  Se usa para agrupar ocurrencias en conjuntos. Por el momento solo utilizamos la primera
  huella; si tienes un caso de uso para huellas adicionales, házselo saber al equipo de la plataforma de incidencias.
- `issue_title`: str. Una breve descripción del problema. Se usará como título
  de la incidencia y también en notificaciones.
- `subtitle`: str: Detalle adicional sobre la incidencia, mostrado debajo de `issue_title`
- `culprit`: str: Dónde ocurrió el problema. Podría ser una ruta de API, una ruta de función, etc.
  ![propiedades de la incidencia](img/issueProperties.jpg)
- `evidence_data`: Mapping[str, Any]. Un mapa arbitrario de datos. La plataforma de incidencias no
  usa estos datos directamente; solo los pone a disposición para su uso en el frontend y en
  notificaciones. Esto puede usarse para personalizar la interfaz de detalles de la incidencia, las notificaciones, etc.
- `evidence_display`: Sequence[<Link to="#issue-evidence-schema">IssueEvidence</Link>]. Una secuencia de entradas de `IssueEvidence`. Se usan para mostrar información genérica sobre tu incidencia en la interfaz de detalles y en varias notificaciones. Incluso si estás personalizando la interfaz y el correo electrónico, se recomienda incluir esto para que podamos mostrar la información correctamente en todas nuestras demás integraciones. Normalmente, se mostrarán en una tabla cuando el espacio lo permita. En integraciones con espacio limitado mostraremos una fila etiquetada como `important` si está disponible.
- `type`: int: El tipo de incidencia que estás creando. Se asigna a `type_id` en tu `GroupType` registrado.
- `detection_time`: float. Marca de tiempo que indica cuándo se detectó la incidencia.
- `level`: str. Info\Warning\Error

Uno de:

- `event_id`: str. El id de un evento existente; normalmente sería un id de error o de transacción.
- `event`: <Link to="#event-schema">Event</Link>

Opcional:

- `resource_id`: str | None. Un identificador usado para enlazar con un sistema externo y cargar datos.
  Por ejemplo, podría ser un id que usemos para construir un enlace a una página de producto específica.

<div id="issue-evidence-schema">
  ### Esquema de evidencia de incidencia
</div>

<Link to="https://github.com/getsentry/sentry/blob/ccfb37212102945df5f35e8f55fe38891b70036b/src/sentry/issues/issue_occurrence.py#L17-L20">
  Esquema
</Link>

- `name`: str.
- `value`: str
- `important`: bool. Indica si esta entrada contiene datos importantes para mostrar al usuario.
  Se debe marcar una entrada como importante y se mostrará en integraciones con espacio limitado.

La versión más reciente de este esquema está documentada aquí:

<div id="event-schema">
  ### Esquema de eventos
</div>

<Link to="https://github.com/getsentry/sentry/blob/ccfb37212102945df5f35e8f55fe38891b70036b/src/sentry/issues/json_schemas.py#L3">
  Esquema
</Link>

El esquema del evento debe coincidir con el <Link to="/sdk/data-model/event-payloads/">esquema de eventos de Sentry</Link>. Cualquier campo o interfaz definido aquí puede enviarse junto con tu evento. Lo ideal es completar tantos como tenga sentido para tu tipo de incidencia.

Hay un conjunto mínimo de campos que se deben incluir:

- `environment`
- `event_id`
- `platform`
- `project_id`
- `received`
- `tags` - Debe ser un diccionario vacío si no hay etiquetas
- `timestamp`

Advertencias

- Los archivos adjuntos no funcionarán. Si necesitas esto, contacta al equipo de incidencias.

<div id="status-change-schema">
  ### Esquema de cambio de estado
</div>

Si `payload_type` está establecido en `STATUS_CHANGE`, proporcionar un `StatusChangeMessage` actualizará el estado de un issue.

El esquema de `StatusChangeMessage` es el siguiente:

- `fingerprint`: identificador único de la ocurrencia
- `project_id`: int.
- `new_status`: int. Usa el enum <Link url="https://github.com/getsentry/sentry/blob/2e5a39ff3dd4afbd33f2ff7d2ba161285107afe4/src/sentry/models/group.py#L148">GroupStatus</Link>. Actualmente admitimos lo siguiente:
  - `UNRESOLVED`
  - `RESOLVED`
  - `IGNORED`
- `new_substatus`: int | None. Usa el enum <Link url="https://github.com/getsentry/sentry/blob/2e5a39ff3dd4afbd33f2ff7d2ba161285107afe4/src/sentry/types/group.py#L4">GroupSubStatus</Link>. No admitimos el subestado `NEW`.

Al proporcionar `new_status` y `new_substatus`, consulta los estados y transiciones de issues admitidos <Link url="https://docs.sentry.io/product/issues/states-triage/">aquí</Link>.

<div id="releasing-your-issue-type">
  ## Publicar tu tipo de incidencia
</div>

La plataforma de incidencias ofrece funciones para ayudar a publicar tu nuevo tipo de incidencia de forma controlada. Hay 3 flags de funcionalidades que se usan para publicar un tipo de incidencia:

- Ingesta: controla si aceptaremos o descartaremos incidencias de este tipo en nuestro consumidor.
- Postprocesamiento: controla si enviaremos la incidencia a postprocesamiento. Si está deshabilitado, las incidencias se crearán pero no se enviarán notificaciones. Esto puede ser útil para probar cómo se ven las incidencias antes de la publicación. _Nota:_ Cualquier incidencia creada de esta manera no enviará notificaciones de nueva incidencia después de habilitar el flag, ya que ya existe. En el futuro, si hay demanda, podríamos ofrecer una forma de eliminar todas las versiones de prueba de un nuevo tipo de incidencia.
- UI: controla si el tipo de incidencia aparecerá en la lista de incidencias y en otros lugares de la UI.

Estos flags se controlan a través de flagpole y se configuran mediante options automator. Para obtener los valores base de todos ellos y pegarlos fácilmente en flagpole, ejecuta `sentry createissueflag --slug=<your_group_slug> --owner=<your_team_name>`. Los resultados se pueden pegar directamente en flagpole.yml.

Una vez que tu tipo de incidencia esté completamente publicado y quieras que esté disponible en self-hosted y single-tenant, puedes establecer `released = True` en tu GroupType. Esto permite publicarlo en todas partes y elimina los flags de funcionalidades y opciones. En general, recomendamos hacerlo después de que tu tipo de incidencia haya estado en GA el tiempo suficiente para verificar que funciona como se pretende.