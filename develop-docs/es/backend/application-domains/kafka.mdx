---
title: Consumidores de Kafka
sidebar_order: 60
---

<div id="create-a-new-kafka-topic">
  ## Crear un nuevo tema de Kafka
</div>

1. Agrega el tema a `KAFKA_TOPIC_TO_CLUSTER` en [src/sentry/conf/server.py](https://github.com/getsentry/sentry/blob/master/src/sentry/conf/server.py):

* p. ej., `subscription-results-eap-items`

2. Agrega el tema a `Topic` en [src/sentry/conf/types/kafka_definition.py](https://github.com/getsentry/sentry/blob/master/src/sentry/conf/types/kafka_definition.py)

<div id="define-or-re-use-a-processing-strategy">
  ## Definir o reutilizar una estrategia de procesamiento
</div>

En la mayoría de los casos, una [Streaming Factory](https://getsentry.github.io/arroyo/getstarted.html#create-a-streaming-consumer) es lo que necesitas al definir un consumidor (consulta la siguiente sección). Puedes encontrar ejemplos en la [base de código de Sentry](https://github.com/search?q=repo%3Agetsentry%2Fsentry+%28ProcessingStrategyFactory&type=code).

<div id="define-a-new-kafka-consumer">
  ## Definir un nuevo consumidor de Kafka
</div>

1. Añade una nueva entrada en la clave `KAFKA_CONSUMERS` en
   [src/sentry/consumers/**init**.py](https://github.com/getsentry/sentry/blob/master/src/sentry/consumers/__init__.py):

```python
KAFKA_CONSUMERS = {
    "<tu_topic_aquí>": {
        "topic": Topic.YOUR_TOPIC,
        "strategy_factory": "sentry_package_defining_your_strategy_factory_class",
    }
}
```

2. Es posible que necesites propiedades opcionales (p. ej., `click_options`); tendrás que investigarlas revisando el código de [ConsumerDefinition](https://github.com/getsentry/sentry/blob/master/src/sentry/conf/types/kafka_definition.py).

3. Asegúrate de poder ejecutarlo: `sentry run consumer <your_topic>`

4. Es posible que necesites agregar algunas opciones de devserver [aquí](https://github.com/getsentry/sentry/blob/master/src/sentry/runner/commands/devserver.py).

5. Agrega pruebas para tu consumer


<div id="deployment">
  ## Despliegue
</div>

Visita el repositorio de Ops y busca `shared_config/kafka/README.md` para una guía completa y detallada, paso a paso.