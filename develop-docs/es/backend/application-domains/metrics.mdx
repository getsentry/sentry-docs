---
title: Métricas
sidebar_order: 180
---

Sentry ofrece una abstracción llamada «métricas» que se usa para el monitoreo interno, generalmente de tiempos y varios contadores.

El backend predeterminado simplemente las descarta (aunque algunos valores aún se conservan en la base de datos interna de series temporales).

<div id="sentry-metrics-abstraction">
  ## Abstracción de métricas de Sentry
</div>

Para unificar la recopilación de métricas en todo el código de `sentry`, contamos con una abstracción que expone tres métodos para recolectarlas.

* `incr` → emite una métrica de contador.
* `timing` → emite una métrica de distribución (con la unidad `second` en las métricas de Sentry).
* `gauge` → emite una métrica de gauge (por ahora emite un contador, hasta que se complete el trabajo de infraestructura).

Cada método tiene tres parámetros principales:

* `key` → el nombre que identifica de forma única la métrica. Usarás este nombre para especificar la métrica cuando quieras graficarla.
* `value` → el valor de la métrica. Graficarás este valor.
* `tags` → las etiquetas de la métrica. Usarás las etiquetas para adjuntar metadatos a la métrica, lo cual puede ser útil para agregaciones.

Para usar la abstracción de métricas, primero tendrás que importarla:

```python
from sentry.utils import metrics
```

Una vez que lo importes, puedes empezar a emitir métricas:

```python
# Emite un contador.
metrics.incr(
	"counter_name",
	tags={"platform": platform}
)

# Emite una distribución.
metrics.distribution(
	"gauge_name",
	10,
	tags={"nation": nation},
	unit="second",
)

# Emite un gauge.
metrics.gauge(
	"gauge_name",
	10,
	tags={"nation": nation}
)

# Emite una distribución (con la unidad predeterminada basada en el tiempo).
metrics.timing(
	"distribution_name",
	100,
	tags={"user_segment": user_segment}
)
```

Si quieres medir cuánto tarda un fragmento específico de código, puedes usar:

```python
# Emitir una métrica de distribución del tiempo de ejecución de la función.
with metrics.timer("my_func"):
	my_func()
```


<div id="statsd-backend">
  ## Backend de StatsD
</div>

```python
SENTRY_METRICS_BACKEND = 'sentry.metrics.statsd.StatsdMetricsBackend'
SENTRY_METRICS_OPTIONS = {
    'host': 'localhost',
    'port': 8125,
}
```


<div id="datadog-backend">
  ## Backend de Datadog
</div>

Datadog requiere que instales el paquete `datadog` en tu entorno de Sentry:

```bash
$ pip install datadog
```

En tu archivo `sentry.conf.py`:

```python
SENTRY_METRICS_BACKEND = 'sentry.metrics.datadog.DatadogMetricsBackend'
SENTRY_METRICS_OPTIONS = {
    'api_key': '...',
    'app_key': '...',
    'tags': {},
}
```

Una vez instalado, las métricas de Sentry se enviarán a la [API REST de Datadog](https://docs.datadoghq.com/api/?lang=python#post-time-series-points) por HTTPS.


<div id="dogstatsd-backend">
  ## Backend de DogStatsD
</div>

Para usar el backend de DogStatsD, necesitas que un [Datadog Agent](https://docs.datadoghq.com/agent/) esté en ejecución con el backend de DogStatsD (habilitado de forma predeterminada en el puerto 8125).

También debes instalar el paquete de Python `datadog` en tu entorno de Sentry:

```bash
$ pip install datadog
```

En tu `sentry.conf.py`:

```python
SENTRY_METRICS_BACKEND = 'sentry.metrics.dogstatsd.DogStatsdMetricsBackend'
SENTRY_METRICS_OPTIONS = {
    'statsd_host': 'localhost',
    'statsd_port': 8125,
    'tags': {},
}
```

Una vez configurado, el backend de métricas enviará datos al servidor DogStatsD y luego los enviará periódicamente a Datadog mediante HTTPS.
