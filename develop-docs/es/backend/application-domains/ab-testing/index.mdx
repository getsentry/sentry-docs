---
title: Tests A/B con Amplitude
sidebar_order: 50
---

<div id="why-ab-testing">
  ## ¿Por qué hacer pruebas A/B?
</div>

1. Es una forma directa y fácil de entender de validar tu hipótesis o un cambio en el producto
2. Incluso cuando sabes que tu cambio supone una mejora, te permite cuantificar su impacto

[Más información](https://www.optimizely.com/optimization-glossary/ab-testing/)

<div id="example">
  ## Ejemplo
</div>

- Agregar un Button “Sign up with GitHub” a la página de registro
- Hipótesis: la tasa de registro aumentará porque habrá una forma más fácil de registrarse

Mostramos a la mitad de los visitantes la nueva página de registro y a la otra mitad la página anterior. Resultó que no hubo efecto en la tasa de registro; es decir, la gente sí usa GitHub para registrarse, pero si no está disponible, utiliza el formulario normal.

<div id="details">
  ## Detalles
</div>

Nuestra plataforma de pruebas A/B está basada en la [biblioteca PlanOut de Facebook](https://github.com/facebookarchive/planout).

Supongamos que quieres optimizar la tasa de clics de los enlaces de Sentry y decides probar si mostrar los complementos en el Directorio de integraciones.

En cualquier experimento, hay 2 eventos de interés:

- Exposición: cuando el usuario está expuesto al experimento. En este caso, cuando se muestra un enlace.
- Acción: el comportamiento que queremos observar, que siempre debe estar asociado a una métrica. En este caso, la acción es un clic y la métrica es la tasa de clics.

<div id="adding-an-ab-test">
  ## Agregar una prueba A/B
</div>

Para lanzar la prueba A/B, deberás hacer lo siguiente:

1. Configura una prueba A/B en GetSentry para asignar usuarios/organizaciones a diferentes grupos de prueba.
2. Agrega el experimento a la lista de experimentos en Sentry para las definiciones de TypeScript.
3. Añade la lógica donde necesites controlar el comportamiento dentro de la aplicación.

<div id="changes-to-getsentrygetsentry">
  ### Cambios en `getsentry/getsentry`
</div>

En **getsentry/getsentry**, busca el archivo `getsentry/experiments/config.py`. En este archivo definirás una clase de experimento que herede de `OrgExperiment` o `UserExperiment`. Elige una según si quieres asignar el experimento a cada usuario o a cada organización.

Para este ejemplo, usaremos `OrgExperiment`; de este modo, todos en la organización recibirán la misma asignación de experimento.

```python
# En getsentry/experiments/config.py

from __future__ import absolute_import

from django.conf import settings

from .base import OrgExperiment
from planout.ops.random import WeightedChoice

WEIGHT_VARIANT = 0.5

class ShowPluginsExperiment(OrgExperiment):
    def default_value(self):
        return "0"

    def assign(self, params, org, actor):
        if settings.IS_TEST or org.slug == "sentry":
            params.variant = "1"
        else:
            params.variant = WeightedChoice(
                choices=["0", "1"], weights=[1 - WEIGHT_VARIANT, WEIGHT_VARIANT], unit=org.id
            )
```

* Puedes establecer el valor de la asignación según lo que necesite tu experimento.
* Lógica de asignación: la función `assign` en la clase del experimento determina en qué grupo se ubica una entidad. En el caso más simple, hay dos grupos: control y prueba. Si es así, puedes usar `BernoulliTrial` para generar el valor de prueba. Si tienes tres o más grupos, puedes usar `UniformChoice`. También puedes incorporar la lógica personalizada que quieras, como habilitar un experimento si se activa un feature flag en particular.
* Puedes usar otros operadores de asignación aleatoria.

Estamos configurando los valores en &quot;0&quot; o &quot;1&quot; y dando un 50% de probabilidad de que una organización vea los plugins en el Directorio de Integraciones.

Inicializa el experimento en `getsentry/web/apps.py`:

Si agregas tu experimento a `getsentry/experiments/config.py` ACTIVE&#95;EXPERIMENTS, entonces se inicializará automáticamente gracias a este fragmento de código. Así que no es necesario hacer ninguna modificación.

```python
class Config(AppConfig):
  for experiment in ACTIVE_EXPERIMENTS:
    expt_manager.add(experiment, experiment.param_name)
```


<div id="changes-to-getsentrysentry">
  ### Cambios en **`getsentry/sentry`**
</div>

En `static/app/data/experimentConfig.tsx`:

```tsx
export const experimentList = [
  {
    key: 'ShowPluginsExperiment',
    type: ExperimentType.Organization,
    parameter: 'exposed',
    assignments: [0, 1],
  },
] as const;
```

Ahora el experimento está disponible en las props de `organization`. Puedes acceder a él con:

`organization?.experiments?.ShowPluginsExperiment`.

Ahora puedes crear lógica condicional para mostrar la vista que quieras, según si pertenecen al experimento o al grupo de control.


<div id="adding-logic">
  ### Agregar lógica
</div>

Para usar el experimento para controlar la lógica en la app del front-end, debes usar el HoC `withExperiment`. Aquí tienes un [ejemplo](https://github.com/getsentry/sentry/blob/76acba78e8bbd730873bb46e04f7930bb748d371/src/sentry/static/sentry/app/views/organizationIntegrations/integrationListDirectory.tsx#L491-L495). Esto añadirá una prop llamada `experimentAssignment` que puedes usar para determinar qué experiencia mostrar.

<div id="logging-the-experiment">
  ### Registro del experimento
</div>

Para medir el resultado del experimento, necesitamos registrarlo. Esto genera un evento `Triggered Experiment (Deduped)` en Amplitude que puedes usar como primer paso de tu embudo (ejemplo [aquí](https://analytics.amplitude.com/sentry/chart/u5gt3z8)). Si usas `withExperiment`, registrará el experimento automáticamente cuando el componente se monte. Si quieres registrar el experimento solo bajo ciertas condiciones (p. ej., que la organización no cumpla los criterios para el experimento), establece `injectLogExperiment` en `true`, y el hijo del HoC será responsable de llamar a `logExperiment`.

<div id="backend-ab-testing">
  ### Pruebas A/B en el backend
</div>

Es posible ejecutar pruebas A/B solo en el backend, donde los valores del experimento deben leerse de forma distinta a como se hace en el frontend. Para ello, debes hacer lo siguiente:

```python
from sentry.experiments import manager as expt_manager

# obtiene el valor asignado de ExampleMultiChoiceExperiment
exposed = expt_manager.get("ExampleMultiChoiceExperiment", org=org, actor=user)
```

Luego puedes añadir comprobaciones sobre el valor de `exposed` para orientar la lógica dentro de tu app.


<div id="logging-the-experiment-on-the-backend">
  ### Registrar el experimento en el backend
</div>

Registrar el experimento en el backend puede ser complicado porque genera un evento de analítica cada vez que se activa. Eso podría ser demasiados eventos según la frecuencia con que se invoque. Consulta la implementación del [endpoint de registro del experimento](https://github.com/getsentry/getsentry/blob/master/getsentry/web/experiment.py) para ver cómo registrarlo en el backend.