---
title: Módulo de agentes de IA
---

El módulo de agentes de IA es independiente de la biblioteca utilizada. El SDK instrumentará agentes de IA existentes en ciertos frameworks o bibliotecas (al momento de escribir esto, estos son `openai-agents` en Python y `Vercel AI` en JavaScript). Es posible que debas anotar spans manualmente para otras bibliotecas.

<div id="spans-conventions">
  ## Convenciones de spans
</div>

Para que los datos de tus agentes de IA aparezcan en [AI Agents Insights](https://sentry.io/orgredirect/organizations/:orgslug/insights/ai/agents/) de Sentry, deben crearse varios spans diferentes con nombres y atributos de datos bien definidos. Si faltan los datos obligatorios (marcados como MUST o required), no se mostrarán en el panel de Agents.

Procuramos seguir la [v1.36.0](https://github.com/open-telemetry/semantic-conventions/blob/v1.36.0/docs/gen-ai/README.md) de las [OpenTelemetry Semantic Conventions](https://opentelemetry.io/docs/specs/semconv/gen-ai/) para IA generativa lo más fielmente posible. Aún no es posible ser 100% compatibles, porque OpenTelemetry tiene "Span Events", que Sentry no admite. La entrada y salida de un modelo de IA se almacena en eventos de span en OpenTelemetry. Dado que esto no es posible en Sentry, añadimos estos datos a los atributos del span como una lista.

<Alert level="success" title="Sugerencia">
Las [Sentry Conventions](https://getsentry.github.io/sentry-conventions/generated/attributes/) contienen todas las especificaciones detalladas para los atributos de span `"gen_ai.*"`.

Sentry Conventions es la única fuente de la verdad.

</Alert>

<div id="create-agent-span">
  ## Crear span de agente
</div>

Describe la invocación de un agente de IA.

- El `op` del span DEBE ser `"gen_ai.create_agent"`.
- El `name` del span DEBERÍA ser `"create_agent {gen_ai.agent.name}"` (p. ej., `"create_agent Weather Agent"`).
- El atributo `gen_ai.operation.name` DEBE ser `"create_agent"`.
- El atributo `gen_ai.agent.name` DEBERÍA establecerse con el nombre del agente (p. ej., `"Weather Agent"`).
- TODOS los [atributos comunes del span](#common-span-attributes) DEBERÍAN establecerse (todos los atributos comunes marcados como `required` DEBEN establecerse).

<div id="invoke-agent-span">
  ## Span de invocación de agente
</div>

Describe la invocación de un agente de IA.

- El `op` del span DEBE ser `"gen_ai.invoke_agent"`.
- El `name` del span DEBERÍA ser `"invoke_agent {gen_ai.agent.name}"` (p. ej., `"invoke_agent Weather Agent"`).
- El atributo `gen_ai.operation.name` DEBE ser `"invoke_agent"`.
- El atributo `gen_ai.agent.name` DEBERÍA establecerse con el nombre del agente (p. ej., `"Weather Agent"`).
- Todos los [atributos comunes del span](#common-span-attributes) DEBERÍAN establecerse (todos los atributos comunes marcados como `required` DEBEN establecerse).

Atributos adicionales en el span:

<div id="request-data">
  ### Datos de la solicitud
</div>

| Atributo                           | Tipo   | Nivel de obligatoriedad | Descripción                                                                                | Ejemplo                                                    |
| :--------------------------------- | :----- | :----------------------- | :----------------------------------------------------------------------------------------- | :--------------------------------------------------------- |
| `gen_ai.request.messages`          | string | opcional                 | Lista de diccionarios que describen los mensajes (prompts) dados al agente **[0]**, **[1]** | `'[{"role": "system", "content": "..."} , ...]'`           |
| `gen_ai.request.available_tools`   | string | opcional                 | Lista de diccionarios que describen las herramientas disponibles. **[0]**                  | `'[{"name": "random_number", "description": "..."}, ...]'` |
| `gen_ai.request.max_tokens`        | int    | opcional                 | Parámetro de configuración del modelo.                                                     | `500`                                                      |
| `gen_ai.request.frequency_penalty` | float  | opcional                 | Parámetro de configuración del modelo.                                                     | `0.5`                                                      |
| `gen_ai.request.presence_penalty`  | float  | opcional                 | Parámetro de configuración del modelo.                                                     | `0.5`                                                      |
| `gen_ai.request.temperature`       | float  | opcional                 | Parámetro de configuración del modelo.                                                     | `0.1`                                                      |
| `gen_ai.request.top_p`             | float  | opcional                 | Parámetro de configuración del modelo.                                                     | `0.7`                                                      |

<div id="response-data">
  ### Datos de la respuesta
</div>

| Atributo                     | Tipo   | Nivel de requisito | Descripción                                      | Ejemplo                                                                       |
| :--------------------------- | :----- | :----------------- | :----------------------------------------------- | :----------------------------------------------------------------------------- |
| `gen_ai.response.text`       | string | opcional           | La representación en texto de la respuesta del agente. | `"The weather in Paris is rainy"`                                            |
| `gen_ai.response.tool_calls` | string | opcional           | Las llamadas de herramientas en la respuesta del modelo. **[0]** | `'[{"name": "random_number", "type": "function_call", "arguments": "..."}]'` |

<div id="token-usage-data">
  ### Datos de uso de tokens
</div>

| Atributo                               | Tipo | Nivel de requisito | Descripción                                                                | Ejemplo |
| :------------------------------------- | :--- | :----------------- | :------------------------------------------------------------------------- | :------ |
| `gen_ai.usage.input_tokens`            | int  | opcional           | Número de tokens usados en la entrada de la IA (prompt).                  | `10`    |
| `gen_ai.usage.input_tokens.cached`     | int  | opcional           | Número de tokens en caché usados en la entrada de la IA (prompt). **[2]** | `50`    |
| `gen_ai.usage.output_tokens`           | int  | opcional           | Número de tokens usados en la respuesta de la IA.                         | `100`   |
| `gen_ai.usage.output_tokens.reasoning` | int  | opcional           | Número de tokens usados para el razonamiento. **[3]**                     | `30`    |
| `gen_ai.usage.total_tokens`            | int  | opcional           | Número total de tokens usados para procesar el prompt (entrada y salida). | `190`   |

- **[0]:** Los atributos de Span solo permiten tipos de datos primitivos (como `int`, `float`, `boolean`, `string`). Esto significa que debes usar una versión en cadena de una lista de diccionarios. NO configures el objeto/arreglo `[{"foo": "bar"}]`, sino la cadena `'[{"foo": "bar"}]'` (debe ser JSON analizables).
- **[1]:** Cada elemento de mensaje usa el formato `{role:"", content:""}`. El `role` debe ser `"user"`, `"assistant"`, `"tool"` o `"system"`. Para mensajes con el rol `tool`, el `content` puede ser una cadena o un objeto arbitrario con información sobre la llamada a la herramienta. Para otros mensajes, el `content` puede ser una cadena o una lista de diccionarios con el formato `{type: "text", text:"..."}`.
- **[2]:** Los tokens en caché son un subconjunto de los tokens de entrada; `gen_ai.usage.input_tokens` incluye `gen_ai.usage.input_tokens.cached`.
- **[3]:** Los tokens de razonamiento son un subconjunto de los tokens de salida; `gen_ai.usage.output_tokens` incluye `gen_ai.usage.output_tokens.reasoning`.

<div id="ai-client-span">
  ## Intervalo del cliente de IA
</div>

Este intervalo representa una solicitud a un modelo o servicio de IA que genera una respuesta o solicita una llamada a una herramienta con base en el prompt de entrada.

- El `op` del intervalo DEBE ser `"gen_ai.{gen_ai.operation.name}"`. (p. ej., `"gen_ai.chat"`)
- El `name` del intervalo DEBERÍA ser `{gen_ai.operation.name} {gen_ai.request.model}"`. (p. ej., `"chat o3-mini"`)
- El atributo `gen_ai.operation.name` DEBE ser la operación realizada.[3] (p. ej., `"chat"`.)
- Todos los [Atributos comunes del intervalo](#common-span-attributes) DEBERÍAN establecerse (todos los atributos comunes `required` DEBEN establecerse).

Atributos adicionales en el intervalo:

<div id="request-data">
  ### Datos de la solicitud
</div>

| Atributo                           | Tipo   | Nivel de requisito | Descripción                                                                              | Ejemplo                                                    |
| :--------------------------------- | :----- | :----------------- | :--------------------------------------------------------------------------------------- | :--------------------------------------------------------- |
| `gen_ai.request.messages`          | string | opcional           | Lista de diccionarios que describen los mensajes (prompts) enviados al LLM **[0]**, **[1]** | `'[{"role": "system", "content": "..."}, ...]'`            |
| `gen_ai.request.available_tools`   | string | opcional           | Lista de diccionarios que describen las herramientas disponibles. **[0]**                | `'[{"name": "random_number", "description": "..."}, ...]'` |
| `gen_ai.request.frequency_penalty` | float  | opcional           | Parámetro de configuración del modelo.                                                   | `0.5`                                                      |
| `gen_ai.request.max_tokens`        | int    | opcional           | Parámetro de configuración del modelo.                                                   | `500`                                                      |
| `gen_ai.request.presence_penalty`  | float  | opcional           | Parámetro de configuración del modelo.                                                   | `0.5`                                                      |
| `gen_ai.request.temperature`       | float  | opcional           | Parámetro de configuración del modelo.                                                   | `0.1`                                                      |
| `gen_ai.request.top_p`             | float  | opcional           | Parámetro de configuración del modelo.                                                   | `0.7`                                                      |

### Datos de respuesta

| Atributo                    | Tipo   | Nivel de obligatoriedad | Descripción                                              | Ejemplo                                                                       |
| :-------------------------- | :----- | :----------------------- | :------------------------------------------------------- | :---------------------------------------------------------------------------- |
| `gen_ai.response.text`       | string | opcional                 | La representación textual de la respuesta del modelo. **[0]** | `"The weather in Paris is rainy"`                                             |
| `gen_ai.response.tool_calls` | string | opcional                 | Las llamadas a herramientas en la respuesta del modelo. **[0]** | `'[{"name": "random_number", "type": "function_call", "arguments": "..."}]'` |

<div id="token-usage-data">
  ### Datos de uso de tokens
</div>

| Atributo                               | Tipo | Nivel de requisito | Descripción                                                                | Ejemplo |
| :------------------------------------- | :--- | :----------------- | :------------------------------------------------------------------------- | :------ |
| `gen_ai.usage.input_tokens`            | int  | opcional           | El número de tokens usados en la entrada de la IA (prompt).               | `10`    |
| `gen_ai.usage.input_tokens.cached`     | int  | opcional           | El número de tokens en caché usados en la entrada de la IA (prompt). **[2]** | `50`    |
| `gen_ai.usage.output_tokens`           | int  | opcional           | El número de tokens usados en la respuesta de la IA.                      | `100`   |
| `gen_ai.usage.output_tokens.reasoning` | int  | opcional           | El número de tokens usados para el razonamiento. **[3]**                  | `30`    |
| `gen_ai.usage.total_tokens`            | int  | opcional           | El número total de tokens usados para procesar el prompt (entrada y salida). | `190`   |

- **[0]:** Los atributos de span solo permiten tipos de datos primitivos (como `int`, `float`, `boolean`, `string`). Esto significa que debes usar una versión en cadena de una lista de diccionarios. NO establezcas el objeto/arreglo `[{"foo": "bar"}]`, sino la cadena `'[{"foo": "bar"}]'` (debe ser JSON analizable).
- **[1]:** Cada elemento de mensaje usa el formato `{role:"", content:""}`. El `role` debe ser `"user"`, `"assistant"`, `"tool"` o `"system"`. Para mensajes con el rol `tool`, el `content` puede ser una cadena o un objeto arbitrario con información sobre la llamada a la herramienta. Para otros mensajes, el `content` puede ser una cadena o una lista de diccionarios con el formato `{type: "text", text:"..."}`.
- **[2]:** Los tokens en caché son un subconjunto de los tokens de entrada; `gen_ai.usage.input_tokens` incluye `gen_ai.usage.input_tokens.cached`.
- **[3]:** Los tokens de razonamiento son un subconjunto de los tokens de salida; `gen_ai.usage.output_tokens` incluye `gen_ai.usage.output_tokens.reasoning`.

<div id="execute-tool-span">
  ## Intervalo de ejecución de herramienta
</div>

Describe la ejecución de una herramienta.

- El `op` del intervalo DEBE ser `"gen_ai.execute_tool"`.
- El `name` del intervalo DEBERÍA ser `"execute_tool {gen_ai.tool.name}"`. (p. ej., `"execute_tool query_database"`)
- El atributo `gen_ai.operation.name` DEBE ser `"execute_tool"`.
- El atributo `gen_ai.tool.name` DEBERÍA establecerse con el nombre de la herramienta. (p. ej., `"query_database"`)
- Todos los [atributos comunes del intervalo](#common-span-attributes) DEBERÍAN establecerse (todos los atributos comunes marcados como `required` DEBEN establecerse).

Atributos adicionales en el intervalo:

<div id="tool-data">
  ### Datos de la herramienta
</div>

| Atributo                  | Tipo   | Nivel de requisito | Descripción                                          | Ejemplo                                    |
| :------------------------ | :----- | :----------------- | :--------------------------------------------------- | :----------------------------------------- |
| `gen_ai.tool.name`        | string | optional           | Nombre de la herramienta ejecutada.                  | `"random_number"`                          |
| `gen_ai.tool.description` | string | optional           | Descripción de la herramienta ejecutada.             | `"Herramienta que devuelve un número aleatorio"` |
| `gen_ai.tool.type`        | string | optional           | Tipo de herramienta.                                 | `"function"`; `"extension"`; `"datastore"` |
| `gen_ai.tool.input`       | string | optional           | Entrada proporcionada a la herramienta ejecutada como cadena. | `'{"max":10}'`                             |
| `gen_ai.tool.output`      | string | optional           | Salida de la herramienta.                            | `"7"`                                      |

<div id="handoff-span">
  ## Span de traspaso
</div>

Un span que describe el traspaso de un agente a otro.

- El `op` del span DEBE ser `"gen_ai.handoff"`.
- El `name` del span DEBERÍA ser `"handoff from {from_agent} to {to_agent}"`.
- Todos los [atributos comunes del span](#common-span-attributes) DEBERÍAN establecerse (todos los atributos comunes `required` DEBEN establecerse).

<div id="common-span-attributes">
  ## Atributos comunes de los spans
</div>

Algunos atributos son comunes a todos los spans de AI Agents:

| Atributo                | Tipo   | Nivel de requisito | Descripción                                                                                      | Ejemplo               |
| :---------------------- | :----- | :----------------- | :----------------------------------------------------------------------------------------------- | :-------------------- |
| `gen_ai.operation.name` | string | obligatorio        | Nombre de la operación que se está realizando. **[2]**                                           | `"chat"`              |
| `gen_ai.request.model`  | string | obligatorio        | Nombre del modelo de IA al que se hace la solicitud.                                             | `"gpt-4o"`            |
| `gen_ai.response.model` | string | opcional           | Nombre del modelo de IA con el que se creó la respuesta.                                         | `"gpt-4o-2024-08-06"` |
| `gen_ai.agent.name`     | string | opcional           | Nombre del agente al que pertenece este span.                                                    | `"Weather Agent"`     |
| `gen_ai.system`         | string | opcional           | Producto de IA generativa identificado por la instrumentación del cliente o del servidor. **[3]** | `"openai"`            |

**[2]** Valores definidos para el atributo de datos `gen_ai.operation.name`:

| Valor                | Descripción                                                                |
| :------------------- | :------------------------------------------------------------------------- |
| `"chat"`             | Operación de finalización de chat, como OpenAI Chat API                    |
| `"responses"`        | OpenAI Responses API                                                       |
| `"create_agent"`     | Crear agente de GenAI                                                      |
| `"embeddings"`       | Operación de embeddings, como OpenAI Create embeddings API                 |
| `"execute_tool"`     | Ejecutar una herramienta                                                   |
| `"generate_content"` | Operación de generación de contenido multimodal, como Gemini Generate Content |
| `"invoke_agent"`     | Invocar agente de GenAI                                                    |

**[3]** Valores definidos para el atributo de datos `gen_ai.system`:

| Valor               | Descripción                              |
| :------------------ | :--------------------------------------- |
| `"anthropic"`       | Anthropic                                |
| `"aws.bedrock"`     | AWS Bedrock                              |
| `"az.ai.inference"` | Azure AI Inference                       |
| `"az.ai.openai"`    | Azure OpenAI                             |
| `"cohere"`          | Cohere                                   |
| `"deepseek"`        | DeepSeek                                 |
| `"gcp.gemini"`      | Gemini                                   |
| `"gcp.gen_ai"`      | Cualquier endpoint de IA generativa de Google |
| `"gcp.vertex_ai"`   | Vertex AI                                |
| `"groq"`            | Groq                                     |
| `"ibm.watsonx.ai"`  | IBM Watsonx AI                           |
| `"mistral_ai"`      | Mistral AI                               |
| `"openai"`          | OpenAI                                   |
| `"perplexity"`      | Perplexity                               |
| `"xai"`             | xAI                                      |

<div id="size-limits">
  ## Límites de tamaño
</div>

Además de los [límites generales de tamaño](https://docs.sentry.io/concepts/data-management/size-limits/) para eventos, spans y adjuntos, existen límites de tamaño específicos para las integraciones de IA:

- Los mensajes de entrada en integraciones de IA registrados en el atributo de span `gen_ai.request.messages` están limitados a 20 kB por span. Si superan el límite, los mensajes se recortan y se truncan, conservando los más recientes.