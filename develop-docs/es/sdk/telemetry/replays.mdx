---
title: Reproducciones
sidebar_order: 5
---

Este documento define el formato que usa Sentry para incorporar reproducciones. Está dirigido a desarrolladores del SDK de Sentry y a los responsables del pipeline de ingesta de Session Replay.

Un elemento `"replay_event"` siempre debe enviarse junto con un elemento `"replay_recording"` en el mismo sobre (envelope).

<div id="replay_event-item">
  ## Elemento `"replay_event"`
</div>

<div id="replay-attributes">
  ### Atributos de Replay
</div>

Los siguientes atributos son específicos del tipo de elemento `"replay_event"`.

| Key                    | Type                      | Description                                                                                                                                                                                                                                                                        |
| ---------------------- | ------------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| type                   | `"replay_event"`          | Debe ser `"replay_event"`                                                                                                                                                                                                                                                          |
| replay&#95;id              | string                    | ID único del replay. Cumple los [mismos requisitos](/es/sdk/data-model/event-payloads/#required-attributes) que un `event_id`: cadena hexadecimal que representa un valor uuid4. La longitud es exactamente de 32 caracteres. No se permiten guiones. Debe estar en minúsculas.       |
| replay&#95;type            | `"session"` | `"buffer"` | Describe el tipo de replay. `buffer` significa que el replay se almacena en búfer mientras espera a que ocurra un error o hasta que se realice un vaciado manual. `session` significa que el replay comienza a grabar de inmediato y continúa durante toda la sesión de replay.    |
| segment&#95;id             | number                    | ID del segmento.                                                                                                                                                                                                                                                                   |
| replay&#95;start&#95;timestamp | number                    | Marca de tiempo UNIX del inicio del replay (en segundos). Solo se requiere en el primer segmento.                                                                                                                                                                                  |
| urls                   | list[string]              | Lista de URL en orden de visita.                                                                                                                                                                                                                                                   |
| trace&#95;ids              | list[string]              | Lista de IDs de traza que ocurrieron durante el replay.                                                                                                                                                                                                                            |
| error&#95;ids              | list[string]              | **EN DESUSO**                                                                                                                                                                                                                                                                       |

<div id="event-attributes">
  ### Atributos del evento
</div>

Los siguientes atributos son un subconjunto de los [atributos opcionales](/es/sdk/data-model/event-payloads/#optional-attributes) de un evento.

| Clave                      | Tipo   | Descripción                                      |
| -------------------------- | ------ | ------------------------------------------------ |
| timestamp                  | number | Marca de tiempo UNIX del momento actual (en segundos). |
| event&#95;id                   | string | Debe ser el mismo que `replay_id`               |
| dist                       | string | -                                                |
| platform                   | string | -                                                |
| environment                | string | -                                                |
| release                    | string | -                                                |
| user.id                    | string | -                                                |
| user.username              | string | -                                                |
| user.email                 | string | -                                                |
| user.ip&#95;address            | string | -                                                |
| sdk.name                   | string | -                                                |
| sdk.version                | string | -                                                |
| request.url                | string | -                                                |
| request.headers.User-Agent | string | -                                                |

<div id="example">
  ### Ejemplo
</div>

```json
{
  "type": "replay_event",
  "replay_id": "36b75d9fa11f45459412a96c41bdf691",
  "replay_start_timestamp": 1710861499.287,
  "replay_type": "session",
  "segment_id": 0,
  "trace_ids": ["905aef2282af5fe2ab2c93aa7a340521"],
  "urls": [
    "https://sentry.io/issues/",
    "https://sentry.io/issues/?project=0&statsPeriod=7d&utc=true"
  ],

  "request": {
    "url": "https://sentry.io/issues/?project=0&statsPeriod=7d&utc=true",
    "headers": {
      "User-Agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (como Gecko) Chrome/122.0.0.0 Safari/537.36"
    }
  },
  "timestamp": 1710861507.579,
  "event_id": "36b75d9fa11f45459412a96c41bdf691",
  "environment": "prod",
  "release": "frontend@f00",
  "sdk": {
    "integrations": ["BrowserTracing", "BrowserProfiling", "Replay", "ReplayCanvas"],
    "name": "sentry.javascript.react",
    "version": "7.105.0"
  },
  "tags": {
    "sentry_version": "24.4.0.dev0"
  },
  "user": {
    "ip_address": "127.0.0.1",
    "email": "admin@sentry.io",
    "id": 1,
    "name": "Admin"
  },
  "contexts": {"organization": {"id": "0", "slug": "sentry"}},
  "platform": "javascript"
}
```

<div id="replay_recording-item">
  ## Elemento `"replay_recording"`
</div>

El elemento `"replay_recording"` consta de dos subelementos separados por saltos de línea. El primero es un JSON con los metadatos de la reproducción grabada. Actualmente, solo se requiere `segment_id`.

```json
{"segment_id": 0}
```

El otro subelemento es el conjunto de instrucciones de la grabación de replay. Esta carga útil debe estar comprimida con gzip, pero también se aceptan cargas sin comprimir. Lee más sobre <Link to="/sdk/data-model/event-payloads/replay-recording/">eventos de grabación de replay aquí</Link>.

```json
[
  {
    "type": 5,
    "timestamp": 1710861507579,
    "data": {}
  }
]
```

<div id="example">
  ### Ejemplo
</div>

```
{"segment_id": 0}
\x00\x00\x00\x14ftypqt  \x00\x00\x00\x00qt  \x00\x00\x00\x08wide\x03\xbdd\x11mdat
```

<div id="full-envelope-example">
  ## Ejemplo completo de Envelope
</div>

```json
{"event_id":"36b75d9fa11f45459412a96c41bdf691","sent_at":"2024-03-19T15:18:27.581Z","sdk":{"name":"sentry.javascript.react","version":"7.105.0"}}
{"type":"replay_event"}
{
  "type": "replay_event",
  "replay_id": "36b75d9fa11f45459412a96c41bdf691",
  "replay_start_timestamp": 1710861499.287,
  "replay_type": "session",
  "segment_id": 0,
  "trace_ids": ["905aef2282af5fe2ab2c93aa7a340521"],
  "urls": [
    "https://sentry.io/issues/",
    "https://sentry.io/issues/?project=0&statsPeriod=7d&utc=true"
  ],

  "request": {
    "url": "https://sentry.io/issues/?project=0&statsPeriod=7d&utc=true",
    "headers": {
      "User-Agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/122.0.0.0 Safari/537.36"
    }
  },
  "timestamp": 1710861507.579,
  "event_id": "36b75d9fa11f45459412a96c41bdf691",
  "environment": "prod",
  "release": "frontend@f00",
  "sdk": {
    "integrations": [
      "BrowserTracing",
      "BrowserProfiling",
      "Replay",
      "ReplayCanvas"
    ],
    "name": "sentry.javascript.react",
    "version": "7.105.0"
  },
  "tags": {
    "sentry_version": "24.4.0.dev0",
  },
  "user": {
    "ip_address": "127.0.0.1",
    "email": "admin@sentry.io",
    "id": 1,
    "name": "Admin"
  },
  "contexts": { "organization": { "id": "0", "slug": "sentry" } },
  "platform": "javascript"
}
{"type":"replay_recording","length":141666}
{"segment_id":0}
/* carga útil JSON comprimida con gzip */
```

<div id="sdk-behavior">
  ## Comportamiento del SDK
</div>

<div id="session-mode">
  ### Modo de sesión
</div>

Cuando un SDK registra Session Replay en modo `session` (si se especifica `sessionSampleRate`), la grabación debe comenzar al inicializar el SDK y transmitirse de forma continua a los servidores de Sentry. El SDK debe enviar un sobre de reproducción cada 5 segundos. La duración máxima de la grabación no debe superar los 60 minutos (o 15 minutos sin actividad en la Web). Una vez alcanzado el límite estricto, el SDK debe dejar de grabar, borrar el `replay_id` actual y eliminarlo del Scope para que los eventos posteriores no se asocien a él.

Para los SDK que admiten caché en disco, la grabación debe pausarse cuando no haya conexión a Internet o el SDK esté sujeto a limitación de tasa. Esto es necesario para evitar desbordar la caché en disco, lo que podría resultar en la pérdida de sobres más críticos. Cuando se restablezca la conexión a Internet o se levante la limitación, la grabación debe reanudarse.

<div id="buffer-mode">
  ### Modo búfer
</div>

Cuando un SDK registra Session Replay en modo `buffer` (se especifica `onErrorSampleRate`), la grabación debe comenzar al inicializarse el SDK y almacenarse en memoria (y en disco si el SDK admite caché en disco) en un búfer circular con un historial de hasta 30 segundos. La captura de la grabación puede activarse cuando se cumple una de las siguientes condiciones:

* Ocurre un evento de bloqueo o error y el SDK lo captura
* Se llama manualmente a la API `flush` en el replay (para SDK que admiten API manual)

Tras capturar el segmento inicial (en búfer), el SDK debe continuar grabando en modo `session`. Sin embargo, ten en cuenta que el campo `replay_type` de los segmentos siguientes debe seguir configurándose como `buffer` para reflejar el `replay_type` original.

Si el evento de bloqueo o error se descartó en `beforeSend`, el replay **no** debe capturarse.