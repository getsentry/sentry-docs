---
title: Filtrado
---

<Alert level="warning">
  üöß Este documento est√° en desarrollo.
</Alert>

<Alert>
  Este documento utiliza palabras clave como ‚ÄúMUST‚Äù, ‚ÄúSHOULD‚Äù y ‚ÄúMAY‚Äù, seg√∫n se definen en la [RFC 2119](https://www.ietf.org/rfc/rfc2119.txt), para indicar niveles de requisito.
</Alert>

El SDK MUST implementar un mecanismo para que los usuarios filtren spans.
El resultado MUST ser binario (`true` o `false`).
Cualquier API expuesta al usuario para filtrar spans MUST adherirse a los siguientes principios de dise√±o:

- Las API est√°n optimizadas para la completitud del trazo
- Las API est√°n optimizadas para decisiones de muestreo concluyentes

<div id="filter-with-ignorespans">
  ## Filtrar con `ignoreSpans`
</div>

La opci√≥n `ignoreSpans` DEBE aceptar una cadena, una RegExp o un patr√≥n glob (el que la plataforma admita). Estos valores DEBEN compararse con el nombre del span.

Adem√°s, `ignoreSpans` DEBER√çA aceptar un objeto con patrones que coincidan con el nombre del span o con atributos del span (consulta las definiciones de tipos a continuaci√≥n).

```ts
type IgnoreSpanNamePattern = string | RegExp | GlobPattern;

// todos los valores permitidos para los atributos de span (poco probable, pero podr√≠a variar seg√∫n la plataforma)
type AttributeValueTypes = string | boolean | number | Array<string> | Array<boolean> | Array<number>;
type EnhancedAttributeValueTypes = AttributeValueTypes | RegExp | GlobPattern;

type IgnoreSpanFilter = {
  name: IgnoreSpanNamePattern;
  attributes?: Record<string, EnhancedAttributeValueTypes>;
} | {
  name?: IgnoreSpanNamePattern;
  attributes?: Record<string, EnhancedAttributeValueTypes>;
}

type IgnoreSpans = Array<IgnoreSpanNamePattern | IgnoreSpanFilter>
```

(Nota: `GlobPattern` se usa como un tipo ilustrativo para plataformas que admiten la coincidencia con patrones glob. No es un tipo v√°lido en TypeScript).

Ejemplo:

```js
Sentry.init({
  ignoreSpans: [
    // aplicar al nombre del span
    'GET /about',
    'events.signal *',
    /api\/\d+/,
    // ignorar solicitudes GET de verificaci√≥n de estado con c√≥digo de estado 200
    {
      name: /healthz?/,
      attributes: {
        'http.method': 'GET',
        'http.status_code': 200,
      }
    },
    // ignorar todas las solicitudes GET a /api/ con c√≥digo de estado 200
    // (es decir, el nombre del span no importa)
    {
      attributes: {
        'http.method': /GET \/api\/.*/,
        'http.status_code': 200,
      }
    },
    // ignorar todos los spans cuyo nombre comience con /imprint-
    // si se admiten patrones glob
    {
      name: '/imprint-*'
    }
  ]
})
```

(Nota: Los patrones glob utilizados en el ejemplo son solo ilustrativos. No est√°n admitidos en JavaScript).


<div id="implementation-requirements">
  ### Requisitos de implementaci√≥n
</div>

1. Los patrones de `ignoreSpans` DEBEN aplicarse a todos los spans, incluido el span ra√≠z o de segmento.
   - Si un patr√≥n coincide con el span ra√≠z, el span y todos sus hijos DEBEN ignorarse.
   - Si un patr√≥n coincide con un span hijo, el span DEBE ignorarse, pero se DEBE intentar volver a asignar cualquier span hijo posible al span padre del span ignorado.
   
2. Si los SDK aceptan objetos `IgnoreSpanFilter`, los atributos DEBEN compararse por valor. Esto tambi√©n aplica a atributos con valores de arreglo.
   - Los valores de atributos de tipo string se comparan del mismo modo que los nombres de los spans: si se proporciona un string, el string DEBE coincidir (contener); si se proporciona un patr√≥n `RegExp` o glob, el valor DEBE coincidir con el patr√≥n.
   - Cualquier otro tipo de valor de atributo DEBE ser estrictamente igual al valor proporcionado.

<div id="filter-with-integrations">
  ## Filtrar con `integrations`
</div>

La opci√≥n `integrations` PUEDE comportarse de forma similar a `ignoreSpans`, o permitir una exclusi√≥n expl√≠cita mediante un indicador booleano.

```js
Sentry.init({
  integrations: [
    fsIntegration: {
      ignoreSpans: [
        'fs.read',
      ],
      readSpans: true,
      writeSpans: false,
    }
  ]
})
```


<div id="other-approaches">
  ## Otros enfoques
</div>

Si ambas opciones mencionadas arriba no son factibles de implementar en ciertos SDK, se DEBEN explorar otros enfoques que logren el mismo resultado.