---
title: Protocolo de Span
---

<Alert level="info">
  Este documento utiliza palabras clave como «MUST», «SHOULD» y «MAY», tal como se definen en la [RFC 2119](https://www.ietf.org/rfc/rfc2119.txt), para indicar niveles de exigencia.
</Alert>

El SDK debe implementar un nuevo elemento de «sobre» llamado «span v2», que se utiliza para enviar spans a Sentry.

<div id="span-v2-envelope-header">
  ## Encabezado de sobre de Span v2
</div>

El encabezado del sobre debe contener las mismas propiedades que anteriormente con las transacciones.
No hay requisitos especiales para el encabezado de sobre de Span v2.

```json
{
  "sent_at": "2025-02-07T14:16:00Z",
  "dsn": "https://e12d836b15bb49d7bbf99e64295d995b@sentry.io/42",
  "sdk": {
    // …
  },
  "trace": {
    // …
  }
}
```

Consulta también [Encabezados de sobres](/es/sdk/data-model/envelopes/#headers).

<div id="span-v2-envelope-item-header">
  ## Encabezado del elemento de sobre de Span v2
</div>

El encabezado del elemento de sobre debe incluir las siguientes propiedades:

```json
{
  "type": "span",
  "item_count": 2,
  "content_type": "application/vnd.sentry.items.span.v2+json"
}
```

<div id="span-v2-envelope-item-payload">
  ## Carga útil del elemento de sobre de Span v2
</div>

La carga útil del elemento de sobre debe contener un arreglo `items` con al menos un span y hasta 1000 objetos span:

```json
{
  "items": [
    {
      "trace_id": "6cf173d587eb48568a9b2e12dcfbea52",
      "span_id": "438f40bd3b4a41ee",
      "name": "GET /users",
      "status": "ok",
      "is_remote": true,
      "kind": "server",
      "start_timestamp": 1742921669.158209,
      "end_timestamp": 1742921669.180536,
      "attributes": {
        "sentry.release": {
          "type": "string",
          "value": "1.0.0"
        },
        "sentry.environment": {
          "type": "string",
          "value": "local"
        },
        "sentry.platform": {
          "type": "string",
          "value": "php"
        },
        "sentry.sdk.name": {
          "type": "string",
          "value": "sentry.php"
        },
        "sentry.sdk.version": {
          "type": "string",
          "value": "4.10.0"
        },
        "sentry.transaction_info.source": {
          "type": "string",
          "value": "route"
        },
        "sentry.origin": {
          "type": "string",
          "value": "auto"
        },
        "server.address": {
          "type": "string",
          "value": "127.0.0.1"
        },
        "http.response.status_code": {
          "type": "integer",
          "value": 200
        }
      },
      "links": [
        {
          "span_id": "6c71fc6b09b8b716",
          "trace_id": "627a2885119dcc8184fae7eef09438cb",
          "sampled": true,
          "attributes": {
            "sentry.link.type": {
              "type": "string",
              "value": "previous_trace"
            }
          }
        }
      ]
    },
    {
      "trace_id": "6cf173d587eb48568a9b2e12dcfbea52",
      "parent_span_id": "438f40bd3b4a41ee",
      "span_id": "f1196292f76e45c0",
      "name": "app.handle",
      "status": "ok",
      "is_remote": false,
      "kind": "server",
      "start_timestamp": 1742921669.178306,
      "end_timestamp": 1742921669.180484,
      "attributes": {
        "sentry.origin": {
          "type": "string",
          "value": "auto"
        }
      }
    }
  ]
}
```

<div id="span-v2-protocol-properties">
  ## Propiedades del protocolo Span v2
</div>

<div id="envelope-item-header-properties">
  ### Propiedades del encabezado del elemento del envelope
</div>

| Propiedad | Tipo | Requerido | Descripción |
|----------|------|----------|-------------|
| `type` | string | Sí | Debe establecerse en `"span"` para identificarlo como un elemento de envelope de tipo span |
| `item_count` | integer | Sí | Número de elementos span en el payload |
| `content_type` | string | Sí | Debe establecerse en `"application/vnd.sentry.items.span.v2+json"` |

<div id="span-properties">
  ### Propiedades de Span
</div>

| Propiedad | Tipo | Requerido | Descripción |
|----------|------|----------|-------------|
| `trace_id` | string | Sí | Cadena hexadecimal de 32 caracteres (un uuid4 válido sin guiones) |
| `span_id` | string | Sí | Cadena hexadecimal de 16 caracteres (un uuid4 válido sin guiones) |
| `parent_span_id` | string | No | Cadena hexadecimal de 16 caracteres (un uuid4 válido sin guiones) |
| `name` | string | Sí | Descripción de baja cardinalidad de lo que representa el span (p. ej., &quot;GET /users&quot;, &quot;database.query&quot;) |
| `status` | string | Sí | Estado de la operación del span. Puede ser `"ok"` o `"error"` |
| `is_remote` | boolean | Sí | Indica si el SpanContext que crea el span se recibió de otro origen o se generó localmente |
| `kind` | string | Sí | Tipo de span. Valores: `"server"`, `"client"`, `"producer"`, `"consumer"`, `"internal"` |
| `start_timestamp` | number | Sí | Marca de tiempo Unix (con microsegundos fraccionarios) en que se inició el span |
| `end_timestamp` | number | Sí | Marca de tiempo Unix (con microsegundos fraccionarios) en que finalizó el span |
| `attributes` | object | No | Pares clave-valor con metadatos adicionales sobre el span |
| `links` | array | No | Lista de enlaces que conectan este span con otros spans o trazas |

<div id="attribute-object-properties">
  ### Propiedades del objeto Attribute
</div>

Los atributos se almacenan como pares clave-valor, donde cada valor es un objeto con información de tipo:

| Propiedad | Tipo | Obligatorio | Descripción |
|----------|------|-------------|-------------|
| `type` | string | Sí | El tipo de dato del valor del atributo. Valores: `"string"`, `"integer"`, `"double"`, `"boolean"` |
| `value` | any | Sí | El valor del atributo; debe coincidir con el tipo especificado |
| `unit` | string | No | La unidad del valor del atributo. Ejemplos: `"ms"`, `"s"`, `"bytes"`, `"count"`, `"percent"` |

<div id="common-attribute-keys">
  #### Claves de atributos comunes
</div>

Todos los atributos mencionados a continuación deben adjuntarse a cada span emitido por el SDK, según la plataforma.
Se deben emitir los atributos vacíos.

| Clave de atributo | Tipo | Descripción |
|---------------|------|-------------|
| `sentry.release` | string | La versión de la aplicación |
| `sentry.environment` | string | El nombre del entorno (p. ej., &quot;production&quot;, &quot;staging&quot;, &quot;development&quot;) |
| `sentry.segment.name` | string | El nombre del segmento (p. ej., &quot;GET /users&quot;) |
| `os.name` | string | El nombre del sistema operativo (p. ej., &quot;Linux&quot;, &quot;Windows&quot;, &quot;macOS&quot;) |
| `browser.name` | string | El nombre del navegador (p. ej., &quot;Chrome&quot;, &quot;Firefox&quot;, &quot;Safari&quot;) |
| `user.id` | string | El ID de usuario (controlado por `sendDefaultPii`) |
| `user.email` | string | El correo electrónico del usuario (controlado por `sendDefaultPii`) |
| `user.ip_address` | string | La dirección IP del usuario (controlado por `sendDefaultPii`) |
| `user.username` | string | El nombre de usuario (controlado por `sendDefaultPii`) |
| `thread.id` | string | El ID del hilo |
| `thread.name` | string | El nombre del hilo |
| `sentry.sdk.name` | string | Nombre del SDK de Sentry (p. ej., &quot;sentry.php&quot;, &quot;sentry.javascript&quot;) |
| `sentry.sdk.version` | string | Versión del SDK de Sentry |

Consulta las [Sentry Conventions](https://github.com/getsentry/sentry-conventions/) para ver la lista completa de atributos compatibles.

<div id="link-object-properties">
  ### Propiedades del objeto Link
</div>

Los enlaces conectan spans con otros spans o con trazas, lo que permite el rastreo distribuido:

| Propiedad | Tipo | Requerido | Descripción |
|----------|------|----------|-------------|
| `span_id` | string | Sí | Cadena hexadecimal de 16 caracteres (uuid4 válido sin guiones) |
| `trace_id` | string | Sí | Cadena hexadecimal de 32 caracteres (uuid4 válido sin guiones) |
| `sampled` | boolean | No | Indica si la traza vinculada fue muestreada |
| `attributes` | object | No | Metadatos adicionales sobre la relación del enlace |

<div id="link-attribute-keys">
  #### Claves de atributos de enlace
</div>

| Clave de atributo | Tipo | Descripción |
|---------------|------|-------------|
| `sentry.link.type` | string | Tipo de relación del enlace (p. ej., &quot;previous&#95;trace&quot;, &quot;child&#95;of&quot;, &quot;follows&#95;from&quot;) |

<div id="data-types-and-formats">
  ## Tipos y formatos de datos
</div>

<div id="timestamp-format">
  ### Formato de marca de tiempo
</div>

Las marcas de tiempo usan la hora Unix con microsegundos fraccionarios como número de coma flotante:

```
1742921669.158209
```

<div id="id-formats">
  ### Formatos de ID
</div>

* **Trace ID**: cadena hexadecimal en minúsculas de 32 caracteres (128 bits) (un uuid4 válido sin guiones)
* **Span ID**: cadena hexadecimal en minúsculas de 16 caracteres (64 bits) (un uuid4 válido sin guiones)

Ejemplo:

```
trace_id: "6cf173d587eb48568a9b2e12dcfbea52"
span_id: "438f40bd3b4a41ee"
```
