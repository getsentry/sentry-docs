---
title: Comentarios
sidebar_order: 4
---

Este documento está dirigido a desarrolladores del SDK de Sentry y a quienes mantienen la canalización de ingesta de comentarios.

<div id="feedback-protocol">
  ## Protocolo de comentarios
</div>

Elemento de tipo `"feedback"`. Este elemento contiene una [carga útil de evento](/es/sdk/data-model/event-payloads/) codificada en JSON, con un objeto de contexto adicional `feedback`.

<div id="feedback-item">
  ## Elemento `"feedback"`
</div>

<div id="feedback-context-attributes">
  ### Atributos de contexto de comentarios
</div>

| Clave                  | Tipo                      | Descripción                                                                                                                                                                                           |
| ---------------------- | ------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| message                | string                    | Obligatorio. Comentarios del usuario que describen lo ocurrido y/o comparten feedback. La longitud máxima es de **4096 caracteres**.                                                                 |
| contact&#95;email          | string                    | El correo electrónico del usuario que envió el feedback. Si se omite, Sentry (no el SDK) intenta completarlo con el contexto del usuario. El feedback anónimo (sin nombre ni correo) sigue siendo aceptado. |
| name                   | string                    | El nombre del usuario que envió el feedback. Si se omite, Sentry (no el SDK) intenta completarlo con el contexto del usuario. El feedback anónimo (sin nombre ni correo) sigue siendo aceptado.      |
| url                    | string                    | La URL de la página web en la que estaba el usuario al enviar el feedback. Puede usarse para buscar o configurar alertas sobre el feedback.                                                          |
| associated&#95;event&#95;id    | string                    | El identificador de un evento de error en el mismo proyecto. Úsalo para vincular explícitamente un error relacionado en la interfaz de feedback.                                                     |
| replay&#95;id              | string                    | El identificador de una Reproducción de sesión relacionada en el mismo proyecto. Sentry usa este ID para mostrar un clip de la reproducción en la interfaz de feedback.                             |

<div id="event-attributes">
  ### Atributos del evento
</div>

A continuación se presenta un resumen de los [atributos obligatorios](/es/sdk/data-model/event-payloads/#required-attributes) para la carga útil del evento.
Para ver la lista completa de atributos, consulta [Cargas útiles de eventos](/es/sdk/data-model/event-payloads/).

| Clave                      | Tipo   | Descripción                                          |
| -------------------------- | ------ | ---------------------------------------------------- |
| timestamp                  | number | Marca de tiempo UNIX del momento actual (en segundos) |
| event&#95;id                   | string | Cadena hexadecimal que representa un valor uuid4     |
| platform                   | string | Plataforma del SDK                                   |

<div id="example">
  ### Ejemplo
</div>

```json
{
  "event_id": "9ec79c33ec9942ab8353589fcb2e04dc",
  "timestamp": "2011-05-02T17:41:36Z",
  "platform": "javascript",
  "contexts": {
    "feedback": {
      "contact_email": "john@example.com",
      "name": "John Smith",
      "message": "¡Me encanta la repetición de sesión!",
      "url": "https://sentry.io/replays/",
      "associated_event_id": "32fd1995636d446385016e2747623e11",
      "replay_id":"82840977e85b4ed3bc27f7b5b25cec15"
    }
  }
}
```

<div id="attaching-screenshots">
  ### Adjuntar capturas de pantalla
</div>

Puedes asociar capturas de pantalla a un feedback enviando los datos de imagen como
[elementos de adjunto](/es/sdk/data-model/envelope-items/#attachment), con el `event_id`
correspondiente al elemento de feedback. Recomendamos enviar los elementos en el mismo
Envelope.

<div id="full-envelope-example">
  ## Ejemplo de sobre completo
</div>

```json
{"event_id":"9ec79c33ec9942ab8353589fcb2e04dc","sent_at":"2024-03-19T15:18:27.581Z","sdk":{"name":"sentry.javascript.react","version":"7.105.0"}}
{"type":"feedback"}
{
  "event_id": "9ec79c33ec9942ab8353589fcb2e04dc",
  "timestamp": "2011-05-02T17:41:36Z",
  "platform": "javascript",
  "contexts": {
    "organization": { "id": "0", "slug": "sentry" },
    "feedback": {
      "contact_email": "john@example.com",
      "name": "John Smith",
      "message": "¡Me encanta la repetición de sesión!",
      "url": "https://sentry.io/replays/",
      "associated_event_id": "32fd1995636d446385016e2747623e11",
      "replay_id":"82840977e85b4ed3bc27f7b5b25cec15"
    }
  },
  "level": "error",
  "environment": "prod",
  "release": "frontend@f00",
  "sdk": {
    "integrations": [
      "BrowserTracing",
      "BrowserProfiling",
      "Replay",
      "ReplayCanvas"
    ],
    "name": "sentry.javascript.react",
    "version": "7.105.0"
  },
  "tags": {
    "sentry_version": "24.4.0.dev0",
  },
  "user": {
    "ip_address": "127.0.0.1",
    "email": "john@example.com",
    "id": 1,
    "name": "John Smith"
  }
}
```

<div id="feedback-sdk-pipeline">
  ## Pipeline del SDK de comentarios
</div>

Un comentario capturado por capture&#95;feedback es procesado por el SDK. Nota: El evento puede descartarse en cualquiera de las etapas, tras lo cual no se realizará más procesamiento.

<div id="beforesendfeedback">
  ### BeforeSendFeedback
</div>

Los SDK deben implementar una función de devolución de llamada `beforeSendFeedback` para permitir que los usuarios modifiquen la retroalimentación antes de enviarla. Esta función debería ser similar a la devolución de llamada existente [`beforeSend`](/es/sdk/expected-features/#before-send-hook) usada para eventos.

<div id="scope-data-and-event-processors">
  ### Datos del scope y procesadores de eventos
</div>

El scope se aplica a los feedbacks, incluidas las etiquetas, el usuario, el trace y los contextos. También se invocan los *procesadores de eventos* del scope.

<div id="rate-limiting">
  ### Limitación de velocidad
</div>

La [limitación de velocidad](/es/sdk/expected-features/rate-limiting/) se aplica a los comentarios igual que a los eventos.

<div id="dropped-feedback-reports">
  ### Informes de feedback descartados
</div>

No existe una tasa de muestreo para el feedback, ya que siempre se registra. Sin embargo, un feedback puede descartarse en cualquiera de las etapas del pipeline, por motivos como limitación de tasa o un mensaje no válido (demasiado grande o vacío). El SDK debería informar el feedback descartado a través de [informes del cliente](/es/sdk/telemetry/client-reports/).

<div id="session-replay-integration">
  ### Integración con Session Replay
</div>

Al enviar comentarios, se espera que los SDK vacíen la reproducción de sesión actual, si está en ejecución. Esto garantiza que exista una grabación útil y que pueda incluirse en el atributo `replay_id` del contexto de comentarios.

<div id="timing-of-replay-sampling-with-feedback-widgets">
  #### Momento del muestreo de Replay con widgets de comentarios
</div>

En el caso específico de los widgets de comentarios, cuando `onErrorSampleRate` de Session Replay es mayor que 0, los SDK deben muestrear y vaciar el replay cuando el widget **se abre**, no cuando el usuario envía el comentario. Este momento es crítico porque:

* El búfer de replay captura la sesión del usuario hasta la apertura del widget de comentarios, proporcionando contexto sobre lo que experimentó antes de decidir dejar un comentario
* Si el muestreo solo ocurre al enviar, el búfer contendría principalmente las interacciones del usuario con el propio formulario de comentarios (mientras escribe su mensaje), lo que aporta un valor de depuración mínimo
* El muestreo temprano garantiza que se conserve el contexto completo del usuario independientemente de si finalmente envía el comentario

Este comportamiento garantiza que los desarrolladores reciban datos de replay de sesión significativos que muestren la experiencia del usuario previa al momento del comentario, en lugar de solo su interacción con el propio widget de comentarios.