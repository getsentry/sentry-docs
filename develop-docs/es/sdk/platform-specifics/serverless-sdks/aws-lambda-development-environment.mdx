---
title: Entorno de desarrollo de AWS Lambda
description: Cómo configurar AWS Lambda para enviar datos a una instancia de desarrollo de Sentry.
sidebar_order: 200
---

Esta guía explica cómo configurar un entorno de desarrollo para trabajar en la [integración de AWS Lambda](https://docs.sentry.io/product/integrations/cloud-monitoring/aws-lambda/). La configuración incluye ejecutar una instancia local de `sentry` y configurar AWS para que ambos entornos funcionen en conjunto.

<Alert level="warning" title="IMPORTANTE">

**Esta guía es únicamente para enviar datos desde una función de AWS Lambda a tu instancia local de `sentry`.**

Cuando trabajas en la capa de Sentry para AWS Lambda desde uno de los SDK, el flujo de trabajo consiste en tener una función Lambda de ejemplo en una cuenta de desarrollo de AWS, desplegar tu capa local en esa cuenta y adjuntarla a la función de ejemplo. Cómo hacerlo en Python se describe en la [guía de contribución](https://github.com/getsentry/sentry-python/blob/master/CONTRIBUTING.md#contributing-to-sentry-aws-lambda-layer) del SDK de Python.

</Alert>

<div id="configuration-of-aws">
  ## Configuración de AWS
</div>

Para emular una integración de Sentry con un proyecto basado en funciones de AWS Lambda, necesitas:

- Una cuenta de AWS que represente a Sentry, con una entidad de IAM y un bucket de S3 que contenga un archivo de configuración JSON.
- Una cuenta de AWS que represente al usuario y que tenga una función Lambda de ejemplo.

<div id="detailed-configuration-steps">
  ### Pasos detallados de configuración
</div>

Para la “cuenta de Sentry” en AWS, en esta guía asumimos que el ID de la cuenta de AWS es `1111 1111 1111`. Esta cuenta puede ser la cuenta oficial compartida de desarrollo de Sentry en AWS, o puedes crear una personal (se requiere tarjeta de crédito).

- Crea un usuario de IAM en la “cuenta de Sentry” que pueda crear buckets de S3 y tenga permiso para asumir roles. La política que se puede adjuntar directamente al usuario de IAM es la siguiente:

  {/* _TODO: check if we can restrict those permissions more_ */}

  ```json
  {
    "Version": "2012-10-17",
    "Statement": [
      {
        "Sid": "VisualEditor0",
        "Effect": "Allow",
        "Action": "sts:AssumeRole",
        "Resource": "*"
      }
    ]
  }
  ```

- Crea un bucket de S3 en la “cuenta de Sentry” que sea público para alojar el archivo de configuración de CloudFormation (más sobre esto más adelante). La política del bucket de S3 debería verse así (en este ejemplo, “sentry-dev-cloudformation” es el nombre del bucket):

  {/* _TODO: check if we can restrict those permissions more_ */}

  ```json
  {
    "Version": "2012-10-17",
    "Statement": [
      {
        "Sid": "Statement1",
        "Effect": "Allow",
        "Principal": "*",
        "Action": "s3:*",
        "Resource": [
          "arn:aws:s3:::sentry-dev-cloudformation",
          "arn:aws:s3:::sentry-dev-cloudformation/dev.json"
        ]
      }
    ]
  }
  ```

- Coloca un archivo de configuración de CloudFormation llamado `dev.json` en el bucket de S3 de la “cuenta de Sentry” mencionado arriba. El archivo `dev.json` apunta a un usuario de la “cuenta de Sentry”. El archivo debe ser legible por el cliente.
  El `dev.json` debe verse así. Debes reemplazar `arn:aws:iam::111111111111:user/sentry` por el ARN de tu usuario:

      {/* *TODO: check if we can restrict those permissions more.* */}

      ```json
      {
        "Description": "This stack grants write access to your Lambda functions in order to add Sentry error and performance monitoring. After pressing create, wait for the stack to be created before copying your AWS account number and region into the Sentry installation modal.",
        "Resources": {
          "SentryRole": {
            "Type": "AWS::IAM::Role",
            "Properties": {
              "AssumeRolePolicyDocument": {
                "Version": "2012-10-17",
                "Statement": [
                  {
                    "Effect": "Allow",
                    "Principal": {
                      "AWS": "arn:aws:iam::111111111111:user/sentry"
                    },
                    "Action": [
                      "sts:AssumeRole"
                    ],
                    "Condition": {
                      "StringEquals": {
                        "sts:ExternalId": {
                          "Ref": "ExternalId"
                        }
                      }
                    }
                  }
                ]
              },
              "Path": "/",
              "RoleName": "SentryRole",
              "ManagedPolicyArns": [],
              "Policies": [
                {
                  "PolicyName": "sentry-policy",
                  "PolicyDocument": {
                    "Version": "2012-10-17",
                    "Statement": [
                      {
                        "Effect": "Allow",
                        "Action": [
                          "lambda:UpdateFunctionConfiguration",
                          "lambda:ListFunctions",
                          "lambda:ListLayerVersions",
                          "lambda:GetFunction",
                          "lambda:GetLayerVersion",
                          "organizations:DescribeAccount"
                        ],
                        "Resource": "*"
                      }
                    ]
                  }
                }
              ]
            }
          }
        },
        "Parameters": {
          "ExternalId": {
            "Description": "External ID for securing the role - Do not change",
            "Type": "String"
          }
        }
      }
      ```

      Este archivo de configuración de CloudFormation básicamente le da al usuario de la “cuenta de Sentry” acceso para asumir un rol en la “cuenta del usuario” y así actualizar las funciones Lambda (agregar la capa Sentry Lambda) para instrumentarlas y enviar errores/métricas a Sentry.

- Crea una cuenta de AWS que represente al usuario y donde residan sus funciones Lambda. A esta cuenta la llamaremos la “cuenta del usuario”.
  La “cuenta de Sentry” y la “cuenta del usuario” también pueden ser la misma cuenta.

Bien, ahora tienes dos cuentas de AWS y has configurado tu archivo de CloudFormation en un bucket de S3 accesible públicamente. ¡Genial!

<div id="configuration-of-local-sentry-instance">
  ## Configuración de una instancia local de Sentry
</div>

Solo necesitas una instalación predeterminada de `sentry` en tu computadora. Instálala siguiendo la [guía de configuración del entorno de desarrollo](https://develop.sentry.dev/development-infrastructure/environment/).

Ahora debes indicarle a tu instalación de Sentry qué cuenta de AWS usar y dónde encontrar la configuración de CloudFormation.

Puedes hacerlo agregando el siguiente parámetro a tu archivo `~/.sentry/config.yml`:

```yaml
aws-lambda.access-key-id: AKIXXXXXXXXXXXXXXXXX
aws-lambda.secret-access-key: IuyXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX2Xoj
aws-lambda.cloudformation-url: https://sentry-dev-cloudformation.s3.eu-central-1.amazonaws.com/dev.json
aws-lambda.node.layer-version: "37"
aws-lambda.python.layer-version: "142"
```

Explicación:

* `aws-lambda.access-key-id` ID de clave de acceso de AWS del usuario de IAM creado en la “Sentry Account”.
* `aws-lambda.secret-access-key` Clave de acceso secreta de AWS del usuario de IAM creado en la “Sentry Account”.
* `aws-lambda.cloudformation-url` URL de acceso público del archivo de configuración de CloudFormation que se encuentra en un bucket de S3 en la “Sentry Account”.
* `aws-lambda.node.layer-version` versión de la capa de Lambda que se debe usar para funciones Lambda de Node. Este número de versión se puede encontrar aquí: [https://github.com/getsentry/sentry-release-registry/tree/master/aws-lambda-layers](https://github.com/getsentry/sentry-release-registry/tree/master/aws-lambda-layers) (Sugerencia: cada región puede tener una versión distinta de la capa instalada).
* `aws-lambda.python.layer-version` igual que arriba, pero para funciones Lambda en Python.


<div id="configuration-of-ngrok">
  ## Configuración de Ngrok
</div>

Con [Ngrok](https://ngrok.com/) obtienes una URL que apunta a tu computadora local. Así, cualquier persona en Internet puede comunicarse con tu instalación de Sentry en tu computadora.

Esto es necesario para que tu función de AWS Lambda pueda enviar sus errores y el tracing a tu instalación local de Sentry.

Sigue las instrucciones en la página de [documentación de Ngrok](https://develop.sentry.dev/development/ngrok/) para instalar ngrok.

Ahora inicia Ngrok de la siguiente manera:

```bash
ngrok http 8000
```

Si ngrok se inicia, mostrará la URL en la que tu computadora ahora está disponible. Copia la URL HTTP (debería verse algo como `http://xxxx-xxx-xxx-x-xxx.ngrok.io`).

Si sigues la guía en la página de ngrok enlazada arriba, obtendrás acceso a la cuenta de Sentry en Ngrok y podrás crear un subdominio personalizado que no cambie cada vez que reinicies ngrok. Muy recomendado.

Ahora tienes que indicarle a tu instalación de Sentry su nueva URL añadiendo la siguiente línea a tu `~/.sentry/config.yml`:

```yaml
system.url-prefix: "http://xxxx-xxx-xxx-x-xxx.ngrok.io"
```

Asegúrate de reiniciar todo el entorno de desarrollo para que todos los servicios reconozcan la nueva URL. (con `devservices down && devservices up`)


<div id="start-the-local-sentry-server">
  ## Inicia el servidor local de Sentry
</div>

Si ejecutas ahora tu instancia local de Sentry con este comando, tendrá toda la información que necesita:

```bash
devservices serve
```

Ya estás listo para desarrollar integraciones sin servidor.


<div id="add-sentry-to-your-lambda-functions">
  ## Añade Sentry a tus funciones Lambda
</div>

Inicia sesión en tu entorno local de Sentry en tu URL de ngrok y sigue la [guía de AWS Lambda](https://docs.sentry.io/product/integrations/cloud-monitoring/aws-lambda/) de nuestra documentación para añadir la instrumentación de Sentry a tu función de demostración de AWS Lambda.