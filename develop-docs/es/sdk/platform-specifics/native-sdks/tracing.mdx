---
title: Trazas
sidebar_order: 30
og_image: /og-images/sdk-platform-specifics-native-sdks-tracing.png
---

<div id="scenarios">
  ## Escenarios
</div>

En el SDK nativo tenemos los siguientes escenarios, que muestran cómo fluye la información de trace context:

<div id="tracing-without-performance">
  ### Trazas sin Performance
</div>

En Trazas sin Performance ([TwP](https://develop.sentry.dev/sdk/telemetry/traces/tracing-without-performance/)) el SDK no crea spans. Sin embargo, seguimos queriendo conectar eventos a través de límites, así que usamos un `propagation_context` para almacenar los datos relevantes (un `trace_id` y un `span_id`) que se generan durante la inicialización del SDK. Este `propagation_context` se puede actualizar llamando a `sentry_set_trace()`, por ejemplo, desde un SDK downstream.

<div id="tracing-with-performance">
  ### Trazas con Performance
</div>

Cuando se habilita cualquier [opción de muestreo de trazas](https://docs.sentry.io/platforms/native/configuration/sampling/#configuring-the-transaction-sample-rate), el SDK puede enviar spans. Igual que en TwP, seguimos usando un `propagation_context` para almacenar los datos relevantes (un `trace_id` y un `span_id`). Ahora, los eventos y los spans pueden conectarse mediante un `trace_id` común y, si un span está en scope, además se conectará jerárquicamente al evento a través de su `span_id`. De forma predeterminada, tanto los spans como los eventos heredarán el `trace_id` del `propagation_context` generado durante la inicialización del SDK.

Independientemente de si se usa tracing con o sin performance, los SDK downstream pueden usar `sentry_set_trace()` para continuar sus trazas en el SDK nativo. Esta función actualiza el `propagation_context` con un nuevo `trace_id`, `span_id` y `parent_span_id`.

Los spans raíz (=transacciones) heredarán el contexto de la traza del `propagation_context` durante la [creación del contexto de transacción](https://docs.sentry.io/platforms/native/tracing/instrumentation/custom-instrumentation/), pero introducirán una nueva capa de spans. Si los usuarios quieren reemplazar las trazas establecidas por el SDK con sus trazas externas, este contexto puede sobrescribirse usando `sentry_transaction_context_update_from_header()`. Todo esto sucede antes de la creación o el scoping de la transacción.

Los spans hijo heredarán luego los datos de traza de su padre. Mientras un span esté en scope, cualquier evento usará el contexto de traza de ese span. Si no hay spans en scope, los eventos usarán directamente los datos de traza del `propagation_context`.

<div id="visualization">
  ### Visualización
</div>

El flujo del contexto de traza (a través de `propagation_context`) puede visualizarse en los siguientes escenarios:

![Trace context scenarios](./img/tracing_overview-data_flow.png)

1. El SDK inicializa `propagation_context` con un `trace_id` y un `span_id`. El evento enviado usará estos datos.
2. El SDK inicializa `propagation_context` con un `trace_id` y un `span_id`, que luego es sobrescrito por `sentry_set_trace()`. El evento enviado usará estos datos actualizados.
3. El SDK inicializa `propagation_context` con un `trace_id` y un `span_id`, que luego es sobrescrito por `sentry_set_trace()`. El evento enviado usará estos datos actualizados. \
Ahora se crea un contexto de transacción que utiliza los datos de `propagation_context`. \
Dado que la transacción se inicia y se aplica al alcance (scoped), cualquier evento enviado mientras esté en ese alcance usará los datos de la transacción (que tiene el mismo `trace_id` que `propagation_context`, pero su propio `span_id`).
4. El SDK inicializa `propagation_context` con un `trace_id` y un `span_id`, que luego es sobrescrito por `sentry_set_trace()`. El evento enviado usará estos datos actualizados. \
Ahora se crea un contexto de transacción que utiliza los datos de `propagation_context`. \
Dado que la transacción se inicia y no se aplica al alcance (not scoped), cualquier evento enviado usará los datos de `propagation_context`. La transacción y el evento seguirán teniendo el mismo `trace_id`, pero distintos `span_id`.
5. El SDK inicializa `propagation_context` con un `trace_id` y un `span_id`, que luego es sobrescrito por `sentry_set_trace()`. El evento enviado usará estos datos actualizados. \
Ahora se crea un contexto de transacción que utiliza los datos de `propagation_context`. Se actualiza mediante `sentry_transaction_context_update_from_header()` antes de iniciar la transacción, estableciendo un nuevo `trace_id`. \
Dado que la transacción se inicia y se aplica al alcance (scoped), cualquier evento enviado mientras esté en ese alcance usará los datos de la transacción, que ahora difieren de los de `propagation_context`.