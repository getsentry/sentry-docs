---
title: Manejo de datos
sidebar_order: 1
---

El manejo de datos es el contexto estandarizado mediante el cual queremos que los SDK ayuden a los usuarios a filtrar datos.

<div id="sensitive-data">
  ## Datos sensibles
</div>

Los SDK no deben incluir PII u otros datos sensibles en la carga útil de forma predeterminada.
Al crear un SDK, podemos encontrarnos con alguna API que proporcione información útil para depurar un problema.
En caso de que esa API devuelva datos considerados PII, los protegemos con una opción llamada *Enviar PII predeterminada*.
Esta es una opción en el SDK llamada [*send-default-pii*](https://docs.sentry.io/platforms/python/configuration/options/#send-default-pii)
y está **deshabilitada de forma predeterminada**. Esto significa que los datos intrínsecamente sensibles no se envían por defecto.

Algunos ejemplos de datos protegidos por esta opción:

* Al adjuntar datos de solicitudes y/o respuestas HTTP a eventos
  * Cuerpo de la solicitud: los cuerpos HTTP “en bruto” (cuerpos que no se pueden analizar como JSON o form-data) se eliminan
  * Encabezados HTTP: encabezados conocidos por ser sensibles, como `Authorization` o `Cookie`, también se eliminan.
  * *Nota*: si un usuario establece explícitamente una solicitud en el scope, no se elimina nada de esa solicitud. Las reglas anteriores solo se aplican a las integraciones que vienen con el SDK.
* La información específica del usuario (p. ej., el ID del usuario actual según el framework web utilizado) no se envía en absoluto.
* En aplicaciones de escritorio
  * El nombre de usuario con sesión iniciada en el dispositivo no se incluye. A menudo es el nombre de una persona.
  * El nombre de la máquina no se incluye, por ejemplo `Bruno's laptop`
* Los SDK no establecen `{{auto}}` como `user.ip_address`. Esto indica al servidor que conserve la dirección IP de la conexión.
* Los SDK de servidor eliminan la dirección IP de las solicitudes HTTP entrantes.

El servidor de Sentry siempre conoce la dirección IP de la conexión y puede usarla para el registro en algunas plataformas: concretamente JavaScript e iOS/macOS/tvOS.
Todas las demás plataformas requieren que el evento incluya `user.ip_address={{auto}}`, lo cual ocurre si `sendDefaultPii` está configurado en true.

Antes de enviar eventos a Sentry, los SDK deben invocar callbacks. Esto permite a los usuarios eliminar cualquier dato sensible del lado del cliente.

* [`before-send` y `event-processors`](/es/sdk/miscellaneous/unified-api/#static-api) se pueden usar para registrar un callback con lógica personalizada para eliminar datos sensibles.

<div id="application-state">
  ### Estado de la aplicación
</div>

El estado de la app puede ser clave para ayudar a los desarrolladores a reproducir errores. Por esa razón, los SDK suelen recopilar el estado de la app y adjuntarlo a los eventos mediante instrumentación automática.

Al adjuntar datos que podrían incluir información sensible o PII, es importante:

* Agregar una nota en la documentación para notificar a los desarrolladores.
* [Marcar esa parte del protocolo en Relay](https://github.com/getsentry/relay/pull/1383) como tal. Esto permite que [la depuración de datos](https://docs.sentry.io/product/relay/) se ejecute sobre esos campos.

Algunos ejemplos de instrumentación automática que podrían adjuntar datos sensibles:

* Una integración de SQL que incluya la consulta. Si un usuario no utiliza consultas parametrizadas y le añade datos sensibles, el SDK podría incluirlos en la carga útil del evento.
* Apps de escritorio que incluyen el título de la ventana.
* Instrumentación de enrutamiento en un framework web que adjunte las rutas `to` y `from`.

<div id="structuring-data">
  ## Estructuración de datos
</div>

Para mejorar el depurado de datos en el servidor, los SDK deben guardar los datos de forma estructurada siempre que sea posible. El punto de partida de la discusión fue el [RFC-0038](https://github.com/getsentry/rfcs/blob/main/text/0038-scrubbing-sensitive-data.md)

<div id="spans">
  ### Spans
</div>

Esto ayuda a Relay a saber qué tipo de datos recibe y también a depurar datos sensibles.

* spans de `http` que contienen URL:

  La descripción de los spans con `op` configurado en `http` debe seguir el formato `HTTP_METHOD scheme://host/path` (p. ej., `GET https://example.com/foo`).
  Si la URL incluye autoridad (`https://username:password@example.com`), esta debe reemplazarse por un marcador de posición independientemente de `sendDefaultPii`, dando como resultado una nueva URL: `https://[Filtered]:[Filtered]@example.com`.
  Si la URL contiene cadenas de consulta o el URI contiene fragmentos (solo en SDKs de navegador), ambos se colocan en el atributo data del span.

  ```js
  span.setAttributes({
    "http.query": url.getQuery(),
    "http.fragment": uri.getFragment(),
  });
  ```

  ```python
  span.set_data("http.query", query)
  ```

  Además, todas las convenciones semánticas de OpenTelemetry para spans de http deben establecerse en `span.data` si corresponde:
  https://opentelemetry.io/docs/reference/specification/trace/semantic&#95;conventions/http/

* spans de `db` que contienen consultas de base de datos: (SQL, GraphQL, Elasticsearch, MongoDB, ...)

  La descripción de los spans con `op` configurado en `db` no debe incluir parámetros de la consulta.
  En su lugar, usa marcadores de posición como `SELECT FROM 'users' WHERE id = ?`

Además, todas las convenciones semánticas de OpenTelemetry para spans de base de datos deben establecerse en `span.data` si corresponde:
https://opentelemetry.io/docs/reference/specification/trace/semantic&#95;conventions/database/

<div id="breadcrumbs">
  ### Breadcrumbs
</div>

Si el `message` de un breadcrumb contiene una URL, debe formatearse igual que en los spans de `http` (ver arriba).
Si la URL incluye cadenas de consulta o la URI incluye fragmentos (solo SDKs del navegador), ambos también deben establecerse en el atributo data, igual que con los spans de `http`.

```js
Sentry.addBreadcrumb({
  type: "http",
  category: "xhr",
  data: {
    method: "POST",
    url: "https://example.com/api/users/create.php",
    "http.query": "username=ada&password=123&newsletter=0",
    "http.fragment": "#foo",
  },
});
```

Additionally all semantic conventions of OpenTelementry for database spans should be set in the `data` if applicable:
https://opentelemetry.io/docs/reference/specification/trace/semantic&#95;conventions/database/

<div id="variable-size">
  ## Tamaño de variables
</div>

Los campos de la carga útil del evento que permiten valores definidos por el usuario o dinámicos tienen límites de tamaño. Esto aplica a la mayoría de los metadatos, como variables en un stack trace, así como a contextos, etiquetas y datos adicionales:

* Las asignaciones de valores (como datos HTTP, datos adicionales, etc.) están limitadas a 50 pares de elementos.
* Los ID de evento están limitados a 36 caracteres y deben ser UUID válidos.
* Las claves de flags están limitadas a 32 caracteres.
* Los valores de flags están limitados a 200 caracteres.
* Las claves de etiquetas están limitadas a 200 caracteres.
* Los valores de etiquetas están limitados a 200 caracteres.
* Los culpables están limitados a 200 caracteres.
* Los objetos de contexto están limitados a 8 kB.
* Los elementos individuales de datos adicionales están limitados a 16 kB. El total de datos adicionales está limitado a 256 kB.
* Los mensajes están limitados a 8192 caracteres.
* Los datos HTTP (el cuerpo) están limitados a 8 kB. Recorta siempre los datos HTTP antes de adjuntarlos al evento.
* Los stack traces están limitados a 50 frames. Si se envían más, se eliminarán datos del medio del stack.
* Los mensajes de entrada en integraciones de IA registrados en el atributo de span `gen_ai.request.messages` están limitados a 20 kB por span. Los mensajes se recortan y truncan si exceden el límite, conservando los más recientes.

Además, se aplican límites de tamaño a todas las solicitudes de almacenamiento para el tamaño total de la solicitud, la carga útil del evento y los adjuntos. Sentry rechaza todas las solicitudes que excedan estos límites. Consulta los siguientes recursos para conocer los límites de tamaño exactos:

* <Link to="/sdk/data-model/envelopes/#size-limits">Límites de tamaño del endpoint Envelope</Link>
* <Link to="/sdk/miscellaneous/store/#size-limits">Límites de tamaño del endpoint Store</Link>