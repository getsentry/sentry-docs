---
title: La visi√≥n general
description: >-
  El ciclo de vida de un evento en Sentry es un proceso complejo que involucra
  muchos componentes. Dynamic Sampling es uno de ellos, y es importante
  entender c√≥mo encaja en el panorama general.
sidebar_order: 1
og_image: /og-images/application-architecture-dynamic-sampling-the-big-picture.png
---

![Secuenciaci√≥n](./images/sequencing.png)

<Alert title="üí° Nota">
  Dynamic Sampling actualmente opera sobre spans o transactions para medir el caudal de datos. Esto est√° controlado por el feature flag `organizations:dynamic-sampling-spans` y suele configurarse seg√∫n c√≥mo se facture la suscripci√≥n de la organizaci√≥n. En entornos de desarrollo, actualmente el valor predeterminado es transactions.
  La l√≥gica entre ambas categor√≠as de datos es id√©ntica, por lo que la mayor parte de esta documentaci√≥n se mantiene a un nivel general y las diferencias importantes se se√±alan expl√≠citamente.
</Alert>

<div id="sequencing">
  ## Secuenciaci√≥n
</div>

El muestreo din√°mico (Dynamic Sampling) ocurre en el per√≠metro de nuestra canalizaci√≥n de ingesta, espec√≠ficamente en [Relay](https://github.com/getsentry/relay).

Cuando llegan los eventos, en un modelo simplificado, pasan por estos pasos:

1. **Filtros de datos de entrada**: cada evento pasa por los filtros configurados en los ajustes del proyecto, como navegadores antiguos o versiones (releases) denegadas. Los eventos descartados aqu√≠ no cuentan para la cuota y no se incluyen en los datos de &quot;eventos totales&quot;.
2. **Aplicaci√≥n de cuotas**: Sentry cobra por todos los eventos que siguen llegando antes de enviarlos al muestreo din√°mico.
3. **Extracci√≥n de m√©tricas**: tras pasar las cuotas, Sentry extrae m√©tricas del total de eventos entrantes. Estas m√©tricas ofrecen cifras granulares sobre el rendimiento y la frecuencia de cada evento.
4. **Muestreo din√°mico (Dynamic Sampling)**: seg√∫n un conjunto interno de reglas, Relay determina una tasa de muestreo para cada evento entrante. Un generador de n√∫meros aleatorios decide finalmente si se conserva o se descarta la carga √∫til.
5. **Limitaci√≥n de tasa**: los eventos muestreados por el muestreo din√°mico se almacenan e indexan. Para proteger la infraestructura, se aplican l√≠mites internos de tasa en este punto. En condiciones normales, este **l√≠mite de tasa nunca se alcanza** porque el muestreo din√°mico ya reduce el volumen de eventos almacenados.

<Alert title="üí° Ejemplo">
  Un cliente env√≠a 1000 eventos por segundo a Sentry:

  1. 100 eventos por segundo provienen de navegadores antiguos y se descartan mediante un filtro de datos de entrada.
  2. Los 900 eventos por segundo restantes aparecen como eventos totales en Sentry.
  3. Su tasa de muestreo general actual es del 20%, lo que, estad√≠sticamente, muestrea 180 eventos por segundo.
  4. Como esto supera el l√≠mite de 100/s, se descartan aleatoriamente unos 80 eventos por segundo y el resto se almacena.
</Alert>

<div id="rate-limiting-and-total-events">
  ## Limitaci√≥n de velocidad y eventos totales
</div>

El pipeline de ingesta tiene dos tipos de l√≠mites de velocidad que se comportan de manera diferente en comparaci√≥n con las organizaciones sin muestreo din√°mico:

1. **L√≠mites de solicitudes de alto nivel en los balanceadores de carga**: estos l√≠mites no diferencian qu√© datos env√≠an los clientes y descartan solicitudes en cuanto el caudal desde los clientes alcanza el l√≠mite.
2. **L√≠mites espec√≠ficos por categor√≠a de datos en Relay**: estos l√≠mites se aplican una vez que las solicitudes han sido analizadas y han pasado por el manejo b√°sico (consulta [Secuenciaci√≥n](#sequencing) arriba).

<Alert title="‚ú®Ô∏è Nota">
  Existe un l√≠mite de velocidad espec√≠fico para los eventos almacenados despu√©s de los filtros de entrada y el muestreo din√°mico. Sin embargo, no afecta a los eventos totales, ya que la fidelidad disminuye con mayores vol√∫menes de eventos totales y no se espera que este l√≠mite de velocidad se active, dado que el muestreo din√°mico ya reduce el caudal de eventos almacenados.
</Alert>

<div id="rate-limiting-and-trace-completeness">
  ## Limitaci√≥n de tasa y completitud de trazas
</div>

El muestreo din√°mico garantiza trazas completas al conservar todos los eventos asociados a una traza si se preserva el evento inicial.

Aunque el muestreo din√°mico proporciona trazas completas, pueden seguir faltando eventos u otros elementos (errores, reproducciones, etc.) en una traza cuando la limitaci√≥n de tasa descarta uno o m√°s de ellos. La limitaci√≥n de tasa descarta elementos sin tener en cuenta la traza, tomando cada decisi√≥n de forma independiente y pudiendo resultar en trazas incompletas.

<Alert title="üí° Ejemplo">
  Por ejemplo, si hay una traza de `Project A` a `Project B` y `Project B` est√° sujeto a limitaci√≥n de tasa o a cuotas, se pierden los eventos de `Project B` en la traza iniciada por `Project A`.
</Alert>

<div id="client-side-sampling-and-dynamic-sampling">
  ## Muestreo del lado del cliente y muestreo din√°mico
</div>

Los clientes tienen su propia [tasa de muestreo de trazas](https://docs.sentry.io/platforms/javascript/tracing/#configure). La tasa de muestreo del cliente es un n√∫mero en el rango `[0.0, 1.0]` (del 0% al 100%) que controla **cu√°ntos eventos llegan a Sentry**. Aunque la documentaci√≥n suele sugerir una tasa de `1.0`, para algunos casos de uso podr√≠a ser mejor reducirla.

El muestreo din√°mico reduce a√∫n m√°s cu√°ntos eventos se almacenan internamente. **Si bien la mayor√≠a de los gr√°ficos y cifras en Sentry se basan en m√©tricas**, acceder a spans y tags requiere eventos almacenados. Las tasas de muestreo se aplican de forma acumulativa.

A continuaci√≥n se muestra un ejemplo de muestreo del lado del cliente y muestreo din√°mico que parte de 100k eventos y resulta en 15k eventos almacenados:

![Client and Dynamic Sampling](./images/clientAndDynamicSampling.png)

<div id="total-transactions">
  ## Transacciones totales
</div>

Para recopilar informaci√≥n sin muestreo de las transacciones ‚Äútotales‚Äù en Performance, Alerts y Dashboards, Relay extrae [m√©tricas](https://getsentry.github.io/relay/relay_metrics/index.html) de spans y transacciones. En resumen, estas m√©tricas incluyen:

* Recuentos y duraciones de todos los eventos.
* Una distribuci√≥n (histograma) de todas las mediciones, especialmente las web vitals.
* La cantidad de usuarios √∫nicos (conjunto).

Cada una de estas m√©tricas se puede filtrar y agrupar por varias etiquetas predefinidas, [implementadas en Relay](https://github.com/getsentry/relay/blob/master/relay-server/src/metrics_extraction/transactions/types.rs#L142-L157).

Para consultas m√°s granulares, **se necesitan eventos almacenados**. *El prop√≥sito del muestreo din√°mico aqu√≠ es garantizar que siempre haya suficientes eventos de muestra representativos.*

<Alert title="üí° Ejemplo">
  Si Sentry aplica una tasa de muestreo din√°mico del 1%, a√∫n puedes obtener eventos por minuto precisos (SPM o TPM, seg√∫n el tipo de evento) y cuantiles de web vitals a partir de los datos de eventos totales respaldados por m√©tricas. Tambi√©n hay un desglose de cada uno de estos valores por transacci√≥n.

  Cuando entras al explorador de trazas o a Discover, quiz√° quieras dividir los datos por una etiqueta personalizada que hayas agregado a tus eventos. Esta granularidad no la ofrecen las m√©tricas, as√≠ que **estas consultas deben usar eventos almacenados**.
</Alert>

Si quieres aprender m√°s sobre Dynamic Sampling, contin√∫a a la [siguiente p√°gina](/es/dynamic-sampling/fidelity-and-biases/).