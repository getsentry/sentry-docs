---
title: Service Manager (devservices)
sidebar_order: 40
---

Se utiliza una herramienta de línea de comandos independiente llamada [`devservices`](https://github.com/getsentry/devservices) para levantar y gestionar las dependencias de servicios. La herramienta lee un archivo `config.yml` dentro del directorio `devservices` de un repositorio. Es una abstracción basada en Docker Compose y Docker.

```shell
usage: devservices [-h] [--version] COMMAND ...

Herramienta CLI para gestionar dependencias de servicios.

options:
  -h, --help          muestra este mensaje de ayuda y termina
  --version           muestra el número de versión del programa y termina

commands:
  up                  Inicia un servicio y sus dependencias
  down                Detiene un servicio y sus dependencias
  list-dependencies   Lista las dependencias de un servicio
  list-services (ls)  Lista los servicios instalados localmente
  status              Ver estado de un servicio
  logs                Ver logs de un servicio
  update              Actualizar devservices a la última versión
  purge               Purgar la caché local de devservices
  toggle              Alternar cómo se ejecuta un servicio
  foreground          Traer a primer plano un proceso en segundo plano para depuración
  serve               Iniciar el devserver
```


<div id="installation">
  ## Instalación
</div>

Las instrucciones de instalación están disponibles [aquí](https://github.com/getsentry/devservices?tab=readme-ov-file#installation).

<div id="viewing-logs-for-a-service">
  ## Ver registros de un servicio
</div>

```shell
devservices logs
```


<div id="running-cli-clients-for-redis-postgres-and-clickhouse">
  ## Ejecutar clientes de la CLI para Redis, Postgres y ClickHouse
</div>

```shell
# redis
docker exec -it redis-redis-1 redis-cli

# clickhouse
docker exec -it snuba-clickhouse-1 clickhouse-client

# psql
docker exec -it sentry-postgres-1 psql -U postgres
```


<div id="removing-container-state">
  ## Eliminar el estado del contenedor
</div>

Si de verdad has dejado hechos un lío tus contenedores o volúmenes, puedes usar `devservices purge` para empezar de cero.

```shell
# Eliminar todos los datos (contenedores, volúmenes y redes) asociados con TODOS los servicios
devservices purge
```

Como ejemplo, supongamos que hemos corrompido nuestra base de datos de Postgres
mientras trabajábamos en una migración y quieres restablecer
tus datos de Postgres; puedes hacer lo siguiente:

```shell
# Elimina todos los datos (contenedores, volúmenes y redes) asociados a un único servicio
docker container rm sentry-postgres-1
docker volume rm sentry_postgres-data
```


<div id="running-devservices-with-a-specific-mode">
  ## Ejecutar devservices con un modo específico
</div>

Modos comunes en Sentry:

* `default`: Inicia las dependencias de Sentry y Relay
* `migrations`: Inicia Postgres y Redis
* `minimal`: Inicia servicios mínimos para desarrollo local
* `full`: Inicia todos los servicios (ingest, symbolicator, taskbroker, snuba, vroom, etc.)
* `taskbroker`: Inicia las dependencias de Sentry y Taskbroker
* `taskworker`: Inicia las dependencias de Sentry, Taskbroker, Taskworker y Taskworker-scheduler
* `memcached`: Inicia las dependencias de Sentry y Memcached

Modos para escenarios específicos de desarrollo:

* `chartcuterie`: Inicia las dependencias de Sentry y Chartcuterie
* `crons`: Inicia las dependencias de Sentry y los consumidores de monitor
* `launchpad`: Inicia las dependencias de Sentry y Launchpad
* `objectstore`: Inicia las dependencias de Sentry y Objectstore
* `profiling`: Inicia las dependencias de Sentry, Vroom y los consumidores de profiling
* `replay`: Inicia las dependencias de Sentry y Replay
* `symbolicator`: Inicia las dependencias de Sentry y Symbolicator
* `tracing`: Inicia las dependencias de Sentry y todo lo necesario para transacciones, spans y métricas

Específico de ingest:

* `ingest`: Inicia las dependencias más comunes de Sentry para admitir la ingesta de errores, transacciones y adjuntos
* `ingest-all`: Inicia las dependencias de Sentry para admitir la ingesta de todo

Específico de CI:

* `acceptance-ci`: Inicia las dependencias de Sentry y todo lo necesario para CI de aceptación
* `backend-ci`: Inicia las dependencias de Sentry y todo lo necesario para CI de backend

```shell
devservices up --mode symbolicator
```


<div id="debugging-a-background-process-interactively">
  ## Depuración interactiva de un proceso en segundo plano
</div>

Hay varios grupos de procesos que se ejecutan en segundo plano. Entre ellos están los consumidores de ingesta, los reenviadores de posprocesamiento y los taskworkers. Si no puedes hacerlo con el propio devserver, usa el comando devservices foreground para depurarlos de forma interactiva.

1. Inicia tu entorno de desarrollo:

```sh
devservices up --mode taskbroker
devservices serve
```

2. Añade un punto de interrupción

```python
def example () -> None
  ...
  breakpoint() // A partir de Python 3.7
  import pdb; pdb.set_trace() // Antes de Python 3.7
  ...
```

3. Lleva un proceso a primer plano para depurarlo

```sh
devservices foreground taskworker
```


<div id="running-a-dependency-locally">
  ## Ejecutar una dependencia de forma local
</div>

Puedes ejecutar una dependencia en tu máquina en lugar de en un contenedor cambiando su tiempo de ejecución con el comando `devservices toggle`.

<div id="toggle-to-local-runtime">
  ### Cambiar al entorno de ejecución local
</div>

Por ejemplo, si estás ejecutando Sentry y quieres ejecutar Snuba **localmente** desde el código fuente, puedes cambiar Snuba al entorno de ejecución local así:

```shell
devservices toggle snuba
```

o puedes especificar el tiempo de ejecución explícitamente:

```shell
devservices toggle snuba local
```

Esto le indica a devservices que trate Snuba como un servicio que debe iniciarse junto con servicios de los que depende, como Sentry. Las dependencias de Snuba, como Redis, Kafka y ClickHouse, seguirán ejecutándose como contenedores.

<Alert title="Nota">
  Cambiar a `local` no inicia el servidor de desarrollo de ese servicio. Tendrás que iniciarlo manualmente.
</Alert>


<div id="what-happens-when-you-toggle">
  ### Qué sucede al alternar
</div>

Si Sentry ya se está ejecutando, alternar Snuba a `local` hará lo siguiente:

1. Detener los contenedores de Snuba (a menos que los comparta otro servicio)
2. Iniciar las dependencias no locales de Snuba (Redis, Kafka, ClickHouse) como contenedores

Si Sentry aún no se está ejecutando, la próxima vez que se ejecute `devservices up`, Snuba (y cualquier otro servicio que alternes a `local`) se iniciará automáticamente como servicio local junto con Sentry.

Si quieres iniciar Snuba u otras dependencias locales de tiempo de ejecución en un modo no predeterminado, puedes:

1. Indicar a devservices que no las inicie automáticamente pasando la opción `--exclude-local` a `devservices up`.
2. Iniciar ese modo manualmente con `devservices up --mode <mode>` ya que los modos son aditivos.
3. Detener ese servicio y volver a iniciarlo con el nuevo modo.

<div id="bringing-down-services-with-local-runtimes">
  ### Detener servicios con runtimes locales
</div>

Al detener servicios con `devservices down`, el comportamiento predeterminado es detener todos los servicios y sus dependencias, incluidas las dependencias con runtimes locales.

Si no quieres que las dependencias con runtimes locales se detengan al bajar un servicio que depende de ellas, puedes pasar la opción `--exclude-local` a `devservices down`. Esto le indica a devservices que solo detenga las dependencias que no se estén ejecutando con runtimes locales.

<div id="toggle-back-to-containerized-runtime">
  ### Volver al entorno en contenedor
</div>

Para hacer que un servicio vuelva a ejecutarse en un contenedor, puedes hacer lo siguiente:

```shell
devservices toggle snuba
```

O especifica explícitamente el tiempo de ejecución:

```shell
devservices toggle snuba CONTAINERIZED
```

Reemplaza `snuba` por el nombre del servicio que quieres activar o desactivar.


<div id="migrating-data-from-the-deprecated-sentry-devservices">
  ## Migrar datos desde el `sentry devservices` en desuso
</div>

<Alert level="warning" title="Importante">
  Estas instrucciones pueden provocar pérdida de datos. Procede con precaución. Este es un ejemplo con Postgres, pero también puede aplicarse a otros volúmenes de Docker.
</Alert>

Los nombres de los volúmenes varían según el servicio.

Clickhouse:

* anterior: `sentry_clickhouse`
  * nuevo: `snuba_clickhouse-data`

Postgres:

* anterior: `sentry_postgres`
  * nuevo: `sentry_postgres-data`

Kafka:

* anterior: `sentry_kafka`
  * nuevo: `kafka_kafka-data`

Redis:

* anterior: `sentry_redis`
  * nuevo: `redis_redis-data`

```shell
# Crear un nuevo volumen de postgres
docker volume create sentry_postgres-data

# Copiar los datos del volumen anterior
docker run --rm \
  -v sentry_postgres:/old_volume \
  -v sentry_postgres-data:/new_volume \
  ubuntu \
  bash -c "cd /old_volume && cp -a . /new_volume"

# Validar que los datos se hayan copiado
docker run --rm -v sentry_postgres-data:/data ubuntu ls -l /data
```
