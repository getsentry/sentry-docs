---
title: Metrics
description: Counter, gauge, and distribution metrics sent as batched trace_metric envelope items.
spec_id: sdk/telemetry/metrics
spec_version: 2.5.0
spec_status: stable
spec_depends_on:
  - id: sdk/foundations/transport/envelopes
    version: ">=1.0.0"
  - id: sdk/foundations/state-management/scopes/attributes
    version: ">=1.0.0"
spec_changelog:
  - version: 2.5.0
    date: 2026-02-12
    summary: Clarified sendDefaultPii gating for user attributes — allowed when user manually sets data
  - version: 2.4.1
    date: 2026-01-19
    summary: Fixed example — replaced unsupported set type with gauge
  - version: 2.4.0
    date: 2026-01-14
    summary: SDKs MUST NOT restrict unit values, SHOULD offer constants for supported units
  - version: 2.3.1
    date: 2026-01-09
    summary: Fixed Swift API examples (syntax correction)
  - version: 2.3.0
    date: 2025-12-15
    summary: Added span_id field, added replay association (sentry.replay_id, sentry._internal.replay_is_buffering)
  - version: 2.2.0
    date: 2025-11-19
    summary: Tightened buffering from SHOULD to MUST, added telemetry buffer forwarding scenarios
  - version: 2.1.0
    date: 2025-11-17
    summary: Added backend SDK default attributes (server.address)
  - version: 2.0.0
    date: 2025-11-13
    summary: Breaking — new trace_metric JSON envelope format, attribute system replacing tags
  - version: 1.0.0
    date: 2023-12-07
    summary: Initial metrics spec (statsd-based format, now superseded)
---

<SpecRfcAlert />

<SpecMeta />

## Overview

This spec defines the format used by Sentry to ingest metrics, as well as the SDK API and behavior that create and send metrics to Sentry. Metrics are sent as `trace_metric` envelope items containing JSON-encoded payloads.

<Alert title="Note" level="info">

The envelope item type is named `trace_metric` for internal usage to avoid naming collisions with other metric systems within Sentry's infrastructure. From an SDK perspective, these are simply referred to as "metrics".

</Alert>

Related specs:
- [Envelopes](/sdk/foundations/transport/envelopes/) — transport format
- [Attributes](/sdk/foundations/state-management/scopes/attributes) — attribute types and structure
- [Tracing without Performance](/sdk/telemetry/traces/tracing-without-performance/) — required before adding metrics support
- [Telemetry Processor](/sdk/foundations/processing/telemetry-processor/) — buffer data forwarding scenarios

---

## Concepts

### Metric Types

A metric has a `type` that determines how its values are interpreted:

- **Counter** — tracks the number of times an event occurs. Only increases. Useful for requests, errors, or any countable event.
- **Gauge** — tracks a value that can arbitrarily increase or decrease over time, such as memory usage, queue depth, or connection pool size.
- **Distribution** — tracks the statistical distribution of a set of values. Useful for understanding percentiles, averages, and other statistical properties of measurements like response times or file sizes.

### Attributes

Metrics carry typed key-value pairs called **attributes** for dimensional filtering and grouping. Each attribute declares its type (`string`, `boolean`, `integer`, `double`). See [Attributes](/sdk/foundations/state-management/scopes/attributes/) for the full type specification.

### Batching

Multiple metrics are batched into a single `trace_metric` envelope item for efficient transport. SDKs buffer metrics locally and flush them periodically or when size thresholds are reached.

---

## Behavior

<Alert title="Note" level="warning">

An SDK **SHOULD** implement [Tracing without Performance](/sdk/telemetry/traces/tracing-without-performance/) before adding support for metrics. This is required to ensure that metrics are associated with traces and that the correct trace context is sent to Sentry.

</Alert>

### Processing Pipeline

<SpecSection id="processing-pipeline" status="stable" since="2.0.0">

Metric processing **MUST** follow this order:

1. Capture metric via [Public APIs](#metrics-module) (e.g. `Sentry.metrics.count`).
2. Check if metrics are disabled as per `enableMetrics`/`enable_metrics` configuration — if so, skip the rest of the steps.
3. Pass the metric to Hub/Scope, which **MUST** offer the same methods as the static API `Sentry.metrics.X`. This is useful for power users who want to use multiple Hubs/Scopes.
4. Pass the metric to the Client, via a generic method that accepts the metric object and the `scope`, such as `captureMetric(metric, scope)`.
5. Process captured metric (attach default attributes as per [Default Attributes](#default-attributes)).
6. Run `beforeSendMetric`/`before_send_metric` to filter or modify the metric.
7. Add metric to buffer/batch processor as detailed in [Buffering](#buffering).
8. At time of flushing buffer, send array of metrics to Sentry via `trace_metric` envelope, apply rate limiting as per [Data Category and Rate Limiting](#data-category-and-rate-limiting).

</SpecSection>

### Default Attributes

<SpecSection id="default-attributes" status="stable" since="2.0.0">

SDKs **MUST** attach the following attributes to every metric by default:

1. `sentry.environment` — the environment set in the SDK, if defined.
2. `sentry.release` — the release set in the SDK, if defined.
3. `sentry.sdk.name` — the name of the SDK that sent the metric.
4. `sentry.sdk.version` — the version of the SDK that sent the metric.

SDKs **SHOULD** minimize the number of default attributes. Metrics cardinality can explode quickly with too many attributes. New default attributes **SHOULD** only be added after significant feedback from users and discussion internally with the SDK and ingest teams.

</SpecSection>

### User Attributes

<SpecSection id="user-attributes" status="stable" since="2.0.0">

SDKs **MAY** attach user information as attributes, guarded by `sendDefaultPii` ([unless manually set by user](/sdk/expected-features/data-handling/#sensitive-data), since 2.5.0):

1. `user.id` — the user ID. Maps to `id` in the [User](/sdk/foundations/transport/event-payloads/user/) payload.
2. `user.name` — the username. Maps to `username` in the [User](/sdk/foundations/transport/event-payloads/user/) payload.
3. `user.email` — the email address. Maps to `email` in the [User](/sdk/foundations/transport/event-payloads/user/) payload.

</SpecSection>

### Browser Attributes (Relay)

<SpecSection id="browser-attributes" status="stable" since="2.0.0">

By default, Relay parses the user agent attached to an incoming metric envelope to extract `browser` and `os` information. These attributes are attached by Relay, but client-side SDKs **MAY** attach them if they do not forward a user agent when sending metrics to Sentry.

1. `browser.name` — display name of the browser application. Maps to `name` in the [Browser Context](/sdk/foundations/transport/event-payloads/contexts/#browser-context).
2. `browser.version` — version string of the browser. Maps to `version` in the [Browser Context](/sdk/foundations/transport/event-payloads/contexts/#browser-context).

</SpecSection>

### Backend SDK Attributes

<SpecSection id="backend-attributes" status="stable" since="2.1.0">

Backend SDKs (Node.js, Python, PHP, etc.) **SHOULD** attach the following attribute:

1. `server.address` — the address of the server that sent the metric. Equivalent to [`server_name`](/sdk/foundations/transport/event-payloads/#optional-attributes) attached to errors and transactions.

</SpecSection>

### Buffering

<SpecSection id="buffering" status="stable" since="2.0.0">

SDKs **MUST** buffer metrics before sending them (since 2.2.0, tightened from SHOULD). SDKs **SHOULD** flush the buffer when specific conditions are met. For initial implementation, a simple strategy is fine, for example: flushing if the buffer length exceeds 100 items or if 5 seconds have passed.

To prevent data loss, the buffer **SHOULD** forward metrics to the transport in the scenarios outlined in the [telemetry buffer data forwarding scenarios](/sdk/foundations/processing/telemetry-processor/#data-forwarding-scenarios) (since 2.2.0).

Furthermore:
- The aggregation window **SHOULD** be time and size based.
- SDKs **SHOULD** implement safeguards to prevent excessive memory usage from metric buffering.

</SpecSection>

### Tracing Association

<SpecSection id="tracing-association" status="stable" since="2.0.0">

Metrics **SHOULD** be associated with traces if possible. If a metric is recorded during an active span, the SDK **SHOULD** set the `span_id` property of the metric to the span ID of the span that was active when the metric was collected.

The `trace_id` field is **REQUIRED** on every metric payload and **MUST** be taken from the current propagation context.

</SpecSection>

### Replay Association

<SpecSection id="replay-association" status="stable" since="2.3.0">

Whenever possible, metrics **SHOULD** be linked to replays. If a metric is recorded while an active, sampled replay is in progress, the SDK **SHOULD** attach:

1. `sentry.replay_id` — the ID of the replay that was active when the metric was collected. This **MUST NOT** be set if there was no active replay.
2. `sentry._internal.replay_is_buffering` — indicates that the metric is associated with a replay that is currently buffering. This ensures correct handling of scenarios where a `replay_id` is present but the corresponding replay was never actually sent.

</SpecSection>

### Data Category and Rate Limiting

<SpecSection id="data-category-rate-limiting" status="stable" since="2.0.0">

The data category for metrics is `trace_metric`. Rate limiting applies as usual. SDKs **SHOULD** track client outcomes to monitor how often metrics are dropped. If the SDK receives a rate limit, it **MUST NOT** send any trace metrics until the limit expires (based on the communicated end timestamp).

</SpecSection>

### Debug Logging

<SpecSection id="debug-logging" status="stable" since="2.0.0">

If `debug` is set to `true` in SDK init, calls to the Sentry metrics API **SHOULD** also print to the console with appropriate details. This will help debugging metrics setups.

</SpecSection>

---

## Wire Format

### `trace_metric` Envelope Item

<SpecSection id="trace-metric-envelope" status="stable" since="2.0.0">

Metrics are sent as a `trace_metric` envelope item containing a JSON object with an `items` array. See the [Examples](#full-trace_metric-envelope) section for a complete envelope.

An envelope **MUST** contain at most one `trace_metric` envelope item — all metrics for a flush are batched into a single item's `items` array. Metrics from different traces **MAY** be mixed into the same `trace_metric` item, but if they are, the envelope **MUST NOT** include a DSC (dynamic sampling context) header.

**Item Headers:**

| Field | Type | Required | Description |
|-------|------|----------|-------------|
| `type` | String | **REQUIRED** | **MUST** be `"trace_metric"`. |
| `item_count` | Number | **REQUIRED** | Number of metric items in the `items` array. **MUST** match the actual count. |
| `content_type` | String | **REQUIRED** | **MUST** be `"application/vnd.sentry.items.trace-metric+json"`. |

```json
{
	"type": "trace_metric",
	"item_count": 10,
	"content_type": "application/vnd.sentry.items.trace-metric+json"
}
{
	"items": [{..metric..}, {..metric..}, {..metric..}]
}
```

</SpecSection>

### Metric Payload

<SpecSection id="metric-payload" status="stable" since="2.0.0">

Each metric in the `items` array is a JSON object with the following fields:

```json
{
  "timestamp": 1544719860.0,
  "trace_id": "5b8efff798038103d269b633813fc60c",
  "span_id": "b0e6f15b45c36b12",
  "name": "api.response_time",
  "value": 125.5,
  "unit": "millisecond",
  "type": "distribution",
  "attributes": {
    "endpoint": { "value": "api/users", "type": "string" },
    "method": { "value": "GET", "type": "string" },
    "status_code": { "value": 200, "type": "integer" }
  }
}
```

| Field | Type | Required | Since | Description |
|-------|------|----------|-------|-------------|
| `timestamp` | Number | **REQUIRED** | 2.0.0 | Timestamp in seconds (epoch time) indicating when the metric was recorded. |
| `type` | String | **REQUIRED** | 2.0.0 | The type of metric. One of `counter`, `gauge`, `distribution`. |
| `name` | String | **REQUIRED** | 2.0.0 | The name of the metric. **SHOULD** follow a hierarchical naming convention using dots as separators (e.g., `api.response_time`, `db.query.duration`). |
| `value` | Number | **REQUIRED** | 2.0.0 | The numeric value. For `counter`: the count to increment by (default 1). For `gauge`: the current value. For `distribution`: a single measured value. Integers **MUST** be 64-bit signed; doubles **MUST** be 64-bit floating point. |
| `trace_id` | String | **REQUIRED** | 2.0.0 | 16 random bytes encoded as a hex string (32 characters). Taken from the current propagation context. |
| `span_id` | String | **OPTIONAL** | 2.3.0 | 8 random bytes encoded as a hex string (16 characters). The span ID of the span that was active when the metric was emitted. |
| `unit` | String | **OPTIONAL** | 2.0.0 | The unit of measurement for the metric value. |
| `attributes` | Object | **OPTIONAL** | 2.0.0 | Typed key-value pairs. See [Attributes](/sdk/foundations/state-management/scopes/attributes/) for supported types and structure. |

</SpecSection>

---

## Public API

### Initialization Options

<SpecSection id="initialization-options" status="stable" since="2.0.0">

SDKs **MUST** expose the following configuration options:

- `enableMetrics`/`enable_metrics` — a boolean flag to control if metric envelopes will be generated and sent to Sentry. If `false`, the SDK **MUST NOT** send metrics. Defaults to `true`.

- `beforeSendMetric`/`before_send_metric` — an **OPTIONAL** function that takes a metric object and returns a metric object. Called before sending the metric to Sentry. Can be used to modify the metric or prevent it from being sent (by returning `null`/`None`).

While metrics functionality is in an experimental state, SDKs **SHOULD** put these options in an experimental namespace to avoid breaking changes:

```
Sentry.init({
  // stable
  enableMetrics: true,

  // experimental
  _experiments: { enableMetrics: true },
})
```

</SpecSection>

### Metrics Module

<SpecSection id="metrics-module" status="stable" since="2.0.0">

SDKs **MUST** expose metrics methods in a `metrics` module or namespace. At minimum, the SDK **MUST** implement the following methods:

- `Sentry.metrics.count(name, value, options)` — increment a counter
- `Sentry.metrics.gauge(name, value, options)` — set a gauge value
- `Sentry.metrics.distribution(name, value, options)` — add a distribution value

**Parameters:**

- `name` **String, required** — the name of the metric.
- `value` **Number, required** — the value of the metric.
- `options` **Object, optional** — containing:
  - `unit` **String, optional** — the unit of measurement (only used for `distribution` and `gauge`). SDKs **MUST NOT** restrict what can be sent in (e.g. by using an enum) but **SHOULD** offer constants or similar that help customers send in <Link to="/sdk/foundations/state-management/scopes/attributes/#units">units we support</Link> (since 2.4.0).
  - `attributes` **Object, optional** — a dictionary of attributes (key-value pairs with type information).
  - `scope` **Scope, optional** — the scope to capture the metric with.

The Hub/Scope **MUST** offer the same methods as the static API `Sentry.metrics.X`, which is useful for power users who want to use multiple Hubs/Scopes. The Client **SHOULD** only offer one generic method that accepts the metric object and the Scope, such as `captureMetric(metric, scope)`.

</SpecSection>

### Threading and Concurrency Considerations

The threading and concurrency considerations for metrics are the same as for logs. See the [Threading and Concurrency Considerations section in the Logs documentation](/sdk/telemetry/logs/#threading-and-concurrency-considerations) for more information.

---

## Examples

### Counter metric

```json
{
  "name": "api.requests",
  "value": 1,
  "type": "counter",
  "attributes": {
    "endpoint": { "value": "/api/users", "type": "string" },
    "method": { "value": "POST", "type": "string" }
  }
}
```

### Gauge metric

```json
{
  "name": "db.connection_pool.active",
  "value": 42,
  "unit": "connection",
  "type": "gauge",
  "attributes": {
    "pool_name": { "value": "main_db", "type": "string" },
    "max_size": { "value": 100, "type": "integer" },
    "database": { "value": "postgres", "type": "string" }
  }
}
```

### Distribution metric

```json
{
  "name": "page.load_time",
  "value": 245.7,
  "unit": "millisecond",
  "type": "distribution",
  "attributes": {
    "page": { "value": "/dashboard", "type": "string" },
    "browser": { "value": "chrome", "type": "string" }
  }
}
```

### SDK API usage

```javascript
// Increment a counter
Sentry.metrics.count("button.clicks", 1, {
  attributes: {
    button_id: "submit",
    page: "checkout",
  },
});

// Set a gauge value
Sentry.metrics.gauge("db.connection_pool.active", 42, {
  unit: "connection",
  attributes: {
    pool_name: "main_db",
    database: "postgres",
  },
});

// Record a distribution
Sentry.metrics.distribution("page.load_time", 245.7, {
  unit: "millisecond",
  attributes: {
    page: "/dashboard",
    browser: "chrome",
  },
});
```
```python
# Increment a counter
Sentry.metrics.count(
  'button.clicks',
  1,
  attributes={'button_id': 'submit', 'page': 'checkout'},
)

# Set a gauge value
Sentry.metrics.gauge(
  'db.connection_pool.active',
  42,
  unit='connection',
  attributes={'pool_name': 'main_db', 'database': 'postgres'},
)

# Record a distribution
Sentry.metrics.distribution(
  'page.load_time',
  245.7,
  unit='millisecond',
  attributes={'page': '/dashboard', 'browser': 'chrome'},
)
```
```php
use function Sentry\metrics;

metrics()->count('button.clicks', 1, [
  'attributes' => ['button_id' => 'submit', 'page' => 'checkout']
]);

metrics()->gauge('db.connection_pool.active', 42, [
  'unit' => 'connection',
  'attributes' => ['pool_name' => 'main_db', 'database' => 'postgres']
]);

metrics()->distribution('page.load_time', 245.7, [
  'unit' => 'millisecond',
  'attributes' => ['page' => '/dashboard', 'browser' => 'chrome']
]);
```
```java
import io.sentry.Sentry;

Sentry.metrics().count("button.clicks", 1,
  Map.of("attributes", Map.of("button_id", "submit", "page", "checkout"))
);

Sentry.metrics().gauge("db.connection_pool.active", 42,
  Map.of(
    "unit", "connection",
    "attributes", Map.of("pool_name", "main_db", "database", "postgres")
  )
);

Sentry.metrics().distribution("page.load_time", 245.7,
  Map.of(
    "unit", "millisecond",
    "attributes", Map.of("page", "/dashboard", "browser", "chrome")
  )
);
```
```swift
SentrySDK.metrics()
  .count(
    name: "button.clicks",
    value: 1,
    attributes: ["button_id": "submit", "page": "checkout"]
  )

SentrySDK.metrics()
  .gauge(
    name: "db.connection_pool.active",
    value: 42,
    unit: "connection",
    attributes: ["pool_name": "main_db", "database": "postgres"]
  )

SentrySDK.metrics()
  .distribution(
    name: "page.load_time",
    value: 245.7,
    unit: "millisecond",
    attributes: ["page": "/dashboard", "browser": "chrome"]
  )
```

### Default attributes example

```json
{
  "attributes": {
    "sentry.environment": { "value": "production", "type": "string" },
    "sentry.release": { "value": "1.0.0", "type": "string" },
    "sentry.sdk.name": {
      "value": "sentry.javascript.browser",
      "type": "string"
    },
    "sentry.sdk.version": { "value": "10.17.0", "type": "string" },
    "sentry.replay_id": {
      "value": "36b75d9fa11f45459412a96c41bdf691",
      "type": "string"
    }
  }
}
```

### User attributes example

```json
{
  "attributes": {
    "user.id": { "value": "123", "type": "string" },
    "user.name": { "value": "john.doe", "type": "string" },
    "user.email": { "value": "john.doe@example.com", "type": "string" }
  }
}
```

### Full `trace_metric` envelope

```json
{ "sdk": { "name": "sentry.javascript.browser", "version": "10.17.0" } }
{
  "type": "trace_metric",
  "item_count": 5,
  "content_type": "application/vnd.sentry.items.trace-metric+json"
}
{
  "items": [
    {
      "timestamp": 1746456149.019,
      "trace_id": "624f66e93a04469f9992c7e9f1485056",
      "span_id": "b0e6f15b45c36b12",
      "name": "api.requests",
      "value": 1,
      "type": "counter",
      "attributes": {
        "endpoint": { "value": "/api/users", "type": "string" },
        "method": { "value": "POST", "type": "string" },
        "status_code": { "value": 201, "type": "integer" },
        "sentry.sdk.name": { "value": "sentry.javascript.browser", "type": "string" },
        "sentry.sdk.version": { "value": "10.17.0", "type": "string" },
        "sentry.environment": { "value": "production", "type": "string" },
        "sentry.release": { "value": "1.0.0", "type": "string" }
      }
    },
    {
      "timestamp": 1746456149.019,
      "trace_id": "624f66e93a04469f9992c7e9f1485056",
      "span_id": "b0e6f15b45c36b12",
      "name": "api.response_time",
      "value": 125.5,
      "unit": "millisecond",
      "type": "distribution",
      "attributes": {
        "endpoint": { "value": "/api/users", "type": "string" },
        "method": { "value": "POST", "type": "string" },
        "sentry.sdk.name": { "value": "sentry.javascript.browser", "type": "string" },
        "sentry.sdk.version": { "value": "10.17.0", "type": "string" }
      }
    },
    {
      "timestamp": 1746456149.02,
      "trace_id": "624f66e93a04469f9992c7e9f1485056",
      "span_id": "b0e6f15b45c36b12",
      "name": "cache.hit_rate",
      "value": 0.95,
      "unit": "ratio",
      "type": "gauge",
      "attributes": {
        "cache_name": { "value": "user_sessions", "type": "string" },
        "region": { "value": "us-west-1", "type": "string" },
        "sentry.sdk.name": { "value": "sentry.javascript.browser", "type": "string" },
        "sentry.sdk.version": { "value": "10.17.0", "type": "string" }
      }
    },
    {
      "timestamp": 1746456149.02,
      "trace_id": "624f66e93a04469f9992c7e9f1485056",
      "span_id": "b0e6f15b45c36b12",
      "name": "database.query.duration",
      "value": 42.3,
      "unit": "millisecond",
      "type": "distribution",
      "attributes": {
        "query_type": { "value": "SELECT", "type": "string" },
        "table": { "value": "users", "type": "string" },
        "sentry.sdk.name": { "value": "sentry.javascript.browser", "type": "string" },
        "sentry.sdk.version": { "value": "10.17.0", "type": "string" },
        "sentry.origin": { "value": "auto.db.graphql", "type": "string" }
      }
    },
    {
      "timestamp": 1746456149.021,
      "trace_id": "624f66e93a04469f9992c7e9f1485056",
      "span_id": "b0e6f15b45c36b12",
      "name": "active.users",
      "value": 12345,
      "type": "gauge",
      "attributes": {
        "cohort": { "value": "beta", "type": "string" },
        "sentry.sdk.name": { "value": "sentry.javascript.browser", "type": "string" },
        "sentry.sdk.version": { "value": "10.17.0", "type": "string" },
        "sentry.replay_id": { "value": "36b75d9fa11f45459412a96c41bdf691", "type": "string" }
      }
    }
  ]
}
```

### Related Resources

- [Experimental JS SDK PR #17883 - Metrics API Implementation](https://github.com/getsentry/sentry-javascript/pull/17883/files)
- [Experimental Python SDK PR #4898 - Metrics API Implementation](https://github.com/getsentry/sentry-python/pull/4898)
- [Batch Processor Specification](/sdk/foundations/processing/batch-processor/)

---

## Changelog

<SpecChangelog />
