#!/bin/bash
# usage: bin/server
#
# Run the jekyll server

set -e

green="\033[0;32m"
reset="\033[0;m"

echo -e "❓  ${green}Would you like to run Sentry Docs in incremental build mode? [Y/n]${reset}"
read -t 7
REPLY=${REPLY:-y}

if [[ $REPLY =~ ^[Yy]$ ]]; then
  echo "👍  The first build will take a while, but the rest will be faster."
  echo ""
  incremental="--incremental "
else
  echo "👍  Ok, running in normal build mode"
fi

export RIGIDSEARCH_SERVER=${RIGIDSEARCH_SERVER:-"http://127.0.0.1:5001/"}

rm -rf _site
rm -rf .jekyll-cache

yarn
(bundle check || bundle install)

./bin/webpack-watch & ./bin/jekyll-watch
