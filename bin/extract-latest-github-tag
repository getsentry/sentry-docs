#!/usr/bin/env python

import sys
import os
import json
import urllib2
import re
import fileinput

def replaceAll(file, searchExp, replaceExp):
    for line in fileinput.input(file, inplace=1):
        if searchExp in line:
            line = line.replace(searchExp,replaceExp)
        sys.stdout.write(line)

url = sys.argv[1]

req = urllib2.Request(url)
req.add_header('Accept', 'application/json')
req.add_header("Content-type", 'application/x-www-form-urlencoded')

res = urllib2.urlopen(req)
data = json.loads(res.read())

file = sys.argv[2]

replaceAll(file, "#LATEST_GITHUB_TAG#", data['tag_name'])

print "Found and wrote tag: " + data['tag_name']