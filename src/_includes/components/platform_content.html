{%- assign __uniq = include.content | jsonify | md5 -%}
{%- assign __default = include.content | first -%}
{%- assign __valid_platforms = site.Array -%}
{%- assign __invalid_platforms = site.Array -%}
{%- for __proposed in include.content -%}
{% comment %}
We need to ensure the platforms match the approved list of platforms so we can
utilize their tokens across sites.
{% endcomment %}
  {%- assign __platform_object = site.data.platforms
    | where: 'name', __proposed[0]
    | first
  -%}
  {% if __platform_object %}
  {%- assign __valid_platforms = __valid_platforms | push: __proposed -%}
  {%- else -%}
  {%- assign __invalid_platforms = __invalid_platforms | push: __proposed[0] -%}
  {%- endif -%}
{%- endfor -%}

{%- if jekyll.environment == 'development' -%}
  {% comment %}
  This warning only appears in development mode.
  {% endcomment %}
  {%- assign __platforms = include.content %}
  {%- if __invalid_platforms.size > 0 -%}
  <div class="alert alert-danger">
    <h5>Invalid platforms included</h5>
    <div class="alert-body content-flush-bottom">
      <p>
        The following platform names do not exist in <em>_data/platforms.yml</em> will not appear in production:
        {%- for __name in __invalid_platforms -%}
          <code>{{ __name }}</code>
        {%- endfor -%}
      </p>
    </div>
  </div>
  {%- endif -%}
{%- else -%}
  {%- assign __platforms = __valid_platforms-%}
{%- endif -%}

<div class="platform-specific-content" data-platform-specific-content>
  <div class="nav pb-1 flex">
    <div class="dropdown mr-2 mb-1">
      <a class="btn btn-sm btn-secondary dropdown-toggle" href="#" role="button" id="{{ __uniq }}-dropdown" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
        {{ __default[0] }}
      </a>

      <div class="nav dropdown-menu" id="{{ __uniq }}-tab" role="tablist" aria-hidden="true">
        {%- assign category = '' -%}
        {%- for __example in __platforms -%}
          {%- if __default[0] == __example[0] -%}
          {% assign __is_default = true %}
          {%- else -%}
          {% assign __is_default = false %}
          {%- endif -%}
          {%- if __example[0] contains '/' -%}
          {%- assign split = __example[0] | split: '/' -%}
          {%- if split[0] != category -%}
          <div class="dropdown-header">{{ split[0] }}</div>
          {%- endif -%}
          {%- assign category = split[0] -%}
          {%- assign __name = split[1] -%}
          {%- assign __slug = __example[0] | slugify -%}
          <a class="dropdown-item{% if __is_default %} active{% endif %} sub" id="{{ __uniq }}-{{ __slug }}-tab" data-platform="{{ __slug }}" data-toggle="platform" href="#{{ __uniq }}-{{ __slug }}" role="tab" aria-controls="{{ __uniq }}-{{ __slug }}" aria-selected="{% if __is_default %}true{% else %}false{% endif %}">{{ __name }}</a>
          {%- else -%}
          {%- assign __name = __example[0] -%}
          {%- assign __slug = __name | slugify -%}
          <a class="dropdown-item{% if __is_default %} active{% endif %}" id="{{ __uniq }}-{{ __slug }}-tab" data-platform="{{ __slug }}" data-toggle="platform" href="#{{ __uniq }}-{{ __slug }}" role="tab" aria-controls="{{ __uniq }}-{{ __slug }}" aria-selected="{% if __is_default %}true{% else %}false{% endif %}">{{ __name }}</a>
          {%- endif -%}
        {%- endfor -%}
      </div>
    </div>
  </div>

  <div class="tab-content" id="{{ __uniq }}-tabContent">
  {%- for __example in __platforms -%}
    {%- assign __slug = __example[0] | slugify -%}
    {%- if __default[0] == __example[0] -%}
    {% assign __is_default = true %}
    {%- else -%}
    {% assign __is_default = false %}
    {%- endif -%}
    {%- assign __content = __example[1] -%}
    <div class="tab-pane{% if __is_default %} show active{% endif %}" id="{{ __uniq }}-{{ __slug }}" role="tabpanel" aria-labelledby="{{ __uniq }}-{{ __slug }}-tab">
      {{ __content | liquify | markdownify }}
    </div>
  {%- endfor -%}
  </div>
</div>
