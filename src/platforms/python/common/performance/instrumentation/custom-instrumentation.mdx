---
title: Custom Instrumentation
sidebar_order: 20
description: "Learn how to capture performance data on any action in your app."
---

<Note>

This is just a THOUGHT experiment and should not be merged!

</Note>

The Sentry SDK for Python does a very good job of auto instrumenting your application. If you use one of the popular frameworks, we've got you covered because everything is instrumented out of the box. The Sentry SDK will check your installed Python packages and auto enable the matching SDK integrations.


## Creating Spans

```python
import sentry_sdk

def do_work():
    with sentry_sdk.start_span(op="function", name="my-span-name"):
        # do some work that 'span' will track
        print("doing some work...")
        # When the 'with' block goes out of scope, 'span' is finished for you
```

## Creacting Nested Spans

If you have a distinct sub-operation you’d like to track as a part of another one, you can create spans to represent the relationship:

```python
import sentry_sdk

def do_work():
    with sentry_sdk.start_span(name="parent") as parent:
        # do some work that 'parent' tracks
        print("doing some work...")
        # Create a nested span to track nested work
        with sentry_sdk.start_span(name="child") as child:
            # do some work that 'child' tracks
            print("doing some nested work...")
            # the nested span is closed when it's out of scope

        # This span is also closed when it goes out of scope
```


## Creating Spans with Decorators

It’s common to have a single span track the execution of an entire function. In that scenario, there is a decorator you can use to reduce code:

```python
import sentry_sdk

@sentry_sdk.start_span
def do_work():
    print("doing some work...")

```

Use of the decorator is equivalent to creating the span inside do_work() and ending it when do_work() is finished.

The function name will be used as the spans name.


## Creating Spans That Need Manual Finishing

Sometimes you do not want to use context managers, and do want to finish spans on your own. You can do this:

```python
import sentry_sdk


parent_span = sentry_sdk.start_span(name="parent")
do_work_parent()

child_span = sentry_sdk.start_span(name="child")
do_work_child()

child_span.finish()
parent_span.finish()

```

If you want to create independend spans that are not in a parent/child relation ship a as above you can create them like this:

```python
import sentry_sdk


span1 = sentry_sdk.start_span(name="step1", independent=True)

step1()

span2 = sentry_sdk.start_span(name="step1", independent=True)

step2()

span3 = sentry_sdk.start_span(name="step1", independent=True)

step3()

span1.finish()
span2.finish()
span3.finish()
```

Now there will be no child relation between the spans, they will be siblings in the span tree.


## Accessing the Current Span

Sometimes it’s helpful to access whatever the current span is at a point in time so that you can enrich it with more information.

```python
import sentry_sdk

current_span = sentry_sdk.get_current_span()
# enrich 'current_span' with some information
```

## Add Data to a Span

You can add additional data to a span so it carries more information about the current operation that it’s tracking.

```python
import sentry_sdk

current_span = sentry_sdk.get_current_span()

if current_span is not None:
    current_span.set_data("operation.value", 1)
    current_span.set_data("operation.name", "Saying hello!")
    current_span.set_data("operation.other-stuff", [1, 2, 3])
```
