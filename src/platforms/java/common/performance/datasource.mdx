---
title: DataSource Instrumentation
description: "Learn how to instrument javax.sql.DataSource"
---

<Note>

This is a preview API, available in `4.4.0-alpha.2`. Features available in a preview API are still in-progress and may have bugs. We recognize the irony. The API may be renamed, changed, or removed in a future version.

</Note>

Sentry provides integration with [P6Spy](https://github.com/p6spy/p6spy) and [DataSource Proxy](https://github.com/ttddyy/datasource-proxy) to intercept *JDBC* database queries and create spans around them.

## P6Spy

To start using the *Sentry P6Spy* integration, include the following dependency in your project:

```xml {tabTitle:Maven}
<dependency>
    <groupId>io.sentry</groupId>
    <artifactId>sentry-p6spy</artifactId>
    <version>{{ packages.version('sentry.java.spring-boot', '4.4.0') }}</version>
</dependency>
```

```groovy {tabTitle:Gradle}
implementation 'io.sentry:sentry-p6spy:{{ packages.version('sentry.java.spring-boot', '4.4.0') }}'
```

To create spans around database queries, `P6DataSource` must be configured to use `SentryJdbcEventListener`:

```java
import javax.sql.DataSource;
import io.sentry.p6spy.SentryJdbcEventListener;
import com.p6spy.engine.spy.P6DataSource;

DataSource dataSource = // original datasource
P6DataSource proxyDataSource = new P6DataSource(dataSource);
proxyDataSource.setJdbcEventListenerFactory(SentryJdbcEventListener::new);
```

```kotlin
import io.sentry.p6spy.SentryJdbcEventListener
import com.p6spy.engine.spy.P6DataSource

val dataSource = // original datasource
val proxyDataSource = P6DataSource(dataSource)
proxyDataSource.setJdbcEventListenerFactory { SentryJdbcEventListener() }
```

*Sentry P6Spy* integration creates spans only if JDBC query runs within a Sentry transaction.

## DataSource Proxy

To start using *Sentry DataSource Proxy* integration, include following dependency in your project:

```xml {tabTitle:Maven}
<dependency>
    <groupId>io.sentry</groupId>
    <artifactId>sentry-datasource-proxy</artifactId>
    <version>{{ packages.version('sentry.java.spring-boot', '4.4.0') }}</version>
</dependency>
```

```groovy {tabTitle:Gradle}
implementation 'io.sentry:sentry-datasource-proxy:{{ packages.version('sentry.java.spring-boot', '4.4.0') }}'
```

To create spans around database queries, `ProxyDataSource` must be configured to use `SentryQueryExecutionListener`:

```java
import javax.sql.DataSource;
import io.sentry.dsproxy.SentryQueryExecutionListener;
import net.ttddyy.dsproxy.support.ProxyDataSource;
import net.ttddyy.dsproxy.support.ProxyDataSourceBuilder;

DataSource dataSource = // original datasource
ProxyDataSource proxyDataSource = ProxyDataSourceBuilder.create(dataSource)
  .listener(new SentryQueryExecutionListener())
  .build();
```

```kotlin
import io.sentry.dsproxy.SentryQueryExecutionListener
import net.ttddyy.dsproxy.support.ProxyDataSource
import net.ttddyy.dsproxy.support.ProxyDataSourceBuilder

val dataSource = // original datasource
val proxyDataSource = ProxyDataSourceBuilder.create(dataSource)
  .listener(SentryQueryExecutionListener())
  .build()
```

*Sentry DataSource Proxy* integration creates spans only if JDBC query runs within a Sentry transaction.

## Using with Spring Boot

Spring Boot, out of the box, does not provide datasource proxying capabilities. We recommend using either the *Sentry P6Spy* or *Sentry DataSource Proxy* integration with a third party library [Spring Boot DataSource Decorator](https://github.com/gavlyukovskiy/spring-boot-data-source-decorator). *Sentry Spring Boot Starter* provides auto-configuration classes, creating `SentryJdbcEventListener` and `SentryQueryExecutionListener` beans when respective integrations are on the class path.
