---
title: ASP.NET
description: "Learn about Sentry's .NET integration with ASP.NET."
---

Sentry provides an integration with _ASP.NET_ through the [Sentry.AspNet NuGet package](https://www.nuget.org/packages/Sentry.AspNet).

## Install

Add the Sentry dependency:

```powershell {tabTitle:Package Manager}
Install-Package Sentry.AspNet
```

```shell {tabTitle:.NET Core CLI}
dotnet add package Sentry.AspNet
```

You can combine this integration with a logging library like `log4net`, `NLog` or `Serilog` to include both request data
as well as your logs as breadcrumbs. The logging integrations also capture events when an error is logged.

### Configuring

You configure the SDK in the `Global.asax.cs`:

```csharp
using Sentry;
using Sentry.AspNet;

public class MvcApplication : System.Web.HttpApplication
{
    private IDisposable _sentry;

    protected void Application_Start()
    {
        _sentry = SentrySdk.Init(o =>
        {
            o.AddAspNet();
            o.Dsn = "___PUBLIC_DSN___";
        });
    }

    protected void Application_Error()
    {
        var exception = Server.GetLastError();
        SentrySdk.CaptureException(exception);
    }

    protected void Application_End()
    {
        _sentry?.Dispose();
    }
}
```

To make use of Sentry's <PlatformLink to="/performance/">performance feature</PlatformLink>, add additional handlers for `BeginRequest` and `EndRequest` events:

```csharp
using Sentry;

public class MvcApplication : System.Web.HttpApplication
{
    private IDisposable _sentry;

    protected void Application_Start()
    {
        // ...
    }

    protected void Application_Error()
    {
        // ...
    }

    protected void Application_End()
    {
        // ...
    }

    protected void Application_BeginRequest()
    {
        // Start a transaction that encompasses the current request
        var transaction = Context.StartSentryTransaction();

        // Attach transaction to the request context to finish it when the request ends
        Context.Items["__SentryTransaction"] = transaction;
    }

    protected void Application_EndRequest()
    {
        // Finish the currently active transaction
        if (Context.Items.Contains("__SentryTransaction"))
        {
            var transaction = Context.Items["__SentryTransaction"] as ISpan;

            var status =
                Context.Response.StatusCode < 400 ? SpanStatus.Ok :
                Context.Response.StatusCode == 400 ? SpanStatus.InvalidArgument :
                Context.Response.StatusCode == 401 ? SpanStatus.Unauthenticated :
                Context.Response.StatusCode == 403 ? SpanStatus.PermissionDenied :
                Context.Response.StatusCode == 404 ? SpanStatus.NotFound :
                Context.Response.StatusCode == 409 ? SpanStatus.AlreadyExists :
                Context.Response.StatusCode == 429 ? SpanStatus.ResourceExhausted :
                Context.Response.StatusCode == 499 ? SpanStatus.Cancelled :
                Context.Response.StatusCode < 500 ? SpanStatus.InvalidArgument :
                Context.Response.StatusCode == 500 ? SpanStatus.InternalError :
                Context.Response.StatusCode == 501 ? SpanStatus.Unimplemented :
                Context.Response.StatusCode == 503 ? SpanStatus.Unavailable :
                Context.Response.StatusCode == 504 ? SpanStatus.DeadlineExceeded :
                Context.Response.StatusCode < 600 ? SpanStatus.InternalError :
                SpanStatus.UnknownError;

            transaction?.Finish(status);
        }
    }
}
```

### Capturing the affected user

When opting-in to [SendDefaultPii](#senddefaultpii), the SDK will automatically read the user from the request by inspecting `HttpContext.User`. Default claim values like `NameIdentifier` for the _Id_ will be used.

If you wish to change the behavior of how to read the user from the request, you can register a new `IUserFactory` into the container:

```csharp
SentrySdk.Init(o =>
{
  o.AddAspNet();
  o.UserFactory = new MyUserFactory();
}
```

### SendDefaultPii

Although this setting is part of the [Sentry](/platforms/dotnet/) package, in the context of ASP.NET Core, it means reporting the user by reading the frameworks `HttpContext.User`. The strategy to create the `SentryUser` can be customized.

### IncludeRequestPayload

It's helpful to troubleshoot a problem in the API when the payload that hit the endpoint is logged.
Opt-in to send the request body to Sentry:

```csharp
SentrySdk.Init(o =>
{
  o.AddAspNet(RequestSize.Always);
  o.MaxRequestBodySize = RequestSize.Always;
}
```

### Proxy server

Often your server can only access the Internet through a proxy server.
If that's the case, make sure your proxy server is listed in the `web.config` so the `HttpClient`
used by Sentry's SDK can pick it up.

```xml
<system.net>
    <defaultProxy>
      <proxy proxyaddress="http://proxy.address.here" bypassonlocal="true" />
    </defaultProxy>
</system.net>
```

### TLS 1.2 Support and Windows Server

If you're not able to capture events from ASP.NET to Sentry,
on older versions of Windows Server, with older .NET Framework you must enable TLS 1.2.

```
ServicePointManager.SecurityProtocol = SecurityProtocolType.Tls12
```

- A [sample with ASP.NET and EF 6](https://github.com/getsentry/sentry-dotnet-samples/tree/master/AspNetMvc5Ef6).
- [More samples](https://github.com/getsentry/sentry-dotnet-samples) of the .NET SDKs
