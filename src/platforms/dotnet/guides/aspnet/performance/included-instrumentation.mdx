---
title: Included Instrumentation
sidebar_order: 20
description: "Learn what transactions are captured after tracing is enabled."
---

<Note>

Capturing transactions requires that you first <PlatformLink to="/performance/">set up performance monitoring</PlatformLink> if you haven't already. You'll also need to enable the <PlatformLink to="/">base Sentry integration</PlatformLink>.

</Note>

ASP.NET integration, once enabled, captures each incoming HTTP request and turns it into a transaction with the help of a custom middleware. To enable tracing on ASP.NET, you need to update your `Global.asax.cs` file like this:

```csharp
using System;
using System.Configuration;
using System.Web.Mvc;
using System.Web.Routing;
using Sentry;
using Sentry.AspNet;

namespace AspNetMvc
{
    public class MvcApplication : System.Web.HttpApplication
    {
        private IDisposable _sentry;

        protected void Application_Start()
        {
            // Set up the sentry SDK
            _sentry = SentrySdk.Init(o =>
            {
                // We store the DSN inside Web.config; make sure to use your own DSN!
                o.Dsn = ConfigurationManager.AppSettings["SentryDsn"];

                // Get ASP.NET integration
                o.AddAspNet();

                // Collect 100% traces for testing purposes
                // (consider using a smaller value when running in production)
                o.TracesSampleRate = 1.0;
            });
        }

        // Global error catcher
        protected void Application_Error()
        {
            var exception = Server.GetLastError();

            // Capture unhandled exceptions
            SentrySdk.CaptureException(exception);
        }

        protected void Application_End()
        {
            // Close the Sentry SDK (flushes queued events to Sentry)
            _sentry?.Dispose();
        }

        protected void Application_BeginRequest()
        {
            // Start a transaction that encompasses the current request
            var transaction = Context.StartSentryTransaction();

            // Attach transaction to the request context to finish it when the request ends
            Context.Items["__SentryTransaction"] = transaction;
        }

        protected void Application_EndRequest()
        {
            // Finish the currently active transaction
            if (Context.Items.Contains("__SentryTransaction"))
            {
                var transaction = Context.Items["__SentryTransaction"] as ISpan;

                var status =
                    Context.Response.StatusCode < 400 ? SpanStatus.Ok :
                    Context.Response.StatusCode == 400 ? SpanStatus.InvalidArgument :
                    Context.Response.StatusCode == 401 ? SpanStatus.Unauthenticated :
                    Context.Response.StatusCode == 403 ? SpanStatus.PermissionDenied :
                    Context.Response.StatusCode == 404 ? SpanStatus.NotFound :
                    Context.Response.StatusCode == 409 ? SpanStatus.AlreadyExists :
                    Context.Response.StatusCode == 429 ? SpanStatus.ResourceExhausted :
                    Context.Response.StatusCode == 499 ? SpanStatus.Cancelled :
                    Context.Response.StatusCode < 500 ? SpanStatus.InvalidArgument :
                    Context.Response.StatusCode == 500 ? SpanStatus.InternalError :
                    Context.Response.StatusCode == 501 ? SpanStatus.Unimplemented :
                    Context.Response.StatusCode == 503 ? SpanStatus.Unavailable :
                    Context.Response.StatusCode == 504 ? SpanStatus.DeadlineExceeded :
                    Context.Response.StatusCode < 600 ? SpanStatus.InternalError :
                    SpanStatus.UnknownError;

                transaction?.Finish(status);
            }
        }
    }
}
```

Transaction names follow the pattern `<HTTP method> <Route>`; for example, a request to the following action will create a transaction named `GET /person/{id}`:

```csharp
using System;
using System.Web.Mvc;

public class HomeController : Controller
{
    [HttpGet("/person/{id}")]
    public ActionResult Person(string id) { /* ... */ }
}
```

Transactions created by this integration are automatically added to the current scope. If you want to start your own spans from the automatically created transaction, you can use the following approach:

```csharp
using System;
using System.Web.Mvc;
using Sentry;

public class HomeController : Controller
{
    [HttpGet("/person/{id}")]
    public ActionResult Person(string id)
    {
        var childSpan = SentrySdk.GetSpan()?.StartChild("additional-work");
        try
        {
            // Do the work that gets measured.

            childSpan?.Finish(SpanStatus.Ok);
        }
        catch (Exception e)
        {
            childSpan?.Finish(e);
            throw;
        }
    }
}
```
