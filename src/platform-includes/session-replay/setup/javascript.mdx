```javascript
// import Sentry from your framework SDK (e.g. @sentry/react) instead of @sentry/browser
import * as Sentry from "@sentry/browser";

Sentry.init({
  dsn: "___PUBLIC_DSN___",

  // This sets the sample rate to be 10%. You may want this to be 100% while
  // in development and sample at a lower rate in production
  replaysSessionSampleRate: 0.1,

  // If the entire session is not sampled, use the below sample rate to sample
  // sessions when an error occurs.
  replaysOnErrorSampleRate: 1.0,

  integrations: [
    Sentry.replayIntegration({
      // Additional SDK configuration goes in here, for example:
      maskAllText: true,
      blockAllMedia: true,
    }),
  ],
});
```

With the settings above, session replays with errors are always captured.
You can verify this by adding the following snippet anywhere in your code and running it:

```javascript
setTimeout(() => {
  throw new Error("Sentry Test Error");
});
```

### Lazy-loading Replay

Once you've added the integration, Replay will start automatically. If you don't want to start it immediately (lazy-load it), you can use `addIntegration`:

```javascript
Sentry.init({
  // Note, Replay is NOT instantiated below:
  integrations: [],
});

// Sometime later
const { Replay } = await import("@sentry/browser");
Sentry.addIntegration(replayIntegration());
```

### Canvas Recording

<Alert level="warning">
  There is currently no PII scrubbing in canvas recordings!
</Alert>

<Alert level="">
  Canvas recording is in beta and currently only available to <a href="/product/accounts/early-adopter-features/">early adopters</a>
</Alert>

In order to record HTML canvas elements, you will need to add an additional integration in your Sentry configuration. The canvas integration is exported from the browser SDK, so no additional package is required. Canvas recording is opt-in and will be tree-shaken from your bundle if it is not used:

```js
// import Sentry from your framework SDK (e.g. @sentry/react) instead of @sentry/browser
import * as Sentry from "@sentry/browser";

Sentry.init({
  dsn: "___PUBLIC_DSN___",
  replaysSessionSampleRate: 0.1,
  replaysOnErrorSampleRate: 1.0,

  integrations: [
    // Keep the Replay integration as before
    new Sentry.Replay(),

    // The following is all you need to enable canvas recording with Replay
    new Sentry.ReplayCanvas(),
  ],
});
```

#### Canvas Recording Performance

The canvas recording integration works by exporting the canvas as an image (at a rate of 2 frames per second). However, in order to export images from 3D and WebGL canvases, the integration needs to enable `preserveDrawingBuffer` which can negatively affect canvas performance. If your canvas application is impacted by enabling `preserveDrawingBuffer`, then you will need to enable manual snapshotting and call a `snapshot()` method inside of your re-paint loop. There are two things you must do in order to use manual snapshotting: first you must enable it when initializing the `ReplayCanvas` integration:

```js
new Sentry.ReplayCanvas({
  // Enabling the following will ensure your canvas elements are not forced
  // into `preserveDrawingBuffer`.
  enableManualSnapshot: true,
});
```

Next, you need to call the the following `snapshot()` method inside of your application's paint loop. `snapshot()` needs to be called in the same execution loop as the canvas draw commands, otherwise you may be snapshotting empty canvas buffers. This is due to how WebGL works when `preserveDrawingBuffer` is `false`.

```js
function paint() {
  const canvasRef = document.querySelector("#my-canvas");
  Sentry.getClient().getIntegrationByName("ReplayCanvas").snapshot(canvasRef);
}
```
